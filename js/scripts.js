(function e(t,r,n){var i=function(){return this}();function a(e,n){if(r[e])return r[e].exports;if(t[e])return o(e,a);throw new Error('cannot find module "'+e+'"')}function o(i,a){var o=r[i]={exports:{}};var s=t[i];var u=s[2];var l=s[0];l.call(o.exports,function(e){var r=t[i][1][e];return a(r?r:e)},o,o.exports,e,t,r,n);if(u)r[u]=r[i];return r[i].exports}for(var s in n){if(n[s]){i[n[s]]=a(s)}else{a(s)}}a.duo=true;a.cache=r;a.modules=t;return a})({1:[function(e,t,r){"use strict";var n=e("component/emitter");var i=e("component/bind");t.exports=a;function a(e){if(!(this instanceof a))return new a(e);this.configure(e);this.billingAgreementId=null;this.consent=undefined;this.widgets={};this._status=this.status();this.setBillingAgreementId=i(this,this.setBillingAgreementId);this.initWallet=i(this,this.initWallet);this.initConsent=i(this,this.initConsent);this.setConsent=i(this,this.setConsent);this.error=i(this,this.error);this.init=i(this,this.init);if("window.OffAmazonPayments"in window){this.init()}else{document.write('<script src="'+"https://static-na.payments-amazon.com/OffAmazonPayments/us"+(this.config.production?"":"/sandbox")+"/js/Widgets.js?sellerId="+this.config.sellerId+'"></script>');window.onAmazonLoginReady=this.init}return this}n(a.prototype);a.prototype.version="1.0.3";a.prototype.configure=function(e){if(typeof e!=="object")throw new Error("opts must be provided as an object.");if(!e.sellerId)throw new Error("opts.sellerId is required.");if(!e.clientId)throw new Error("opts.clientId is required.");if(!e.button)throw new Error("opts.button is required.");if(!e.wallet)throw new Error("opts.wallet is required.");if(!e.consent)throw new Error("opts.consent is required.");if(typeof e.button==="string")e.button={id:e.button};if(typeof e.wallet==="string")e.wallet={id:e.wallet};if(typeof e.consent==="string")e.consent={id:e.consent};if(typeof e.addressBook==="string")e.addressBook={id:e.addressBook};e.button.type=e.button.type==="small"?"Pay":"PwA";e.button.color=e.button.color||"Gold";if(e.wallet.width||e.wallet.height){e.wallet.dimensions={width:o(e.wallet.width||400),height:o(e.wallet.height||260)}}if(e.consent.width||e.consent.height){e.consent.dimensions={width:o(e.consent.width||400),height:o(e.consent.height||140)}}if(e.addressBook&&(e.addressBook.width||e.addressBook.height)){e.addressBook.dimensions={width:o(e.addressBook.width||400),height:o(e.addressBook.height||260)}}e.production=typeof e.production==="boolean"?e.production:false;e.openedClass=e.openedClass||"open";this.config=e};a.prototype.init=function(){window.amazon.Login.setClientId(this.config.clientId);var e=this;var t=setInterval(r,200);function r(){if(!window.OffAmazonPayments.Button)return;clearTimeout(t);e.initButton()}};a.prototype.status=function(){var e=this.billingAgreementId;var t=this.consent;var r={};if(!e){r.error="Billing agreement ID has not been set."}if(t!==undefined){r.consent=t}if(t===undefined){r.error="Billing consent not yet given."}else if(!t){r.error="Billing consent not given."}if(!r.error){r.id=e}return r};a.prototype.check=function(){var e=this.status();if(JSON.stringify(e)!==JSON.stringify(this._status)){this._status=e;this.emit("change",e)}};a.prototype.initButton=function(){var e=this;var t=this.config.button.type;var r=this.config.button.color;this.widgets.button=new window.OffAmazonPayments.Button(this.config.button.id,this.config.sellerId,{type:t,color:r,authorization:function(){var t={scope:"profile payments:widget payments:shipping_address",popup:true};window.amazon.Login.authorize(t,function(t){if(t.error)return e.error(t.error);e.emit("login");e.initAddressBook()})},onError:this.error})};a.prototype.initAddressBook=function(){var e=this;if(!this.config.addressBook)return this.initWallet();var t={agreementType:"BillingAgreement",sellerId:this.config.sellerId,onReady:function(t){e.emit("ready.addressBook");e.setBillingAgreementId(t)},onAddressSelect:this.initWallet,design:s(this.config.addressBook),onError:this.error};this.widgets.addressBook=new window.OffAmazonPayments.Widgets.AddressBook(t);this.widgets.addressBook.bind(this.config.addressBook.id);this.opened(this.config.addressBook.id)};a.prototype.initWallet=function(){var e=this;var t={amazonBillingAgreementId:this.billingAgreementId,sellerId:this.config.sellerId,design:s(this.config.wallet),onReady:function(t){e.emit("ready.wallet");if(!e.billingAgreementId){e.setBillingAgreementId(t)}},onPaymentSelect:function(){e.initConsent();e.check()},onError:this.error};if(!this.billingAgreementId){t.agreementType="BillingAgreement"}this.widgets.wallet=new window.OffAmazonPayments.Widgets.Wallet(t);this.widgets.wallet.bind(this.config.wallet.id);this.opened(this.config.wallet.id)};a.prototype.initConsent=function(){var e=this;var t={amazonBillingAgreementId:this.billingAgreementId,sellerId:this.config.sellerId,design:s(this.config.consent),onReady:function(t){e.emit("ready.consent");e.setConsent(t)},onConsent:this.setConsent,onError:this.error};this.widgets.consent=new window.OffAmazonPayments.Widgets.Consent(t);this.widgets.consent.bind(this.config.consent.id);this.opened(this.config.consent.id)};a.prototype.setBillingAgreementId=function(e){this.billingAgreementId=e.getAmazonBillingAgreementId();this.check()};a.prototype.setConsent=function(e){if(typeof e.getConsentStatus==="undefined")return;this.consent=e.getConsentStatus()==="true";this.check()};a.prototype.opened=function(e){var t=document.getElementById(e);if(t)t.className=t.className+" "+this.config.openedClass};a.prototype.error=function(e){var t={code:e.getErrorCode(),message:e.getErrorMessage()};if(console){if(Error.captureStackTrace){Error.captureStackTrace(t,this.error)}console.error(t)}this.emit("error",t)};function o(e){e=e+"";return e+(isNaN(parseInt(e.charAt(e.length-1),10))?"":"px")}function s(e){if(e.dimensions){return{size:e.dimensions}}else{return{designMode:"responsive"}}}},{"component/emitter":2,"component/bind":3}],2:[function(e,t,r){t.exports=n;function n(e){if(e)return i(e)}function i(e){for(var t in n.prototype){e[t]=n.prototype[t]}return e}n.prototype.on=n.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks[e]=this._callbacks[e]||[]).push(t);return this};n.prototype.once=function(e,t){var r=this;this._callbacks=this._callbacks||{};function n(){r.off(e,n);t.apply(this,arguments)}n.fn=t;this.on(e,n);return this};n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var r=this._callbacks[e];if(!r)return this;if(1==arguments.length){delete this._callbacks[e];return this}var n;for(var i=0;i<r.length;i++){n=r[i];if(n===t||n.fn===t){r.splice(i,1);break}}return this};n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n){r[n].apply(this,t)}}return this};n.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks[e]||[]};n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],3:[function(e,t,r){var n=[].slice;t.exports=function(e,t){if("string"==typeof t)t=e[t];if("function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},{}]},{},{1:"PayWithAmazon"});(function(e){"use strict";var t=e.Base64;var r="2.1.9";var n;if(typeof module!=="undefined"&&module.exports){try{n=require("buffer").Buffer}catch(i){}}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var o=function(e){var t={};for(var r=0,n=e.length;r<n;r++)t[e.charAt(r)]=r;return t}(a);var s=String.fromCharCode;var u=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?s(192|t>>>6)+s(128|t&63):s(224|t>>>12&15)+s(128|t>>>6&63)+s(128|t&63)}else{var t=65536+(e.charCodeAt(0)-55296)*1024+(e.charCodeAt(1)-56320);return s(240|t>>>18&7)+s(128|t>>>12&63)+s(128|t>>>6&63)+s(128|t&63)}};var l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var c=function(e){return e.replace(l,u)};var p=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),n=[a.charAt(r>>>18),a.charAt(r>>>12&63),t>=2?"=":a.charAt(r>>>6&63),t>=1?"=":a.charAt(r&63)];return n.join("")};var d=e.btoa?function(t){return e.btoa(t)}:function(e){return e.replace(/[\s\S]{1,3}/g,p)};var f=n?function(e){return(e.constructor===n.constructor?e:new n(e)).toString("base64")}:function(e){return d(c(e))};var h=function(e,t){return!t?f(String(e)):f(String(e)).replace(/[+\/]/g,function(e){return e=="+"?"-":"_"}).replace(/=/g,"")};var m=function(e){return h(e,true)};var g=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g");var v=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return s((r>>>10)+55296)+s((r&1023)+56320);case 3:return s((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return s((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}};var b=function(e){return e.replace(g,v)};var y=function(e){var t=e.length,r=t%4,n=(t>0?o[e.charAt(0)]<<18:0)|(t>1?o[e.charAt(1)]<<12:0)|(t>2?o[e.charAt(2)]<<6:0)|(t>3?o[e.charAt(3)]:0),i=[s(n>>>16),s(n>>>8&255),s(n&255)];i.length-=[0,0,2,1][r];return i.join("")};var w=e.atob?function(t){return e.atob(t)}:function(e){return e.replace(/[\s\S]{1,4}/g,y)};var C=n?function(e){return(e.constructor===n.constructor?e:new n(e,"base64")).toString()}:function(e){return b(w(e))};var S=function(e){return C(String(e).replace(/[-_]/g,function(e){return e=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};var x=function(){var r=e.Base64;e.Base64=t;return r};e.Base64={VERSION:r,atob:w,btoa:d,fromBase64:S,toBase64:h,utob:c,encode:h,encodeURI:m,btou:b,decode:S,noConflict:x};if(typeof Object.defineProperty==="function"){var A=function(e){return{value:e,enumerable:false,writable:true,configurable:true}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",A(function(){return S(this)}));Object.defineProperty(String.prototype,"toBase64",A(function(e){return h(this,e)}));Object.defineProperty(String.prototype,"toBase64URI",A(function(){return h(this,true)}))}}if(e["Meteor"]){Base64=e.Base64}})(this);!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.html2canvas=e()}}(function(){var e;return function t(e,r,n){function i(o,s){if(!r[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};e[o][0].call(c.exports,function(t){var r=e[o][1][t];return i(r?r:t)},c,c.exports,t,e,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,r,n){(function(t){!function(i){function a(e){throw RangeError(R[e])}function o(e,t){for(var r=e.length;r--;)e[r]=t(e[r]);return e}function s(e,t){return o(e.split(L),t).join(".")}function u(e){for(var t,r,n=[],i=0,a=e.length;a>i;)t=e.charCodeAt(i++),t>=55296&&56319>=t&&a>i?(r=e.charCodeAt(i++),56320==(64512&r)?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--)):n.push(t);return n}function l(e){return o(e,function(e){var t="";return e>65535&&(e-=65536,t+=F(e>>>10&1023|55296),e=56320|1023&e),t+=F(e)}).join("")}function c(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:x}function p(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function d(e,t,r){var n=0;for(e=r?U(e/E):e>>1,e+=U(e/t);e>N*T>>1;n+=x)e=U(e/N);return U(n+(N+1)*e/(e+I))}function f(e){var t,r,n,i,o,s,u,p,f,h,m=[],g=e.length,v=0,b=k,y=P;for(r=e.lastIndexOf(M),0>r&&(r=0),n=0;r>n;++n)e.charCodeAt(n)>=128&&a("not-basic"),m.push(e.charCodeAt(n));for(i=r>0?r+1:0;g>i;){for(o=v,s=1,u=x;i>=g&&a("invalid-input"),p=c(e.charCodeAt(i++)),(p>=x||p>U((S-v)/s))&&a("overflow"),v+=p*s,f=y>=u?A:u>=y+T?T:u-y,!(f>p);u+=x)h=x-f,s>U(S/h)&&a("overflow"),s*=h;t=m.length+1,y=d(v-o,t,0==o),U(v/t)>S-b&&a("overflow"),b+=U(v/t),v%=t,m.splice(v++,0,b)}return l(m)}function h(e){var t,r,n,i,o,s,l,c,f,h,m,g,v,b,y,w=[];for(e=u(e),g=e.length,t=k,r=0,o=P,s=0;g>s;++s)m=e[s],128>m&&w.push(F(m));for(n=i=w.length,i&&w.push(M);g>n;){for(l=S,s=0;g>s;++s)m=e[s],m>=t&&l>m&&(l=m);for(v=n+1,l-t>U((S-r)/v)&&a("overflow"),r+=(l-t)*v,t=l,s=0;g>s;++s)if(m=e[s],t>m&&++r>S&&a("overflow"),m==t){for(c=r,f=x;h=o>=f?A:f>=o+T?T:f-o,!(h>c);f+=x)y=c-h,b=x-h,w.push(F(p(h+y%b,0))),c=U(y/b);w.push(F(p(c,0))),o=d(r,v,n==i),r=0,++n}++r,++t}return w.join("")}function m(e){return s(e,function(e){return $.test(e)?f(e.slice(4).toLowerCase()):e})}function g(e){return s(e,function(e){return D.test(e)?"xn--"+h(e):e})}var v="object"==typeof n&&n,b="object"==typeof r&&r&&r.exports==v&&r,y="object"==typeof t&&t;(y.global===y||y.window===y)&&(i=y);var w,C,S=2147483647,x=36,A=1,T=26,I=38,E=700,P=72,k=128,M="-",$=/^xn--/,D=/[^ -~]/,L=/\x2E|\u3002|\uFF0E|\uFF61/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=x-A,U=Math.floor,F=String.fromCharCode;if(w={version:"1.2.4",ucs2:{decode:u,encode:l},decode:f,encode:h,toASCII:g,toUnicode:m},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return w});else if(v&&!v.nodeType)if(b)b.exports=w;else for(C in w)w.hasOwnProperty(C)&&(v[C]=w[C]);else i.punycode=w}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t){function r(e,t,r){!e.defaultView||t===e.defaultView.pageXOffset&&r===e.defaultView.pageYOffset||e.defaultView.scrollTo(t,r)}function n(e,t){try{t&&(t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e.getContext("2d").getImageData(0,0,e.width,e.height),0,0))}catch(r){o("Unable to copy canvas content from",e,r)}}function i(e,t){for(var r=3===e.nodeType?document.createTextNode(e.nodeValue):e.cloneNode(!1),a=e.firstChild;a;)(t===!0||1!==a.nodeType||"SCRIPT"!==a.nodeName)&&r.appendChild(i(a,t)),a=a.nextSibling;return 1===e.nodeType&&(r._scrollTop=e.scrollTop,r._scrollLeft=e.scrollLeft,"CANVAS"===e.nodeName?n(e,r):("TEXTAREA"===e.nodeName||"SELECT"===e.nodeName)&&(r.value=e.value)),r}function a(e){if(1===e.nodeType){e.scrollTop=e._scrollTop,e.scrollLeft=e._scrollLeft;for(var t=e.firstChild;t;)a(t),t=t.nextSibling}}var o=e("./log");t.exports=function(e,t,n,o,s,u,l){var c=i(e.documentElement,s.javascriptEnabled),p=t.createElement("iframe");return p.className="html2canvas-container",p.style.visibility="hidden",p.style.position="fixed",p.style.left="-10000px",p.style.top="0px",p.style.border="0",p.width=n,p.height=o,p.scrolling="no",t.body.appendChild(p),new Promise(function(t){var n=p.contentWindow.document;p.contentWindow.onload=p.onload=function(){var e=setInterval(function(){n.body.childNodes.length>0&&(a(n.documentElement),clearInterval(e),"view"===s.type&&(p.contentWindow.scrollTo(u,l),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||p.contentWindow.scrollY===l&&p.contentWindow.scrollX===u||(n.documentElement.style.top=-l+"px",n.documentElement.style.left=-u+"px",n.documentElement.style.position="absolute")),t(p))},50)},n.open(),n.write("<!DOCTYPE html><html></html>"),r(e,u,l),n.replaceChild(n.adoptNode(c),n.documentElement),n.close()})}},{"./log":13}],3:[function(e,t){function r(e){this.r=0,this.g=0,this.b=0,this.a=null;this.fromArray(e)||this.namedColor(e)||this.rgb(e)||this.rgba(e)||this.hex6(e)||this.hex3(e)}r.prototype.darken=function(e){var t=1-e;return new r([Math.round(this.r*t),Math.round(this.g*t),Math.round(this.b*t),this.a])},r.prototype.isTransparent=function(){return 0===this.a},r.prototype.isBlack=function(){return 0===this.r&&0===this.g&&0===this.b},r.prototype.fromArray=function(e){return Array.isArray(e)&&(this.r=Math.min(e[0],255),this.g=Math.min(e[1],255),this.b=Math.min(e[2],255),e.length>3&&(this.a=e[3])),Array.isArray(e)};var n=/^#([a-f0-9]{3})$/i;r.prototype.hex3=function(e){var t=null;return null!==(t=e.match(n))&&(this.r=parseInt(t[1][0]+t[1][0],16),this.g=parseInt(t[1][1]+t[1][1],16),this.b=parseInt(t[1][2]+t[1][2],16)),null!==t};var i=/^#([a-f0-9]{6})$/i;r.prototype.hex6=function(e){var t=null;return null!==(t=e.match(i))&&(this.r=parseInt(t[1].substring(0,2),16),this.g=parseInt(t[1].substring(2,4),16),this.b=parseInt(t[1].substring(4,6),16)),null!==t};var a=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/;r.prototype.rgb=function(e){var t=null;return null!==(t=e.match(a))&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3])),null!==t};var o=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/;r.prototype.rgba=function(e){var t=null;return null!==(t=e.match(o))&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3]),this.a=Number(t[4])),null!==t},r.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join(",")+")":"rgb("+[this.r,this.g,this.b].join(",")+")"},r.prototype.namedColor=function(e){e=e.toLowerCase();var t=s[e];if(t)this.r=t[0],this.g=t[1],this.b=t[2];else if("transparent"===e)return this.r=this.g=this.b=this.a=0,!0;return!!t},r.prototype.isColor=!0;var s={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};t.exports=r},{}],4:[function(t,r){function n(e,t){var r=S++;if(t=t||{},t.logging&&(g.options.logging=!0,g.options.start=Date.now()),t.async="undefined"==typeof t.async?!0:t.async,t.allowTaint="undefined"==typeof t.allowTaint?!1:t.allowTaint,t.removeContainer="undefined"==typeof t.removeContainer?!0:t.removeContainer,t.javascriptEnabled="undefined"==typeof t.javascriptEnabled?!1:t.javascriptEnabled,t.imageTimeout="undefined"==typeof t.imageTimeout?1e4:t.imageTimeout,t.renderer="function"==typeof t.renderer?t.renderer:d,t.strict=!!t.strict,"string"==typeof e){if("string"!=typeof t.proxy)return Promise.reject("Proxy must be used when rendering url");var n=null!=t.width?t.width:window.innerWidth,o=null!=t.height?t.height:window.innerHeight;return y(c(e),t.proxy,document,n,o,t).then(function(e){return a(e.contentWindow.document.documentElement,e,t,n,o)})}var s=(void 0===e?[document.documentElement]:e.length?e:[e])[0];return s.setAttribute(C+r,r),i(s.ownerDocument,t,s.ownerDocument.defaultView.innerWidth,s.ownerDocument.defaultView.innerHeight,r).then(function(e){return"function"==typeof t.onrendered&&(g("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),t.onrendered(e)),e})}function i(e,t,r,n,i){return b(e,e,r,n,t,e.defaultView.pageXOffset,e.defaultView.pageYOffset).then(function(o){g("Document cloned");var s=C+i,u="["+s+"='"+i+"']";e.querySelector(u).removeAttribute(s);var l=o.contentWindow,c=l.document.querySelector(u),p=Promise.resolve("function"==typeof t.onclone?t.onclone(l.document):!0);return p.then(function(){return a(c,o,t,r,n)})})}function a(e,t,r,n,i){var a=t.contentWindow,c=new p(a.document),d=new f(r,c),m=w(e),v="view"===r.type?n:u(a.document),b="view"===r.type?i:l(a.document),y=new r.renderer(v,b,d,r,document),C=new h(e,y,c,d,r);return C.ready.then(function(){g("Finished rendering");var n;return n="view"===r.type?s(y.canvas,{width:y.canvas.width,height:y.canvas.height,top:0,left:0,x:0,y:0}):e===a.document.body||e===a.document.documentElement||null!=r.canvas?y.canvas:s(y.canvas,{width:null!=r.width?r.width:m.width,height:null!=r.height?r.height:m.height,top:m.top,left:m.left,x:0,y:0}),o(t,r),n})}function o(e,t){t.removeContainer&&(e.parentNode.removeChild(e),g("Cleaned up container"))}function s(e,t){var r=document.createElement("canvas"),n=Math.min(e.width-1,Math.max(0,t.left)),i=Math.min(e.width,Math.max(1,t.left+t.width)),a=Math.min(e.height-1,Math.max(0,t.top)),o=Math.min(e.height,Math.max(1,t.top+t.height));r.width=t.width,r.height=t.height;var s=i-n,u=o-a;return g("Cropping canvas at:","left:",t.left,"top:",t.top,"width:",s,"height:",u),g("Resulting crop with width",t.width,"and height",t.height,"with x",n,"and y",a),r.getContext("2d").drawImage(e,n,a,s,u,t.x,t.y,s,u),r}function u(e){return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function l(e){return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function c(e){var t=document.createElement("a");return t.href=e,t.href=t.href,t}var p=t("./support"),d=t("./renderers/canvas"),f=t("./imageloader"),h=t("./nodeparser"),m=t("./nodecontainer"),g=t("./log"),v=t("./utils"),b=t("./clone"),y=t("./proxy").loadUrlDocument,w=v.getBounds,C="data-html2canvas-node",S=0;n.CanvasRenderer=d,n.NodeContainer=m,n.log=g,n.utils=v;var x="undefined"==typeof document||"function"!=typeof Object.create||"function"!=typeof document.createElement("canvas").getContext?function(){return Promise.reject("No canvas support")}:n;r.exports=x,"function"==typeof e&&e.amd&&e("html2canvas",[],function(){return x})},{"./clone":2,"./imageloader":11,"./log":13,"./nodecontainer":14,"./nodeparser":15,"./proxy":16,"./renderers/canvas":20,"./support":22,"./utils":26}],5:[function(e,t){function r(e){if(this.src=e,n("DummyImageContainer for",e),!this.promise||!this.image){n("Initiating DummyImageContainer"),r.prototype.image=new Image;var t=this.image;r.prototype.promise=new Promise(function(e,r){t.onload=e,t.onerror=r,t.src=i(),t.complete===!0&&e(t)})}}var n=e("./log"),i=e("./utils").smallImage;t.exports=r},{"./log":13,"./utils":26}],6:[function(e,t){function r(e,t){var r,i,a=document.createElement("div"),o=document.createElement("img"),s=document.createElement("span"),u="Hidden Text";a.style.visibility="hidden",a.style.fontFamily=e,a.style.fontSize=t,a.style.margin=0,a.style.padding=0,document.body.appendChild(a),o.src=n(),o.width=1,o.height=1,o.style.margin=0,o.style.padding=0,o.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin=0,s.style.padding=0,s.appendChild(document.createTextNode(u)),a.appendChild(s),a.appendChild(o),r=o.offsetTop-s.offsetTop+1,a.removeChild(s),a.appendChild(document.createTextNode(u)),a.style.lineHeight="normal",o.style.verticalAlign="super",i=o.offsetTop-a.offsetTop+1,document.body.removeChild(a),this.baseline=r,this.lineWidth=1,this.middle=i}var n=e("./utils").smallImage;t.exports=r},{"./utils":26}],7:[function(e,t){function r(){this.data={}}var n=e("./font");r.prototype.getMetrics=function(e,t){return void 0===this.data[e+"-"+t]&&(this.data[e+"-"+t]=new n(e,t)),this.data[e+"-"+t]},t.exports=r},{"./font":6}],8:[function(e,t){function r(t,r,n){this.image=null,this.src=t;var a=this,o=i(t);this.promise=(r?new Promise(function(e){"about:blank"===t.contentWindow.document.URL||null==t.contentWindow.document.documentElement?t.contentWindow.onload=t.onload=function(){e(t)}:e(t)}):this.proxyLoad(n.proxy,o,n)).then(function(t){var r=e("./core");return r(t.contentWindow.document.documentElement,{type:"view",width:t.width,height:t.height,proxy:n.proxy,javascriptEnabled:n.javascriptEnabled,removeContainer:n.removeContainer,allowTaint:n.allowTaint,imageTimeout:n.imageTimeout/2})}).then(function(e){return a.image=e})}var n=e("./utils"),i=n.getBounds,a=e("./proxy").loadUrlDocument;r.prototype.proxyLoad=function(e,t,r){var n=this.src;return a(n.src,e,n.ownerDocument,t.width,t.height,r)},t.exports=r},{"./core":4,"./proxy":16,"./utils":26}],9:[function(e,t){function r(e){this.src=e.value,this.colorStops=[],this.type=null,this.x0=.5,this.y0=.5,this.x1=.5,this.y1=.5,this.promise=Promise.resolve(!0)}r.TYPES={LINEAR:1,RADIAL:2},r.REGEXP_COLORSTOP=/^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i,t.exports=r},{}],10:[function(e,t){function r(e,t){this.src=e,this.image=new Image;var r=this;this.tainted=null,this.promise=new Promise(function(n,i){r.image.onload=n,r.image.onerror=i,t&&(r.image.crossOrigin="anonymous"),r.image.src=e,r.image.complete===!0&&n(r.image)})}t.exports=r},{}],11:[function(e,t){function r(e,t){this.link=null,this.options=e,this.support=t,this.origin=this.getOrigin(window.location.href)}var n=e("./log"),i=e("./imagecontainer"),a=e("./dummyimagecontainer"),o=e("./proxyimagecontainer"),s=e("./framecontainer"),u=e("./svgcontainer"),l=e("./svgnodecontainer"),c=e("./lineargradientcontainer"),p=e("./webkitgradientcontainer"),d=e("./utils").bind;r.prototype.findImages=function(e){var t=[];return e.reduce(function(e,t){switch(t.node.nodeName){case"IMG":return e.concat([{args:[t.node.src],method:"url"}]);case"svg":case"IFRAME":return e.concat([{args:[t.node],method:t.node.nodeName}])}return e},[]).forEach(this.addImage(t,this.loadImage),this),t},r.prototype.findBackgroundImage=function(e,t){return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e,this.loadImage),this),e},r.prototype.addImage=function(e,t){return function(r){r.args.forEach(function(i){this.imageExists(e,i)||(e.splice(0,0,t.call(this,r)),n("Added image #"+e.length,"string"==typeof i?i.substring(0,100):i))},this)}},r.prototype.hasImageBackground=function(e){return"none"!==e.method},r.prototype.loadImage=function(e){if("url"===e.method){var t=e.args[0];return!this.isSVG(t)||this.support.svg||this.options.allowTaint?t.match(/data:image\/.*;base64,/i)?new i(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(t)||this.options.allowTaint===!0||this.isSVG(t)?new i(t,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new i(t,!0):this.options.proxy?new o(t,this.options.proxy):new a(t):new u(t)}return"linear-gradient"===e.method?new c(e):"gradient"===e.method?new p(e):"svg"===e.method?new l(e.args[0],this.support.svg):"IFRAME"===e.method?new s(e.args[0],this.isSameOrigin(e.args[0].src),this.options):new a(e)},r.prototype.isSVG=function(e){return"svg"===e.substring(e.length-3).toLowerCase()||u.prototype.isInline(e)},r.prototype.imageExists=function(e,t){return e.some(function(e){return e.src===t})},r.prototype.isSameOrigin=function(e){return this.getOrigin(e)===this.origin},r.prototype.getOrigin=function(e){var t=this.link||(this.link=document.createElement("a"));return t.href=e,t.href=t.href,t.protocol+t.hostname+t.port},r.prototype.getPromise=function(e){return this.timeout(e,this.options.imageTimeout)["catch"](function(){var t=new a(e.src);return t.promise.then(function(t){e.image=t})})},r.prototype.get=function(e){var t=null;return this.images.some(function(r){return(t=r).src===e})?t:null},r.prototype.fetch=function(e){return this.images=e.reduce(d(this.findBackgroundImage,this),this.findImages(e)),this.images.forEach(function(e,t){e.promise.then(function(){n("Succesfully loaded image #"+(t+1),e)},function(r){n("Failed loading image #"+(t+1),e,r)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),n("Finished searching images"),this},r.prototype.timeout=function(e,t){var r,i=Promise.race([e.promise,new Promise(function(i,a){r=setTimeout(function(){n("Timed out loading image",e),a(e)},t)})]).then(function(e){return clearTimeout(r),e});return i["catch"](function(){clearTimeout(r)}),i},t.exports=r},{"./dummyimagecontainer":5,"./framecontainer":8,"./imagecontainer":10,"./lineargradientcontainer":12,"./log":13,"./proxyimagecontainer":17,"./svgcontainer":23,"./svgnodecontainer":24,"./utils":26,"./webkitgradientcontainer":27}],12:[function(e,t){function r(e){n.apply(this,arguments),this.type=n.TYPES.LINEAR;var t=r.REGEXP_DIRECTION.test(e.args[0])||!n.REGEXP_COLORSTOP.test(e.args[0]);t?e.args[0].split(/\s+/).reverse().forEach(function(e,t){switch(e){case"left":this.x0=0,this.x1=1;break;case"top":this.y0=0,this.y1=1;break;case"right":this.x0=1,this.x1=0;break;case"bottom":this.y0=1,this.y1=0;break;case"to":var r=this.y0,n=this.x0;this.y0=this.y1,this.x0=this.x1,this.x1=n,this.y1=r;break;case"center":break;default:var i=.01*parseFloat(e,10);if(isNaN(i))break;0===t?(this.y0=i,this.y1=1-this.y0):(this.x0=i,this.x1=1-this.x0)}},this):(this.y0=0,this.y1=1),this.colorStops=e.args.slice(t?1:0).map(function(e){var t=e.match(n.REGEXP_COLORSTOP),r=+t[2],a=0===r?"%":t[3];return{color:new i(t[1]),stop:"%"===a?r/100:null}}),null===this.colorStops[0].stop&&(this.colorStops[0].stop=0),
null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1),this.colorStops.forEach(function(e,t){null===e.stop&&this.colorStops.slice(t).some(function(r,n){return null!==r.stop?(e.stop=(r.stop-this.colorStops[t-1].stop)/(n+1)+this.colorStops[t-1].stop,!0):!1},this)},this)}var n=e("./gradientcontainer"),i=e("./color");r.prototype=Object.create(n.prototype),r.REGEXP_DIRECTION=/^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i,t.exports=r},{"./color":3,"./gradientcontainer":9}],13:[function(e,t){var r=function(){r.options.logging&&window.console&&window.console.log&&Function.prototype.bind.call(window.console.log,window.console).apply(window.console,[Date.now()-r.options.start+"ms","html2canvas:"].concat([].slice.call(arguments,0)))};r.options={logging:!1},t.exports=r},{}],14:[function(e,t){function r(e,t){this.node=e,this.parent=t,this.stack=null,this.bounds=null,this.borders=null,this.clip=[],this.backgroundClip=[],this.offsetBounds=null,this.visible=null,this.computedStyles=null,this.colors={},this.styles={},this.backgroundImages=null,this.transformData=null,this.transformMatrix=null,this.isPseudoElement=!1,this.opacity=null}function n(e){var t=e.options[e.selectedIndex||0];return t?t.text||"":""}function i(e){if(e&&"matrix"===e[1])return e[2].split(",").map(function(e){return parseFloat(e.trim())});if(e&&"matrix3d"===e[1]){var t=e[2].split(",").map(function(e){return parseFloat(e.trim())});return[t[0],t[1],t[4],t[5],t[12],t[13]]}}function a(e){return-1!==e.toString().indexOf("%")}function o(e){return e.replace("px","")}function s(e){return parseFloat(e)}var u=e("./color"),l=e("./utils"),c=l.getBounds,p=l.parseBackgrounds,d=l.offsetBounds;r.prototype.cloneTo=function(e){e.visible=this.visible,e.borders=this.borders,e.bounds=this.bounds,e.clip=this.clip,e.backgroundClip=this.backgroundClip,e.computedStyles=this.computedStyles,e.styles=this.styles,e.backgroundImages=this.backgroundImages,e.opacity=this.opacity},r.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity},r.prototype.assignStack=function(e){this.stack=e,e.children.push(this)},r.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))},r.prototype.css=function(e){return this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null)),this.styles[e]||(this.styles[e]=this.computedStyles[e])},r.prototype.prefixedCss=function(e){var t=["webkit","moz","ms","o"],r=this.css(e);return void 0===r&&t.some(function(t){return r=this.css(t+e.substr(0,1).toUpperCase()+e.substr(1)),void 0!==r},this),void 0===r?null:r},r.prototype.computedStyle=function(e){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,e)},r.prototype.cssInt=function(e){var t=parseInt(this.css(e),10);return isNaN(t)?0:t},r.prototype.color=function(e){return this.colors[e]||(this.colors[e]=new u(this.css(e)))},r.prototype.cssFloat=function(e){var t=parseFloat(this.css(e));return isNaN(t)?0:t},r.prototype.fontWeight=function(){var e=this.css("fontWeight");switch(parseInt(e,10)){case 401:e="bold";break;case 400:e="normal"}return e},r.prototype.parseClip=function(){var e=this.css("clip").match(this.CLIP);return e?{top:parseInt(e[1],10),right:parseInt(e[2],10),bottom:parseInt(e[3],10),left:parseInt(e[4],10)}:null},r.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=p(this.css("backgroundImage")))},r.prototype.cssList=function(e,t){var r=(this.css(e)||"").split(",");return r=r[t||0]||r[0]||"auto",r=r.trim().split(" "),1===r.length&&(r=[r[0],a(r[0])?"auto":r[0]]),r},r.prototype.parseBackgroundSize=function(e,t,r){var n,i,o=this.cssList("backgroundSize",r);if(a(o[0]))n=e.width*parseFloat(o[0])/100;else{if(/contain|cover/.test(o[0])){var s=e.width/e.height,u=t.width/t.height;return u>s^"contain"===o[0]?{width:e.height*u,height:e.height}:{width:e.width,height:e.width/u}}n=parseInt(o[0],10)}return i="auto"===o[0]&&"auto"===o[1]?t.height:"auto"===o[1]?n/t.width*t.height:a(o[1])?e.height*parseFloat(o[1])/100:parseInt(o[1],10),"auto"===o[0]&&(n=i/t.height*t.width),{width:n,height:i}},r.prototype.parseBackgroundPosition=function(e,t,r,n){var i,o,s=this.cssList("backgroundPosition",r);return i=a(s[0])?(e.width-(n||t).width)*(parseFloat(s[0])/100):parseInt(s[0],10),o="auto"===s[1]?i/t.width*t.height:a(s[1])?(e.height-(n||t).height)*parseFloat(s[1])/100:parseInt(s[1],10),"auto"===s[0]&&(i=o/t.height*t.width),{left:i,top:o}},r.prototype.parseBackgroundRepeat=function(e){return this.cssList("backgroundRepeat",e)[0]},r.prototype.parseTextShadows=function(){var e=this.css("textShadow"),t=[];if(e&&"none"!==e)for(var r=e.match(this.TEXT_SHADOW_PROPERTY),n=0;r&&n<r.length;n++){var i=r[n].match(this.TEXT_SHADOW_VALUES);t.push({color:new u(i[0]),offsetX:i[1]?parseFloat(i[1].replace("px","")):0,offsetY:i[2]?parseFloat(i[2].replace("px","")):0,blur:i[3]?i[3].replace("px",""):0})}return t},r.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var e=this.parseBounds(),t=this.prefixedCss("transformOrigin").split(" ").map(o).map(s);t[0]+=e.left,t[1]+=e.top,this.transformData={origin:t,matrix:this.parseTransformMatrix()}}else this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData},r.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var e=this.prefixedCss("transform"),t=e?i(e.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=t?t:[1,0,0,1,0,0]}return this.transformMatrix},r.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?d(this.node):c(this.node))},r.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&this.parent.hasTransform()},r.prototype.getValue=function(){var e=this.node.value||"";return"SELECT"===this.node.tagName?e=n(this.node):"password"===this.node.type&&(e=Array(e.length+1).join("•")),0===e.length?this.node.placeholder||"":e},r.prototype.MATRIX_PROPERTY=/(matrix|matrix3d)\((.+)\)/,r.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,r.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,r.prototype.CLIP=/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,t.exports=r},{"./color":3,"./utils":26}],15:[function(e,t){function r(e,t,r,n,i){B("Starting NodeParser"),this.renderer=t,this.options=i,this.range=null,this.support=r,this.renderQueue=[],this.stack=new j(!0,1,e.ownerDocument,null);var a=new q(e,null);if(i.background&&t.rectangle(0,0,t.width,t.height,new z(i.background)),e===e.ownerDocument.documentElement){var o=new q(a.color("backgroundColor").isTransparent()?e.ownerDocument.body:e.ownerDocument.documentElement,null);t.rectangle(0,0,t.width,t.height,o.color("backgroundColor"))}a.visibile=a.isElementVisible(),this.createPseudoHideStyles(e.ownerDocument),this.disableAnimations(e.ownerDocument),this.nodes=R([a].concat(this.getChildren(a)).filter(function(e){return e.visible=e.isElementVisible()}).map(this.getPseudoElements,this)),this.fontMetrics=new W,B("Fetched nodes, total:",this.nodes.length),B("Calculate overflow clips"),this.calculateOverflowClips(),B("Start fetching images"),this.images=n.fetch(this.nodes.filter(I)),this.ready=this.images.ready.then(Q(function(){return B("Images loaded, starting parsing"),B("Creating stacking contexts"),this.createStackingContexts(),B("Sorting stacking contexts"),this.sortStackingContexts(this.stack),this.parse(this.stack),B("Render queue created with "+this.renderQueue.length+" items"),new Promise(Q(function(e){i.async?"function"==typeof i.async?i.async.call(this,this.renderQueue,e):this.renderQueue.length>0?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,e)):e():(this.renderQueue.forEach(this.paint,this),e())},this))},this))}function n(e){return e.parent&&e.parent.clip.length}function i(e){return e.replace(/(\-[a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function a(){}function o(e,t,r,n){return e.map(function(i,a){if(i.width>0){var o=t.left,s=t.top,u=t.width,l=t.height-e[2].width;switch(a){case 0:l=e[0].width,i.args=c({c1:[o,s],c2:[o+u,s],c3:[o+u-e[1].width,s+l],c4:[o+e[3].width,s+l]},n[0],n[1],r.topLeftOuter,r.topLeftInner,r.topRightOuter,r.topRightInner);break;case 1:o=t.left+t.width-e[1].width,u=e[1].width,i.args=c({c1:[o+u,s],c2:[o+u,s+l+e[2].width],c3:[o,s+l],c4:[o,s+e[0].width]},n[1],n[2],r.topRightOuter,r.topRightInner,r.bottomRightOuter,r.bottomRightInner);break;case 2:s=s+t.height-e[2].width,l=e[2].width,i.args=c({c1:[o+u,s+l],c2:[o,s+l],c3:[o+e[3].width,s],c4:[o+u-e[3].width,s]},n[2],n[3],r.bottomRightOuter,r.bottomRightInner,r.bottomLeftOuter,r.bottomLeftInner);break;case 3:u=e[3].width,i.args=c({c1:[o,s+l+e[2].width],c2:[o,s],c3:[o+u,s+e[0].width],c4:[o+u,s+l]},n[3],n[0],r.bottomLeftOuter,r.bottomLeftInner,r.topLeftOuter,r.topLeftInner)}}return i})}function s(e,t,r,n){var i=4*((Math.sqrt(2)-1)/3),a=r*i,o=n*i,s=e+r,u=t+n;return{topLeft:l({x:e,y:u},{x:e,y:u-o},{x:s-a,y:t},{x:s,y:t}),topRight:l({x:e,y:t},{x:e+a,y:t},{x:s,y:u-o},{x:s,y:u}),bottomRight:l({x:s,y:t},{x:s,y:t+o},{x:e+a,y:u},{x:e,y:u}),bottomLeft:l({x:s,y:u},{x:s-a,y:u},{x:e,y:t+o},{x:e,y:t})}}function u(e,t,r){var n=e.left,i=e.top,a=e.width,o=e.height,u=t[0][0]<a/2?t[0][0]:a/2,l=t[0][1]<o/2?t[0][1]:o/2,c=t[1][0]<a/2?t[1][0]:a/2,p=t[1][1]<o/2?t[1][1]:o/2,d=t[2][0]<a/2?t[2][0]:a/2,f=t[2][1]<o/2?t[2][1]:o/2,h=t[3][0]<a/2?t[3][0]:a/2,m=t[3][1]<o/2?t[3][1]:o/2,g=a-c,v=o-f,b=a-d,y=o-m;return{topLeftOuter:s(n,i,u,l).topLeft.subdivide(.5),topLeftInner:s(n+r[3].width,i+r[0].width,Math.max(0,u-r[3].width),Math.max(0,l-r[0].width)).topLeft.subdivide(.5),topRightOuter:s(n+g,i,c,p).topRight.subdivide(.5),topRightInner:s(n+Math.min(g,a+r[3].width),i+r[0].width,g>a+r[3].width?0:c-r[3].width,p-r[0].width).topRight.subdivide(.5),bottomRightOuter:s(n+b,i+v,d,f).bottomRight.subdivide(.5),bottomRightInner:s(n+Math.min(b,a-r[3].width),i+Math.min(v,o+r[0].width),Math.max(0,d-r[1].width),f-r[2].width).bottomRight.subdivide(.5),bottomLeftOuter:s(n,i+y,h,m).bottomLeft.subdivide(.5),bottomLeftInner:s(n+r[3].width,i+y,Math.max(0,h-r[3].width),m-r[2].width).bottomLeft.subdivide(.5)}}function l(e,t,r,n){var i=function(e,t,r){return{x:e.x+(t.x-e.x)*r,y:e.y+(t.y-e.y)*r}};return{start:e,startControl:t,endControl:r,end:n,subdivide:function(a){var o=i(e,t,a),s=i(t,r,a),u=i(r,n,a),c=i(o,s,a),p=i(s,u,a),d=i(c,p,a);return[l(e,o,c,d),l(d,p,u,n)]},curveTo:function(e){e.push(["bezierCurve",t.x,t.y,r.x,r.y,n.x,n.y])},curveToReversed:function(n){n.push(["bezierCurve",r.x,r.y,t.x,t.y,e.x,e.y])}}}function c(e,t,r,n,i,a,o){var s=[];return t[0]>0||t[1]>0?(s.push(["line",n[1].start.x,n[1].start.y]),n[1].curveTo(s)):s.push(["line",e.c1[0],e.c1[1]]),r[0]>0||r[1]>0?(s.push(["line",a[0].start.x,a[0].start.y]),a[0].curveTo(s),s.push(["line",o[0].end.x,o[0].end.y]),o[0].curveToReversed(s)):(s.push(["line",e.c2[0],e.c2[1]]),s.push(["line",e.c3[0],e.c3[1]])),t[0]>0||t[1]>0?(s.push(["line",i[1].end.x,i[1].end.y]),i[1].curveToReversed(s)):s.push(["line",e.c4[0],e.c4[1]]),s}function p(e,t,r,n,i,a,o){t[0]>0||t[1]>0?(e.push(["line",n[0].start.x,n[0].start.y]),n[0].curveTo(e),n[1].curveTo(e)):e.push(["line",a,o]),(r[0]>0||r[1]>0)&&e.push(["line",i[0].start.x,i[0].start.y])}function d(e){return e.cssInt("zIndex")<0}function f(e){return e.cssInt("zIndex")>0}function h(e){return 0===e.cssInt("zIndex")}function m(e){return-1!==["inline","inline-block","inline-table"].indexOf(e.css("display"))}function g(e){return e instanceof j}function v(e){return e.node.data.trim().length>0}function b(e){return/^(normal|none|0px)$/.test(e.parent.css("letterSpacing"))}function y(e){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){var r=e.css("border"+t+"Radius"),n=r.split(" ");return n.length<=1&&(n[1]=n[0]),n.map($)})}function w(e){return e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE}function C(e){var t=e.css("position"),r=-1!==["absolute","relative","fixed"].indexOf(t)?e.css("zIndex"):"auto";return"auto"!==r}function S(e){return"static"!==e.css("position")}function x(e){return"none"!==e.css("float")}function A(e){return-1!==["inline-block","inline-table"].indexOf(e.css("display"))}function T(e){var t=this;return function(){return!e.apply(t,arguments)}}function I(e){return e.node.nodeType===Node.ELEMENT_NODE}function E(e){return e.isPseudoElement===!0}function P(e){return e.node.nodeType===Node.TEXT_NODE}function k(e){return function(t,r){return t.cssInt("zIndex")+e.indexOf(t)/e.length-(r.cssInt("zIndex")+e.indexOf(r)/e.length)}}function M(e){return e.getOpacity()<1}function $(e){return parseInt(e,10)}function D(e){return e.width}function L(e){return e.node.nodeType!==Node.ELEMENT_NODE||-1===["SCRIPT","HEAD","TITLE","OBJECT","BR","OPTION"].indexOf(e.node.nodeName)}function R(e){return[].concat.apply([],e)}function N(e){var t=e.substr(0,1);return t===e.substr(e.length-1)&&t.match(/'|"/)?e.substr(1,e.length-2):e}function U(e){for(var t,r=[],n=0,i=!1;e.length;)F(e[n])===i?(t=e.splice(0,n),t.length&&r.push(H.ucs2.encode(t)),i=!i,n=0):n++,n>=e.length&&(t=e.splice(0,n),t.length&&r.push(H.ucs2.encode(t)));return r}function F(e){return-1!==[32,13,10,9,45].indexOf(e)}function O(e){return/[^\u0000-\u00ff]/.test(e)}var B=e("./log"),H=e("punycode"),q=e("./nodecontainer"),G=e("./textcontainer"),_=e("./pseudoelementcontainer"),W=e("./fontmetrics"),z=e("./color"),j=e("./stackingcontext"),V=e("./utils"),Q=V.bind,Y=V.getBounds,X=V.parseBackgrounds,K=V.offsetBounds;r.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(e){if(I(e)){E(e)&&e.appendToDOM(),e.borders=this.parseBorders(e);var t="hidden"===e.css("overflow")?[e.borders.clip]:[],r=e.parseClip();r&&-1!==["absolute","fixed"].indexOf(e.css("position"))&&t.push([["rect",e.bounds.left+r.left,e.bounds.top+r.top,r.right-r.left,r.bottom-r.top]]),e.clip=n(e)?e.parent.clip.concat(t):t,e.backgroundClip="hidden"!==e.css("overflow")?e.clip.concat([e.borders.clip]):e.clip,E(e)&&e.cleanDOM()}else P(e)&&(e.clip=n(e)?e.parent.clip:[]);E(e)||(e.bounds=null)},this)},r.prototype.asyncRenderer=function(e,t,r){r=r||Date.now(),this.paint(e[this.renderIndex++]),e.length===this.renderIndex?t():r+20>Date.now()?this.asyncRenderer(e,t,r):setTimeout(Q(function(){this.asyncRenderer(e,t)},this),0)},r.prototype.createPseudoHideStyles=function(e){this.createStyles(e,"."+_.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+_.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')},r.prototype.disableAnimations=function(e){this.createStyles(e,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")},r.prototype.createStyles=function(e,t){var r=e.createElement("style");r.innerHTML=t,e.body.appendChild(r)},r.prototype.getPseudoElements=function(e){var t=[[e]];if(e.node.nodeType===Node.ELEMENT_NODE){var r=this.getPseudoElement(e,":before"),n=this.getPseudoElement(e,":after");r&&t.push(r),n&&t.push(n)}return R(t)},r.prototype.getPseudoElement=function(e,t){var r=e.computedStyle(t);if(!r||!r.content||"none"===r.content||"-moz-alt-content"===r.content||"none"===r.display)return null;for(var n=N(r.content),a="url"===n.substr(0,3),o=document.createElement(a?"img":"html2canvaspseudoelement"),s=new _(o,e,t),u=r.length-1;u>=0;u--){var l=i(r.item(u));o.style[l]=r[l]}if(o.className=_.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+_.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER,a)return o.src=X(n)[0].args[0],[s];var c=document.createTextNode(n);return o.appendChild(c),[s,new G(c,s)]},r.prototype.getChildren=function(e){return R([].filter.call(e.node.childNodes,w).map(function(t){var r=[t.nodeType===Node.TEXT_NODE?new G(t,e):new q(t,e)].filter(L);return t.nodeType===Node.ELEMENT_NODE&&r.length&&"TEXTAREA"!==t.tagName?r[0].isElementVisible()?r.concat(this.getChildren(r[0])):[]:r},this))},r.prototype.newStackingContext=function(e,t){var r=new j(t,e.getOpacity(),e.node,e.parent);e.cloneTo(r);var n=t?r.getParentStack(this):r.parent.stack;n.contexts.push(r),e.stack=r},r.prototype.createStackingContexts=function(){this.nodes.forEach(function(e){I(e)&&(this.isRootElement(e)||M(e)||C(e)||this.isBodyWithTransparentRoot(e)||e.hasTransform())?this.newStackingContext(e,!0):I(e)&&(S(e)&&h(e)||A(e)||x(e))?this.newStackingContext(e,!1):e.assignStack(e.parent.stack)},this)},r.prototype.isBodyWithTransparentRoot=function(e){return"BODY"===e.node.nodeName&&e.parent.color("backgroundColor").isTransparent()},r.prototype.isRootElement=function(e){return null===e.parent},r.prototype.sortStackingContexts=function(e){e.contexts.sort(k(e.contexts.slice(0))),e.contexts.forEach(this.sortStackingContexts,this)},r.prototype.parseTextBounds=function(e){return function(t,r,n){if("none"!==e.parent.css("textDecoration").substr(0,4)||0!==t.trim().length){if(this.support.rangeBounds&&!e.parent.hasTransform()){var i=n.slice(0,r).join("").length;return this.getRangeBounds(e.node,i,t.length)}if(e.node&&"string"==typeof e.node.data){var a=e.node.splitText(t.length),o=this.getWrapperBounds(e.node,e.parent.hasTransform());return e.node=a,o}}else(!this.support.rangeBounds||e.parent.hasTransform())&&(e.node=e.node.splitText(t.length));return{}}},r.prototype.getWrapperBounds=function(e,t){var r=e.ownerDocument.createElement("html2canvaswrapper"),n=e.parentNode,i=e.cloneNode(!0);r.appendChild(e.cloneNode(!0)),n.replaceChild(r,e);var a=t?K(r):Y(r);return n.replaceChild(i,r),a},r.prototype.getRangeBounds=function(e,t,r){var n=this.range||(this.range=e.ownerDocument.createRange());return n.setStart(e,t),n.setEnd(e,t+r),n.getBoundingClientRect()},r.prototype.parse=function(e){var t=e.contexts.filter(d),r=e.children.filter(I),n=r.filter(T(x)),i=n.filter(T(S)).filter(T(m)),o=r.filter(T(S)).filter(x),s=n.filter(T(S)).filter(m),u=e.contexts.concat(n.filter(S)).filter(h),l=e.children.filter(P).filter(v),c=e.contexts.filter(f);t.concat(i).concat(o).concat(s).concat(u).concat(l).concat(c).forEach(function(e){this.renderQueue.push(e),g(e)&&(this.parse(e),this.renderQueue.push(new a))},this)},r.prototype.paint=function(e){try{e instanceof a?this.renderer.ctx.restore():P(e)?(E(e.parent)&&e.parent.appendToDOM(),this.paintText(e),E(e.parent)&&e.parent.cleanDOM()):this.paintNode(e)}catch(t){if(B(t),this.options.strict)throw t}},r.prototype.paintNode=function(e){g(e)&&(this.renderer.setOpacity(e.opacity),this.renderer.ctx.save(),e.hasTransform()&&this.renderer.setTransform(e.parseTransform())),"INPUT"===e.node.nodeName&&"checkbox"===e.node.type?this.paintCheckbox(e):"INPUT"===e.node.nodeName&&"radio"===e.node.type?this.paintRadio(e):this.paintElement(e)},r.prototype.paintElement=function(e){var t=e.parseBounds();this.renderer.clip(e.backgroundClip,function(){this.renderer.renderBackground(e,t,e.borders.borders.map(D))},this),this.renderer.clip(e.clip,function(){this.renderer.renderBorders(e.borders.borders)},this),this.renderer.clip(e.backgroundClip,function(){switch(e.node.nodeName){case"svg":case"IFRAME":var r=this.images.get(e.node);r?this.renderer.renderImage(e,t,e.borders,r):B("Error loading <"+e.node.nodeName+">",e.node);break;case"IMG":var n=this.images.get(e.node.src);n?this.renderer.renderImage(e,t,e.borders,n):B("Error loading <img>",e.node.src);break;case"CANVAS":this.renderer.renderImage(e,t,e.borders,{image:e.node});break;case"SELECT":case"INPUT":case"TEXTAREA":this.paintFormValue(e)}},this)},r.prototype.paintCheckbox=function(e){var t=e.parseBounds(),r=Math.min(t.width,t.height),n={width:r-1,height:r-1,top:t.top,left:t.left},i=[3,3],a=[i,i,i,i],s=[1,1,1,1].map(function(e){return{color:new z("#A5A5A5"),width:e}}),l=u(n,a,s);this.renderer.clip(e.backgroundClip,function(){this.renderer.rectangle(n.left+1,n.top+1,n.width-2,n.height-2,new z("#DEDEDE")),this.renderer.renderBorders(o(s,n,l,a)),e.node.checked&&(this.renderer.font(new z("#424242"),"normal","normal","bold",r-3+"px","arial"),this.renderer.text("✔",n.left+r/6,n.top+r-1))},this)},r.prototype.paintRadio=function(e){var t=e.parseBounds(),r=Math.min(t.width,t.height)-2;this.renderer.clip(e.backgroundClip,function(){this.renderer.circleStroke(t.left+1,t.top+1,r,new z("#DEDEDE"),1,new z("#A5A5A5")),e.node.checked&&this.renderer.circle(Math.ceil(t.left+r/4)+1,Math.ceil(t.top+r/4)+1,Math.floor(r/2),new z("#424242"))},this)},r.prototype.paintFormValue=function(e){var t=e.getValue();if(t.length>0){var r=e.node.ownerDocument,n=r.createElement("html2canvaswrapper"),i=["lineHeight","textAlign","fontFamily","fontWeight","fontSize","color","paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","borderLeftStyle","borderTopStyle","borderLeftWidth","borderTopWidth","boxSizing","whiteSpace","wordWrap"];i.forEach(function(t){try{n.style[t]=e.css(t)}catch(r){B("html2canvas: Parse: Exception caught in renderFormValue: "+r.message)}});var a=e.parseBounds();n.style.position="fixed",n.style.left=a.left+"px",n.style.top=a.top+"px",n.textContent=t,r.body.appendChild(n),this.paintText(new G(n.firstChild,e)),r.body.removeChild(n)}},r.prototype.paintText=function(e){e.applyTextTransform();var t=H.ucs2.decode(e.node.data),r=this.options.letterRendering&&!b(e)||O(e.node.data)?t.map(function(e){return H.ucs2.encode([e])}):U(t),n=e.parent.fontWeight(),i=e.parent.css("fontSize"),a=e.parent.css("fontFamily"),o=e.parent.parseTextShadows();this.renderer.font(e.parent.color("color"),e.parent.css("fontStyle"),e.parent.css("fontVariant"),n,i,a),o.length?this.renderer.fontShadow(o[0].color,o[0].offsetX,o[0].offsetY,o[0].blur):this.renderer.clearShadow(),this.renderer.clip(e.parent.clip,function(){r.map(this.parseTextBounds(e),this).forEach(function(t,n){t&&(this.renderer.text(r[n],t.left,t.bottom),this.renderTextDecoration(e.parent,t,this.fontMetrics.getMetrics(a,i)))},this)},this)},r.prototype.renderTextDecoration=function(e,t,r){switch(e.css("textDecoration").split(" ")[0]){case"underline":this.renderer.rectangle(t.left,Math.round(t.top+r.baseline+r.lineWidth),t.width,1,e.color("color"));break;case"overline":this.renderer.rectangle(t.left,Math.round(t.top),t.width,1,e.color("color"));break;case"line-through":this.renderer.rectangle(t.left,Math.ceil(t.top+r.middle+r.lineWidth),t.width,1,e.color("color"))}};var J={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};r.prototype.parseBorders=function(e){var t=e.parseBounds(),r=y(e),n=["Top","Right","Bottom","Left"].map(function(t,r){var n=e.css("border"+t+"Style"),i=e.color("border"+t+"Color");"inset"===n&&i.isBlack()&&(i=new z([255,255,255,i.a]));var a=J[n]?J[n][r]:null;return{width:e.cssInt("border"+t+"Width"),color:a?i[a[0]](a[1]):i,args:null}}),i=u(t,r,n);return{clip:this.parseBackgroundClip(e,i,n,r,t),borders:o(n,t,i,r)}},r.prototype.parseBackgroundClip=function(e,t,r,n,i){var a=e.css("backgroundClip"),o=[];switch(a){case"content-box":case"padding-box":p(o,n[0],n[1],t.topLeftInner,t.topRightInner,i.left+r[3].width,i.top+r[0].width),p(o,n[1],n[2],t.topRightInner,t.bottomRightInner,i.left+i.width-r[1].width,i.top+r[0].width),p(o,n[2],n[3],t.bottomRightInner,t.bottomLeftInner,i.left+i.width-r[1].width,i.top+i.height-r[2].width),p(o,n[3],n[0],t.bottomLeftInner,t.topLeftInner,i.left+r[3].width,i.top+i.height-r[2].width);break;default:p(o,n[0],n[1],t.topLeftOuter,t.topRightOuter,i.left,i.top),p(o,n[1],n[2],t.topRightOuter,t.bottomRightOuter,i.left+i.width,i.top),p(o,n[2],n[3],t.bottomRightOuter,t.bottomLeftOuter,i.left+i.width,i.top+i.height),p(o,n[3],n[0],t.bottomLeftOuter,t.topLeftOuter,i.left,i.top+i.height)}return o},t.exports=r},{"./color":3,"./fontmetrics":7,"./log":13,"./nodecontainer":14,"./pseudoelementcontainer":18,"./stackingcontext":21,"./textcontainer":25,"./utils":26,punycode:1}],16:[function(e,t,r){function n(e,t,r){var n="withCredentials"in new XMLHttpRequest;if(!t)return Promise.reject("No proxy configured");var i=o(n),u=s(t,e,i);return n?c(u):a(r,u,i).then(function(e){return h(e.content)})}function i(e,t,r){var n="crossOrigin"in new Image,i=o(n),u=s(t,e,i);return n?Promise.resolve(u):a(r,u,i).then(function(e){return"data:"+e.type+";base64,"+e.content})}function a(e,t,r){return new Promise(function(n,i){var a=e.createElement("script"),o=function(){delete window.html2canvas.proxy[r],e.body.removeChild(a)};window.html2canvas.proxy[r]=function(e){o(),n(e)},a.src=t,a.onerror=function(e){o(),i(e)},e.body.appendChild(a)})}function o(e){return e?"":"html2canvas_"+Date.now()+"_"+ ++m+"_"+Math.round(1e5*Math.random())}function s(e,t,r){return e+"?url="+encodeURIComponent(t)+(r.length?"&callback=html2canvas.proxy."+r:"")}function u(e){return function(t){var r,n=new DOMParser;try{r=n.parseFromString(t,"text/html")}catch(i){d("DOMParser not supported, falling back to createHTMLDocument"),r=document.implementation.createHTMLDocument("");try{r.open(),r.write(t),r.close()}catch(a){d("createHTMLDocument write not supported, falling back to document.body.innerHTML"),r.body.innerHTML=t}}var o=r.querySelector("base");if(!o||!o.href.host){var s=r.createElement("base");s.href=e,r.head.insertBefore(s,r.head.firstChild)}return r}}function l(e,t,r,i,a,o){return new n(e,t,window.document).then(u(e)).then(function(e){return f(e,r,i,a,o,0,0)})}var c=e("./xhr"),p=e("./utils"),d=e("./log"),f=e("./clone"),h=p.decode64,m=0;r.Proxy=n,r.ProxyURL=i,r.loadUrlDocument=l},{"./clone":2,"./log":13,"./utils":26,"./xhr":28}],17:[function(e,t){function r(e,t){var r=document.createElement("a");r.href=e,e=r.href,this.src=e,this.image=new Image;var i=this;this.promise=new Promise(function(r,a){i.image.crossOrigin="Anonymous",i.image.onload=r,i.image.onerror=a,new n(e,t,document).then(function(e){i.image.src=e})["catch"](a)})}var n=e("./proxy").ProxyURL;t.exports=r},{"./proxy":16}],18:[function(e,t){function r(e,t,r){n.call(this,e,t),this.isPseudoElement=!0,this.before=":before"===r}var n=e("./nodecontainer");r.prototype.cloneTo=function(e){r.prototype.cloneTo.call(this,e),e.isPseudoElement=!0,e.before=this.before},r.prototype=Object.create(n.prototype),r.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node),this.parent.node.className+=" "+this.getHideClass()},r.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node),this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")},r.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+(this.before?"BEFORE":"AFTER")]},r.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",r.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",t.exports=r},{"./nodecontainer":14}],19:[function(e,t){function r(e,t,r,n,i){this.width=e,this.height=t,this.images=r,this.options=n,this.document=i}var n=e("./log");r.prototype.renderImage=function(e,t,r,n){var i=e.cssInt("paddingLeft"),a=e.cssInt("paddingTop"),o=e.cssInt("paddingRight"),s=e.cssInt("paddingBottom"),u=r.borders,l=t.width-(u[1].width+u[3].width+i+o),c=t.height-(u[0].width+u[2].width+a+s);this.drawImage(n,0,0,n.image.width||l,n.image.height||c,t.left+i+u[3].width,t.top+a+u[0].width,l,c)},r.prototype.renderBackground=function(e,t,r){t.height>0&&t.width>0&&(this.renderBackgroundColor(e,t),this.renderBackgroundImage(e,t,r))},r.prototype.renderBackgroundColor=function(e,t){var r=e.color("backgroundColor");r.isTransparent()||this.rectangle(t.left,t.top,t.width,t.height,r)},r.prototype.renderBorders=function(e){e.forEach(this.renderBorder,this)},r.prototype.renderBorder=function(e){e.color.isTransparent()||null===e.args||this.drawShape(e.args,e.color)},r.prototype.renderBackgroundImage=function(e,t,r){var i=e.parseBackgroundImages();i.reverse().forEach(function(i,a,o){switch(i.method){case"url":var s=this.images.get(i.args[0]);s?this.renderBackgroundRepeating(e,t,s,o.length-(a+1),r):n("Error loading background-image",i.args[0]);break;case"linear-gradient":case"gradient":var u=this.images.get(i.value);u?this.renderBackgroundGradient(u,t,r):n("Error loading background-image",i.args[0]);break;case"none":break;default:n("Unknown background-image type",i.args[0])}},this)},r.prototype.renderBackgroundRepeating=function(e,t,r,n,i){var a=e.parseBackgroundSize(t,r.image,n),o=e.parseBackgroundPosition(t,r.image,n,a),s=e.parseBackgroundRepeat(n);switch(s){case"repeat-x":case"repeat no-repeat":this.backgroundRepeatShape(r,o,a,t,t.left+i[3],t.top+o.top+i[0],99999,a.height,i);break;case"repeat-y":case"no-repeat repeat":this.backgroundRepeatShape(r,o,a,t,t.left+o.left+i[3],t.top+i[0],a.width,99999,i);break;case"no-repeat":this.backgroundRepeatShape(r,o,a,t,t.left+o.left+i[3],t.top+o.top+i[0],a.width,a.height,i);break;default:this.renderBackgroundRepeat(r,o,a,{top:t.top,left:t.left},i[3],i[0])}},t.exports=r},{"./log":13}],20:[function(e,t){function r(e,t){i.apply(this,arguments),this.canvas=this.options.canvas||this.document.createElement("canvas"),this.options.canvas||(this.canvas.width=e,this.canvas.height=t),this.ctx=this.canvas.getContext("2d"),this.taintCtx=this.document.createElement("canvas").getContext("2d"),this.ctx.textBaseline="bottom",this.variables={},o("Initialized CanvasRenderer with size",e,"x",t)}function n(e){return e.length>0}var i=e("../renderer"),a=e("../lineargradientcontainer"),o=e("../log");r.prototype=Object.create(i.prototype),r.prototype.setFillStyle=function(e){return this.ctx.fillStyle="object"==typeof e&&e.isColor?e.toString():e,this.ctx},r.prototype.rectangle=function(e,t,r,n,i){this.setFillStyle(i).fillRect(e,t,r,n)},r.prototype.circle=function(e,t,r,n){this.setFillStyle(n),this.ctx.beginPath(),this.ctx.arc(e+r/2,t+r/2,r/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()},r.prototype.circleStroke=function(e,t,r,n,i,a){this.circle(e,t,r,n),this.ctx.strokeStyle=a.toString(),this.ctx.stroke()},r.prototype.drawShape=function(e,t){this.shape(e),this.setFillStyle(t).fill()},r.prototype.taints=function(e){if(null===e.tainted){this.taintCtx.drawImage(e.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),e.tainted=!1}catch(t){this.taintCtx=document.createElement("canvas").getContext("2d"),e.tainted=!0}}return e.tainted},r.prototype.drawImage=function(e,t,r,n,i,a,o,s,u){(!this.taints(e)||this.options.allowTaint)&&this.ctx.drawImage(e.image,t,r,n,i,a,o,s,u)},r.prototype.clip=function(e,t,r){this.ctx.save(),e.filter(n).forEach(function(e){this.shape(e).clip()},this),t.call(r),this.ctx.restore()},r.prototype.shape=function(e){return this.ctx.beginPath(),e.forEach(function(e,t){"rect"===e[0]?this.ctx.rect.apply(this.ctx,e.slice(1)):this.ctx[0===t?"moveTo":e[0]+"To"].apply(this.ctx,e.slice(1))},this),this.ctx.closePath(),this.ctx},r.prototype.font=function(e,t,r,n,i,a){this.setFillStyle(e).font=[t,r,n,i,a].join(" ").split(",")[0]},r.prototype.fontShadow=function(e,t,r,n){this.setVariable("shadowColor",e.toString()).setVariable("shadowOffsetY",t).setVariable("shadowOffsetX",r).setVariable("shadowBlur",n)},r.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")},r.prototype.setOpacity=function(e){this.ctx.globalAlpha=e},r.prototype.setTransform=function(e){this.ctx.translate(e.origin[0],e.origin[1]),this.ctx.transform.apply(this.ctx,e.matrix),this.ctx.translate(-e.origin[0],-e.origin[1])},r.prototype.setVariable=function(e,t){return this.variables[e]!==t&&(this.variables[e]=this.ctx[e]=t),this},r.prototype.text=function(e,t,r){this.ctx.fillText(e,t,r)},r.prototype.backgroundRepeatShape=function(e,t,r,n,i,a,o,s,u){var l=[["line",Math.round(i),Math.round(a)],["line",Math.round(i+o),Math.round(a)],["line",Math.round(i+o),Math.round(s+a)],["line",Math.round(i),Math.round(s+a)]];
this.clip([l],function(){this.renderBackgroundRepeat(e,t,r,n,u[3],u[0])},this)},r.prototype.renderBackgroundRepeat=function(e,t,r,n,i,a){var o=Math.round(n.left+t.left+i),s=Math.round(n.top+t.top+a);this.setFillStyle(this.ctx.createPattern(this.resizeImage(e,r),"repeat")),this.ctx.translate(o,s),this.ctx.fill(),this.ctx.translate(-o,-s)},r.prototype.renderBackgroundGradient=function(e,t){if(e instanceof a){var r=this.ctx.createLinearGradient(t.left+t.width*e.x0,t.top+t.height*e.y0,t.left+t.width*e.x1,t.top+t.height*e.y1);e.colorStops.forEach(function(e){r.addColorStop(e.stop,e.color.toString())}),this.rectangle(t.left,t.top,t.width,t.height,r)}},r.prototype.resizeImage=function(e,t){var r=e.image;if(r.width===t.width&&r.height===t.height)return r;var n,i=document.createElement("canvas");return i.width=t.width,i.height=t.height,n=i.getContext("2d"),n.drawImage(r,0,0,r.width,r.height,0,0,t.width,t.height),i},t.exports=r},{"../lineargradientcontainer":12,"../log":13,"../renderer":19}],21:[function(e,t){function r(e,t,r,i){n.call(this,r,i),this.ownStacking=e,this.contexts=[],this.children=[],this.opacity=(this.parent?this.parent.stack.opacity:1)*t}var n=e("./nodecontainer");r.prototype=Object.create(n.prototype),r.prototype.getParentStack=function(e){var t=this.parent?this.parent.stack:null;return t?t.ownStacking?t:t.getParentStack(e):e.stack},t.exports=r},{"./nodecontainer":14}],22:[function(e,t){function r(e){this.rangeBounds=this.testRangeBounds(e),this.cors=this.testCORS(),this.svg=this.testSVG()}r.prototype.testRangeBounds=function(e){var t,r,n,i,a=!1;return e.createRange&&(t=e.createRange(),t.getBoundingClientRect&&(r=e.createElement("boundtest"),r.style.height="123px",r.style.display="block",e.body.appendChild(r),t.selectNode(r),n=t.getBoundingClientRect(),i=n.height,123===i&&(a=!0),e.body.removeChild(r))),a},r.prototype.testCORS=function(){return"undefined"!=typeof(new Image).crossOrigin},r.prototype.testSVG=function(){var e=new Image,t=document.createElement("canvas"),r=t.getContext("2d");e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch(n){return!1}return!0},t.exports=r},{}],23:[function(e,t){function r(e){this.src=e,this.image=null;var t=this;this.promise=this.hasFabric().then(function(){return t.isInline(e)?Promise.resolve(t.inlineFormatting(e)):n(e)}).then(function(e){return new Promise(function(r){window.html2canvas.svg.fabric.loadSVGFromString(e,t.createCanvas.call(t,r))})})}var n=e("./xhr"),i=e("./utils").decode64;r.prototype.hasFabric=function(){return window.html2canvas.svg&&window.html2canvas.svg.fabric?Promise.resolve():Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))},r.prototype.inlineFormatting=function(e){return/^data:image\/svg\+xml;base64,/.test(e)?this.decode64(this.removeContentType(e)):this.removeContentType(e)},r.prototype.removeContentType=function(e){return e.replace(/^data:image\/svg\+xml(;base64)?,/,"")},r.prototype.isInline=function(e){return/^data:image\/svg\+xml/i.test(e)},r.prototype.createCanvas=function(e){var t=this;return function(r,n){var i=new window.html2canvas.svg.fabric.StaticCanvas("c");t.image=i.lowerCanvasEl,i.setWidth(n.width).setHeight(n.height).add(window.html2canvas.svg.fabric.util.groupSVGElements(r,n)).renderAll(),e(i.lowerCanvasEl)}},r.prototype.decode64=function(e){return"function"==typeof window.atob?window.atob(e):i(e)},t.exports=r},{"./utils":26,"./xhr":28}],24:[function(e,t){function r(e,t){this.src=e,this.image=null;var r=this;this.promise=t?new Promise(function(t,n){r.image=new Image,r.image.onload=t,r.image.onerror=n,r.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(e),r.image.complete===!0&&t(r.image)}):this.hasFabric().then(function(){return new Promise(function(t){window.html2canvas.svg.fabric.parseSVGDocument(e,r.createCanvas.call(r,t))})})}var n=e("./svgcontainer");r.prototype=Object.create(n.prototype),t.exports=r},{"./svgcontainer":23}],25:[function(e,t){function r(e,t){i.call(this,e,t)}function n(e,t,r){return e.length>0?t+r.toUpperCase():void 0}var i=e("./nodecontainer");r.prototype=Object.create(i.prototype),r.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))},r.prototype.transform=function(e){var t=this.node.data;switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,n);case"uppercase":return t.toUpperCase();default:return t}},t.exports=r},{"./nodecontainer":14}],26:[function(e,t,r){r.smallImage=function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},r.bind=function(e,t){return function(){return e.apply(t,arguments)}},r.decode64=function(e){var t,r,n,i,a,o,s,u,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=e.length,p="";for(t=0;c>t;t+=4)r=l.indexOf(e[t]),n=l.indexOf(e[t+1]),i=l.indexOf(e[t+2]),a=l.indexOf(e[t+3]),o=r<<2|n>>4,s=(15&n)<<4|i>>2,u=(3&i)<<6|a,p+=64===i?String.fromCharCode(o):64===a||-1===a?String.fromCharCode(o,s):String.fromCharCode(o,s,u);return p},r.getBounds=function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect(),r=null==e.offsetWidth?t.width:e.offsetWidth;return{top:t.top,bottom:t.bottom||t.top+t.height,right:t.left+r,left:t.left,width:r,height:null==e.offsetHeight?t.height:e.offsetHeight}}return{}},r.offsetBounds=function(e){var t=e.offsetParent?r.offsetBounds(e.offsetParent):{top:0,left:0};return{top:e.offsetTop+t.top,bottom:e.offsetTop+e.offsetHeight+t.top,right:e.offsetLeft+t.left+e.offsetWidth,left:e.offsetLeft+t.left,width:e.offsetWidth,height:e.offsetHeight}},r.parseBackgrounds=function(e){var t,r,n,i,a,o,s,u=" \r\n	",l=[],c=0,p=0,d=function(){t&&('"'===r.substr(0,1)&&(r=r.substr(1,r.length-2)),r&&s.push(r),"-"===t.substr(0,1)&&(i=t.indexOf("-",1)+1)>0&&(n=t.substr(0,i),t=t.substr(i)),l.push({prefix:n,method:t.toLowerCase(),value:a,args:s,image:null})),s=[],t=n=r=a=""};return s=[],t=n=r=a="",e.split("").forEach(function(e){if(!(0===c&&u.indexOf(e)>-1)){switch(e){case'"':o?o===e&&(o=null):o=e;break;case"(":if(o)break;if(0===c)return c=1,void(a+=e);p++;break;case")":if(o)break;if(1===c){if(0===p)return c=0,a+=e,void d();p--}break;case",":if(o)break;if(0===c)return void d();if(1===c&&0===p&&!t.match(/^url$/i))return s.push(r),r="",void(a+=e)}a+=e,0===c?t+=e:r+=e}}),d(),l}},{}],27:[function(e,t){function r(e){n.apply(this,arguments),this.type="linear"===e.args[0]?n.TYPES.LINEAR:n.TYPES.RADIAL}var n=e("./gradientcontainer");r.prototype=Object.create(n.prototype),t.exports=r},{"./gradientcontainer":9}],28:[function(e,t){function r(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200===n.status?t(n.responseText):r(new Error(n.statusText))},n.onerror=function(){r(new Error("Network Error"))},n.send()})}t.exports=r},{}]},{},[4])(4)});(function(){var e=false;var t=this;var r=function(e){if(e instanceof r)return e;if(!(this instanceof r))return new r(e);this.EXIFwrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=r}exports.EXIF=r}else{t.EXIF=r}var n=r.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};var i=r.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"};var a=r.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};var o=r.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"};var s=r.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function u(e,t,r){if(e.addEventListener){e.addEventListener(t,r,false)}else if(e.attachEvent){e.attachEvent("on"+t,r)}}function l(e){return!!e.exifdata}function c(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"";e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");var r=atob(e);var n=r.length;var i=new ArrayBuffer(n);var a=new Uint8Array(i);for(var o=0;o<n;o++){a[o]=r.charCodeAt(o)}return i}function p(e,t){var r=new XMLHttpRequest;r.open("GET",e,true);r.responseType="blob";r.onload=function(e){if(this.status==200||this.status===0){t(this.response)}};r.send()}function d(t,n){function i(e){var i=f(e);t.exifdata=i||{};var a=h(e);t.iptcdata=a||{};if(r.isXmpEnabled){var o=x(e);t.xmpdata=o||{}}if(n){n.call(t)}}if(t.src){if(/^data\:/i.test(t.src)){var a=c(t.src);i(a)}else if(/^blob\:/i.test(t.src)){var o=new FileReader;o.onload=function(e){i(e.target.result)};p(t.src,function(e){o.readAsArrayBuffer(e)})}else{var s=new XMLHttpRequest;s.onload=function(){if(this.status==200||this.status===0){i(s.response)}else{throw"Could not load image"}s=null};s.open("GET",t.src,true);s.responseType="arraybuffer";s.send(null)}}else if(self.FileReader&&(t instanceof self.Blob||t instanceof self.File)){var o=new FileReader;o.onload=function(t){if(e)console.log("Got file of length "+t.target.result.byteLength);i(t.target.result)};o.readAsArrayBuffer(t)}}function f(t){var r=new DataView(t);if(e)console.log("Got file of length "+t.byteLength);if(r.getUint8(0)!=255||r.getUint8(1)!=216){if(e)console.log("Not a valid JPEG");return false}var n=2,i=t.byteLength,a;while(n<i){if(r.getUint8(n)!=255){if(e)console.log("Not a valid marker at offset "+n+", found: "+r.getUint8(n));return false}a=r.getUint8(n+1);if(e)console.log(a);if(a==225){if(e)console.log("Found 0xFFE1 marker");return S(r,n+4,r.getUint16(n+2)-2)}else{n+=2+r.getUint16(n+2)}}}function h(t){var r=new DataView(t);if(e)console.log("Got file of length "+t.byteLength);if(r.getUint8(0)!=255||r.getUint8(1)!=216){if(e)console.log("Not a valid JPEG");return false}var n=2,i=t.byteLength;var a=function(e,t){return e.getUint8(t)===56&&e.getUint8(t+1)===66&&e.getUint8(t+2)===73&&e.getUint8(t+3)===77&&e.getUint8(t+4)===4&&e.getUint8(t+5)===4};while(n<i){if(a(r,n)){var o=r.getUint8(n+7);if(o%2!==0)o+=1;if(o===0){o=4}var s=n+8+o;var u=r.getUint16(n+6+o);return g(t,s,u);break}n++}}var m={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function g(e,t,r){var n=new DataView(e);var i={};var a,o,s,u,l;var c=t;while(c<t+r){if(n.getUint8(c)===28&&n.getUint8(c+1)===2){u=n.getUint8(c+2);if(u in m){s=n.getInt16(c+3);l=s+5;o=m[u];a=C(n,c+5,s);if(i.hasOwnProperty(o)){if(i[o]instanceof Array){i[o].push(a)}else{i[o]=[i[o],a]}}else{i[o]=a}}}c++}return i}function v(t,r,n,i,a){var o=t.getUint16(n,!a),s={},u,l,c;for(c=0;c<o;c++){u=n+c*12+2;l=i[t.getUint16(u,!a)];if(!l&&e)console.log("Unknown tag: "+t.getUint16(u,!a));s[l]=b(t,u,r,n,a)}return s}function b(e,t,r,n,i){var a=e.getUint16(t+2,!i),o=e.getUint32(t+4,!i),s=e.getUint32(t+8,!i)+r,u,l,c,p,d,f;switch(a){case 1:case 7:if(o==1){return e.getUint8(t+8,!i)}else{u=o>4?s:t+8;l=[];for(p=0;p<o;p++){l[p]=e.getUint8(u+p)}return l}case 2:u=o>4?s:t+8;return C(e,u,o-1);case 3:if(o==1){return e.getUint16(t+8,!i)}else{u=o>2?s:t+8;l=[];for(p=0;p<o;p++){l[p]=e.getUint16(u+2*p,!i)}return l}case 4:if(o==1){return e.getUint32(t+8,!i)}else{l=[];for(p=0;p<o;p++){l[p]=e.getUint32(s+4*p,!i)}return l}case 5:if(o==1){d=e.getUint32(s,!i);f=e.getUint32(s+4,!i);c=new Number(d/f);c.numerator=d;c.denominator=f;return c}else{l=[];for(p=0;p<o;p++){d=e.getUint32(s+8*p,!i);f=e.getUint32(s+4+8*p,!i);l[p]=new Number(d/f);l[p].numerator=d;l[p].denominator=f}return l}case 9:if(o==1){return e.getInt32(t+8,!i)}else{l=[];for(p=0;p<o;p++){l[p]=e.getInt32(s+4*p,!i)}return l}case 10:if(o==1){return e.getInt32(s,!i)/e.getInt32(s+4,!i)}else{l=[];for(p=0;p<o;p++){l[p]=e.getInt32(s+8*p,!i)/e.getInt32(s+4+8*p,!i)}return l}}}function y(e,t,r){var n=e.getUint16(t,!r);return e.getUint32(t+2+n*12,!r)}function w(e,t,r,n){var i=y(e,t+r,n);if(!i){return{}}else if(i>e.byteLength){return{}}var a=v(e,t,t+i,o,n);if(a["Compression"]){switch(a["Compression"]){case 6:if(a.JpegIFOffset&&a.JpegIFByteCount){var s=t+a.JpegIFOffset;var u=a.JpegIFByteCount;a["blob"]=new Blob([new Uint8Array(e.buffer,s,u)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",a["Compression"])}}else if(a["PhotometricInterpretation"]==2){console.log("Thumbnail image format is RGB, which is not implemented.")}return a}function C(e,t,r){var n="";for(var i=t;i<t+r;i++){n+=String.fromCharCode(e.getUint8(i))}return n}function S(t,r){if(C(t,r,4)!="Exif"){if(e)console.log("Not valid EXIF data! "+C(t,r,4));return false}var o,u,l,c,p,d=r+6;if(t.getUint16(d)==18761){o=false}else if(t.getUint16(d)==19789){o=true}else{if(e)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false}if(t.getUint16(d+2,!o)!=42){if(e)console.log("Not valid TIFF data! (no 0x002A)");return false}var f=t.getUint32(d+4,!o);if(f<8){if(e)console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(d+4,!o));return false}u=v(t,d,d+f,i,o);if(u.ExifIFDPointer){c=v(t,d,d+u.ExifIFDPointer,n,o);for(l in c){switch(l){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":c[l]=s[l][c[l]];break;case"ExifVersion":case"FlashpixVersion":c[l]=String.fromCharCode(c[l][0],c[l][1],c[l][2],c[l][3]);break;case"ComponentsConfiguration":c[l]=s.Components[c[l][0]]+s.Components[c[l][1]]+s.Components[c[l][2]]+s.Components[c[l][3]];break}u[l]=c[l]}}if(u.GPSInfoIFDPointer){p=v(t,d,d+u.GPSInfoIFDPointer,a,o);for(l in p){switch(l){case"GPSVersionID":p[l]=p[l][0]+"."+p[l][1]+"."+p[l][2]+"."+p[l][3];break}u[l]=p[l]}}u["thumbnail"]=w(t,d,f,o);return u}function x(t){if(!("DOMParser"in self)){return}var r=new DataView(t);if(e)console.log("Got file of length "+t.byteLength);if(r.getUint8(0)!=255||r.getUint8(1)!=216){if(e)console.log("Not a valid JPEG");return false}var n=2,i=t.byteLength,a=new DOMParser;while(n<i-4){if(C(r,n,4)=="http"){var o=n-1;var s=r.getUint16(n-2)-1;var u=C(r,o,s);var l=u.indexOf("xmpmeta>")+8;u=u.substring(u.indexOf("<x:xmpmeta"),l);var c=u.indexOf("x:xmpmeta")+10;u=u.slice(0,c)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" '+'xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+'xmlns:tiff="http://ns.adobe.com/tiff/1.0/" '+'xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" '+'xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" '+'xmlns:exif="http://ns.adobe.com/exif/1.0/" '+'xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" '+'xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" '+'xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" '+'xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" '+'xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+u.slice(c);var p=a.parseFromString(u,"text/xml");return T(p)}else{n++}}}function A(e){var t={};if(e.nodeType==1){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var n=e.attributes.item(r);t["@attributes"][n.nodeName]=n.nodeValue}}}else if(e.nodeType==3){return e.nodeValue}if(e.hasChildNodes()){for(var i=0;i<e.childNodes.length;i++){var a=e.childNodes.item(i);var o=a.nodeName;if(t[o]==null){t[o]=A(a)}else{if(t[o].push==null){var s=t[o];t[o]=[];t[o].push(s)}t[o].push(A(a))}}}return t}function T(e){try{var t={};if(e.children.length>0){for(var r=0;r<e.children.length;r++){var n=e.children.item(r);var i=n.attributes;for(var a in i){var o=i[a];var s=o.nodeName;var u=o.nodeValue;if(s!==undefined){t[s]=u}}var l=n.nodeName;if(typeof t[l]=="undefined"){t[l]=A(n)}else{if(typeof t[l].push=="undefined"){var c=t[l];t[l]=[];t[l].push(c)}t[l].push(A(n))}}}else{t=e.textContent}return t}catch(p){console.log(p.message)}}r.enableXmp=function(){r.isXmpEnabled=true};r.disableXmp=function(){r.isXmpEnabled=false};r.getData=function(e,t){if((self.Image&&e instanceof self.Image||self.HTMLImageElement&&e instanceof self.HTMLImageElement)&&!e.complete)return false;if(!l(e)){d(e,t)}else{if(t){t.call(e)}}return true};r.getTag=function(e,t){if(!l(e))return;return e.exifdata[t]};r.getIptcTag=function(e,t){if(!l(e))return;return e.iptcdata[t]};r.getAllTags=function(e){if(!l(e))return{};var t,r=e.exifdata,n={};for(t in r){if(r.hasOwnProperty(t)){n[t]=r[t]}}return n};r.getAllIptcTags=function(e){if(!l(e))return{};var t,r=e.iptcdata,n={};for(t in r){if(r.hasOwnProperty(t)){n[t]=r[t]}}return n};r.pretty=function(e){if(!l(e))return"";var t,r=e.exifdata,n="";for(t in r){if(r.hasOwnProperty(t)){if(typeof r[t]=="object"){if(r[t]instanceof Number){n+=t+" : "+r[t]+" ["+r[t].numerator+"/"+r[t].denominator+"]\r\n"}else{n+=t+" : ["+r[t].length+" values]\r\n"}}else{n+=t+" : "+r[t]+"\r\n"}}}return n};r.readFromBinaryFile=function(e){return f(e)};if(typeof define==="function"&&define.amd){define("exif-js",[],function(){return r})}}).call(this);(function(e,t,r,n){"use strict";var i=["","webkit","Moz","MS","ms","o"];var a=t.createElement("div");var o="function";var s=Math.round;var u=Math.abs;var l=Date.now;function c(e,t,r){return setTimeout(b(e,r),t)}function p(e,t,r){if(Array.isArray(e)){d(e,r[t],r);return true}return false}function d(e,t,r){var i;if(!e){return}if(e.forEach){e.forEach(t,r)}else if(e.length!==n){i=0;while(i<e.length){t.call(r,e[i],i,e);i++}}else{for(i in e){e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}}}function f(t,r,n){var i="DEPRECATED METHOD: "+r+"\n"+n+" AT \n";return function(){var r=new Error("get-stack-trace");var n=r&&r.stack?r.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace";var a=e.console&&(e.console.warn||e.console.log);if(a){a.call(e.console,i,n)}return t.apply(this,arguments)}}var h;if(typeof Object.assign!=="function"){h=function xt(e){if(e===n||e===null){throw new TypeError("Cannot convert undefined or null to object")}var t=Object(e);for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i!==n&&i!==null){for(var a in i){if(i.hasOwnProperty(a)){t[a]=i[a]}}}}return t}}else{h=Object.assign}var m=f(function At(e,t,r){var i=Object.keys(t);var a=0;while(a<i.length){if(!r||r&&e[i[a]]===n){e[i[a]]=t[i[a]]}a++}return e},"extend","Use `assign`.");var g=f(function Tt(e,t){return m(e,t,true)},"merge","Use `assign`.");function v(e,t,r){var n=t.prototype,i;i=e.prototype=Object.create(n);i.constructor=e;i._super=n;if(r){h(i,r)}}function b(e,t){return function r(){return e.apply(t,arguments)}}function y(e,t){if(typeof e==o){return e.apply(t?t[0]||n:n,t)}return e}function w(e,t){return e===n?t:e}function C(e,t,r){d(T(t),function(t){e.addEventListener(t,r,false)})}function S(e,t,r){d(T(t),function(t){e.removeEventListener(t,r,false)})}function x(e,t){while(e){if(e==t){return true}e=e.parentNode}return false}function A(e,t){return e.indexOf(t)>-1}function T(e){return e.trim().split(/\s+/g)}function I(e,t,r){if(e.indexOf&&!r){return e.indexOf(t)}else{var n=0;while(n<e.length){if(r&&e[n][r]==t||!r&&e[n]===t){return n}n++}return-1}}function E(e){return Array.prototype.slice.call(e,0)}function P(e,t,r){var n=[];var i=[];var a=0;while(a<e.length){var o=t?e[a][t]:e[a];if(I(i,o)<0){n.push(e[a])}i[a]=o;a++}if(r){if(!t){n=n.sort()}else{n=n.sort(function s(e,r){return e[t]>r[t]})}}return n}function k(e,t){var r,a;var o=t[0].toUpperCase()+t.slice(1);var s=0;while(s<i.length){r=i[s];a=r?r+o:t;if(a in e){return a}s++}return n}var M=1;function $(){return M++}function D(t){var r=t.ownerDocument||t;return r.defaultView||r.parentWindow||e}var L=/mobile|tablet|ip(ad|hone|od)|android/i;var R="ontouchstart"in e;var N=k(e,"PointerEvent")!==n;var U=R&&L.test(navigator.userAgent);var F="touch";var O="pen";var B="mouse";var H="kinect";var q=25;var G=1;var _=2;var W=4;var z=8;var j=1;var V=2;var Q=4;var Y=8;var X=16;var K=V|Q;var J=Y|X;var Z=K|J;var ee=["x","y"];var te=["clientX","clientY"];function re(e,t){var r=this;this.manager=e;this.callback=t;this.element=e.element;this.target=e.options.inputTarget;this.domHandler=function(t){if(y(e.options.enable,[e])){r.handler(t)}};this.init()}re.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler);this.evTarget&&C(this.target,this.evTarget,this.domHandler);this.evWin&&C(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler);this.evTarget&&S(this.target,this.evTarget,this.domHandler);this.evWin&&S(D(this.element),this.evWin,this.domHandler)}};function ne(e){var t;var r=e.options.inputClass;if(r){t=r}else if(N){t=Ae}else if(U){t=De}else if(!R){t=ye}else{t=Ue}return new t(e,ie)}function ie(e,t,r){var n=r.pointers.length;var i=r.changedPointers.length;var a=t&G&&n-i===0;var o=t&(W|z)&&n-i===0;r.isFirst=!!a;r.isFinal=!!o;if(a){e.session={}}r.eventType=t;ae(e,r);e.emit("hammer.input",r);e.recognize(r);e.session.prevInput=r}function ae(e,t){var r=e.session;var n=t.pointers;var i=n.length;if(!r.firstInput){r.firstInput=ue(t)}if(i>1&&!r.firstMultiple){r.firstMultiple=ue(t)}else if(i===1){r.firstMultiple=false}var a=r.firstInput;var o=r.firstMultiple;var s=o?o.center:a.center;var c=t.center=le(n);t.timeStamp=l();t.deltaTime=t.timeStamp-a.timeStamp;t.angle=fe(s,c);t.distance=de(s,c);oe(r,t);t.offsetDirection=pe(t.deltaX,t.deltaY);var p=ce(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x;t.overallVelocityY=p.y;t.overallVelocity=u(p.x)>u(p.y)?p.x:p.y;t.scale=o?me(o.pointers,n):1;t.rotation=o?he(o.pointers,n):0;t.maxPointers=!r.prevInput?t.pointers.length:t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers;se(r,t);var d=e.element;if(x(t.srcEvent.target,d)){d=t.srcEvent.target}t.target=d}function oe(e,t){var r=t.center;var n=e.offsetDelta||{};var i=e.prevDelta||{};var a=e.prevInput||{};if(t.eventType===G||a.eventType===W){i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0};n=e.offsetDelta={x:r.x,y:r.y}}t.deltaX=i.x+(r.x-n.x);t.deltaY=i.y+(r.y-n.y)}function se(e,t){var r=e.lastInterval||t,i=t.timeStamp-r.timeStamp,a,o,s,l;if(t.eventType!=z&&(i>q||r.velocity===n)){var c=t.deltaX-r.deltaX;var p=t.deltaY-r.deltaY;var d=ce(i,c,p);o=d.x;s=d.y;a=u(d.x)>u(d.y)?d.x:d.y;l=pe(c,p);e.lastInterval=t}else{a=r.velocity;o=r.velocityX;s=r.velocityY;l=r.direction}t.velocity=a;t.velocityX=o;t.velocityY=s;t.direction=l}function ue(e){var t=[];var r=0;while(r<e.pointers.length){t[r]={clientX:s(e.pointers[r].clientX),clientY:s(e.pointers[r].clientY)};r++}return{timeStamp:l(),pointers:t,center:le(t),deltaX:e.deltaX,deltaY:e.deltaY}}function le(e){var t=e.length;if(t===1){return{x:s(e[0].clientX),y:s(e[0].clientY)}}var r=0,n=0,i=0;while(i<t){r+=e[i].clientX;n+=e[i].clientY;i++}return{x:s(r/t),y:s(n/t)}}function ce(e,t,r){return{x:t/e||0,y:r/e||0}}function pe(e,t){if(e===t){return j}if(u(e)>=u(t)){return e<0?V:Q}return t<0?Y:X}function de(e,t,r){if(!r){r=ee}var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.sqrt(n*n+i*i)}function fe(e,t,r){if(!r){r=ee}var n=t[r[0]]-e[r[0]],i=t[r[1]]-e[r[1]];return Math.atan2(i,n)*180/Math.PI}function he(e,t){return fe(t[1],t[0],te)+fe(e[1],e[0],te)}function me(e,t){return de(t[0],t[1],te)/de(e[0],e[1],te)}var ge={mousedown:G,mousemove:_,mouseup:W};var ve="mousedown";var be="mousemove mouseup";function ye(){this.evEl=ve;this.evWin=be;this.pressed=false;re.apply(this,arguments)}v(ye,re,{handler:function It(e){var t=ge[e.type];if(t&G&&e.button===0){this.pressed=true}if(t&_&&e.which!==1){t=W}if(!this.pressed){return}if(t&W){this.pressed=false}this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:B,srcEvent:e})}});var we={pointerdown:G,pointermove:_,pointerup:W,pointercancel:z,pointerout:z};var Ce={2:F,3:O,4:B,5:H};var Se="pointerdown";var xe="pointermove pointerup pointercancel";if(e.MSPointerEvent&&!e.PointerEvent){Se="MSPointerDown";xe="MSPointerMove MSPointerUp MSPointerCancel"}function Ae(){this.evEl=Se;this.evWin=xe;re.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}v(Ae,re,{handler:function Et(e){var t=this.store;var r=false;var n=e.type.toLowerCase().replace("ms","");var i=we[n];var a=Ce[e.pointerType]||e.pointerType;var o=a==F;var s=I(t,e.pointerId,"pointerId");if(i&G&&(e.button===0||o)){if(s<0){t.push(e);s=t.length-1}}else if(i&(W|z)){r=true}if(s<0){return}t[s]=e;this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e});if(r){t.splice(s,1)}}});var Te={touchstart:G,touchmove:_,touchend:W,touchcancel:z};var Ie="touchstart";var Ee="touchstart touchmove touchend touchcancel";function Pe(){this.evTarget=Ie;this.evWin=Ee;this.started=false;re.apply(this,arguments)}v(Pe,re,{handler:function Pt(e){var t=Te[e.type];if(t===G){this.started=true}if(!this.started){return}var r=ke.call(this,e,t);if(t&(W|z)&&r[0].length-r[1].length===0){this.started=false}this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:e})}});function ke(e,t){var r=E(e.touches);var n=E(e.changedTouches);if(t&(W|z)){r=P(r.concat(n),"identifier",true)}return[r,n]}var Me={touchstart:G,touchmove:_,touchend:W,touchcancel:z};var $e="touchstart touchmove touchend touchcancel";function De(){this.evTarget=$e;this.targetIds={};re.apply(this,arguments)}v(De,re,{handler:function kt(e){var t=Me[e.type];var r=Le.call(this,e,t);if(!r){return}this.callback(this.manager,t,{pointers:r[0],changedPointers:r[1],pointerType:F,srcEvent:e})}});function Le(e,t){var r=E(e.touches);var n=this.targetIds;if(t&(G|_)&&r.length===1){n[r[0].identifier]=true;return[r,r]}var i,a,o=E(e.changedTouches),s=[],u=this.target;a=r.filter(function(e){return x(e.target,u)});if(t===G){i=0;while(i<a.length){n[a[i].identifier]=true;i++}}i=0;while(i<o.length){if(n[o[i].identifier]){s.push(o[i])}if(t&(W|z)){delete n[o[i].identifier]}i++}if(!s.length){return}return[P(a.concat(s),"identifier",true),s]}var Re=2500;var Ne=25;function Ue(){re.apply(this,arguments);var e=b(this.handler,this);this.touch=new De(this.manager,e);this.mouse=new ye(this.manager,e);this.primaryTouch=null;this.lastTouches=[]}v(Ue,re,{handler:function Mt(e,t,r){var n=r.pointerType==F,i=r.pointerType==B;if(i&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents){return}if(n){Fe.call(this,t,r)}else if(i&&Be.call(this,r)){return}this.callback(e,t,r)},destroy:function $t(){this.touch.destroy();this.mouse.destroy()}});function Fe(e,t){if(e&G){this.primaryTouch=t.changedPointers[0].identifier;Oe.call(this,t)}else if(e&(W|z)){Oe.call(this,t)}}function Oe(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var r={
x:t.clientX,y:t.clientY};this.lastTouches.push(r);var n=this.lastTouches;var i=function(){var e=n.indexOf(r);if(e>-1){n.splice(e,1)}};setTimeout(i,Re)}}function Be(e){var t=e.srcEvent.clientX,r=e.srcEvent.clientY;for(var n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n];var a=Math.abs(t-i.x),o=Math.abs(r-i.y);if(a<=Ne&&o<=Ne){return true}}return false}var He=k(a.style,"touchAction");var qe=He!==n;var Ge="compute";var _e="auto";var We="manipulation";var ze="none";var je="pan-x";var Ve="pan-y";var Qe=Ke();function Ye(e,t){this.manager=e;this.set(t)}Ye.prototype={set:function(e){if(e==Ge){e=this.compute()}if(qe&&this.manager.element.style&&Qe[e]){this.manager.element.style[He]=e}this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];d(this.manager.recognizers,function(t){if(y(t.options.enable,[t])){e=e.concat(t.getTouchAction())}});return Xe(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent;var r=e.offsetDirection;if(this.manager.session.prevented){t.preventDefault();return}var n=this.actions;var i=A(n,ze)&&!Qe[ze];var a=A(n,Ve)&&!Qe[Ve];var o=A(n,je)&&!Qe[je];if(i){var s=e.pointers.length===1;var u=e.distance<2;var l=e.deltaTime<250;if(s&&u&&l){return}}if(o&&a){return}if(i||a&&r&K||o&&r&J){return this.preventSrc(t)}},preventSrc:function(e){this.manager.session.prevented=true;e.preventDefault()}};function Xe(e){if(A(e,ze)){return ze}var t=A(e,je);var r=A(e,Ve);if(t&&r){return ze}if(t||r){return t?je:Ve}if(A(e,We)){return We}return _e}function Ke(){if(!qe){return false}var t={};var r=e.CSS&&e.CSS.supports;["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=r?e.CSS.supports("touch-action",n):true});return t}var Je=1;var Ze=2;var et=4;var tt=8;var rt=tt;var nt=16;var it=32;function at(e){this.options=h({},this.defaults,e||{});this.id=$();this.manager=null;this.options.enable=w(this.options.enable,true);this.state=Je;this.simultaneous={};this.requireFail=[]}at.prototype={defaults:{},set:function(e){h(this.options,e);this.manager&&this.manager.touchAction.update();return this},recognizeWith:function(e){if(p(e,"recognizeWith",this)){return this}var t=this.simultaneous;e=ut(e,this);if(!t[e.id]){t[e.id]=e;e.recognizeWith(this)}return this},dropRecognizeWith:function(e){if(p(e,"dropRecognizeWith",this)){return this}e=ut(e,this);delete this.simultaneous[e.id];return this},requireFailure:function(e){if(p(e,"requireFailure",this)){return this}var t=this.requireFail;e=ut(e,this);if(I(t,e)===-1){t.push(e);e.requireFailure(this)}return this},dropRequireFailure:function(e){if(p(e,"dropRequireFailure",this)){return this}e=ut(e,this);var t=I(this.requireFail,e);if(t>-1){this.requireFail.splice(t,1)}return this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this;var r=this.state;function n(r){t.manager.emit(r,e)}if(r<tt){n(t.options.event+ot(r))}n(t.options.event);if(e.additionalEvent){n(e.additionalEvent)}if(r>=tt){n(t.options.event+ot(r))}},tryEmit:function(e){if(this.canEmit()){return this.emit(e)}this.state=it},canEmit:function(){var e=0;while(e<this.requireFail.length){if(!(this.requireFail[e].state&(it|Je))){return false}e++}return true},recognize:function(e){var t=h({},e);if(!y(this.options.enable,[this,t])){this.reset();this.state=it;return}if(this.state&(rt|nt|it)){this.state=Je}this.state=this.process(t);if(this.state&(Ze|et|tt|nt)){this.tryEmit(t)}},process:function(e){},getTouchAction:function(){},reset:function(){}};function ot(e){if(e&nt){return"cancel"}else if(e&tt){return"end"}else if(e&et){return"move"}else if(e&Ze){return"start"}return""}function st(e){if(e==X){return"down"}else if(e==Y){return"up"}else if(e==V){return"left"}else if(e==Q){return"right"}return""}function ut(e,t){var r=t.manager;if(r){return r.get(e)}return e}function lt(){at.apply(this,arguments)}v(lt,at,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return t===0||e.pointers.length===t},process:function(e){var t=this.state;var r=e.eventType;var n=t&(Ze|et);var i=this.attrTest(e);if(n&&(r&z||!i)){return t|nt}else if(n||i){if(r&W){return t|tt}else if(!(t&Ze)){return Ze}return t|et}return it}});function ct(){lt.apply(this,arguments);this.pX=null;this.pY=null}v(ct,lt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Z},getTouchAction:function(){var e=this.options.direction;var t=[];if(e&K){t.push(Ve)}if(e&J){t.push(je)}return t},directionTest:function(e){var t=this.options;var r=true;var n=e.distance;var i=e.direction;var a=e.deltaX;var o=e.deltaY;if(!(i&t.direction)){if(t.direction&K){i=a===0?j:a<0?V:Q;r=a!=this.pX;n=Math.abs(e.deltaX)}else{i=o===0?j:o<0?Y:X;r=o!=this.pY;n=Math.abs(e.deltaY)}}e.direction=i;return r&&n>t.threshold&&i&t.direction},attrTest:function(e){return lt.prototype.attrTest.call(this,e)&&(this.state&Ze||!(this.state&Ze)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX;this.pY=e.deltaY;var t=st(e.direction);if(t){e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}});function pt(){lt.apply(this,arguments)}v(pt,lt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ze]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&Ze)},emit:function(e){if(e.scale!==1){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}});function dt(){at.apply(this,arguments);this._timer=null;this._input=null}v(dt,at,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[_e]},process:function(e){var t=this.options;var r=e.pointers.length===t.pointers;var n=e.distance<t.threshold;var i=e.deltaTime>t.time;this._input=e;if(!n||!r||e.eventType&(W|z)&&!i){this.reset()}else if(e.eventType&G){this.reset();this._timer=c(function(){this.state=rt;this.tryEmit()},t.time,this)}else if(e.eventType&W){return rt}return it},reset:function(){clearTimeout(this._timer)},emit:function(e){if(this.state!==rt){return}if(e&&e.eventType&W){this.manager.emit(this.options.event+"up",e)}else{this._input.timeStamp=l();this.manager.emit(this.options.event,this._input)}}});function ft(){lt.apply(this,arguments)}v(ft,lt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ze]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&Ze)}});function ht(){lt.apply(this,arguments)}v(ht,lt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:K|J,pointers:1},getTouchAction:function(){return ct.prototype.getTouchAction.call(this)},attrTest:function(e){var t=this.options.direction;var r;if(t&(K|J)){r=e.overallVelocity}else if(t&K){r=e.overallVelocityX}else if(t&J){r=e.overallVelocityY}return this._super.attrTest.call(this,e)&&t&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&u(r)>this.options.velocity&&e.eventType&W},emit:function(e){var t=st(e.offsetDirection);if(t){this.manager.emit(this.options.event+t,e)}this.manager.emit(this.options.event,e)}});function mt(){at.apply(this,arguments);this.pTime=false;this.pCenter=false;this._timer=null;this._input=null;this.count=0}v(mt,at,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[We]},process:function(e){var t=this.options;var r=e.pointers.length===t.pointers;var n=e.distance<t.threshold;var i=e.deltaTime<t.time;this.reset();if(e.eventType&G&&this.count===0){return this.failTimeout()}if(n&&i&&r){if(e.eventType!=W){return this.failTimeout()}var a=this.pTime?e.timeStamp-this.pTime<t.interval:true;var o=!this.pCenter||de(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp;this.pCenter=e.center;if(!o||!a){this.count=1}else{this.count+=1}this._input=e;var s=this.count%t.taps;if(s===0){if(!this.hasRequireFailures()){return rt}else{this._timer=c(function(){this.state=rt;this.tryEmit()},t.interval,this);return Ze}}}return it},failTimeout:function(){this._timer=c(function(){this.state=it},this.options.interval,this);return it},reset:function(){clearTimeout(this._timer)},emit:function(){if(this.state==rt){this._input.tapCount=this.count;this.manager.emit(this.options.event,this._input)}}});function gt(e,t){t=t||{};t.recognizers=w(t.recognizers,gt.defaults.preset);return new yt(e,t)}gt.VERSION="2.0.8";gt.defaults={domEvents:false,touchAction:Ge,enable:true,inputTarget:null,inputClass:null,preset:[[ft,{enable:false}],[pt,{enable:false},["rotate"]],[ht,{direction:K}],[ct,{direction:K},["swipe"]],[mt],[mt,{event:"doubletap",taps:2},["tap"]],[dt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vt=1;var bt=2;function yt(e,t){this.options=h({},gt.defaults,t||{});this.options.inputTarget=this.options.inputTarget||e;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=e;this.input=ne(this);this.touchAction=new Ye(this,this.options.touchAction);wt(this,true);d(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]);e[3]&&t.requireFailure(e[3])},this)}yt.prototype={set:function(e){h(this.options,e);if(e.touchAction){this.touchAction.update()}if(e.inputTarget){this.input.destroy();this.input.target=e.inputTarget;this.input.init()}return this},stop:function(e){this.session.stopped=e?bt:vt},recognize:function(e){var t=this.session;if(t.stopped){return}this.touchAction.preventDefaults(e);var r;var n=this.recognizers;var i=t.curRecognizer;if(!i||i&&i.state&rt){i=t.curRecognizer=null}var a=0;while(a<n.length){r=n[a];if(t.stopped!==bt&&(!i||r==i||r.canRecognizeWith(i))){r.recognize(e)}else{r.reset()}if(!i&&r.state&(Ze|et|tt)){i=t.curRecognizer=r}a++}},get:function(e){if(e instanceof at){return e}var t=this.recognizers;for(var r=0;r<t.length;r++){if(t[r].options.event==e){return t[r]}}return null},add:function(e){if(p(e,"add",this)){return this}var t=this.get(e.options.event);if(t){this.remove(t)}this.recognizers.push(e);e.manager=this;this.touchAction.update();return e},remove:function(e){if(p(e,"remove",this)){return this}e=this.get(e);if(e){var t=this.recognizers;var r=I(t,e);if(r!==-1){t.splice(r,1);this.touchAction.update()}}return this},on:function(e,t){if(e===n){return}if(t===n){return}var r=this.handlers;d(T(e),function(e){r[e]=r[e]||[];r[e].push(t)});return this},off:function(e,t){if(e===n){return}var r=this.handlers;d(T(e),function(e){if(!t){delete r[e]}else{r[e]&&r[e].splice(I(r[e],t),1)}});return this},emit:function(e,t){if(this.options.domEvents){Ct(e,t)}var r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length){return}t.type=e;t.preventDefault=function(){t.srcEvent.preventDefault()};var n=0;while(n<r.length){r[n](t);n++}},destroy:function(){this.element&&wt(this,false);this.handlers={};this.session={};this.input.destroy();this.element=null}};function wt(e,t){var r=e.element;if(!r.style){return}var n;d(e.options.cssProps,function(i,a){n=k(r.style,a);if(t){e.oldCssProps[n]=r.style[n];r.style[n]=i}else{r.style[n]=e.oldCssProps[n]||""}});if(!t){e.oldCssProps={}}}function Ct(e,r){var n=t.createEvent("Event");n.initEvent(e,true,true);n.gesture=r;r.target.dispatchEvent(n)}h(gt,{INPUT_START:G,INPUT_MOVE:_,INPUT_END:W,INPUT_CANCEL:z,STATE_POSSIBLE:Je,STATE_BEGAN:Ze,STATE_CHANGED:et,STATE_ENDED:tt,STATE_RECOGNIZED:rt,STATE_CANCELLED:nt,STATE_FAILED:it,DIRECTION_NONE:j,DIRECTION_LEFT:V,DIRECTION_RIGHT:Q,DIRECTION_UP:Y,DIRECTION_DOWN:X,DIRECTION_HORIZONTAL:K,DIRECTION_VERTICAL:J,DIRECTION_ALL:Z,Manager:yt,Input:re,TouchAction:Ye,TouchInput:De,MouseInput:ye,PointerEventInput:Ae,TouchMouseInput:Ue,SingleTouchInput:Pe,Recognizer:at,AttrRecognizer:lt,Tap:mt,Pan:ct,Swipe:ht,Pinch:pt,Rotate:ft,Press:dt,on:C,off:S,each:d,merge:g,extend:m,assign:h,inherit:v,bindFn:b,prefixed:k});var St=typeof e!=="undefined"?e:typeof self!=="undefined"?self:{};St.Hammer=gt;if(typeof define==="function"&&define.amd){define(function(){return gt})}else if(typeof module!="undefined"&&module.exports){module.exports=gt}else{e[r]=gt}})(window,document,"Hammer");(function(){var e=window.MutationObserver||window.WebKitMutationObserver;var t="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;var r=document.documentElement.style["touch-action"]!==undefined||document.documentElement.style["-ms-touch-action"];if(r||!t||!e){return}window.Hammer=window.Hammer||{};var n=/touch-action[:][\s]*(none)[^;'"]*/;var i=/touch-action[:][\s]*(manipulation)[^;'"]*/;var a=/touch-action/;var o=/(iP(ad|hone|od))/.test(navigator.userAgent)&&("indexedDB"in window||!!window.performance);window.Hammer.time={getTouchAction:function(e){return this.checkStyleString(e.getAttribute("style"))},checkStyleString:function(e){if(!a.test(e)){return undefined}if(n.test(e)){return"none"}if(i.test(e)){return"manipulation"}return true},shouldHammer:function(e){var t=e.target.hasParent;return t&&(!o||Date.now()-e.target.lastStart<125)?t:false},touchHandler:function(e){var t=this.shouldHammer(e);if(t==="none"){this.dropHammer(e)}else if(t==="manipulation"){var r=e.target.getBoundingClientRect();var n=r.top!==this.pos.top||r.left!==this.pos.left;!n&&this.dropHammer(e)}this.scrolled=false;delete e.target.lastStart;delete e.target.hasParent},dropHammer:function(e){if(e.type==="touchend"){e.target.focus();setTimeout(function(){e.target.click()},0)}e.preventDefault()},touchStart:function(e){this.pos=e.target.getBoundingClientRect();e.target.hasParent=this.hasParent(e.target);if(o&&e.target.hasParent){e.target.lastStart=Date.now()}},styleWatcher:function(e){e.forEach(this.styleUpdater,this)},styleUpdater:function(e){if(e.target.updateNext){e.target.updateNext=false;return}var t=this.getTouchAction(e.target);if(t){if(t!=="none"){e.target.hadTouchNone=false}return}if(!t&&(e.oldValue&&this.checkStyleString(e.oldValue)||e.target.hadTouchNone)){e.target.hadTouchNone=true;e.target.updateNext=false;e.target.setAttribute("style",e.target.getAttribute("style")+" touch-action: none;")}},hasParent:function(e){var t;for(var r=e;r&&r.parentNode;r=r.parentNode){t=this.getTouchAction(r);if(t){return t}}return false},installStartEvents:function(){document.addEventListener("touchstart",this.touchStart.bind(this));document.addEventListener("mousedown",this.touchStart.bind(this))},installEndEvents:function(){document.addEventListener("touchend",this.touchHandler.bind(this),true);document.addEventListener("mouseup",this.touchHandler.bind(this),true)},installObserver:function(){this.observer=new e(this.styleWatcher.bind(this)).observe(document,{subtree:true,attributes:true,attributeOldValue:true,attributeFilter:["style"]})},install:function(){this.installEndEvents();this.installStartEvents();this.installObserver()}};window.Hammer.time.install()})();(function(e){e.fn.appendText=function(t){return this.each(function(){var r=document.createTextNode(t);e(this).append(r)})}})(jQuery);!function(e){"use strict";var t=0?console.log.bind(console,"[fastdom]"):function(){};var r=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.msRequestAnimationFrame||function(e){return setTimeout(e,16)};function n(){var n=this;n.reads=[];n.writes=[];n.raf=r.bind(e);t("initialized",n)}n.prototype={constructor:n,measure:function(e,r){t("measure");var n=!r?e:e.bind(r);this.reads.push(n);i(this);return n},mutate:function(e,r){t("mutate");var n=!r?e:e.bind(r);this.writes.push(n);i(this);return n},clear:function(e){t("clear",e);return s(this.reads,e)||s(this.writes,e)},extend:function(e){t("extend",e);if(typeof e!="object")throw new Error("expected object");var r=Object.create(this);u(r,e);r.fastdom=this;if(r.initialize)r.initialize();return r},"catch":null};function i(e){if(!e.scheduled){e.scheduled=true;e.raf(a.bind(null,e));t("flush scheduled")}}function a(e){t("flush");var r=e.writes;var n=e.reads;var a;try{t("flushing reads",n.length);o(n);t("flushing writes",r.length);o(r)}catch(s){a=s}e.scheduled=false;if(n.length||r.length)i(e);if(a){t("task errored",a.message);if(e.catch)e.catch(a);else throw a}}function o(e){t("run tasks");var r;while(r=e.shift())r()}function s(e,t){var r=e.indexOf(t);return!!~r&&!!e.splice(r,1)}function u(e,t){for(var r in t){if(t.hasOwnProperty(r))e[r]=t[r]}}var l=e.fastdom=e.fastdom||new n;if((typeof define)[0]=="f")define(function(){return l});else if((typeof module)[0]=="o")module.exports=l}(this);(function(e,t){if(typeof module==="object"&&module.exports){module.exports=t()}else if(typeof define==="function"&&define.amd){define(t)}else{e.findAndReplaceDOMText=t()}})(this,function t(){var e="retain";var t="first";var r=document;var n={}.hasOwnProperty;function i(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function a(){return o.apply(null,arguments)||s.apply(null,arguments)}function o(e,t,r,n,i){if(t&&!t.nodeType&&arguments.length<=2){return false}var o=typeof r=="function";if(o){r=function(e){return function(t,r){return e(t.text,r.startIndex)}}(r)}var u=s(t,{find:e,wrap:o?null:r,replace:o?r:"$"+(n||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(n>0){var r=e[n];e.index+=e[0].indexOf(r);e[0]=r}e.endIndex=e.index+e[0].length;e.startIndex=e.index;e.index=t;return e},filterElements:i});a.revert=function(){return u.revert()};return true}function s(e,t){return new u(e,t)}a.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1};a.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1};a.NON_INLINE_PROSE=function(e){return n.call(a.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())};a.PRESETS={prose:{forceContext:a.NON_INLINE_PROSE,filterElements:function(e){return!n.call(a.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}};a.Finder=u;function u(t,r){var i=r.preset&&a.PRESETS[r.preset];r.portionMode=r.portionMode||e;if(i){for(var o in i){if(n.call(i,o)&&!n.call(r,o)){r[o]=i[o]}}}this.node=t;this.options=r;this.prepMatch=r.prepMatch||this.prepMatch;this.reverts=[];this.matches=this.search();if(this.matches.length){this.processMatches()}}u.prototype={search:function(){var e;var t=0;var r=0;var n=this.options.find;var a=this.getAggregateText();var o=[];var s=this;n=typeof n==="string"?RegExp(i(n),"g"):n;u(a);function u(i){for(var a=0,l=i.length;a<l;++a){var c=i[a];if(typeof c!=="string"){u(c);continue}if(n.global){while(e=n.exec(c)){o.push(s.prepMatch(e,t++,r))}}else{if(e=c.match(n)){o.push(s.prepMatch(e,0,r))}}r+=c.length}}return o},prepMatch:function(e,t,r){if(!e[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}e.endIndex=r+e.index+e[0].length;e.startIndex=r+e.index;e.index=t;return e},getAggregateText:function(){var e=this.options.filterElements;var t=this.options.forceContext;return r(this.node);function r(n){if(n.nodeType===3){return[n.data]}if(e&&!e(n)){return[]}var i=[""];var a=0;if(n=n.firstChild)do{if(n.nodeType===3){i[a]+=n.data;continue}var o=r(n);if(t&&n.nodeType===1&&(t===true||t(n))){i[++a]=o;i[++a]=""}else{if(typeof o[0]==="string"){i[a]+=o.shift()}if(o.length){i[++a]=o;i[++a]=""}}}while(n=n.nextSibling);return i}},processMatches:function(){var e=this.matches;var t=this.node;var r=this.options.filterElements;var n,i,a=[],o=t,s=e.shift(),u=0,l=0,c=0,p,d=[t];e:while(true){if(o.nodeType===3){if(!i&&o.length+u>=s.endIndex){i={node:o,index:c++,text:o.data.substring(s.startIndex-u,s.endIndex-u),indexInMatch:u-s.startIndex,indexInNode:s.startIndex-u,endIndexInNode:s.endIndex-u,isEnd:true}}else if(n){a.push({node:o,index:c++,text:o.data,indexInMatch:u-s.startIndex,indexInNode:0})}if(!n&&o.length+u>s.startIndex){n={node:o,index:c++,indexInMatch:0,indexInNode:s.startIndex-u,endIndexInNode:s.endIndex-u,text:o.data.substring(s.startIndex-u,s.endIndex-u)}}u+=o.data.length}p=o.nodeType===1&&r&&!r(o);if(n&&i){o=this.replaceMatch(s,n,a,i);u-=i.node.data.length-i.endIndexInNode;n=null;i=null;a=[];s=e.shift();c=0;l++;if(!s){break}}else if(!p&&(o.firstChild||o.nextSibling)){if(o.firstChild){d.push(o);o=o.firstChild}else{o=o.nextSibling}continue}while(true){if(o.nextSibling){o=o.nextSibling;break}o=d.pop();if(o===t){break e}}}},revert:function(){for(var e=this.reverts.length;e--;){this.reverts[e]()}this.reverts=[]},prepareReplacementString:function(e,r,n){var i=this.options.portionMode;if(i===t&&r.indexInMatch>0){return""}e=e.replace(/\$(\d+|&|`|')/g,function(e,t){var r;switch(t){case"&":r=n[0];break;case"`":r=n.input.substring(0,n.startIndex);break;case"'":r=n.input.substring(n.endIndex);break;default:r=n[+t]}return r});if(i===t){return e}if(r.isEnd){return e.substring(r.indexInMatch)}return e.substring(r.indexInMatch,r.indexInMatch+r.text.length)},getPortionReplacementNode:function(e,t){var n=this.options.replace||"$&";var i=this.options.wrap;if(i&&i.nodeType){var a=r.createElement("div");a.innerHTML=i.outerHTML||(new XMLSerializer).serializeToString(i);i=a.firstChild}if(typeof n=="function"){n=n(e,t);if(n&&n.nodeType){return n}return r.createTextNode(String(n))}var o=typeof i=="string"?r.createElement(i):i;n=r.createTextNode(this.prepareReplacementString(n,e,t));if(!n.data){return n}if(!o){return n}o.appendChild(n);return o},replaceMatch:function(e,t,n,i){var a=t.node;var o=i.node;var s;var u;if(a===o){var l=a;if(t.indexInNode>0){s=r.createTextNode(l.data.substring(0,t.indexInNode));l.parentNode.insertBefore(s,l)}var c=this.getPortionReplacementNode(i,e);l.parentNode.insertBefore(c,l);if(i.endIndexInNode<l.length){u=r.createTextNode(l.data.substring(i.endIndexInNode));l.parentNode.insertBefore(u,l)}l.parentNode.removeChild(l);this.reverts.push(function(){if(s===c.previousSibling){s.parentNode.removeChild(s)}if(u===c.nextSibling){u.parentNode.removeChild(u)}c.parentNode.replaceChild(l,c)});return c}else{s=r.createTextNode(a.data.substring(0,t.indexInNode));u=r.createTextNode(o.data.substring(i.endIndexInNode));var p=this.getPortionReplacementNode(t,e);var d=[];for(var f=0,h=n.length;f<h;++f){var m=n[f];var g=this.getPortionReplacementNode(m,e);m.node.parentNode.replaceChild(g,m.node);this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(m,g));d.push(g)}var v=this.getPortionReplacementNode(i,e);a.parentNode.insertBefore(s,a);a.parentNode.insertBefore(p,a);a.parentNode.removeChild(a);o.parentNode.insertBefore(v,o);o.parentNode.insertBefore(u,o);o.parentNode.removeChild(o);this.reverts.push(function(){s.parentNode.removeChild(s);p.parentNode.replaceChild(a,p);u.parentNode.removeChild(u);v.parentNode.replaceChild(o,v)});return v}}};return a});(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){e.ui=e.ui||{};e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});e.fn.extend({scrollParent:function(t){var r=this.css("position"),n=r==="absolute",i=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);if(n&&t.css("position")==="static"){return false}return i.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return r==="fixed"||!a.length?e(this[0].ownerDocument||document):a},uniqueId:function(){var e=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+ ++e}})}}(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){e(this).removeAttr("id")}})}});function t(t,n){var i,a,o,s=t.nodeName.toLowerCase();if("area"===s){i=t.parentNode;a=i.name;if(!t.href||!a||i.nodeName.toLowerCase()!=="map"){return false}o=e("img[usemap='#"+a+"']")[0];return!!o&&r(o)}return(/^(input|select|textarea|button|object)$/.test(s)?!t.disabled:"a"===s?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(r){return!!e.data(r,t)}}):function(t,r,n){return!!e.data(t,n[3])},focusable:function(r){return t(r,!isNaN(e.attr(r,"tabindex")))},tabbable:function(r){var n=e.attr(r,"tabindex"),i=isNaN(n);return(i||n>=0)&&t(r,!i)}});if(!e("<a>").outerWidth(1).jquery){e.each(["Width","Height"],function(t,r){var n=r==="Width"?["Left","Right"]:["Top","Bottom"],i=r.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function o(t,r,i,a){e.each(n,function(){r-=parseFloat(e.css(t,"padding"+this))||0;if(i){r-=parseFloat(e.css(t,"border"+this+"Width"))||0}if(a){r-=parseFloat(e.css(t,"margin"+this))||0}});return r}e.fn["inner"+r]=function(t){if(t===undefined){return a["inner"+r].call(this)}return this.each(function(){e(this).css(i,o(this,t)+"px")})};e.fn["outer"+r]=function(t,n){if(typeof t!=="number"){return a["outer"+r].call(this,t)}return this.each(function(){e(this).css(i,o(this,t,true,n)+"px")})}})}if(!e.fn.addBack){e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}if(e("<a>").data("a-b","a").removeData("a-b").data("a-b")){e.fn.removeData=function(t){return function(r){if(arguments.length){return t.call(this,e.camelCase(r))}else{return t.call(this)}}}(e.fn.removeData)}e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());e.fn.extend({focus:function(t){return function(r,n){return typeof r==="number"?this.each(function(){var t=this;setTimeout(function(){e(t).focus();if(n){n.call(t)}},r)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(t!==undefined){return this.css("zIndex",t)}if(this.length){var r=e(this[0]),n,i;while(r.length&&r[0]!==document){n=r.css("position");if(n==="absolute"||n==="relative"||n==="fixed"){i=parseInt(r.css("zIndex"),10);if(!isNaN(i)&&i!==0){return i}}r=r.parent()}}return 0}});e.ui.plugin={add:function(t,r,n){var i,a=e.ui[t].prototype;for(i in n){a.plugins[i]=a.plugins[i]||[];a.plugins[i].push([r,n[i]])}},call:function(e,t,r,n){var i,a=e.plugins[t];if(!a){return}if(!n&&(!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)){return}for(i=0;i<a.length;i++){if(e.options[a[i][0]]){a[i][1].apply(e.element,r)}}}};var n=0,i=Array.prototype.slice;e.cleanData=function(t){return function(r){var n,i,a;for(a=0;(i=r[a])!=null;a++){try{n=e._data(i,"events");if(n&&n.remove){e(i).triggerHandler("remove")}}catch(o){}}t(r)}}(e.cleanData);e.widget=function(t,r,n){var i,a,o,s,u={},l=t.split(".")[0];t=t.split(".")[1];i=l+"-"+t;if(!n){n=r;r=e.Widget}e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)};e[l]=e[l]||{};a=e[l][t];o=e[l][t]=function(e,t){if(!this._createWidget){return new o(e,t)}if(arguments.length){this._createWidget(e,t)}};e.extend(o,a,{version:n.version,_proto:e.extend({},n),_childConstructors:[]});s=new r;s.options=e.widget.extend({},s.options);e.each(n,function(t,n){if(!e.isFunction(n)){u[t]=n;return}u[t]=function(){var e=function(){return r.prototype[t].apply(this,arguments)},i=function(e){return r.prototype[t].apply(this,e)};return function(){var t=this._super,r=this._superApply,a;this._super=e;this._superApply=i;a=n.apply(this,arguments);this._super=t;this._superApply=r;return a}}()});o.prototype=e.widget.extend(s,{widgetEventPrefix:a?s.widgetEventPrefix||t:t},u,{constructor:o,namespace:l,widgetName:t,widgetFullName:i});if(a){e.each(a._childConstructors,function(t,r){var n=r.prototype;e.widget(n.namespace+"."+n.widgetName,o,r._proto)});delete a._childConstructors}else{r._childConstructors.push(o)}e.widget.bridge(t,o);return o};e.widget.extend=function(t){var r=i.call(arguments,1),n=0,a=r.length,o,s;for(;n<a;n++){for(o in r[n]){s=r[n][o];if(r[n].hasOwnProperty(o)&&s!==undefined){if(e.isPlainObject(s)){t[o]=e.isPlainObject(t[o])?e.widget.extend({},t[o],s):e.widget.extend({},s)}else{t[o]=s}}}}return t};e.widget.bridge=function(t,r){var n=r.prototype.widgetFullName||t;e.fn[t]=function(a){var o=typeof a==="string",s=i.call(arguments,1),u=this;if(o){this.each(function(){var r,i=e.data(this,n);if(a==="instance"){u=i;return false}if(!i){return e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}if(!e.isFunction(i[a])||a.charAt(0)==="_"){return e.error("no such method '"+a+"' for "+t+" widget instance")}r=i[a].apply(i,s);if(r!==i&&r!==undefined){u=r&&r.jquery?u.pushStack(r.get()):r;return false}})}else{if(s.length){a=e.widget.extend.apply(null,[a].concat(s))}this.each(function(){var t=e.data(this,n);if(t){t.option(a||{});if(t._init){t._init()}}else{e.data(this,n,new r(a,this))}})}return u}};e.Widget=function(){};e.Widget._childConstructors=[];e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0];this.element=e(r);this.uuid=n++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=e();this.hoverable=e();this.focusable=e();if(r!==this){e.data(r,this.widgetFullName,this);this._on(true,this.element,{remove:function(e){if(e.target===r){this.destroy()}}});this.document=e(r.style?r.ownerDocument:r.document||r);this.window=e(this.document[0].defaultView||this.document[0].parentWindow)}this.options=e.widget.extend({},this.options,this._getCreateOptions(),t);this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,r){var n=t,i,a,o;if(arguments.length===0){return e.widget.extend({},this.options)}if(typeof t==="string"){n={};i=t.split(".");t=i.shift();if(i.length){a=n[t]=e.widget.extend({},this.options[t]);for(o=0;o<i.length-1;o++){a[i[o]]=a[i[o]]||{};a=a[i[o]]}t=i.pop();if(arguments.length===1){return a[t]===undefined?null:a[t]}a[t]=r}else{if(arguments.length===1){return this.options[t]===undefined?null:this.options[t]}n[t]=r}}this._setOptions(n);return this},_setOptions:function(e){var t;for(t in e){this._setOption(t,e[t])}return this},_setOption:function(e,t){this.options[e]=t;if(e==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled",!!t);if(t){this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}}return this},enable:function(){return this._setOptions({disabled:false})},disable:function(){return this._setOptions({disabled:true})},_on:function(t,r,n){var i,a=this;if(typeof t!=="boolean"){n=r;r=t;t=false}if(!n){n=r;r=this.element;i=this.widget()}else{r=i=e(r);this.bindings=this.bindings.add(r)}e.each(n,function(n,o){function s(){if(!t&&(a.options.disabled===true||e(this).hasClass("ui-state-disabled"))){
return}return(typeof o==="string"?a[o]:o).apply(a,arguments)}if(typeof o!=="string"){s.guid=o.guid=o.guid||s.guid||e.guid++}var u=n.match(/^([\w:-]*)\s*(.*)$/),l=u[1]+a.eventNamespace,c=u[2];if(c){i.delegate(c,l,s)}else{r.bind(l,s)}})},_off:function(t,r){r=(r||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;t.unbind(r).undelegate(r);this.bindings=e(this.bindings.not(t).get());this.focusable=e(this.focusable.not(t).get());this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function r(){return(typeof e==="string"?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(r,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t);this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t);this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,r,n){var i,a,o=this.options[t];n=n||{};r=e.Event(r);r.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase();r.target=this.element[0];a=r.originalEvent;if(a){for(i in a){if(!(i in r)){r[i]=a[i]}}}this.element.trigger(r,n);return!(e.isFunction(o)&&o.apply(this.element[0],[r].concat(n))===false||r.isDefaultPrevented())}};e.each({show:"fadeIn",hide:"fadeOut"},function(t,r){e.Widget.prototype["_"+t]=function(n,i,a){if(typeof i==="string"){i={effect:i}}var o,s=!i?t:i===true||typeof i==="number"?r:i.effect||r;i=i||{};if(typeof i==="number"){i={duration:i}}o=!e.isEmptyObject(i);i.complete=a;if(i.delay){n.delay(i.delay)}if(o&&e.effects&&e.effects.effect[s]){n[t](i)}else if(s!==t&&n[s]){n[s](i.duration,i.easing,a)}else{n.queue(function(r){e(this)[t]();if(a){a.call(n[0])}r()})}}});var a=e.widget;var o=false;e(document).mouseup(function(){o=false});var s=e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(r){if(true===e.data(r.target,t.widgetName+".preventClickEvent")){e.removeData(r.target,t.widgetName+".preventClickEvent");r.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)}},_mouseDown:function(t){if(o){return}this._mouseMoved=false;this._mouseStarted&&this._mouseUp(t);this._mouseDownEvent=t;var r=this,n=t.which===1,i=typeof this.options.cancel==="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:false;if(!n||i||!this._mouseCapture(t)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==false;if(!this._mouseStarted){t.preventDefault();return true}}if(true===e.data(t.target,this.widgetName+".preventClickEvent")){e.removeData(t.target,this.widgetName+".preventClickEvent")}this._mouseMoveDelegate=function(e){return r._mouseMove(e)};this._mouseUpDelegate=function(e){return r._mouseUp(e)};this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);t.preventDefault();o=true;return true},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button){return this._mouseUp(t)}else if(!t.which){return this._mouseUp(t)}}if(t.which||t.button){this._mouseMoved=true}if(this._mouseStarted){this._mouseDrag(t);return t.preventDefault()}if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==false;this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)}return!this._mouseStarted},_mouseUp:function(t){this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(t.target===this._mouseDownEvent.target){e.data(t.target,this.widgetName+".preventClickEvent",true)}this._mouseStop(t)}o=false;return false},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}});e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"){this._setPositionRelative()}if(this.options.addClasses){this.element.addClass("ui-draggable")}if(this.options.disabled){this.element.addClass("ui-draggable-disabled")}this._setHandleClassName();this._mouseInit()},_setOption:function(e,t){this._super(e,t);if(e==="handle"){this._removeHandleClassName();this._setHandleClassName()}},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return}this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._removeHandleClassName();this._mouseDestroy()},_mouseCapture:function(t){var r=this.options;this._blurActiveElement(t);if(this.helper||r.disabled||e(t.target).closest(".ui-resizable-handle").length>0){return false}this.handle=this._getHandle(t);if(!this.handle){return false}this._blockFrames(r.iframeFix===true?"iframe":r.iframeFix);return true},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks}},_blurActiveElement:function(t){var r=this.document[0];if(!this.handleElement.is(t.target)){return}try{if(r.activeElement&&r.activeElement.nodeName.toLowerCase()!=="body"){e(r.activeElement).blur()}}catch(n){}},_mouseStart:function(t){var r=this.options;this.helper=this._createHelper(t);this.helper.addClass("ui-draggable-dragging");this._cacheHelperProportions();if(e.ui.ddmanager){e.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.hasFixedAncestor=this.helper.parents().filter(function(){return e(this).css("position")==="fixed"}).length>0;this.positionAbs=this.element.offset();this._refreshOffsets(t);this.originalPosition=this.position=this._generatePosition(t,false);this.originalPageX=t.pageX;this.originalPageY=t.pageY;r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt);this._setContainment();if(this._trigger("start",t)===false){this._clear();return false}this._cacheHelperProportions();if(e.ui.ddmanager&&!r.dropBehaviour){e.ui.ddmanager.prepareOffsets(this,t)}this._normalizeRightBottom();this._mouseDrag(t,true);if(e.ui.ddmanager){e.ui.ddmanager.dragStart(this,t)}return true},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:false,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,r){if(this.hasFixedAncestor){this.offset.parent=this._getParentOffset()}this.position=this._generatePosition(t,true);this.positionAbs=this._convertPositionTo("absolute");if(!r){var n=this._uiHash();if(this._trigger("drag",t,n)===false){this._mouseUp({});return false}this.position=n.position}this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if(e.ui.ddmanager){e.ui.ddmanager.drag(this,t)}return false},_mouseStop:function(t){var r=this,n=false;if(e.ui.ddmanager&&!this.options.dropBehaviour){n=e.ui.ddmanager.drop(this,t)}if(this.dropped){n=this.dropped;this.dropped=false}if(this.options.revert==="invalid"&&!n||this.options.revert==="valid"&&n||this.options.revert===true||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(r._trigger("stop",t)!==false){r._clear()}})}else{if(this._trigger("stop",t)!==false){this._clear()}}return false},_mouseUp:function(t){this._unblockFrames();if(e.ui.ddmanager){e.ui.ddmanager.dragStop(this,t)}if(this.handleElement.is(t.target)){this.element.focus()}return e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({})}else{this._clear()}return this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:true},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var r=this.options,n=e.isFunction(r.helper),i=n?e(r.helper.apply(this.element[0],[t])):r.helper==="clone"?this.element.clone().removeAttr("id"):this.element;if(!i.parents("body").length){i.appendTo(r.appendTo==="parent"?this.element[0].parentNode:r.appendTo)}if(n&&i[0]===this.element[0]){this._setPositionRelative()}if(i[0]!==this.element[0]&&!/(fixed|absolute)/.test(i.css("position"))){i.css("position","absolute")}return i},_setPositionRelative:function(){if(!/^(?:r|a|f)/.test(this.element.css("position"))){this.element[0].style.position="relative"}},_adjustOffsetFromHelper:function(t){if(typeof t==="string"){t=t.split(" ")}if(e.isArray(t)){t={left:+t[0],top:+t[1]||0}}if("left"in t){this.offset.click.left=t.left+this.margins.left}if("right"in t){this.offset.click.left=this.helperProportions.width-t.right+this.margins.left}if("top"in t){this.offset.click.top=t.top+this.margins.top}if("bottom"in t){this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top}},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),r=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==r&&e.contains(this.scrollParent[0],this.offsetParent[0])){t.left+=this.scrollParent.scrollLeft();t.top+=this.scrollParent.scrollTop()}if(this._isRootNode(this.offsetParent[0])){t={top:0,left:0}}return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition!=="relative"){return{top:0,left:0}}var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(!t?this.scrollParent.scrollTop():0),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(!t?this.scrollParent.scrollLeft():0)}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,r,n,i=this.options,a=this.document[0];this.relativeContainer=null;if(!i.containment){this.containment=null;return}if(i.containment==="window"){this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment==="document"){this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment.constructor===Array){this.containment=i.containment;return}if(i.containment==="parent"){i.containment=this.helper[0].parentNode}r=e(i.containment);n=r[0];if(!n){return}t=/(scroll|auto)/.test(r.css("overflow"));this.containment=[(parseInt(r.css("borderLeftWidth"),10)||0)+(parseInt(r.css("paddingLeft"),10)||0),(parseInt(r.css("borderTopWidth"),10)||0)+(parseInt(r.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(r.css("borderRightWidth"),10)||0)-(parseInt(r.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(r.css("borderBottomWidth"),10)||0)-(parseInt(r.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relativeContainer=r},_convertPositionTo:function(e,t){if(!t){t=this.position}var r=e==="absolute"?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.offset.scroll.top:n?0:this.offset.scroll.top)*r,left:t.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.offset.scroll.left:n?0:this.offset.scroll.left)*r}},_generatePosition:function(e,t){var r,n,i,a,o=this.options,s=this._isRootNode(this.scrollParent[0]),u=e.pageX,l=e.pageY;if(!s||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}}if(t){if(this.containment){if(this.relativeContainer){n=this.relativeContainer.offset();r=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]}else{r=this.containment}if(e.pageX-this.offset.click.left<r[0]){u=r[0]+this.offset.click.left}if(e.pageY-this.offset.click.top<r[1]){l=r[1]+this.offset.click.top}if(e.pageX-this.offset.click.left>r[2]){u=r[2]+this.offset.click.left}if(e.pageY-this.offset.click.top>r[3]){l=r[3]+this.offset.click.top}}if(o.grid){i=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;l=r?i-this.offset.click.top>=r[1]||i-this.offset.click.top>r[3]?i:i-this.offset.click.top>=r[1]?i-o.grid[1]:i+o.grid[1]:i;a=o.grid[0]?this.originalPageX+Math.round((u-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;u=r?a-this.offset.click.left>=r[0]||a-this.offset.click.left>r[2]?a:a-this.offset.click.left>=r[0]?a-o.grid[0]:a+o.grid[0]:a}if(o.axis==="y"){u=this.originalPageX}if(o.axis==="x"){l=this.originalPageY}}return{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.offset.scroll.top:s?0:this.offset.scroll.top),left:u-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.offset.scroll.left:s?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy()}},_normalizeRightBottom:function(){if(this.options.axis!=="y"&&this.helper.css("right")!=="auto"){this.helper.width(this.helper.width());this.helper.css("right","auto")}if(this.options.axis!=="x"&&this.helper.css("bottom")!=="auto"){this.helper.height(this.helper.height());this.helper.css("bottom","auto")}},_trigger:function(t,r,n){n=n||this._uiHash();e.ui.plugin.call(this,t,[r,n,this],true);if(/^(drag|start|stop)/.test(t)){this.positionAbs=this._convertPositionTo("absolute");n.offset=this.positionAbs}return e.Widget.prototype._trigger.call(this,t,r,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}});e.ui.plugin.add("draggable","connectToSortable",{start:function(t,r,n){var i=e.extend({},r,{item:n.element});n.sortables=[];e(n.options.connectToSortable).each(function(){var r=e(this).sortable("instance");if(r&&!r.options.disabled){n.sortables.push(r);r.refreshPositions();r._trigger("activate",t,i)}})},stop:function(t,r,n){var i=e.extend({},r,{item:n.element});n.cancelHelperRemoval=false;e.each(n.sortables,function(){var e=this;if(e.isOver){e.isOver=0;n.cancelHelperRemoval=true;e.cancelHelperRemoval=false;e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")};e._mouseStop(t);e.options.helper=e.options._helper}else{e.cancelHelperRemoval=true;e._trigger("deactivate",t,i)}})},drag:function(t,r,n){e.each(n.sortables,function(){var i=false,a=this;a.positionAbs=n.positionAbs;a.helperProportions=n.helperProportions;a.offset.click=n.offset.click;if(a._intersectsWith(a.containerCache)){i=true;e.each(n.sortables,function(){this.positionAbs=n.positionAbs;this.helperProportions=n.helperProportions;this.offset.click=n.offset.click;if(this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])){i=false}return i})}if(i){if(!a.isOver){a.isOver=1;n._parent=r.helper.parent();a.currentItem=r.helper.appendTo(a.element).data("ui-sortable-item",true);a.options._helper=a.options.helper;a.options.helper=function(){return r.helper[0]};t.target=a.currentItem[0];a._mouseCapture(t,true);a._mouseStart(t,true,true);a.offset.click.top=n.offset.click.top;a.offset.click.left=n.offset.click.left;a.offset.parent.left-=n.offset.parent.left-a.offset.parent.left;a.offset.parent.top-=n.offset.parent.top-a.offset.parent.top;n._trigger("toSortable",t);n.dropped=a.element;e.each(n.sortables,function(){this.refreshPositions()});n.currentItem=n.element;a.fromOutside=n}if(a.currentItem){a._mouseDrag(t);r.position=a.position}}else{if(a.isOver){a.isOver=0;a.cancelHelperRemoval=true;a.options._revert=a.options.revert;a.options.revert=false;a._trigger("out",t,a._uiHash(a));a._mouseStop(t,true);a.options.revert=a.options._revert;a.options.helper=a.options._helper;if(a.placeholder){a.placeholder.remove()}r.helper.appendTo(n._parent);n._refreshOffsets(t);r.position=n._generatePosition(t,true);n._trigger("fromSortable",t);n.dropped=false;e.each(n.sortables,function(){this.refreshPositions()})}}})}});e.ui.plugin.add("draggable","cursor",{start:function(t,r,n){var i=e("body"),a=n.options;if(i.css("cursor")){a._cursor=i.css("cursor")}i.css("cursor",a.cursor)},stop:function(t,r,n){var i=n.options;if(i._cursor){e("body").css("cursor",i._cursor)}}});e.ui.plugin.add("draggable","opacity",{start:function(t,r,n){var i=e(r.helper),a=n.options;if(i.css("opacity")){a._opacity=i.css("opacity")}i.css("opacity",a.opacity)},stop:function(t,r,n){var i=n.options;if(i._opacity){e(r.helper).css("opacity",i._opacity)}}});e.ui.plugin.add("draggable","scroll",{start:function(e,t,r){if(!r.scrollParentNotHidden){r.scrollParentNotHidden=r.helper.scrollParent(false)}if(r.scrollParentNotHidden[0]!==r.document[0]&&r.scrollParentNotHidden[0].tagName!=="HTML"){r.overflowOffset=r.scrollParentNotHidden.offset()}},drag:function(t,r,n){var i=n.options,a=false,o=n.scrollParentNotHidden[0],s=n.document[0];if(o!==s&&o.tagName!=="HTML"){if(!i.axis||i.axis!=="x"){if(n.overflowOffset.top+o.offsetHeight-t.pageY<i.scrollSensitivity){o.scrollTop=a=o.scrollTop+i.scrollSpeed}else if(t.pageY-n.overflowOffset.top<i.scrollSensitivity){o.scrollTop=a=o.scrollTop-i.scrollSpeed}}if(!i.axis||i.axis!=="y"){if(n.overflowOffset.left+o.offsetWidth-t.pageX<i.scrollSensitivity){o.scrollLeft=a=o.scrollLeft+i.scrollSpeed}else if(t.pageX-n.overflowOffset.left<i.scrollSensitivity){o.scrollLeft=a=o.scrollLeft-i.scrollSpeed}}}else{if(!i.axis||i.axis!=="x"){if(t.pageY-e(s).scrollTop()<i.scrollSensitivity){a=e(s).scrollTop(e(s).scrollTop()-i.scrollSpeed)}else if(e(window).height()-(t.pageY-e(s).scrollTop())<i.scrollSensitivity){a=e(s).scrollTop(e(s).scrollTop()+i.scrollSpeed)}}if(!i.axis||i.axis!=="y"){if(t.pageX-e(s).scrollLeft()<i.scrollSensitivity){a=e(s).scrollLeft(e(s).scrollLeft()-i.scrollSpeed)}else if(e(window).width()-(t.pageX-e(s).scrollLeft())<i.scrollSensitivity){a=e(s).scrollLeft(e(s).scrollLeft()+i.scrollSpeed)}}}if(a!==false&&e.ui.ddmanager&&!i.dropBehaviour){e.ui.ddmanager.prepareOffsets(n,t)}}});e.ui.plugin.add("draggable","snap",{start:function(t,r,n){var i=n.options;n.snapElements=[];e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var t=e(this),r=t.offset();if(this!==n.element[0]){n.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:r.top,left:r.left})}})},drag:function(t,r,n){var i,a,o,s,u,l,c,p,d,f,h=n.options,m=h.snapTolerance,g=r.offset.left,v=g+n.helperProportions.width,b=r.offset.top,y=b+n.helperProportions.height;for(d=n.snapElements.length-1;d>=0;d--){u=n.snapElements[d].left-n.margins.left;l=u+n.snapElements[d].width;c=n.snapElements[d].top-n.margins.top;p=c+n.snapElements[d].height;if(v<u-m||g>l+m||y<c-m||b>p+m||!e.contains(n.snapElements[d].item.ownerDocument,n.snapElements[d].item)){if(n.snapElements[d].snapping){n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[d].item}))}n.snapElements[d].snapping=false;continue}if(h.snapMode!=="inner"){i=Math.abs(c-y)<=m;a=Math.abs(p-b)<=m;o=Math.abs(u-v)<=m;s=Math.abs(l-g)<=m;if(i){r.position.top=n._convertPositionTo("relative",{top:c-n.helperProportions.height,left:0}).top}if(a){r.position.top=n._convertPositionTo("relative",{top:p,left:0}).top}if(o){r.position.left=n._convertPositionTo("relative",{top:0,left:u-n.helperProportions.width}).left}if(s){r.position.left=n._convertPositionTo("relative",{top:0,left:l}).left}}f=i||a||o||s;if(h.snapMode!=="outer"){i=Math.abs(c-b)<=m;a=Math.abs(p-y)<=m;o=Math.abs(u-g)<=m;s=Math.abs(l-v)<=m;if(i){r.position.top=n._convertPositionTo("relative",{top:c,left:0}).top}if(a){r.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top}if(o){r.position.left=n._convertPositionTo("relative",{top:0,left:u}).left}if(s){r.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width}).left}}if(!n.snapElements[d].snapping&&(i||a||o||s||f)){n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[d].item}))}n.snapElements[d].snapping=i||a||o||s||f}}});e.ui.plugin.add("draggable","stack",{start:function(t,r,n){var i,a=n.options,o=e.makeArray(e(a.stack)).sort(function(t,r){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(r).css("zIndex"),10)||0)});if(!o.length){return}i=parseInt(e(o[0]).css("zIndex"),10)||0;e(o).each(function(t){e(this).css("zIndex",i+t)});this.css("zIndex",i+o.length)}});e.ui.plugin.add("draggable","zIndex",{start:function(t,r,n){var i=e(r.helper),a=n.options;if(i.css("zIndex")){a._zIndex=i.css("zIndex")}i.css("zIndex",a.zIndex)},stop:function(t,r,n){var i=n.options;if(i._zIndex){e(r.helper).css("zIndex",i._zIndex)}}});var u=e.ui.draggable});(function(){var e,t=[].indexOf||function(e){for(var t=0,r=this.length;t<r;t++){if(t in this&&this[t]===e)return t}return-1};e=jQuery;e.fn.validateCreditCard=function(r,n){var i,a,o,s,u,l,c,p,d,f,h,m,g;s=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^36/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[16]},{name:"mastercard",pattern:/^(5[1-5]|2[2-7])/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}];i=false;if(r){if(typeof r==="object"){n=r;i=false;r=null}else if(typeof r==="function"){i=true}}if(n==null){n={}}if(n.accept==null){n.accept=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++){a=s[e];r.push(a.name)}return r}()}g=n.accept;for(h=0,m=g.length;h<m;h++){o=g[h];if(t.call(function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++){a=s[e];r.push(a.name)}return r}(),o)<0){throw"Credit card type '"+o+"' is not supported"}}u=function(e){var r,i,u;u=function(){var e,r,i,o;o=[];for(e=0,r=s.length;e<r;e++){a=s[e];if(i=a.name,t.call(n.accept,i)>=0){o.push(a)}}return o}();for(r=0,i=u.length;r<i;r++){o=u[r];if(e.match(o.pattern)){return o}}return null};c=function(e){var t,r,n,i,a,o;n=0;o=e.split("").reverse();for(r=i=0,a=o.length;i<a;r=++i){t=o[r];t=+t;if(r%2){t*=2;if(t<10){n+=t}else{n+=t-9}}else{n+=t}}return n%10===0};l=function(e,r){var n;return n=e.length,t.call(r.valid_length,n)>=0};f=function(e){return function(e){var t,r;o=u(e);r=false;t=false;if(o!=null){r=c(e);t=l(e,o)}return{card_type:o,valid:r&&t,luhn_valid:r,length_valid:t}}}(this);d=function(t){return function(){var r;r=p(e(t).val());return f(r)}}(this);p=function(e){return e.replace(/[ -]/g,"")};if(!i){return d()}this.on("input.jccv",function(t){return function(){e(t).off("keyup.jccv");return r.call(t,d())}}(this));this.on("keyup.jccv",function(e){return function(){return r.call(e,d())}}(this));r.call(this,d());return this}}).call(this);jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,r,n,i){return jQuery.easing[jQuery.easing.def](e,t,r,n,i)},easeInQuad:function(e,t,r,n,i){return n*(t/=i)*t+r},easeOutQuad:function(e,t,r,n,i){return-n*(t/=i)*(t-2)+r},easeInOutQuad:function(e,t,r,n,i){if((t/=i/2)<1)return n/2*t*t+r;return-n/2*(--t*(t-2)-1)+r},easeInCubic:function(e,t,r,n,i){return n*(t/=i)*t*t+r},easeOutCubic:function(e,t,r,n,i){return n*((t=t/i-1)*t*t+1)+r},easeInOutCubic:function(e,t,r,n,i){if((t/=i/2)<1)return n/2*t*t*t+r;return n/2*((t-=2)*t*t+2)+r},easeInQuart:function(e,t,r,n,i){return n*(t/=i)*t*t*t+r},easeOutQuart:function(e,t,r,n,i){return-n*((t=t/i-1)*t*t*t-1)+r},easeInOutQuart:function(e,t,r,n,i){if((t/=i/2)<1)return n/2*t*t*t*t+r;return-n/2*((t-=2)*t*t*t-2)+r},easeInQuint:function(e,t,r,n,i){return n*(t/=i)*t*t*t*t+r},easeOutQuint:function(e,t,r,n,i){return n*((t=t/i-1)*t*t*t*t+1)+r},easeInOutQuint:function(e,t,r,n,i){if((t/=i/2)<1)return n/2*t*t*t*t*t+r;return n/2*((t-=2)*t*t*t*t+2)+r},easeInSine:function(e,t,r,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+r},easeOutSine:function(e,t,r,n,i){return n*Math.sin(t/i*(Math.PI/2))+r},easeInOutSine:function(e,t,r,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+r},easeInExpo:function(e,t,r,n,i){return t==0?r:n*Math.pow(2,10*(t/i-1))+r},easeOutExpo:function(e,t,r,n,i){return t==i?r+n:n*(-Math.pow(2,-10*t/i)+1)+r},easeInOutExpo:function(e,t,r,n,i){if(t==0)return r;if(t==i)return r+n;if((t/=i/2)<1)return n/2*Math.pow(2,10*(t-1))+r;return n/2*(-Math.pow(2,-10*--t)+2)+r},easeInCirc:function(e,t,r,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+r},easeOutCirc:function(e,t,r,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+r},easeInOutCirc:function(e,t,r,n,i){if((t/=i/2)<1)return-n/2*(Math.sqrt(1-t*t)-1)+r;return n/2*(Math.sqrt(1-(t-=2)*t)+1)+r},easeInElastic:function(e,t,r,n,i){var a=1.70158;var o=0;var s=n;if(t==0)return r;if((t/=i)==1)return r+n;if(!o)o=i*.3;if(s<Math.abs(n)){s=n;var a=o/4}else var a=o/(2*Math.PI)*Math.asin(n/s);return-(s*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o))+r},easeOutElastic:function(e,t,r,n,i){var a=1.70158;var o=0;var s=n;if(t==0)return r;if((t/=i)==1)return r+n;if(!o)o=i*.3;if(s<Math.abs(n)){s=n;var a=o/4}else var a=o/(2*Math.PI)*Math.asin(n/s);return s*Math.pow(2,-10*t)*Math.sin((t*i-a)*(2*Math.PI)/o)+n+r},easeInOutElastic:function(e,t,r,n,i){var a=1.70158;var o=0;var s=n;if(t==0)return r;if((t/=i/2)==2)return r+n;if(!o)o=i*(.3*1.5);if(s<Math.abs(n)){s=n;var a=o/4}else var a=o/(2*Math.PI)*Math.asin(n/s);if(t<1)return-.5*(s*Math.pow(2,10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o))+r;return s*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*(2*Math.PI)/o)*.5+n+r},easeInBack:function(e,t,r,n,i,a){if(a==undefined)a=1.70158;return n*(t/=i)*t*((a+1)*t-a)+r},easeOutBack:function(e,t,r,n,i,a){if(a==undefined)a=1.70158;return n*((t=t/i-1)*t*((a+1)*t+a)+1)+r},easeInOutBack:function(e,t,r,n,i,a){if(a==undefined)a=1.70158;if((t/=i/2)<1)return n/2*(t*t*(((a*=1.525)+1)*t-a))+r;return n/2*((t-=2)*t*(((a*=1.525)+1)*t+a)+2)+r},easeInBounce:function(e,t,r,n,i){return n-jQuery.easing.easeOutBounce(e,i-t,0,n,i)+r},easeOutBounce:function(e,t,r,n,i){if((t/=i)<1/2.75){return n*(7.5625*t*t)+r}else if(t<2/2.75){return n*(7.5625*(t-=1.5/2.75)*t+.75)+r}else if(t<2.5/2.75){return n*(7.5625*(t-=2.25/2.75)*t+.9375)+r}else{return n*(7.5625*(t-=2.625/2.75)*t+.984375)+r}},easeInOutBounce:function(e,t,r,n,i){if(t<i/2)return jQuery.easing.easeInBounce(e,t*2,0,n,i)*.5+r;return jQuery.easing.easeOutBounce(e,t*2-i,0,n,i)*.5+n*.5+r}});(function(e,t,r){if(typeof define==="function"&&define.amd){define(["jquery"],function(n){r(n,e,t);return n.mobile})}else{r(e.jQuery,e,t)}})(this,document,function(e,t,r,n){(function(e,t,r,n){var i="virtualMouseBindings",a="virtualTouchID",o="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),s="clientX clientY pageX pageY screenX screenY".split(" "),u=e.event.mouseHooks?e.event.mouseHooks.props:[],l=e.event.props.concat(u),c={},p=0,d=0,f=0,h=false,m=[],g=false,v=false,b="addEventListener"in r,y=e(r),w=1,C=0,S,x;e.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500};function A(e){while(e&&typeof e.originalEvent!=="undefined"){e=e.originalEvent}return e}function T(t,r){var i=t.type,a,o,u,c,p,d,f,h,m;t=e.Event(t);t.type=r;a=t.originalEvent;o=e.event.props;if(i.search(/^(mouse|click)/)>-1){o=l}if(a){for(f=o.length,c;f;){c=o[--f];t[c]=a[c]}}if(i.search(/mouse(down|up)|click/)>-1&&!t.which){t.which=1}if(i.search(/^touch/)!==-1){u=A(a);i=u.touches;p=u.changedTouches;d=i&&i.length?i[0]:p&&p.length?p[0]:n;if(d){for(h=0,m=s.length;h<m;h++){c=s[h];t[c]=d[c]}}}return t}function I(t){var r={},n,a;while(t){n=e.data(t,i);for(a in n){if(n[a]){r[a]=r.hasVirtualBinding=true}}t=t.parentNode}return r}function E(t,r){var n;while(t){n=e.data(t,i);if(n&&(!r||n[r])){return t}t=t.parentNode}return null}function P(){v=false}function k(){v=true}function M(){C=0;m.length=0;g=false;k()}function $(){P()}function D(){L();p=setTimeout(function(){p=0;M()},e.vmouse.resetTimerDuration)}function L(){if(p){clearTimeout(p);p=0}}function R(t,r,n){var i;if(n&&n[t]||!n&&E(r.target,t)){i=T(r,t);e(r.target).trigger(i)}return i}function N(t){var r=e.data(t.target,a),n;if(!g&&(!C||C!==r)){n=R("v"+t.type,t);if(n){if(n.isDefaultPrevented()){t.preventDefault()}if(n.isPropagationStopped()){t.stopPropagation()}if(n.isImmediatePropagationStopped()){t.stopImmediatePropagation()}}}}function U(t){var r=A(t).touches,n,i,o;if(r&&r.length===1){n=t.target;i=I(n);if(i.hasVirtualBinding){C=w++;e.data(n,a,C);L();$();h=false;o=A(t).touches[0];d=o.pageX;f=o.pageY;R("vmouseover",t,i);R("vmousedown",t,i)}}}function F(e){if(v){return}if(!h){R("vmousecancel",e,I(e.target))}h=true;D()}function O(t){if(v){return;
}var r=A(t).touches[0],n=h,i=e.vmouse.moveDistanceThreshold,a=I(t.target);h=h||(Math.abs(r.pageX-d)>i||Math.abs(r.pageY-f)>i);if(h&&!n){R("vmousecancel",t,a)}R("vmousemove",t,a);D()}function B(e){if(v){return}k();var t=I(e.target),r,n;R("vmouseup",e,t);if(!h){r=R("vclick",e,t);if(r&&r.isDefaultPrevented()){n=A(e).changedTouches[0];m.push({touchID:C,x:n.clientX,y:n.clientY});g=true}}R("vmouseout",e,t);h=false;D()}function H(t){var r=e.data(t,i),n;if(r){for(n in r){if(r[n]){return true}}}return false}function q(){}function G(t){var r=t.substr(1);return{setup:function(){if(!H(this)){e.data(this,i,{})}var n=e.data(this,i);n[t]=true;c[t]=(c[t]||0)+1;if(c[t]===1){y.bind(r,N)}e(this).bind(r,q);if(b){c["touchstart"]=(c["touchstart"]||0)+1;if(c["touchstart"]===1){y.bind("touchstart",U).bind("touchend",B).bind("touchmove",O).bind("scroll",F)}}},teardown:function(){--c[t];if(!c[t]){y.unbind(r,N)}if(b){--c["touchstart"];if(!c["touchstart"]){y.unbind("touchstart",U).unbind("touchmove",O).unbind("touchend",B).unbind("scroll",F)}}var n=e(this),a=e.data(this,i);if(a){a[t]=false}n.unbind(r,q);if(!H(this)){n.removeData(i)}}}}for(x=0;x<o.length;x++){e.event.special[o[x]]=G(o[x])}if(b){r.addEventListener("click",function(t){var r=m.length,n=t.target,i,o,s,u,l,c;if(r){i=t.clientX;o=t.clientY;S=e.vmouse.clickDistanceThreshold;s=n;while(s){for(u=0;u<r;u++){l=m[u];c=0;if(s===n&&Math.abs(l.x-i)<S&&Math.abs(l.y-o)<S||e.data(s,a)===l.touchID){t.preventDefault();t.stopPropagation();return}}s=s.parentNode}}},true)}})(e,t,r);(function(e){e.mobile={}})(e);(function(e,t){var n={touch:"ontouchend"in r};e.mobile.support=e.mobile.support||{};e.extend(e.support,n);e.extend(e.mobile.support,n)})(e);(function(e,t,n){var i=e(r),a=e.mobile.support.touch,o="touchmove scroll",s=a?"touchstart":"mousedown",u=a?"touchend":"mouseup",l=a?"touchmove":"mousemove";e.each(("touchstart touchmove touchend "+"tap taphold "+"swipe swipeleft swiperight "+"scrollstart scrollstop").split(" "),function(t,r){e.fn[r]=function(e){return e?this.bind(r,e):this.trigger(r)};if(e.attrFn){e.attrFn[r]=true}});function c(t,r,i,a){var o=i.type;i.type=r;if(a){e.event.trigger(i,n,t)}else{e.event.dispatch.call(t,i)}i.type=o}e.event.special.scrollstart={enabled:true,setup:function(){var t=this,r=e(t),n,i;function a(e,r){n=r;c(t,n?"scrollstart":"scrollstop",e)}r.bind(o,function(t){if(!e.event.special.scrollstart.enabled){return}if(!n){a(t,true)}clearTimeout(i);i=setTimeout(function(){a(t,false)},50)})},teardown:function(){e(this).unbind(o)}};e.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:true,setup:function(){var t=this,r=e(t),n=false;r.bind("vmousedown",function(a){n=false;if(a.which&&a.which!==1){return false}var o=a.target,s;function u(){clearTimeout(s)}function l(){u();r.unbind("vclick",p).unbind("vmouseup",u);i.unbind("vmousecancel",l)}function p(e){l();if(!n&&o===e.target){c(t,"tap",e)}else if(n){e.preventDefault()}}r.bind("vmouseup",u).bind("vclick",p);i.bind("vmousecancel",l);s=setTimeout(function(){if(!e.event.special.tap.emitTapOnTaphold){n=true}c(t,"taphold",e.Event("taphold",{target:o}))},e.event.special.tap.tapholdThreshold)})},teardown:function(){e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup");i.unbind("vmousecancel")}};e.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:30,verticalDistanceThreshold:30,getLocation:function(e){var r=t.pageXOffset,n=t.pageYOffset,i=e.clientX,a=e.clientY;if(e.pageY===0&&Math.floor(a)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(i)>Math.floor(e.pageX)){i=i-r;a=a-n}else if(a<e.pageY-n||i<e.pageX-r){i=e.pageX-r;a=e.pageY-n}return{x:i,y:a}},start:function(t){var r=t.originalEvent.touches?t.originalEvent.touches[0]:t,n=e.event.special.swipe.getLocation(r);return{time:(new Date).getTime(),coords:[n.x,n.y],origin:e(t.target)}},stop:function(t){var r=t.originalEvent.touches?t.originalEvent.touches[0]:t,n=e.event.special.swipe.getLocation(r);return{time:(new Date).getTime(),coords:[n.x,n.y]}},handleSwipe:function(t,r,n,i){if(r.time-t.time<e.event.special.swipe.durationThreshold&&Math.abs(t.coords[0]-r.coords[0])>e.event.special.swipe.horizontalDistanceThreshold&&Math.abs(t.coords[1]-r.coords[1])<e.event.special.swipe.verticalDistanceThreshold){var a=t.coords[0]>r.coords[0]?"swipeleft":"swiperight";c(n,"swipe",e.Event("swipe",{target:i,swipestart:t,swipestop:r}),true);c(n,a,e.Event(a,{target:i,swipestart:t,swipestop:r}),true);return true}return false},eventInProgress:false,setup:function(){var t,r=this,n=e(r),a={};t=e.data(this,"mobile-events");if(!t){t={length:0};e.data(this,"mobile-events",t)}t.length++;t.swipe=a;a.start=function(t){if(e.event.special.swipe.eventInProgress){return}e.event.special.swipe.eventInProgress=true;var n,o=e.event.special.swipe.start(t),s=t.target,c=false;a.move=function(t){if(!o||t.isDefaultPrevented()){return}n=e.event.special.swipe.stop(t);if(!c){c=e.event.special.swipe.handleSwipe(o,n,r,s);if(c){e.event.special.swipe.eventInProgress=false}}if(Math.abs(o.coords[0]-n.coords[0])>e.event.special.swipe.scrollSupressionThreshold){t.preventDefault()}};a.stop=function(){c=true;e.event.special.swipe.eventInProgress=false;i.off(l,a.move);a.move=null};i.on(l,a.move).one(u,a.stop)};n.on(s,a.start)},teardown:function(){var t,r;t=e.data(this,"mobile-events");if(t){r=t.swipe;delete t.swipe;t.length--;if(t.length===0){e.removeData(this,"mobile-events")}}if(r){if(r.start){e(this).off(s,r.start)}if(r.move){i.off(l,r.move)}if(r.stop){i.off(u,r.stop)}}}};e.each({scrollstop:"scrollstart",taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(t,r){e.event.special[t]={setup:function(){e(this).bind(r,e.noop)},teardown:function(){e(this).unbind(r)}}})})(e,this)});(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof exports==="object"){module.exports=e}else{e(jQuery)}})(function(e){var t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"];var r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];var n,i;if(e.event.fixHooks){for(var a=t.length;a;){e.event.fixHooks[t[--a]]=e.event.mouseHooks}}e.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=r.length;e;){this.addEventListener(r[--e],o,false)}}else{this.onmousewheel=o}},teardown:function(){if(this.removeEventListener){for(var e=r.length;e;){this.removeEventListener(r[--e],o,false)}}else{this.onmousewheel=null}}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function o(t){var r=t||window.event,a=[].slice.call(arguments,1),o=0,s=0,u=0,l=0,c=0,p;t=e.event.fix(r);t.type="mousewheel";if(r.wheelDelta){o=r.wheelDelta}if(r.detail){o=r.detail*-1}if(r.deltaY){u=r.deltaY*-1;o=u}if(r.deltaX){s=r.deltaX;o=s*-1}if(r.wheelDeltaY!==undefined){u=r.wheelDeltaY}if(r.wheelDeltaX!==undefined){s=r.wheelDeltaX*-1}l=Math.abs(o);if(!n||l<n){n=l}c=Math.max(Math.abs(u),Math.abs(s));if(!i||c<i){i=c}p=o>0?"floor":"ceil";o=Math[p](o/n);s=Math[p](s/i);u=Math[p](u/i);a.unshift(t,o,s,u);return(e.event.dispatch||e.event.handle).apply(this,a)}});(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof module!=="undefined"&&module.exports){module.exports=e(require("jquery"))}else{e(jQuery)}})(function(e){"use strict";var t=e.scrollTo=function(t,r,n){return e(window).scrollTo(t,r,n)};t.defaults={axis:"xy",duration:0,limit:true};function r(t){return!t.nodeName||e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])!==-1}e.fn.scrollTo=function(i,a,o){if(typeof a==="object"){o=a;a=0}if(typeof o==="function"){o={onAfter:o}}if(i==="max"){i=9e9}o=e.extend({},t.defaults,o);a=a||o.duration;var s=o.queue&&o.axis.length>1;if(s){a/=2}o.offset=n(o.offset);o.over=n(o.over);return this.each(function(){if(i===null)return;var u=r(this),l=u?this.contentWindow||window:this,c=e(l),p=i,d={},f;switch(typeof p){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(p)){p=n(p);break}p=u?e(p):e(p,l);case"object":if(p.length===0)return;if(p.is||p.style){f=(p=e(p)).offset()}}var h=e.isFunction(o.offset)&&o.offset(l,p)||o.offset;e.each(o.axis.split(""),function(e,r){var n=r==="x"?"Left":"Top",i=n.toLowerCase(),a="scroll"+n,g=c[a](),v=t.max(l,r);if(f){d[a]=f[i]+(u?0:g-c.offset()[i]);if(o.margin){d[a]-=parseInt(p.css("margin"+n),10)||0;d[a]-=parseInt(p.css("border"+n+"Width"),10)||0}d[a]+=h[i]||0;if(o.over[i]){d[a]+=p[r==="x"?"width":"height"]()*o.over[i]}}else{var b=p[i];d[a]=b.slice&&b.slice(-1)==="%"?parseFloat(b)/100*v:b}if(o.limit&&/^\d+$/.test(d[a])){d[a]=d[a]<=0?0:Math.min(d[a],v)}if(!e&&o.axis.length>1){if(g===d[a]){d={}}else if(s){m(o.onAfterFirst);d={}}}});m(o.onAfter);function m(t){var r=e.extend({},o,{queue:true,duration:a,complete:t&&function(){t.call(l,p,o)}});c.animate(d,r)}})};t.max=function(t,n){var i=n==="x"?"Width":"Height",a="scroll"+i;if(!r(t))return t[a]-e(t)[i.toLowerCase()]();var o="client"+i,s=t.ownerDocument||t.document,u=s.documentElement,l=s.body;return Math.max(u[a],l[a])-Math.min(u[o],l[o])};function n(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var r=this.get(t);if(t.options.interrupt&&t._last&&t._last!==r){return e(t.elem).stop()}var n=Math.round(t.now);if(r!==n){e(t.elem)[t.prop](n);t._last=this.get(t)}}};return t});(function(e){e.support.touch="ontouchend"in document;if(!e.support.touch){return}var t=e.ui.mouse.prototype,r=t._mouseInit,n=t._mouseDestroy,i;function a(t,r){if(t.originalEvent.touches.length>1){return}var n=t.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");if(e(n.target).is("input")||e(n.target).is("textarea")){t.stopPropagation()}else{if(t.cancelable)t.preventDefault()}i.initMouseEvent(r,true,true,window,1,n.screenX,n.screenY,n.clientX,n.clientY,false,false,false,false,0,null);t.target.dispatchEvent(i)}t._touchStart=function(e){var t=this;if(i||!t._mouseCapture(e.originalEvent.changedTouches[0])){return}i=true;t._touchMoved=false;this._startedMove=e.timeStamp;a(e,"mouseover");a(e,"mousemove");a(e,"mousedown")};t._touchMove=function(e){if(!i){return}this._touchMoved=true;a(e,"mousemove")};t._touchEnd=function(e){if(!i){return}a(e,"mouseup");a(e,"mouseout");var t=e.timeStamp-this._startedMove;if(!this._touchMoved||t<500){a(e,"click")}i=false};t._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")});r.call(t)};t._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")});n.call(t)}})(jQuery);(function(e){if(typeof define==="function"&&define.amd){define(e)}else if(typeof exports==="object"){module.exports=e()}else{var t=window.Cookies;var r=window.Cookies=e();r.noConflict=function(){window.Cookies=t;return r}}})(function(){function e(){var e=0;var t={};for(;e<arguments.length;e++){var r=arguments[e];for(var n in r){t[n]=r[n]}}return t}function t(r){function n(t,i,a){var o;if(arguments.length>1){a=e({path:"/"},n.defaults,a);if(typeof a.expires==="number"){var s=new Date;s.setMilliseconds(s.getMilliseconds()+a.expires*864e5);a.expires=s}try{o=JSON.stringify(i);if(/^[\{\[]/.test(o)){i=o}}catch(u){}if(!r.write){i=encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)}else{i=r.write(i,t)}t=encodeURIComponent(String(t));t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent);t=t.replace(/[\(\)]/g,escape);return document.cookie=[t,"=",i,a.expires&&"; expires="+a.expires.toUTCString(),a.path&&"; path="+a.path,a.domain&&"; domain="+a.domain,a.secure?"; secure":""].join("")}if(!t){o={}}var l=document.cookie?document.cookie.split("; "):[];var c=/(%[0-9A-Z]{2})+/g;var p=0;for(;p<l.length;p++){var d=l[p].split("=");var f=d[0].replace(c,decodeURIComponent);var h=d.slice(1).join("=");if(h.charAt(0)==='"'){h=h.slice(1,-1)}try{h=r.read?r.read(h,f):r(h,f)||h.replace(c,decodeURIComponent);if(this.json){try{h=JSON.parse(h)}catch(u){}}if(t===f){o=h;break}if(!t){o[f]=h}}catch(u){}}return o}n.get=n.set=n;n.getJSON=function(){return n.apply({json:true},[].slice.call(arguments))};n.defaults={};n.remove=function(t,r){n(t,"",e(r,{expires:-1}))};n.withConverter=t;return n}return t(function(){})});"use strict";if(!window.jscolor){window.jscolor=function(){var e={register:function(){e.attachDOMReadyEvent(e.init);e.attachEvent(document,"mousedown",e.onDocumentMouseDown);e.attachEvent(document,"touchstart",e.onDocumentTouchStart);e.attachEvent(window,"resize",e.onWindowResize)},init:function(){if(e.jscolor.lookupClass){e.jscolor.installByClassName(e.jscolor.lookupClass)}},tryInstallOnElements:function(t,r){var n=new RegExp("(^|\\s)("+r+")(\\s*(\\{[^}]*\\})|\\s|$)","i");for(var i=0;i<t.length;i+=1){if(t[i].type!==undefined&&t[i].type.toLowerCase()=="color"){if(e.isColorAttrSupported){continue}}var a;if(!t[i].jscolor&&t[i].className&&(a=t[i].className.match(n))){var o=t[i];var s=null;var u=e.getDataAttr(o,"jscolor");if(u!==null){s=u}else if(a[4]){s=a[4]}var l={};if(s){try{l=new Function("return ("+s+")")()}catch(c){e.warn("Error parsing jscolor options: "+c+":\n"+s)}}o.jscolor=new e.jscolor(o,l)}}},isColorAttrSupported:function(){var e=document.createElement("input");if(e.setAttribute){e.setAttribute("type","color");if(e.type.toLowerCase()=="color"){return true}}return false}(),isCanvasSupported:function(){var e=document.createElement("canvas");return!!(e.getContext&&e.getContext("2d"))}(),fetchElement:function(e){return typeof e==="string"?document.getElementById(e):e},isElementType:function(e,t){return e.nodeName.toLowerCase()===t.toLowerCase()},getDataAttr:function(e,t){var r="data-"+t;var n=e.getAttribute(r);if(n!==null){return n}return null},attachEvent:function(e,t,r){if(e.addEventListener){e.addEventListener(t,r,false)}else if(e.attachEvent){e.attachEvent("on"+t,r)}},detachEvent:function(e,t,r){if(e.removeEventListener){e.removeEventListener(t,r,false)}else if(e.detachEvent){e.detachEvent("on"+t,r)}},_attachedGroupEvents:{},attachGroupEvent:function(t,r,n,i){if(!e._attachedGroupEvents.hasOwnProperty(t)){e._attachedGroupEvents[t]=[]}e._attachedGroupEvents[t].push([r,n,i]);e.attachEvent(r,n,i)},detachGroupEvents:function(t){if(e._attachedGroupEvents.hasOwnProperty(t)){for(var r=0;r<e._attachedGroupEvents[t].length;r+=1){var n=e._attachedGroupEvents[t][r];e.detachEvent(n[0],n[1],n[2])}delete e._attachedGroupEvents[t]}},attachDOMReadyEvent:function(e){var t=false;var r=function(){if(!t){t=true;e()}};if(document.readyState==="complete"){setTimeout(r,1);return}if(document.addEventListener){document.addEventListener("DOMContentLoaded",r,false);window.addEventListener("load",r,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);r()}});window.attachEvent("onload",r);if(document.documentElement.doScroll&&window==window.top){var n=function(){if(!document.body){return}try{document.documentElement.doScroll("left");r()}catch(e){setTimeout(n,1)}};n()}}},warn:function(e){if(window.console&&window.console.warn){window.console.warn(e)}},preventDefault:function(e){if(e.preventDefault){e.preventDefault()}e.returnValue=false},captureTarget:function(t){if(t.setCapture){e._capturedTarget=t;e._capturedTarget.setCapture()}},releaseTarget:function(){if(e._capturedTarget){e._capturedTarget.releaseCapture();e._capturedTarget=null}},fireEvent:function(e,t){if(!e){return}if(document.createEvent){var r=document.createEvent("HTMLEvents");r.initEvent(t,true,true);e.dispatchEvent(r)}else if(document.createEventObject){var r=document.createEventObject();e.fireEvent("on"+t,r)}else if(e["on"+t]){e["on"+t]()}},classNameToList:function(e){return e.replace(/^\s+|\s+$/g,"").split(/\s+/)},hasClass:function(e,t){if(!t){return false}return-1!=(" "+e.className.replace(/\s+/g," ")+" ").indexOf(" "+t+" ")},setClass:function(t,r){var n=e.classNameToList(r);for(var i=0;i<n.length;i+=1){if(!e.hasClass(t,n[i])){t.className+=(t.className?" ":"")+n[i]}}},unsetClass:function(t,r){var n=e.classNameToList(r);for(var i=0;i<n.length;i+=1){var a=new RegExp("^\\s*"+n[i]+"\\s*|"+"\\s*"+n[i]+"\\s*$|"+"\\s+"+n[i]+"(\\s+)","g");t.className=t.className.replace(a,"$1")}},getStyle:function(e){return window.getComputedStyle?window.getComputedStyle(e):e.currentStyle},setStyle:function(){var e=document.createElement("div");var t=function(t){for(var r=0;r<t.length;r+=1){if(t[r]in e.style){return t[r]}}};var r={borderRadius:t(["borderRadius","MozBorderRadius","webkitBorderRadius"]),boxShadow:t(["boxShadow","MozBoxShadow","webkitBoxShadow"])};return function(e,t,n){switch(t.toLowerCase()){case"opacity":var i=Math.round(parseFloat(n)*100);e.style.opacity=n;e.style.filter="alpha(opacity="+i+")";break;default:e.style[r[t]]=n;break}}}(),setBorderRadius:function(t,r){e.setStyle(t,"borderRadius",r||"0")},setBoxShadow:function(t,r){e.setStyle(t,"boxShadow",r||"none")},getElementPos:function(t,r){var n=0,i=0;var a=t.getBoundingClientRect();n=a.left;i=a.top;if(!r){var o=e.getViewPos();n+=o[0];i+=o[1]}return[n,i]},getElementSize:function(e){return[e.offsetWidth,e.offsetHeight]},getAbsPointerPos:function(e){if(!e){e=window.event}var t=0,r=0;if(typeof e.changedTouches!=="undefined"&&e.changedTouches.length){t=e.changedTouches[0].clientX;r=e.changedTouches[0].clientY}else if(typeof e.clientX==="number"){t=e.clientX;r=e.clientY}return{x:t,y:r}},getRelPointerPos:function(e){if(!e){e=window.event}var t=e.target||e.srcElement;var r=t.getBoundingClientRect();var n=0,i=0;var a=0,o=0;if(typeof e.changedTouches!=="undefined"&&e.changedTouches.length){a=e.changedTouches[0].clientX;o=e.changedTouches[0].clientY}else if(typeof e.clientX==="number"){a=e.clientX;o=e.clientY}n=a-r.left;i=o-r.top;return{x:n,y:i}},getViewPos:function(){var e=document.documentElement;return[(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0),(window.pageYOffset||e.scrollTop)-(e.clientTop||0)]},getViewSize:function(){var e=document.documentElement;return[window.innerWidth||e.clientWidth,window.innerHeight||e.clientHeight]},redrawPosition:function(){if(e.picker&&e.picker.owner){var t=e.picker.owner;var r,n;if(t.fixed){r=e.getElementPos(t.targetElement,true);n=[0,0]}else{r=e.getElementPos(t.targetElement);n=e.getViewPos()}var i=e.getElementSize(t.targetElement);var a=e.getViewSize();var o=e.getPickerOuterDims(t);var s,u,l;switch(t.position.toLowerCase()){case"left":s=1;u=0;l=-1;break;case"right":s=1;u=0;l=1;break;case"top":s=0;u=1;l=-1;break;default:s=0;u=1;l=1;break}var c=(i[u]+o[u])/2;if(!t.smartPosition){var p=[r[s],r[u]+i[u]-c+c*l]}else{var p=[-n[s]+r[s]+o[s]>a[s]?-n[s]+r[s]+i[s]/2>a[s]/2&&r[s]+i[s]-o[s]>=0?r[s]+i[s]-o[s]:r[s]:r[s],-n[u]+r[u]+i[u]+o[u]-c+c*l>a[u]?-n[u]+r[u]+i[u]/2>a[u]/2&&r[u]+i[u]-c-c*l>=0?r[u]+i[u]-c-c*l:r[u]+i[u]-c+c*l:r[u]+i[u]-c+c*l>=0?r[u]+i[u]-c+c*l:r[u]+i[u]-c-c*l]}var d=p[s];var f=p[u];var h=t.fixed?"fixed":"absolute";var m=(p[0]+o[0]>r[0]||p[0]<r[0]+i[0])&&p[1]+o[1]<r[1]+i[1];e._drawPosition(t,d,f,h,m)}},_drawPosition:function(t,r,n,i,a){var o=a?0:t.shadowBlur;e.picker.wrap.style.position=i;e.picker.wrap.style.left=r+"px";e.picker.wrap.style.top=n+"px";e.setBoxShadow(e.picker.boxS,t.shadow?new e.BoxShadow(0,o,t.shadowBlur,0,t.shadowColor):null)},getPickerDims:function(t){var r=!!e.getSliderComponent(t);var n=[2*t.insetWidth+2*t.padding+t.width+(r?2*t.insetWidth+e.getPadToSliderPadding(t)+t.sliderSize:0),2*t.insetWidth+2*t.padding+t.height+(t.closable?2*t.insetWidth+t.padding+t.buttonHeight:0)];return n},getPickerOuterDims:function(t){var r=e.getPickerDims(t);return[r[0]+2*t.borderWidth,r[1]+2*t.borderWidth]},getPadToSliderPadding:function(e){return Math.max(e.padding,1.5*(2*e.pointerBorderWidth+e.pointerThickness))},getPadYComponent:function(e){switch(e.mode.charAt(1).toLowerCase()){case"v":return"v";break}return"s"},getSliderComponent:function(e){if(e.mode.length>2){switch(e.mode.charAt(2).toLowerCase()){case"s":return"s";break;case"v":return"v";break}}return null},onDocumentMouseDown:function(t){if(!t){t=window.event}var r=t.target||t.srcElement;if(r._jscLinkedInstance){if(r._jscLinkedInstance.showOnClick){r._jscLinkedInstance.show()}}else if(r._jscControlName){e.onControlPointerStart(t,r,r._jscControlName,"mouse")}else{if(e.picker&&e.picker.owner){e.picker.owner.hide()}}},onDocumentTouchStart:function(t){if(!t){t=window.event}var r=t.target||t.srcElement;if(r._jscLinkedInstance){if(r._jscLinkedInstance.showOnClick){r._jscLinkedInstance.show()}}else if(r._jscControlName){e.onControlPointerStart(t,r,r._jscControlName,"touch")}else{if(e.picker&&e.picker.owner){e.picker.owner.hide()}}},onWindowResize:function(t){e.redrawPosition()},onParentScroll:function(t){if(e.picker&&e.picker.owner){e.picker.owner.hide()}},_pointerMoveEvent:{mouse:"mousemove",touch:"touchmove"},_pointerEndEvent:{mouse:"mouseup",touch:"touchend"},_pointerOrigin:null,_capturedTarget:null,onControlPointerStart:function(t,r,n,i){var a=r._jscInstance;e.preventDefault(t);e.captureTarget(r);var o=function(a,o){e.attachGroupEvent("drag",a,e._pointerMoveEvent[i],e.onDocumentPointerMove(t,r,n,i,o));e.attachGroupEvent("drag",a,e._pointerEndEvent[i],e.onDocumentPointerEnd(t,r,n,i))};o(document,[0,0]);if(window.parent&&window.frameElement){var s=window.frameElement.getBoundingClientRect();var u=[-s.left,-s.top];o(window.parent.window.document,u)}var l=e.getAbsPointerPos(t);var c=e.getRelPointerPos(t);e._pointerOrigin={x:l.x-c.x,y:l.y-c.y};switch(n){case"pad":switch(e.getSliderComponent(a)){case"s":if(a.hsv[1]===0){a.fromHSV(null,100,null)};break;case"v":if(a.hsv[2]===0){a.fromHSV(null,null,100)};break}e.setPad(a,t,0,0);break;case"sld":e.setSld(a,t,0);break}e.dispatchFineChange(a)},onDocumentPointerMove:function(t,r,n,i,a){return function(t){var i=r._jscInstance;switch(n){case"pad":if(!t){t=window.event}e.setPad(i,t,a[0],a[1]);e.dispatchFineChange(i);break;case"sld":if(!t){t=window.event}e.setSld(i,t,a[1]);e.dispatchFineChange(i);break}}},onDocumentPointerEnd:function(t,r,n,i){return function(t){var n=r._jscInstance;e.detachGroupEvents("drag");e.releaseTarget();e.dispatchChange(n)}},dispatchChange:function(t){if(t.valueElement){if(e.isElementType(t.valueElement,"input")){e.fireEvent(t.valueElement,"change")}}},dispatchFineChange:function(e){if(e.onFineChange){var t;if(typeof e.onFineChange==="string"){t=new Function(e.onFineChange)}else{t=e.onFineChange}t.call(e)}},setPad:function(t,r,n,i){var a=e.getAbsPointerPos(r);var o=n+a.x-e._pointerOrigin.x-t.padding-t.insetWidth;var s=i+a.y-e._pointerOrigin.y-t.padding-t.insetWidth;var u=o*(360/(t.width-1));var l=100-s*(100/(t.height-1));switch(e.getPadYComponent(t)){case"s":t.fromHSV(u,l,null,e.leaveSld);break;case"v":t.fromHSV(u,null,l,e.leaveSld);break}},setSld:function(t,r,n){var i=e.getAbsPointerPos(r);var a=n+i.y-e._pointerOrigin.y-t.padding-t.insetWidth;var o=100-a*(100/(t.height-1));switch(e.getSliderComponent(t)){case"s":t.fromHSV(null,o,null,e.leavePad);break;case"v":t.fromHSV(null,null,o,e.leavePad);break}},_vmlNS:"jsc_vml_",_vmlCSS:"jsc_vml_css_",_vmlReady:false,initVML:function(){if(!e._vmlReady){var t=document;if(!t.namespaces[e._vmlNS]){t.namespaces.add(e._vmlNS,"urn:schemas-microsoft-com:vml")}if(!t.styleSheets[e._vmlCSS]){var r=["shape","shapetype","group","background","path","formulas","handles","fill","stroke","shadow","textbox","textpath","imagedata","line","polyline","curve","rect","roundrect","oval","arc","image"];var n=t.createStyleSheet();n.owningElement.id=e._vmlCSS;for(var i=0;i<r.length;i+=1){n.addRule(e._vmlNS+"\\:"+r[i],"behavior:url(#default#VML);")}}e._vmlReady=true}},createPalette:function(){var t={elm:null,draw:null};if(e.isCanvasSupported){var r=document.createElement("canvas");var n=r.getContext("2d");var i=function(e,t,i){r.width=e;r.height=t;n.clearRect(0,0,r.width,r.height);var a=n.createLinearGradient(0,0,r.width,0);a.addColorStop(0/6,"#F00");a.addColorStop(1/6,"#FF0");a.addColorStop(2/6,"#0F0");a.addColorStop(3/6,"#0FF");a.addColorStop(4/6,"#00F");a.addColorStop(5/6,"#F0F");a.addColorStop(6/6,"#F00");n.fillStyle=a;n.fillRect(0,0,r.width,r.height);var o=n.createLinearGradient(0,0,0,r.height);switch(i.toLowerCase()){case"s":o.addColorStop(0,"rgba(255,255,255,0)");o.addColorStop(1,"rgba(255,255,255,1)");break;case"v":o.addColorStop(0,"rgba(0,0,0,0)");o.addColorStop(1,"rgba(0,0,0,1)");break}n.fillStyle=o;n.fillRect(0,0,r.width,r.height)};t.elm=r;t.draw=i}else{e.initVML();var a=document.createElement("div");a.style.position="relative";a.style.overflow="hidden";var o=document.createElement(e._vmlNS+":fill");o.type="gradient";o.method="linear";o.angle="90";o.colors="16.67% #F0F, 33.33% #00F, 50% #0FF, 66.67% #0F0, 83.33% #FF0";var s=document.createElement(e._vmlNS+":rect");s.style.position="absolute";s.style.left=-1+"px";s.style.top=-1+"px";s.stroked=false;s.appendChild(o);a.appendChild(s);var u=document.createElement(e._vmlNS+":fill");u.type="gradient";u.method="linear";u.angle="180";u.opacity="0";var l=document.createElement(e._vmlNS+":rect");l.style.position="absolute";l.style.left=-1+"px";l.style.top=-1+"px";l.stroked=false;l.appendChild(u);a.appendChild(l);var i=function(e,t,r){a.style.width=e+"px";a.style.height=t+"px";s.style.width=l.style.width=e+1+"px";s.style.height=l.style.height=t+1+"px";o.color="#F00";o.color2="#F00";switch(r.toLowerCase()){case"s":u.color=u.color2="#FFF";break;case"v":u.color=u.color2="#000";break}};t.elm=a;t.draw=i}return t},createSliderGradient:function(){var t={elm:null,draw:null};if(e.isCanvasSupported){var r=document.createElement("canvas");var n=r.getContext("2d");var i=function(e,t,i,a){r.width=e;r.height=t;n.clearRect(0,0,r.width,r.height);var o=n.createLinearGradient(0,0,0,r.height);o.addColorStop(0,i);o.addColorStop(1,a);n.fillStyle=o;n.fillRect(0,0,r.width,r.height)};t.elm=r;t.draw=i}else{e.initVML();var a=document.createElement("div");a.style.position="relative";a.style.overflow="hidden";var o=document.createElement(e._vmlNS+":fill");o.type="gradient";o.method="linear";o.angle="180";var s=document.createElement(e._vmlNS+":rect");s.style.position="absolute";s.style.left=-1+"px";s.style.top=-1+"px";s.stroked=false;s.appendChild(o);a.appendChild(s);var i=function(e,t,r,n){a.style.width=e+"px";a.style.height=t+"px";s.style.width=e+1+"px";s.style.height=t+1+"px";o.color=r;o.color2=n};t.elm=a;t.draw=i}return t},leaveValue:1<<0,leaveStyle:1<<1,leavePad:1<<2,leaveSld:1<<3,BoxShadow:function(){var e=function(e,t,r,n,i,a){this.hShadow=e;this.vShadow=t;this.blur=r;this.spread=n;this.color=i;this.inset=!!a};e.prototype.toString=function(){var e=[Math.round(this.hShadow)+"px",Math.round(this.vShadow)+"px",Math.round(this.blur)+"px",Math.round(this.spread)+"px",this.color];if(this.inset){e.push("inset")}return e.join(" ")};return e}(),jscolor:function(t,r){this.value=null;this.valueElement=t;this.styleElement=t;this.required=true;this.refine=true;this.hash=false;this.uppercase=true;this.onFineChange=null;this.activeClass="jscolor-active";this.minS=0;this.maxS=100;this.minV=0;this.maxV=100;this.hsv=[0,0,100];this.rgb=[255,255,255];this.width=181;this.height=101;this.showOnClick=true;this.mode="HSV";this.position="bottom";this.smartPosition=true;this.sliderSize=16;this.crossSize=8;this.closable=false;this.closeText="Close";this.buttonColor="#000000";this.buttonHeight=18;this.padding=12;this.backgroundColor="#FFFFFF";this.borderWidth=1;this.borderColor="#BBBBBB";this.borderRadius=8;this.insetWidth=1;this.insetColor="#BBBBBB";this.shadow=true;this.shadowBlur=15;this.shadowColor="rgba(0,0,0,0.2)";this.pointerColor="#4C4C4C";this.pointerBorderColor="#FFFFFF";this.pointerBorderWidth=1;this.pointerThickness=2;this.zIndex=1e3;this.container=null;for(var n in r){if(r.hasOwnProperty(n)){this[n]=r[n]}}this.hide=function(){if(c()){o()}};this.show=function(){s()};this.redraw=function(){if(c()){s()}};this.importColor=function(){if(!this.valueElement){this.exportColor()}else{if(e.isElementType(this.valueElement,"input")){if(!this.refine){if(!this.fromString(this.valueElement.value,e.leaveValue)){if(this.styleElement){this.styleElement.style.backgroundImage=this.styleElement._jscOrigStyle.backgroundImage;this.styleElement.style.backgroundColor=this.styleElement._jscOrigStyle.backgroundColor;this.styleElement.style.color=this.styleElement._jscOrigStyle.color}this.exportColor(e.leaveValue|e.leaveStyle)}}else if(!this.required&&/^\s*$/.test(this.valueElement.value)){this.valueElement.value="";if(this.styleElement){this.styleElement.style.backgroundImage=this.styleElement._jscOrigStyle.backgroundImage;this.styleElement.style.backgroundColor=this.styleElement._jscOrigStyle.backgroundColor;this.styleElement.style.color=this.styleElement._jscOrigStyle.color}this.exportColor(e.leaveValue|e.leaveStyle)}else if(this.fromString(this.valueElement.value)){}else{this.exportColor()}}else{this.exportColor()}}};this.exportColor=function(t){if(!(t&e.leaveValue)&&this.valueElement){var r=this.toString();if(this.uppercase){r=r.toUpperCase()}if(this.hash){r="#"+r}if(e.isElementType(this.valueElement,"input")){this.valueElement.value=r}else{this.valueElement.innerHTML=r}}if(!(t&e.leaveStyle)){if(this.styleElement){this.styleElement.style.backgroundImage="none";this.styleElement.style.backgroundColor="#"+this.toString();this.styleElement.style.color=this.isLight()?"#000":"#FFF"}}if(!(t&e.leavePad)&&c()){u()}if(!(t&e.leaveSld)&&c()){l()}};this.fromHSV=function(e,t,r,n){if(e!==null){if(isNaN(e)){return false}e=Math.max(0,Math.min(360,e))}if(t!==null){if(isNaN(t)){return false}t=Math.max(0,Math.min(100,this.maxS,t),this.minS)}if(r!==null){if(isNaN(r)){return false}r=Math.max(0,Math.min(100,this.maxV,r),this.minV)}this.rgb=a(e===null?this.hsv[0]:this.hsv[0]=e,t===null?this.hsv[1]:this.hsv[1]=t,r===null?this.hsv[2]:this.hsv[2]=r);this.exportColor(n)};this.fromRGB=function(e,t,r,n){if(e!==null){if(isNaN(e)){return false}e=Math.max(0,Math.min(255,e))}if(t!==null){if(isNaN(t)){return false}t=Math.max(0,Math.min(255,t))}if(r!==null){if(isNaN(r)){return false}r=Math.max(0,Math.min(255,r))}var o=i(e===null?this.rgb[0]:e,t===null?this.rgb[1]:t,r===null?this.rgb[2]:r);if(o[0]!==null){this.hsv[0]=Math.max(0,Math.min(360,o[0]))}if(o[2]!==0){this.hsv[1]=o[1]===null?null:Math.max(0,this.minS,Math.min(100,this.maxS,o[1]))}this.hsv[2]=o[2]===null?null:Math.max(0,this.minV,Math.min(100,this.maxV,o[2]));var s=a(this.hsv[0],this.hsv[1],this.hsv[2]);this.rgb[0]=s[0];this.rgb[1]=s[1];this.rgb[2]=s[2];this.exportColor(n)};this.fromString=function(e,t){var r;if(r=e.match(/^\W*([0-9A-F]{3}([0-9A-F]{3})?)\W*$/i)){if(r[1].length===6){this.fromRGB(parseInt(r[1].substr(0,2),16),parseInt(r[1].substr(2,2),16),parseInt(r[1].substr(4,2),16),t)}else{this.fromRGB(parseInt(r[1].charAt(0)+r[1].charAt(0),16),parseInt(r[1].charAt(1)+r[1].charAt(1),16),parseInt(r[1].charAt(2)+r[1].charAt(2),16),t)}return true}else if(r=e.match(/^\W*rgba?\(([^)]*)\)\W*$/i)){var n=r[1].split(",");var i=/^\s*(\d*)(\.\d+)?\s*$/;var a,o,s;if(n.length>=3&&(a=n[0].match(i))&&(o=n[1].match(i))&&(s=n[2].match(i))){var u=parseFloat((a[1]||"0")+(a[2]||""));var l=parseFloat((o[1]||"0")+(o[2]||""));var c=parseFloat((s[1]||"0")+(s[2]||""));this.fromRGB(u,l,c,t);return true}}return false};this.toString=function(){return(256|Math.round(this.rgb[0])).toString(16).substr(1)+(256|Math.round(this.rgb[1])).toString(16).substr(1)+(256|Math.round(this.rgb[2])).toString(16).substr(1)};this.toHEXString=function(){return"#"+this.toString().toUpperCase()};this.toRGBString=function(){return"rgb("+Math.round(this.rgb[0])+","+Math.round(this.rgb[1])+","+Math.round(this.rgb[2])+")"};this.isLight=function(){return.213*this.rgb[0]+.715*this.rgb[1]+.072*this.rgb[2]>255/2};this._processParentElementsInDOM=function(){
if(this._linkedElementsProcessed){return}this._linkedElementsProcessed=true;var t=this.targetElement;do{var r=e.getStyle(t);if(r&&r.position.toLowerCase()==="fixed"){this.fixed=true}if(t!==this.targetElement){if(!t._jscEventsAttached){e.attachEvent(t,"scroll",e.onParentScroll);t._jscEventsAttached=true}}}while((t=t.parentNode)&&!e.isElementType(t,"body"))};function i(e,t,r){e/=255;t/=255;r/=255;var n=Math.min(Math.min(e,t),r);var i=Math.max(Math.max(e,t),r);var a=i-n;if(a===0){return[null,0,100*i]}var o=e===n?3+(r-t)/a:t===n?5+(e-r)/a:1+(t-e)/a;return[60*(o===6?0:o),100*(a/i),100*i]}function a(e,t,r){var n=255*(r/100);if(e===null){return[n,n,n]}e/=60;t/=100;var i=Math.floor(e);var a=i%2?e-i:1-(e-i);var o=n*(1-t);var s=n*(1-t*a);switch(i){case 6:case 0:return[n,s,o];case 1:return[s,n,o];case 2:return[o,n,s];case 3:return[o,s,n];case 4:return[s,o,n];case 5:return[n,o,s]}}function o(){e.unsetClass(h.targetElement,h.activeClass);e.picker.wrap.parentNode.removeChild(e.picker.wrap);delete e.picker.owner}function s(){h._processParentElementsInDOM();if(!e.picker){e.picker={owner:null,wrap:document.createElement("div"),box:document.createElement("div"),boxS:document.createElement("div"),boxB:document.createElement("div"),pad:document.createElement("div"),padB:document.createElement("div"),padM:document.createElement("div"),padPal:e.createPalette(),cross:document.createElement("div"),crossBY:document.createElement("div"),crossBX:document.createElement("div"),crossLY:document.createElement("div"),crossLX:document.createElement("div"),sld:document.createElement("div"),sldB:document.createElement("div"),sldM:document.createElement("div"),sldGrad:e.createSliderGradient(),sldPtrS:document.createElement("div"),sldPtrIB:document.createElement("div"),sldPtrMB:document.createElement("div"),sldPtrOB:document.createElement("div"),btn:document.createElement("div"),btnT:document.createElement("span")};e.picker.pad.appendChild(e.picker.padPal.elm);e.picker.padB.appendChild(e.picker.pad);e.picker.cross.appendChild(e.picker.crossBY);e.picker.cross.appendChild(e.picker.crossBX);e.picker.cross.appendChild(e.picker.crossLY);e.picker.cross.appendChild(e.picker.crossLX);e.picker.padB.appendChild(e.picker.cross);e.picker.box.appendChild(e.picker.padB);e.picker.box.appendChild(e.picker.padM);e.picker.sld.appendChild(e.picker.sldGrad.elm);e.picker.sldB.appendChild(e.picker.sld);e.picker.sldB.appendChild(e.picker.sldPtrOB);e.picker.sldPtrOB.appendChild(e.picker.sldPtrMB);e.picker.sldPtrMB.appendChild(e.picker.sldPtrIB);e.picker.sldPtrIB.appendChild(e.picker.sldPtrS);e.picker.box.appendChild(e.picker.sldB);e.picker.box.appendChild(e.picker.sldM);e.picker.btn.appendChild(e.picker.btnT);e.picker.box.appendChild(e.picker.btn);e.picker.boxB.appendChild(e.picker.box);e.picker.wrap.appendChild(e.picker.boxS);e.picker.wrap.appendChild(e.picker.boxB)}var t=e.picker;var r=!!e.getSliderComponent(h);var n=e.getPickerDims(h);var i=2*h.pointerBorderWidth+h.pointerThickness+2*h.crossSize;var a=e.getPadToSliderPadding(h);var o=Math.min(h.borderRadius,Math.round(h.padding*Math.PI));var s="crosshair";t.wrap.style.clear="both";t.wrap.style.width=n[0]+2*h.borderWidth+"px";t.wrap.style.height=n[1]+2*h.borderWidth+"px";t.wrap.style.zIndex=h.zIndex;t.box.style.width=n[0]+"px";t.box.style.height=n[1]+"px";t.boxS.style.position="absolute";t.boxS.style.left="0";t.boxS.style.top="0";t.boxS.style.width="100%";t.boxS.style.height="100%";e.setBorderRadius(t.boxS,o+"px");t.boxB.style.position="relative";t.boxB.style.border=h.borderWidth+"px solid";t.boxB.style.borderColor=h.borderColor;t.boxB.style.background=h.backgroundColor;e.setBorderRadius(t.boxB,o+"px");t.padM.style.background=t.sldM.style.background="#FFF";e.setStyle(t.padM,"opacity","0");e.setStyle(t.sldM,"opacity","0");t.pad.style.position="relative";t.pad.style.width=h.width+"px";t.pad.style.height=h.height+"px";t.padPal.draw(h.width,h.height,e.getPadYComponent(h));t.padB.style.position="absolute";t.padB.style.left=h.padding+"px";t.padB.style.top=h.padding+"px";t.padB.style.border=h.insetWidth+"px solid";t.padB.style.borderColor=h.insetColor;t.padM._jscInstance=h;t.padM._jscControlName="pad";t.padM.style.position="absolute";t.padM.style.left="0";t.padM.style.top="0";t.padM.style.width=h.padding+2*h.insetWidth+h.width+a/2+"px";t.padM.style.height=n[1]+"px";t.padM.style.cursor=s;t.cross.style.position="absolute";t.cross.style.left=t.cross.style.top="0";t.cross.style.width=t.cross.style.height=i+"px";t.crossBY.style.position=t.crossBX.style.position="absolute";t.crossBY.style.background=t.crossBX.style.background=h.pointerBorderColor;t.crossBY.style.width=t.crossBX.style.height=2*h.pointerBorderWidth+h.pointerThickness+"px";t.crossBY.style.height=t.crossBX.style.width=i+"px";t.crossBY.style.left=t.crossBX.style.top=Math.floor(i/2)-Math.floor(h.pointerThickness/2)-h.pointerBorderWidth+"px";t.crossBY.style.top=t.crossBX.style.left="0";t.crossLY.style.position=t.crossLX.style.position="absolute";t.crossLY.style.background=t.crossLX.style.background=h.pointerColor;t.crossLY.style.height=t.crossLX.style.width=i-2*h.pointerBorderWidth+"px";t.crossLY.style.width=t.crossLX.style.height=h.pointerThickness+"px";t.crossLY.style.left=t.crossLX.style.top=Math.floor(i/2)-Math.floor(h.pointerThickness/2)+"px";t.crossLY.style.top=t.crossLX.style.left=h.pointerBorderWidth+"px";t.sld.style.overflow="hidden";t.sld.style.width=h.sliderSize+"px";t.sld.style.height=h.height+"px";t.sldGrad.draw(h.sliderSize,h.height,"#000","#000");t.sldB.style.display=r?"block":"none";t.sldB.style.position="absolute";t.sldB.style.right=h.padding+"px";t.sldB.style.top=h.padding+"px";t.sldB.style.border=h.insetWidth+"px solid";t.sldB.style.borderColor=h.insetColor;t.sldM._jscInstance=h;t.sldM._jscControlName="sld";t.sldM.style.display=r?"block":"none";t.sldM.style.position="absolute";t.sldM.style.right="0";t.sldM.style.top="0";t.sldM.style.width=h.sliderSize+a/2+h.padding+2*h.insetWidth+"px";t.sldM.style.height=n[1]+"px";t.sldM.style.cursor="default";t.sldPtrIB.style.border=t.sldPtrOB.style.border=h.pointerBorderWidth+"px solid "+h.pointerBorderColor;t.sldPtrOB.style.position="absolute";t.sldPtrOB.style.left=-(2*h.pointerBorderWidth+h.pointerThickness)+"px";t.sldPtrOB.style.top="0";t.sldPtrMB.style.border=h.pointerThickness+"px solid "+h.pointerColor;t.sldPtrS.style.width=h.sliderSize+"px";t.sldPtrS.style.height=g+"px";function c(){var e=h.insetColor.split(/\s+/);var r=e.length<2?e[0]:e[1]+" "+e[0]+" "+e[0]+" "+e[1];t.btn.style.borderColor=r}t.btn.style.display=h.closable?"block":"none";t.btn.style.position="absolute";t.btn.style.left=h.padding+"px";t.btn.style.bottom=h.padding+"px";t.btn.style.padding="0 15px";t.btn.style.height=h.buttonHeight+"px";t.btn.style.border=h.insetWidth+"px solid";c();t.btn.style.color=h.buttonColor;t.btn.style.font="12px sans-serif";t.btn.style.textAlign="center";try{t.btn.style.cursor="pointer"}catch(p){t.btn.style.cursor="hand"}t.btn.onmousedown=function(){h.hide()};t.btnT.style.lineHeight=h.buttonHeight+"px";t.btnT.innerHTML="";t.btnT.appendChild(document.createTextNode(h.closeText));u();l();if(e.picker.owner&&e.picker.owner!==h){e.unsetClass(e.picker.owner.targetElement,h.activeClass)}e.picker.owner=h;if(e.isElementType(m,"body")){e.redrawPosition()}else{e._drawPosition(h,0,0,"relative",false)}if(t.wrap.parentNode!=m){m.appendChild(t.wrap)}e.setClass(h.targetElement,h.activeClass)}function u(){switch(e.getPadYComponent(h)){case"s":var t=1;break;case"v":var t=2;break}var r=Math.round(h.hsv[0]/360*(h.width-1));var n=Math.round((1-h.hsv[t]/100)*(h.height-1));var i=2*h.pointerBorderWidth+h.pointerThickness+2*h.crossSize;var o=-Math.floor(i/2);e.picker.cross.style.left=r+o+"px";e.picker.cross.style.top=n+o+"px";switch(e.getSliderComponent(h)){case"s":var s=a(h.hsv[0],100,h.hsv[2]);var u=a(h.hsv[0],0,h.hsv[2]);var l="rgb("+Math.round(s[0])+","+Math.round(s[1])+","+Math.round(s[2])+")";var c="rgb("+Math.round(u[0])+","+Math.round(u[1])+","+Math.round(u[2])+")";e.picker.sldGrad.draw(h.sliderSize,h.height,l,c);break;case"v":var p=a(h.hsv[0],h.hsv[1],100);var l="rgb("+Math.round(p[0])+","+Math.round(p[1])+","+Math.round(p[2])+")";var c="#000";e.picker.sldGrad.draw(h.sliderSize,h.height,l,c);break}}function l(){var t=e.getSliderComponent(h);if(t){switch(t){case"s":var r=1;break;case"v":var r=2;break}var n=Math.round((1-h.hsv[r]/100)*(h.height-1));e.picker.sldPtrOB.style.top=n-(2*h.pointerBorderWidth+h.pointerThickness)-Math.floor(g/2)+"px"}}function c(){return e.picker&&e.picker.owner===h}function p(){h.importColor()}if(typeof t==="string"){var d=t;var f=document.getElementById(d);if(f){this.targetElement=f}else{e.warn("Could not find target element with ID '"+d+"'")}}else if(t){this.targetElement=t}else{e.warn("Invalid target element: '"+t+"'")}if(this.targetElement._jscLinkedInstance){e.warn("Cannot link jscolor twice to the same element. Skipping.");return}this.targetElement._jscLinkedInstance=this;this.valueElement=e.fetchElement(this.valueElement);this.styleElement=e.fetchElement(this.styleElement);var h=this;var m=this.container?e.fetchElement(this.container):document.getElementsByTagName("body")[0];var g=3;if(e.isElementType(this.targetElement,"button")){if(this.targetElement.onclick){var v=this.targetElement.onclick;this.targetElement.onclick=function(e){v.call(this,e);return false}}else{this.targetElement.onclick=function(){return false}}}if(this.valueElement){if(e.isElementType(this.valueElement,"input")){var b=function(){h.fromString(h.valueElement.value,e.leaveValue);e.dispatchFineChange(h)};e.attachEvent(this.valueElement,"keyup",b);e.attachEvent(this.valueElement,"input",b);e.attachEvent(this.valueElement,"blur",p);this.valueElement.setAttribute("autocomplete","off")}}if(this.styleElement){this.styleElement._jscOrigStyle={backgroundImage:this.styleElement.style.backgroundImage,backgroundColor:this.styleElement.style.backgroundColor,color:this.styleElement.style.color}}if(this.value){this.fromString(this.value)||this.exportColor()}else{this.importColor()}}};e.jscolor.lookupClass="jscolor";e.jscolor.installByClassName=function(t){var r=document.getElementsByTagName("input");var n=document.getElementsByTagName("button");e.tryInstallOnElements(r,t);e.tryInstallOnElements(n,t)};e.register();return e.jscolor}()}(function(e){var t={};e.publish=function(r,n){if(t[r]){var i=t[r],a=n||[];for(var o=0,s=i.length;o<s;o++){if(typeof i[o]==="undefined"){continue}i[o].apply(e,a)}}};e.subscribe=function(e,r,n){if(!t[e]||n){t[e]=[]}t[e].push(r);return[e,r]};e.unsubscribe=function(e){if(typeof e!=="undefined"&&e!==null){var r=e[0];if(t[r]){var n=t[r];for(var i=0,a=n.length;i<a;i++){if(n[i]===e[1]){n.splice(i,1)}}}}}})(jQuery);(function(e){var t={};e.query=function(r){if(typeof t[r]==="undefined"){t[r]=e(r)}return t[r]}})(jQuery);(function(e){var t=window.Chicago||{utils:{now:Date.now||function(){return(new Date).getTime()},uid:function(e){return(e||"id")+t.utils.now()+"RAND"+Math.ceil(Math.random()*1e5)},is:{number:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},fn:function(e){return typeof e==="function"},object:function(e){return Object.prototype.toString.call(e)==="[object Object]"}},debounce:function(e,t,r){var n;return function(){var i=this,a=arguments,o=function(){n=null;if(!r){e.apply(i,a)}},s=r&&!n;if(n){clearTimeout(n)}n=setTimeout(o,t);if(s){e.apply(i,a)}}}},$:window.jQuery||null};if(typeof define==="function"&&define.amd){define("chicago",function(){t.load=function(e,r,n,i){var a=e.split(","),o=[];var s=(i.config&&i.config.chicago&&i.config.chicago.base?i.config.chicago.base:"").replace(/\/+$/g,"");if(!s){throw new Error("Please define base path to jQuery scrollend in the requirejs config.")}var u=0;while(u<a.length){var l=a[u].replace(/\./g,"/");o.push(s+"/"+l);u+=1}r(o,function(){n(t)})};return t})}if(window&&window.jQuery){return e(t,window,window.document)}else if(!window.jQuery){throw new Error("jQuery scrollend requires jQuery")}})(function(e,t,r){e.$win=e.$(t);e.$doc=e.$(r);if(!e.events){e.events={}}e.events.scrollend={defaults:{delay:250},setup:function(t){var r=arguments,n={delay:e.$.event.special.scrollend.defaults.delay},i;if(e.utils.is.fn(r[0])){i=r[0]}else if(e.utils.is.number(r[0])){n.delay=r[0]}else if(e.utils.is.object(r[0])){n=e.$.extend({},n,r[0])}var a=e.utils.uid("scrollend"),o=e.$.extend({delay:e.$.event.special.scrollend.defaults.delay},n),s=null,u=false,l=function(t){if(s){clearTimeout(s)}else{t.type="scrollend.chicago.dom";e.$(t.target).trigger("scrollend",t)}s=setTimeout(function(){s=null},o.delay)};e.$(this).data("chicago.event.scrollend.uid",a);return e.$(this).on("scroll",e.utils.debounce(l,100)).data(a,l)},teardown:function(){var t=e.$(this).data("chicago.event.scrollend.uid");e.$(this).off("scroll",e.$(this).data(t));e.$(this).removeData(t);return e.$(this).removeData("chicago.event.scrollend.uid")}};(function(){e.$.event.special.scrollend=e.events.scrollend;e.$.fn.scrollend=function(t,r){return this.each(function(){e.$(this).on("scrollend",t,r)})}})()});(function(e,t){if(typeof define==="function"&&define.amd){define("sifter",t)}else if(typeof exports==="object"){module.exports=t()}else{e.Sifter=t()}})(this,function(){var e=function(e,t){this.items=e;this.settings=t||{diacritics:true}};e.prototype.tokenize=function(e){e=n(String(e||"").toLowerCase());if(!e||!e.length)return[];var t,r,a,s;var u=[];var l=e.split(/ +/);for(t=0,r=l.length;t<r;t++){a=i(l[t]);if(this.settings.diacritics){for(s in o){if(o.hasOwnProperty(s)){a=a.replace(new RegExp(s,"g"),o[s])}}}u.push({string:l[t],regex:new RegExp(a,"gi")})}return u};e.prototype.iterator=function(e,t){var r;if(a(e)){r=Array.prototype.forEach||function(e){for(var t=0,r=this.length;t<r;t++){e(this[t],t,this)}}}else{r=function(e){for(var t in this){if(this.hasOwnProperty(t)){e(this[t],t,this)}}}}r.apply(e,[t])};e.prototype.getScoreFunction=function(e,t){var r,n,i,a;r=this;e=r.prepareSearch(e,t);i=e.tokens;n=e.options.fields;a=i.length;var o=function(e,t){var r,n;if(!e)return 0;e=String(e||"");n=e.search(t.regex);if(n===-1)return 0;r=t.string.length/e.length;if(n===0)r+=.5;return r};var s=function(){var e=n.length;if(!e){return function(){return 0}}if(e===1){return function(e,t){return o(t[n[0]],e)}}return function(t,r){for(var i=0,a=0;i<e;i++){a+=o(r[n[i]],t)}return a/e}}();if(!a){return function(){return 0}}if(a===1){return function(e){return s(i[0],e)}}if(e.options.conjunction==="and"){return function(e){var t;for(var r=0,n=0;r<a;r++){t=s(i[r],e);if(t<=0)return 0;n+=t}return n/a}}else{return function(e){for(var t=0,r=0;t<a;t++){r+=s(i[t],e)}return r/a}}};e.prototype.getSortFunction=function(e,r){var n,i,a,o,s,u,l,c,p,d,f;a=this;e=a.prepareSearch(e,r);f=!e.query&&r.sort_empty||r.sort;p=function(e,t){if(e==="$score")return t.score;return a.items[t.id][e]};s=[];if(f){for(n=0,i=f.length;n<i;n++){if(e.query||f[n].field!=="$score"){s.push(f[n])}}}if(e.query){d=true;for(n=0,i=s.length;n<i;n++){if(s[n].field==="$score"){d=false;break}}if(d){s.unshift({field:"$score",direction:"desc"})}}else{for(n=0,i=s.length;n<i;n++){if(s[n].field==="$score"){s.splice(n,1);break}}}c=[];for(n=0,i=s.length;n<i;n++){c.push(s[n].direction==="desc"?-1:1)}u=s.length;if(!u){return null}else if(u===1){o=s[0].field;l=c[0];return function(e,r){return l*t(p(o,e),p(o,r))}}else{return function(e,r){var n,i,a,o,l;for(n=0;n<u;n++){l=s[n].field;i=c[n]*t(p(l,e),p(l,r));if(i)return i}return 0}}};e.prototype.prepareSearch=function(e,t){if(typeof e==="object")return e;t=r({},t);var n=t.fields;var i=t.sort;var o=t.sort_empty;if(n&&!a(n))t.fields=[n];if(i&&!a(i))t.sort=[i];if(o&&!a(o))t.sort_empty=[o];return{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}};e.prototype.search=function(e,t){var r=this,n,i,a,o;var s;var u;a=this.prepareSearch(e,t);t=a.options;e=a.query;u=t.score||r.getScoreFunction(a);if(e.length){r.iterator(r.items,function(e,r){i=u(e);if(t.filter===false||i>0){a.items.push({score:i,id:r})}})}else{r.iterator(r.items,function(e,t){a.items.push({score:1,id:t})})}s=r.getSortFunction(a,t);if(s)a.items.sort(s);a.total=a.items.length;if(typeof t.limit==="number"){a.items=a.items.slice(0,t.limit)}return a};var t=function(e,t){if(typeof e==="number"&&typeof t==="number"){return e>t?1:e<t?-1:0}e=s(String(e||""));t=s(String(t||""));if(e>t)return 1;if(t>e)return-1;return 0};var r=function(e,t){var r,n,i,a;for(r=1,n=arguments.length;r<n;r++){a=arguments[r];if(!a)continue;for(i in a){if(a.hasOwnProperty(i)){e[i]=a[i]}}}return e};var n=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")};var i=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var a=Array.isArray||$&&$.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};var o={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"};var s=function(){var e,t,r,n;var i="";var a={};for(r in o){if(o.hasOwnProperty(r)){n=o[r].substring(2,o[r].length-1);i+=n;for(e=0,t=n.length;e<t;e++){a[n.charAt(e)]=r}}}var s=new RegExp("["+i+"]","g");return function(e){return e.replace(s,function(e){return a[e]}).toLowerCase()}}();return e});(function(e,t){if(typeof define==="function"&&define.amd){define("microplugin",t)}else if(typeof exports==="object"){module.exports=t()}else{e.MicroPlugin=t()}})(this,function(){var e={};e.mixin=function(e){e.plugins={};e.prototype.initializePlugins=function(e){var r,n,i;var a=this;var o=[];a.plugins={names:[],settings:{},requested:{},loaded:{}};if(t.isArray(e)){for(r=0,n=e.length;r<n;r++){if(typeof e[r]==="string"){o.push(e[r])}else{a.plugins.settings[e[r].name]=e[r].options;o.push(e[r].name)}}}else if(e){for(i in e){if(e.hasOwnProperty(i)){a.plugins.settings[i]=e[i];o.push(i)}}}while(o.length){a.require(o.shift())}};e.prototype.loadPlugin=function(t){var r=this;var n=r.plugins;var i=e.plugins[t];if(!e.plugins.hasOwnProperty(t)){throw new Error('Unable to find "'+t+'" plugin')}n.requested[t]=true;n.loaded[t]=i.fn.apply(r,[r.plugins.settings[t]||{}]);n.names.push(t)};e.prototype.require=function(e){var t=this;var r=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(r.requested[e]){throw new Error('Plugin has circular dependency ("'+e+'")')}t.loadPlugin(e)}return r.loaded[e]};e.define=function(t,r){e.plugins[t]={name:t,fn:r}}};var t={isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}};return e});(function(e,t){if(typeof define==="function"&&define.amd){define("selectize",["jquery","sifter","microplugin"],t)}else if(typeof exports==="object"){module.exports=t(require("jquery"),require("sifter"),require("microplugin"))}else{e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}})(this,function(e,t,r){"use strict";var n=function(e,t){if(typeof t==="string"&&!t.length)return;var r=typeof t==="string"?new RegExp(t,"i"):t;var n=function(e){var t=0;if(e.nodeType===3){var i=e.data.search(r);if(i>=0&&e.data.length>0){var a=e.data.match(r);var o=document.createElement("span");o.className="highlight";var s=e.splitText(i);var u=s.splitText(a[0].length);var l=s.cloneNode(true);o.appendChild(l);s.parentNode.replaceChild(o,s);t=1}}else if(e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName)){for(var c=0;c<e.childNodes.length;++c){c+=n(e.childNodes[c])}}return t};return e.each(function(){n(this)})};var i=function(){};i.prototype={on:function(e,t){this._events=this._events||{};this._events[e]=this._events[e]||[];this._events[e].push(t)},off:function(e,t){var r=arguments.length;if(r===0)return delete this._events;if(r===1)return delete this._events[e];this._events=this._events||{};if(e in this._events===false)return;this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){this._events=this._events||{};if(e in this._events===false)return;for(var t=0;t<this._events[e].length;t++){this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}}};i.mixin=function(e){var t=["on","off","trigger"];for(var r=0;r<t.length;r++){e.prototype[t[r]]=i.prototype[t[r]]}};var a=/Mac/.test(navigator.userAgent);var o=65;var s=188;var u=13;var l=27;var c=37;var p=38;var d=80;var f=39;var h=40;var m=78;var g=8;var v=46;var b=16;var y=a?91:17;var w=a?18:17;var C=9;var S=1;var x=2;var A=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity;var T=function(e){return typeof e!=="undefined"};var I=function(e){if(typeof e==="undefined"||e===null)return null;if(typeof e==="boolean")return e?"1":"0";return e+""};var E=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var P=function(e){return(e+"").replace(/\$/g,"$$$$")};var k={};k.before=function(e,t,r){var n=e[t];e[t]=function(){r.apply(e,arguments);return n.apply(e,arguments)}};k.after=function(e,t,r){var n=e[t];e[t]=function(){var t=n.apply(e,arguments);r.apply(e,arguments);return t}};var M=function(e){var t=false;return function(){if(t)return;t=true;e.apply(this,arguments)}};var $=function(e,t){var r;return function(){var n=this;var i=arguments;window.clearTimeout(r);r=window.setTimeout(function(){e.apply(n,i)},t)}};var D=function(e,t,r){var n;var i=e.trigger;var a={};e.trigger=function(){var r=arguments[0];if(t.indexOf(r)!==-1){a[r]=arguments}else{return i.apply(e,arguments)}};r.apply(e,[]);e.trigger=i;for(n in a){if(a.hasOwnProperty(n)){i.apply(e,a[n])}}};var L=function(e,t,r,n){e.on(t,r,function(t){var r=t.target;while(r&&r.parentNode!==e[0]){r=r.parentNode}t.currentTarget=r;return n.apply(this,[t])})};var R=function(e){var t={};if("selectionStart"in e){t.start=e.selectionStart;t.length=e.selectionEnd-t.start}else if(document.selection){e.focus();var r=document.selection.createRange();var n=document.selection.createRange().text.length;r.moveStart("character",-e.value.length);t.start=r.text.length-n;t.length=n}return t};var N=function(e,t,r){var n,i,a={};if(r){for(n=0,i=r.length;n<i;n++){a[r[n]]=e.css(r[n])}}else{a=e.css()}t.css(a)};var U=function(t,r){if(!t){return 0}var n=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");N(r,n,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var i=n.width();n.remove();return i};var F=function(e){var t=null;var r=function(r,n){var i,a,o,s,u;var l,c,p;r=r||window.event||{};n=n||{};if(r.metaKey||r.altKey)return;if(!n.force&&e.data("grow")===false)return;i=e.val();if(r.type&&r.type.toLowerCase()==="keydown"){a=r.keyCode;o=a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57||a===32;if(a===v||a===g){p=R(e[0]);if(p.length){i=i.substring(0,p.start)+i.substring(p.start+p.length)}else if(a===g&&p.start){i=i.substring(0,p.start-1)+i.substring(p.start+1)}else if(a===v&&typeof p.start!=="undefined"){i=i.substring(0,p.start)+i.substring(p.start+1)}}else if(o){l=r.shiftKey;c=String.fromCharCode(r.keyCode);if(l)c=c.toUpperCase();else c=c.toLowerCase();i+=c}}s=e.attr("placeholder");if(!i&&s){i=s}u=U(i,e)+4;if(u!==t){t=u;e.width(u);e.triggerHandler("resize")}};e.on("keydown keyup update blur",r);r()};var O=function(r,n){var i,a,o,s,u,l=this;u=r[0];u.selectize=l;var c=window.getComputedStyle&&window.getComputedStyle(u,null);s=c?c.getPropertyValue("direction"):u.currentStyle&&u.currentStyle.direction;s=s||r.parents("[dir]:first").attr("dir")||"";e.extend(l,{order:0,settings:n,$input:r,tabIndex:r.attr("tabindex")||"",tagType:u.tagName.toLowerCase()==="select"?S:x,rtl:/rtl/i.test(s),eventNS:".selectize"+ ++O.count,highlightedValue:null,isOpen:false,isDisabled:false,isRequired:r.is("[required]"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:n.loadThrottle===null?l.onSearchChange:$(l.onSearchChange,n.loadThrottle)});l.sifter=new t(this.options,{diacritics:n.diacritics});if(l.settings.options){for(a=0,o=l.settings.options.length;a<o;a++){l.registerOption(l.settings.options[a])}delete l.settings.options}if(l.settings.optgroups){for(a=0,o=l.settings.optgroups.length;a<o;a++){l.registerOptionGroup(l.settings.optgroups[a])}delete l.settings.optgroups}l.settings.mode=l.settings.mode||(l.settings.maxItems===1?"single":"multi");if(typeof l.settings.hideSelected!=="boolean"){l.settings.hideSelected=l.settings.mode==="multi"}l.initializePlugins(l.settings.plugins);l.setupCallbacks();l.setupTemplates();l.setup()};i.mixin(O);r.mixin(O);e.extend(O.prototype,{setup:function(){var t=this;var r=t.settings;var n=t.eventNS;var i=e(window);var o=e(document);var s=t.$input;var u;var l;var c;var p;var d;var f;var h;var m;var g;var v;var C;h=t.settings.mode;v=s.attr("class")||"";u=e("<div>").addClass(r.wrapperClass).addClass(v).addClass(h);l=e("<div>").addClass(r.inputClass).addClass("items").appendTo(u);c=e('<input type="text" autocomplete="off" />').appendTo(l).attr("tabindex",s.is(":disabled")?"-1":t.tabIndex);f=e(r.dropdownParent||u);p=e("<div>").addClass(r.dropdownClass).addClass(h).hide().appendTo(f);d=e("<div>").addClass(r.dropdownContentClass).appendTo(p);if(t.settings.copyClassesToDropdown){p.addClass(v)}u.css({width:s[0].style.width});if(t.plugins.names.length){C="plugin-"+t.plugins.names.join(" plugin-");u.addClass(C);p.addClass(C)}if((r.maxItems===null||r.maxItems>1)&&t.tagType===S){s.attr("multiple","multiple")}if(t.settings.placeholder){c.attr("placeholder",r.placeholder)}if(!t.settings.splitOn&&t.settings.delimiter){var x=t.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");t.settings.splitOn=new RegExp("\\s*"+x+"+\\s*")}if(s.attr("autocorrect")){c.attr("autocorrect",s.attr("autocorrect"))}if(s.attr("autocapitalize")){c.attr("autocapitalize",s.attr("autocapitalize"))}t.$wrapper=u;t.$control=l;t.$control_input=c;t.$dropdown=p;t.$dropdown_content=d;p.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)});p.on("mousedown click","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)});L(l,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)});F(c);l.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}});c.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){t.ignoreBlur=false;return t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}});o.on("keydown"+n,function(e){t.isCmdDown=e[a?"metaKey":"ctrlKey"];t.isCtrlDown=e[a?"altKey":"ctrlKey"];t.isShiftDown=e.shiftKey});o.on("keyup"+n,function(e){if(e.keyCode===w)t.isCtrlDown=false;if(e.keyCode===b)t.isShiftDown=false;if(e.keyCode===y)t.isCmdDown=false});o.on("mousedown"+n,function(e){if(t.isFocused){if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0]){return false}if(!t.$control.has(e.target).length&&e.target!==t.$control[0]){t.blur(e.target)}}});i.on(["scroll"+n,"resize"+n].join(" "),function(){if(t.isOpen){t.positionDropdown.apply(t,arguments)}});i.on("mousemove"+n,function(){t.ignoreHover=false});this.revertSettings={$children:s.children().detach(),tabindex:s.attr("tabindex")};s.attr("tabindex",-1).hide().after(t.$wrapper);if(e.isArray(r.items)){t.setValue(r.items);delete r.items}if(A){s.on("invalid"+n,function(e){e.preventDefault();t.isInvalid=true;t.refreshState()})}t.updateOriginalInput();t.refreshItems();t.refreshState();t.updatePlaceholder();t.isSetup=true;if(s.is(":disabled")){t.disable()}t.on("change",this.onChange);s.data("selectize",t);s.addClass("selectized");t.trigger("initialize");if(r.preload===true){t.onSearchChange("")}},setupTemplates:function(){var t=this;var r=t.settings.labelField;var n=t.settings.optgroupLabelField;var i={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[n])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[r])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[r])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};t.settings.render=e.extend({},i,t.settings.render)},setupCallbacks:function(){var e,t,r={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in r){if(r.hasOwnProperty(e)){t=this.settings[r[e]];if(t)this.on(e,t)}}},onClick:function(e){var t=this;if(!t.isFocused){t.focus();e.preventDefault()}},onMouseDown:function(t){var r=this;var n=t.isDefaultPrevented();var i=e(t.target);if(r.isFocused){if(t.target!==r.$control_input[0]){if(r.settings.mode==="single"){r.isOpen?r.close():r.open()}else if(!n){r.setActiveItem(null)}return false}}else{if(!n){window.setTimeout(function(){r.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var r=this;if(r.isFull()||r.isInputHidden||r.isLocked){t.preventDefault()}else{if(r.settings.splitOn){setTimeout(function(){var t=e.trim(r.$control_input.val()||"").split(r.settings.splitOn);for(var n=0,i=t.length;n<i;n++){r.createItem(t[n])}},0)}}},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&this.settings.mode==="multi"&&t===this.settings.delimiter){this.createItem();e.preventDefault();return false}},onKeyDown:function(e){var t=e.target===this.$control_input[0];var r=this;if(r.isLocked){if(e.keyCode!==C){e.preventDefault()}return}switch(e.keyCode){case o:if(r.isCmdDown){r.selectAll();return}break;case l:if(r.isOpen){e.preventDefault();e.stopPropagation();r.close()}return;case m:if(!e.ctrlKey||e.altKey)break;case h:if(!r.isOpen&&r.hasOptions){r.open()}else if(r.$activeOption){r.ignoreHover=true;var n=r.getAdjacentOption(r.$activeOption,1);if(n.length)r.setActiveOption(n,true,true)}e.preventDefault();return;case d:if(!e.ctrlKey||e.altKey)break;case p:if(r.$activeOption){r.ignoreHover=true;var i=r.getAdjacentOption(r.$activeOption,-1);if(i.length)r.setActiveOption(i,true,true)}e.preventDefault();return;case u:if(r.isOpen&&r.$activeOption){r.onOptionSelect({currentTarget:r.$activeOption});e.preventDefault()}return;case c:r.advanceSelection(-1,e);return;case f:r.advanceSelection(1,e);return;case C:if(r.settings.selectOnTab&&r.isOpen&&r.$activeOption){r.onOptionSelect({currentTarget:r.$activeOption});if(!r.isFull()){e.preventDefault()}}if(r.settings.create&&r.createItem()){e.preventDefault()}return;case g:case v:r.deleteSelection(e);return}if((r.isFull()||r.isInputHidden)&&!(a?e.metaKey:e.ctrlKey)){e.preventDefault();return}},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var r=t.$control_input.val()||"";if(t.lastValue!==r){t.lastValue=r;t.onSearchChange(r);t.refreshOptions();t.trigger("type",r)}},onSearchChange:function(e){var t=this;var r=t.settings.load;if(!r)return;if(t.loadedSearches.hasOwnProperty(e))return;t.loadedSearches[e]=true;t.load(function(n){r.apply(t,[e,n])})},onFocus:function(e){var t=this;var r=t.isFocused;if(t.isDisabled){t.blur();e&&e.preventDefault();return false}if(t.ignoreFocus)return;t.isFocused=true;if(t.settings.preload==="focus")t.onSearchChange("");
if(!r)t.trigger("focus");if(!t.$activeItems.length){t.showInput();t.setActiveItem(null);t.refreshOptions(!!t.settings.openOnFocus)}t.refreshState()},onBlur:function(e,t){var r=this;if(!r.isFocused)return;r.isFocused=false;if(r.ignoreFocus){return}else if(!r.ignoreBlur&&document.activeElement===r.$dropdown_content[0]){r.ignoreBlur=true;r.onFocus(e);return}var n=function(){r.close();r.setTextboxValue("");r.setActiveItem(null);r.setActiveOption(null);r.setCaret(r.items.length);r.refreshState();(t||document.body).focus();r.ignoreFocus=false;r.trigger("blur")};r.ignoreFocus=true;if(r.settings.create&&r.settings.createOnBlur){r.createItem(null,false,n)}else{n()}},onOptionHover:function(e){if(this.ignoreHover)return;this.setActiveOption(e.currentTarget,false)},onOptionSelect:function(t){var r,n,i,a=this;if(t.preventDefault){t.preventDefault();t.stopPropagation()}n=e(t.currentTarget);if(n.hasClass("create")){a.createItem(null,function(){if(a.settings.closeAfterSelect){a.close()}})}else{r=n.attr("data-value");if(typeof r!=="undefined"){a.lastQuery=null;a.setTextboxValue("");a.addItem(r);if(a.settings.closeAfterSelect){a.close()}else if(!a.settings.hideSelected&&t.type&&/mouse/.test(t.type)){a.setActiveOption(a.getOption(r))}}}},onItemSelect:function(e){var t=this;if(t.isLocked)return;if(t.settings.mode==="multi"){e.preventDefault();t.setActiveItem(e.currentTarget,e)}},load:function(e){var t=this;var r=t.$wrapper.addClass(t.settings.loadingClass);t.loading++;e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0);if(e&&e.length){t.addOption(e);t.refreshOptions(t.isFocused&&!t.isInputHidden)}if(!t.loading){r.removeClass(t.settings.loadingClass)}t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input;var r=t.val()!==e;if(r){t.val(e).triggerHandler("update");this.lastValue=e}},getValue:function(){if(this.tagType===S&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(e,t){var r=t?[]:["change"];D(this,r,function(){this.clear(t);this.addItems(e,t)})},setActiveItem:function(t,r){var n=this;var i;var a,o,s,u,l,c;var p;if(n.settings.mode==="single")return;t=e(t);if(!t.length){e(n.$activeItems).removeClass("active");n.$activeItems=[];if(n.isFocused){n.showInput()}return}i=r&&r.type.toLowerCase();if(i==="mousedown"&&n.isShiftDown&&n.$activeItems.length){p=n.$control.children(".active:last");s=Array.prototype.indexOf.apply(n.$control[0].childNodes,[p[0]]);u=Array.prototype.indexOf.apply(n.$control[0].childNodes,[t[0]]);if(s>u){c=s;s=u;u=c}for(a=s;a<=u;a++){l=n.$control[0].childNodes[a];if(n.$activeItems.indexOf(l)===-1){e(l).addClass("active");n.$activeItems.push(l)}}r.preventDefault()}else if(i==="mousedown"&&n.isCtrlDown||i==="keydown"&&this.isShiftDown){if(t.hasClass("active")){o=n.$activeItems.indexOf(t[0]);n.$activeItems.splice(o,1);t.removeClass("active")}else{n.$activeItems.push(t.addClass("active")[0])}}else{e(n.$activeItems).removeClass("active");n.$activeItems=[t.addClass("active")[0]]}n.hideInput();if(!this.isFocused){n.focus()}},setActiveOption:function(t,r,n){var i,a,o;var s,u;var l=this;if(l.$activeOption)l.$activeOption.removeClass("active");l.$activeOption=null;t=e(t);if(!t.length)return;l.$activeOption=t.addClass("active");if(r||!T(r)){i=l.$dropdown_content.height();a=l.$activeOption.outerHeight(true);r=l.$dropdown_content.scrollTop()||0;o=l.$activeOption.offset().top-l.$dropdown_content.offset().top+r;s=o;u=o-i+a;if(o+a>i+r){l.$dropdown_content.stop().animate({scrollTop:u},n?l.settings.scrollDuration:0)}else if(o<r){l.$dropdown_content.stop().animate({scrollTop:s},n?l.settings.scrollDuration:0)}}},selectAll:function(){var e=this;if(e.settings.mode==="single")return;e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active"));if(e.$activeItems.length){e.hideInput();e.close()}e.focus()},hideInput:function(){var e=this;e.setTextboxValue("");e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4});e.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var e=this;if(e.isDisabled)return;e.ignoreFocus=true;e.$control_input[0].focus();window.setTimeout(function(){e.ignoreFocus=false;e.onFocus()},0)},blur:function(e){this.$control_input[0].blur();this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings;var t=e.sortField;if(typeof t==="string"){t=[{field:t}]}return{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(t){var r,n,i,a,o;var s=this;var u=s.settings;var l=this.getSearchOptions();if(u.score){o=s.settings.score.apply(this,[t]);if(typeof o!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(t!==s.lastQuery){s.lastQuery=t;a=s.sifter.search(t,e.extend(l,{score:o}));s.currentResults=a}else{a=e.extend(true,{},s.currentResults)}if(u.hideSelected){for(r=a.items.length-1;r>=0;r--){if(s.items.indexOf(I(a.items[r].id))!==-1){a.items.splice(r,1)}}}return a},refreshOptions:function(t){var r,i,a,o,s,u,l,c,p,d,f,h,m;var g,v,b;if(typeof t==="undefined"){t=true}var y=this;var w=e.trim(y.$control_input.val());var C=y.search(w);var S=y.$dropdown_content;var x=y.$activeOption&&I(y.$activeOption.attr("data-value"));o=C.items.length;if(typeof y.settings.maxOptions==="number"){o=Math.min(o,y.settings.maxOptions)}s={};u=[];for(r=0;r<o;r++){l=y.options[C.items[r].id];c=y.render("option",l);p=l[y.settings.optgroupField]||"";d=e.isArray(p)?p:[p];for(i=0,a=d&&d.length;i<a;i++){p=d[i];if(!y.optgroups.hasOwnProperty(p)){p=""}if(!s.hasOwnProperty(p)){s[p]=[];u.push(p)}s[p].push(c)}}if(this.settings.lockOptgroupOrder){u.sort(function(e,t){var r=y.optgroups[e].$order||0;var n=y.optgroups[t].$order||0;return r-n})}f=[];for(r=0,o=u.length;r<o;r++){p=u[r];if(y.optgroups.hasOwnProperty(p)&&s[p].length){h=y.render("optgroup_header",y.optgroups[p])||"";h+=s[p].join("");f.push(y.render("optgroup",e.extend({},y.optgroups[p],{html:h})))}else{f.push(s[p].join(""))}}S.html(f.join(""));if(y.settings.highlight&&C.query.length&&C.tokens.length){for(r=0,o=C.tokens.length;r<o;r++){n(S,C.tokens[r].regex)}}if(!y.settings.hideSelected){for(r=0,o=y.items.length;r<o;r++){y.getOption(y.items[r]).addClass("selected")}}m=y.canCreate(w);if(m){S.prepend(y.render("option_create",{input:w}));b=e(S[0].childNodes[0])}y.hasOptions=C.items.length>0||m;if(y.hasOptions){if(C.items.length>0){v=x&&y.getOption(x);if(v&&v.length){g=v}else if(y.settings.mode==="single"&&y.items.length){g=y.getOption(y.items[0])}if(!g||!g.length){if(b&&!y.settings.addPrecedence){g=y.getAdjacentOption(b,1)}else{g=S.find("[data-selectable]:first")}}}else{g=b}y.setActiveOption(g);if(t&&!y.isOpen){y.open()}}else{y.setActiveOption(null);if(t&&y.isOpen){y.close()}}},addOption:function(t){var r,n,i,a=this;if(e.isArray(t)){for(r=0,n=t.length;r<n;r++){a.addOption(t[r])}return}if(i=a.registerOption(t)){a.userOptions[i]=true;a.lastQuery=null;a.trigger("option_add",i,t)}},registerOption:function(e){var t=I(e[this.settings.valueField]);if(!t||this.options.hasOwnProperty(t))return false;e.$order=e.$order||++this.order;this.options[t]=e;return t},registerOptionGroup:function(e){var t=I(e[this.settings.optgroupValueField]);if(!t)return false;e.$order=e.$order||++this.order;this.optgroups[t]=e;return t},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e;if(e=this.registerOptionGroup(t)){this.trigger("optgroup_add",e,t)}},removeOptionGroup:function(e){if(this.optgroups.hasOwnProperty(e)){delete this.optgroups[e];this.renderCache={};this.trigger("optgroup_remove",e)}},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger("optgroup_clear")},updateOption:function(t,r){var n=this;var i,a;var o,s,u,l,c;t=I(t);o=I(r[n.settings.valueField]);if(t===null)return;if(!n.options.hasOwnProperty(t))return;if(typeof o!=="string")throw new Error("Value must be set in option data");c=n.options[t].$order;if(o!==t){delete n.options[t];s=n.items.indexOf(t);if(s!==-1){n.items.splice(s,1,o)}}r.$order=r.$order||c;n.options[o]=r;u=n.renderCache["item"];l=n.renderCache["option"];if(u){delete u[t];delete u[o]}if(l){delete l[t];delete l[o]}if(n.items.indexOf(o)!==-1){i=n.getItem(t);a=e(n.render("item",r));if(i.hasClass("active"))a.addClass("active");i.replaceWith(a)}n.lastQuery=null;if(n.isOpen){n.refreshOptions(false)}},removeOption:function(e,t){var r=this;e=I(e);var n=r.renderCache["item"];var i=r.renderCache["option"];if(n)delete n[e];if(i)delete i[e];delete r.userOptions[e];delete r.options[e];r.lastQuery=null;r.trigger("option_remove",e);r.removeItem(e,t)},clearOptions:function(){var e=this;e.loadedSearches={};e.userOptions={};e.renderCache={};e.options=e.sifter.items={};e.lastQuery=null;e.trigger("option_clear");e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,r){var n=this.$dropdown.find("[data-selectable]");var i=n.index(t)+r;return i>=0&&i<n.length?n.eq(i):e()},getElementWithValue:function(t,r){t=I(t);if(typeof t!=="undefined"&&t!==null){for(var n=0,i=r.length;n<i;n++){if(r[n].getAttribute("data-value")===t){return e(r[n])}}}return e()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(t,r){var n=e.isArray(t)?t:[t];for(var i=0,a=n.length;i<a;i++){this.isPending=i<a-1;this.addItem(n[i],r)}},addItem:function(t,r){var n=r?[]:["change"];D(this,n,function(){var n,i,a;var o=this;var s=o.settings.mode;var u,l,c,p;t=I(t);if(o.items.indexOf(t)!==-1){if(s==="single")o.close();return}if(!o.options.hasOwnProperty(t))return;if(s==="single")o.clear(r);if(s==="multi"&&o.isFull())return;n=e(o.render("item",o.options[t]));p=o.isFull();o.items.splice(o.caretPos,0,t);o.insertAtCaret(n);if(!o.isPending||!p&&o.isFull()){o.refreshState()}if(o.isSetup){a=o.$dropdown_content.find("[data-selectable]");if(!o.isPending){i=o.getOption(t);c=o.getAdjacentOption(i,1).attr("data-value");o.refreshOptions(o.isFocused&&s!=="single");if(c){o.setActiveOption(o.getOption(c))}}if(!a.length||o.isFull()){o.close()}else{o.positionDropdown()}o.updatePlaceholder();o.trigger("item_add",t,n);o.updateOriginalInput({silent:r})}})},removeItem:function(e,t){var r=this;var n,i,a;n=typeof e==="object"?e:r.getItem(e);e=I(n.attr("data-value"));i=r.items.indexOf(e);if(i!==-1){n.remove();if(n.hasClass("active")){a=r.$activeItems.indexOf(n[0]);r.$activeItems.splice(a,1)}r.items.splice(i,1);r.lastQuery=null;if(!r.settings.persist&&r.userOptions.hasOwnProperty(e)){r.removeOption(e,t)}if(i<r.caretPos){r.setCaret(r.caretPos-1)}r.refreshState();r.updatePlaceholder();r.updateOriginalInput({silent:t});r.positionDropdown();r.trigger("item_remove",e,n)}},createItem:function(t,r){var n=this;var i=n.caretPos;t=t||e.trim(n.$control_input.val()||"");var a=arguments[arguments.length-1];if(typeof a!=="function")a=function(){};if(typeof r!=="boolean"){r=true}if(!n.canCreate(t)){a();return false}n.lock();var o=typeof n.settings.create==="function"?this.settings.create:function(e){var t={};t[n.settings.labelField]=e;t[n.settings.valueField]=e;return t};var s=M(function(e){n.unlock();if(!e||typeof e!=="object")return a();var t=I(e[n.settings.valueField]);if(typeof t!=="string")return a();n.setTextboxValue("");n.addOption(e);n.setCaret(i);n.addItem(t);n.refreshOptions(r&&n.settings.mode!=="single");a(e)});var u=o.apply(this,[t,s]);if(typeof u!=="undefined"){s(u)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){this.addItem(this.items)}this.refreshState();this.updateOriginalInput()},refreshState:function(){var e,t=this;if(t.isRequired){if(t.items.length)t.isInvalid=false;t.$control_input.prop("required",e)}t.refreshClasses()},refreshClasses:function(){var t=this;var r=t.isFull();var n=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl);t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",n).toggleClass("full",r).toggleClass("not-full",!r).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!e.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0);t.$control_input.data("grow",!r&&!n)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,r,n,i,a=this;e=e||{};if(a.tagType===S){n=[];for(t=0,r=a.items.length;t<r;t++){i=a.options[a.items[t]][a.settings.labelField]||"";n.push('<option value="'+E(a.items[t])+'" selected="selected">'+E(i)+"</option>")}if(!n.length&&!this.$input.attr("multiple")){n.push('<option value="" selected="selected"></option>')}a.$input.html(n.join(""))}else{a.$input.val(a.getValue());a.$input.attr("value",a.$input.val())}if(a.isSetup){if(!e.silent){a.trigger("change",a.$input.val())}}},updatePlaceholder:function(){if(!this.settings.placeholder)return;var e=this.$control_input;if(this.items.length){e.removeAttr("placeholder")}else{e.attr("placeholder",this.settings.placeholder)}e.triggerHandler("update",{force:true})},open:function(){var e=this;if(e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull())return;e.focus();e.isOpen=true;e.refreshState();e.$dropdown.css({visibility:"hidden",display:"block"});e.positionDropdown();e.$dropdown.css({visibility:"visible"});e.trigger("dropdown_open",e.$dropdown)},close:function(){var e=this;var t=e.isOpen;if(e.settings.mode==="single"&&e.items.length){e.hideInput()}e.isOpen=false;e.$dropdown.hide();e.setActiveOption(null);e.refreshState();if(t)e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control;var t=this.settings.dropdownParent==="body"?e.offset():e.position();t.top+=e.outerHeight(true);this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(e){var t=this;if(!t.items.length)return;t.$control.children(":not(input)").remove();t.items=[];t.lastQuery=null;t.setCaret(0);t.setActiveItem(null);t.updatePlaceholder();t.updateOriginalInput({silent:e});t.refreshState();t.showInput();t.trigger("clear")},insertAtCaret:function(t){var r=Math.min(this.caretPos,this.items.length);if(r===0){this.$control.prepend(t)}else{e(this.$control[0].childNodes[r]).before(t)}this.setCaret(r+1)},deleteSelection:function(t){var r,n,i,a,o,s,u,l,c;var p=this;i=t&&t.keyCode===g?-1:1;a=R(p.$control_input[0]);if(p.$activeOption&&!p.settings.hideSelected){u=p.getAdjacentOption(p.$activeOption,-1).attr("data-value")}o=[];if(p.$activeItems.length){c=p.$control.children(".active:"+(i>0?"last":"first"));s=p.$control.children(":not(input)").index(c);if(i>0){s++}for(r=0,n=p.$activeItems.length;r<n;r++){o.push(e(p.$activeItems[r]).attr("data-value"))}if(t){t.preventDefault();t.stopPropagation()}}else if((p.isFocused||p.settings.mode==="single")&&p.items.length){if(i<0&&a.start===0&&a.length===0){o.push(p.items[p.caretPos-1])}else if(i>0&&a.start===p.$control_input.val().length){o.push(p.items[p.caretPos])}}if(!o.length||typeof p.settings.onDelete==="function"&&p.settings.onDelete.apply(p,[o])===false){return false}if(typeof s!=="undefined"){p.setCaret(s)}while(o.length){p.removeItem(o.pop())}p.showInput();p.positionDropdown();p.refreshOptions(true);if(u){l=p.getOption(u);if(l.length){p.setActiveOption(l)}}return true},advanceSelection:function(e,t){var r,n,i,a,o,s;var u=this;if(e===0)return;if(u.rtl)e*=-1;r=e>0?"last":"first";n=R(u.$control_input[0]);if(u.isFocused&&!u.isInputHidden){a=u.$control_input.val().length;o=e<0?n.start===0&&n.length===0:n.start===a;if(o&&!a){u.advanceCaret(e,t)}}else{s=u.$control.children(".active:"+r);if(s.length){i=u.$control.children(":not(input)").index(s);u.setActiveItem(null);u.setCaret(e>0?i+1:i)}}},advanceCaret:function(e,t){var r=this,n,i;if(e===0)return;n=e>0?"next":"prev";if(r.isShiftDown){i=r.$control_input[n]();if(i.length){r.hideInput();r.setActiveItem(i);t&&t.preventDefault()}}else{r.setCaret(r.caretPos+e)}},setCaret:function(t){var r=this;if(r.settings.mode==="single"){t=r.items.length}else{t=Math.max(0,Math.min(r.items.length,t))}if(!r.isPending){var n,i,a,o,s;o=r.$control.children(":not(input)");for(n=0,i=o.length;n<i;n++){s=e(o[n]).detach();if(n<t){r.$control_input.before(s)}else{r.$control.append(s)}}}r.caretPos=t},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",true);e.$control_input.prop("disabled",true).prop("tabindex",-1);e.isDisabled=true;e.lock()},enable:function(){var e=this;e.$input.prop("disabled",false);e.$control_input.prop("disabled",false).prop("tabindex",e.tabIndex);e.isDisabled=false;e.unlock()},destroy:function(){var t=this;var r=t.eventNS;var n=t.revertSettings;t.trigger("destroy");t.off();t.$wrapper.remove();t.$dropdown.remove();t.$input.html("").append(n.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:n.tabindex}).show();t.$control_input.removeData("grow");t.$input.removeData("selectize");e(window).off(r);e(document).off(r);e(document.body).off(r);delete t.$input[0].selectize},render:function(e,t){var r,n,i;var a="";var o=false;var s=this;var u=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(e==="option"||e==="item"){r=I(t[s.settings.valueField]);o=!!r}if(o){if(!T(s.renderCache[e])){s.renderCache[e]={}}if(s.renderCache[e].hasOwnProperty(r)){return s.renderCache[e][r]}}a=s.settings.render[e].apply(this,[t,E]);if(e==="option"||e==="option_create"){a=a.replace(u,"<$1 data-selectable")}if(e==="optgroup"){n=t[s.settings.optgroupValueField]||"";a=a.replace(u,'<$1 data-group="'+P(E(n))+'"')}if(e==="option"||e==="item"){a=a.replace(u,'<$1 data-value="'+P(E(r||""))+'"')}if(o){s.renderCache[e][r]=a}return a},clearCache:function(e){var t=this;if(typeof e==="undefined"){t.renderCache={}}else{delete t.renderCache[e]}},canCreate:function(e){var t=this;if(!t.settings.create)return false;var r=t.settings.createFilter;return e.length&&(typeof r!=="function"||r.apply(t,[e]))&&(typeof r!=="string"||new RegExp(r).test(e))&&(!(r instanceof RegExp)||r.test(e))}});O.count=0;O.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:true,diacritics:true,create:false,createOnBlur:false,createFilter:null,highlight:true,openOnFocus:true,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:false,selectOnTab:false,preload:false,allowEmptyOption:false,closeAfterSelect:false,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:false,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:true,render:{}};e.fn.selectize=function(t){var r=e.fn.selectize.defaults;var n=e.extend({},r,t);var i=n.dataAttr;var a=n.labelField;var o=n.valueField;var s=n.optgroupField;var u=n.optgroupLabelField;var l=n.optgroupValueField;var c=function(t,r){var s,u,l,c;var p=t.attr(i);if(!p){var d=e.trim(t.val()||"");if(!n.allowEmptyOption&&!d.length)return;l=d.split(n.delimiter);for(s=0,u=l.length;s<u;s++){c={};c[a]=l[s];c[o]=l[s];r.options.push(c)}r.items=l}else{r.options=JSON.parse(p);for(s=0,u=r.options.length;s<u;s++){r.items.push(r.options[s][o])}}};var p=function(t,r){var c,p,d,f,h=0;var m=r.options;var g={};var v=function(e){var t=i&&e.attr(i);if(typeof t==="string"&&t.length){return JSON.parse(t)}return null};var b=function(t,i){t=e(t);var u=I(t.attr("value"));if(!u&&!n.allowEmptyOption)return;if(g.hasOwnProperty(u)){if(i){var l=g[u][s];if(!l){g[u][s]=i}else if(!e.isArray(l)){g[u][s]=[l,i]}else{l.push(i)}}return}var c=v(t)||{};c[a]=c[a]||t.text();c[o]=c[o]||u;c[s]=c[s]||i;g[u]=c;m.push(c);if(t.is(":selected")){r.items.push(u)}};var y=function(t){var n,i,a,o,s;t=e(t);a=t.attr("label");if(a){o=v(t)||{};o[u]=a;o[l]=a;r.optgroups.push(o)}s=e("option",t);for(n=0,i=s.length;n<i;n++){b(s[n],a)}};r.maxItems=t.attr("multiple")?null:1;f=t.children();for(c=0,p=f.length;c<p;c++){d=f[c].tagName.toLowerCase();if(d==="optgroup"){y(f[c])}else if(d==="option"){b(f[c])}}};return this.each(function(){if(this.selectize)return;var i;var a=e(this);var o=this.tagName.toLowerCase();var s=a.attr("placeholder")||a.attr("data-placeholder");if(!s&&!n.allowEmptyOption){s=a.children('option[value=""]').text()}var u={placeholder:s,options:[],optgroups:[],items:[]};if(o==="select"){p(a,u)}else{c(a,u)}i=new O(a,e.extend(true,{},r,u,t))})};e.fn.selectize.defaults=O.defaults;e.fn.selectize.support={validity:A};O.define("drag_drop",function(t){if(!e.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(this.settings.mode!=="multi")return;var r=this;r.lock=function(){var e=r.lock;return function(){var t=r.$control.data("sortable");if(t)t.disable();return e.apply(r,arguments)}}();r.unlock=function(){var e=r.unlock;return function(){var t=r.$control.data("sortable");if(t)t.enable();return e.apply(r,arguments)}}();r.setup=function(){var t=r.setup;return function(){t.apply(this,arguments);var n=r.$control.sortable({items:"[data-value]",forcePlaceholderSize:true,disabled:r.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width"));n.css({overflow:"visible"})},stop:function(){n.css({overflow:"hidden"});var t=r.$activeItems?r.$activeItems.slice():null;var i=[];n.children("[data-value]").each(function(){i.push(e(this).attr("data-value"))});r.setValue(i);r.setActiveItem(t)}})}}()});O.define("dropdown_header",function(t){var r=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'">'+'<div class="'+e.titleRowClass+'">'+'<span class="'+e.labelClass+'">'+e.title+"</span>"+'<a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a>'+"</div>"+"</div>"}},t);r.setup=function(){var n=r.setup;return function(){n.apply(r,arguments);r.$dropdown_header=e(t.html(t));r.$dropdown.prepend(r.$dropdown_header)}}()});O.define("optgroup_columns",function(t){var r=this;t=e.extend({equalizeWidth:true,equalizeHeight:true},t);this.getAdjacentOption=function(t,r){var n=t.closest("[data-group]").find("[data-selectable]");var i=n.index(t)+r;return i>=0&&i<n.length?n.eq(i):e()};this.onKeyDown=function(){var e=r.onKeyDown;return function(t){var n,i,a,o;if(this.isOpen&&(t.keyCode===c||t.keyCode===f)){r.ignoreHover=true;o=this.$activeOption.closest("[data-group]");n=o.find("[data-selectable]").index(this.$activeOption);if(t.keyCode===c){o=o.prev("[data-group]")}else{o=o.next("[data-group]")}a=o.find("[data-selectable]");i=a.eq(Math.min(a.length-1,n));if(i.length){this.setActiveOption(i)}return}return e.apply(this,arguments)}}();var n=function(){var e;var t=n.width;var r=document;if(typeof t==="undefined"){e=r.createElement("div");e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>';e=e.firstChild;r.body.appendChild(e);t=n.width=e.offsetWidth-e.clientWidth;r.body.removeChild(e)}return t};var i=function(){var i,a,o,s,u,l,c;c=e("[data-group]",r.$dropdown_content);a=c.length;if(!a||!r.$dropdown_content.width())return;if(t.equalizeHeight){o=0;for(i=0;i<a;i++){o=Math.max(o,c.eq(i).height())}c.css({height:o})}if(t.equalizeWidth){l=r.$dropdown_content.innerWidth()-n();s=Math.round(l/a);c.css({width:s});if(a>1){u=l-s*(a-1);c.eq(a-1).css({width:u})}}};if(t.equalizeHeight||t.equalizeWidth){k.after(this,"positionDropdown",i);k.after(this,"refreshOptions",i)}});O.define("remove_button",function(t){if(this.settings.mode==="single")return;t=e.extend({label:"&times;",title:"Remove",className:"remove",append:true},t);var r=this;var n='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+E(t.title)+'">'+t.label+"</a>";var i=function(e,t){var r=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,r)+t+e.substring(r)};this.setup=function(){var a=r.setup;return function(){if(t.append){var o=r.settings.render.item;r.settings.render.item=function(e){return i(o.apply(this,arguments),n)}}a.apply(this,arguments);this.$control.on("click","."+t.className,function(t){t.preventDefault();if(r.isLocked)return;var n=e(t.currentTarget).parent();r.setActiveItem(n);if(r.deleteSelection()){r.setCaret(r.items.length)}})}}()});O.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]};this.onKeyDown=function(){var r=t.onKeyDown;return function(t){var n,i;if(t.keyCode===g&&this.$control_input.val()===""&&!this.$activeItems.length){n=this.caretPos-1;if(n>=0&&n<this.items.length){i=this.options[this.items[n]];if(this.deleteSelection(t)){this.setTextboxValue(e.text.apply(this,[i]));this.refreshOptions(true)}t.preventDefault();return}}return r.apply(this,arguments)}}()});return O});(function(e){if(e.jQuery){return}var t=function(e,r){return new t.fn.init(e,r)};t.isWindow=function(e){return e!=null&&e==e.window};t.type=function(e){if(e==null){return e+""}return typeof e==="object"||typeof e==="function"?i[o.call(e)]||"object":typeof e};t.isArray=Array.isArray||function(e){return t.type(e)==="array"};function r(e){var r=e.length,n=t.type(e);if(n==="function"||t.isWindow(e)){return false}if(e.nodeType===1&&r){return true}return n==="array"||r===0||typeof r==="number"&&r>0&&r-1 in e}t.isPlainObject=function(e){var r;if(!e||t.type(e)!=="object"||e.nodeType||t.isWindow(e)){return false}try{if(e.constructor&&!a.call(e,"constructor")&&!a.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(n){return false}for(r in e){}return r===undefined||a.call(e,r)};t.each=function(e,t,n){var i,a=0,o=e.length,s=r(e);if(n){if(s){for(;a<o;a++){i=t.apply(e[a],n);if(i===false){break}}}else{for(a in e){i=t.apply(e[a],n);if(i===false){break}}}}else{if(s){for(;a<o;a++){i=t.call(e[a],a,e[a]);if(i===false){break}}}else{for(a in e){i=t.call(e[a],a,e[a]);if(i===false){break}}}}return e};t.data=function(e,r,i){if(i===undefined){var a=e[t.expando],o=a&&n[a];if(r===undefined){return o}else if(o){if(r in o){return o[r]}}}else if(r!==undefined){var a=e[t.expando]||(e[t.expando]=++t.uuid);n[a]=n[a]||{};n[a][r]=i;return i}};t.removeData=function(e,r){var i=e[t.expando],a=i&&n[i];if(a){t.each(r,function(e,t){delete a[t]})}};t.extend=function(){var e,r,n,i,a,o,s=arguments[0]||{},u=1,l=arguments.length,c=false;if(typeof s==="boolean"){c=s;s=arguments[u]||{};u++}if(typeof s!=="object"&&t.type(s)!=="function"){s={}}if(u===l){s=this;u--}for(;u<l;u++){if((a=arguments[u])!=null){for(i in a){e=s[i];n=a[i];if(s===n){continue}if(c&&n&&(t.isPlainObject(n)||(r=t.isArray(n)))){if(r){r=false;o=e&&t.isArray(e)?e:[]}else{o=e&&t.isPlainObject(e)?e:{}}s[i]=t.extend(c,o,n)}else if(n!==undefined){s[i]=n}}}}return s};t.queue=function(e,n,i){function a(e,t){var n=t||[];if(e!=null){if(r(Object(e))){(function(e,t){var r=+t.length,n=0,i=e.length;while(n<r){e[i++]=t[n++]}if(r!==r){while(t[n]!==undefined){e[i++]=t[n++]}}e.length=i;return e})(n,typeof e==="string"?[e]:e)}else{[].push.call(n,e)}}return n}if(!e){return}n=(n||"fx")+"queue";var o=t.data(e,n);if(!i){return o||[]}if(!o||t.isArray(i)){o=t.data(e,n,a(i))}else{o.push(i)}return o};t.dequeue=function(e,r){t.each(e.nodeType?[e]:e,function(e,n){r=r||"fx";var i=t.queue(n,r),a=i.shift();if(a==="inprogress"){a=i.shift()}if(a){if(r==="fx"){i.unshift("inprogress")}a.call(n,function(){t.dequeue(n,r)})}})};t.fn=t.prototype={init:function(e){if(e.nodeType){this[0]=e;return this}else{throw new Error("Not a DOM node.")}},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){var e=this.offsetParent||document;while(e&&(!e.nodeType.toLowerCase==="html"&&e.style.position==="static")){e=e.offsetParent}return e||document}var r=this[0],e=e.apply(r),n=this.offset(),i=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:t(e).offset();n.top-=parseFloat(r.style.marginTop)||0;n.left-=parseFloat(r.style.marginLeft)||0;if(e.style){i.top+=parseFloat(e.style.borderTopWidth)||0;i.left+=parseFloat(e.style.borderLeftWidth)||0}return{top:n.top-i.top,left:n.left-i.left}}};var n={};t.expando="velocity"+(new Date).getTime();t.uuid=0;var i={},a=i.hasOwnProperty,o=i.toString;var s="Boolean Number String Function Array Date RegExp Object Error".split(" ");for(var u=0;u<s.length;u++){i["[object "+s[u]+"]"]=s[u].toLowerCase()}t.fn.init.prototype=t.fn;e.Velocity={Utilities:t}})(window);(function(e){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{e()}})(function(){return function(e,t,r,n){var i=function(){if(r.documentMode){return r.documentMode}else{for(var e=7;e>4;e--){var t=r.createElement("div");t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->";if(t.getElementsByTagName("span").length){t=null;return e}}}return n}();var a=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var r=(new Date).getTime(),n;n=Math.max(0,16-(r-e));e=r+n;return setTimeout(function(){t(r+n)},n)}}();function o(e){var t=-1,r=e?e.length:0,n=[];while(++t<r){var i=e[t];if(i){n.push(i)}}return n}function s(e){if(u.isWrapped(e)){e=[].slice.call(e)}else if(u.isNode(e)){e=[e]}return e}var u={isString:function(e){return typeof e==="string"},isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},isFunction:function(e){return Object.prototype.toString.call(e)==="[object Function]"},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return typeof e==="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==n&&(e.length===0||typeof e[0]==="object"&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e){return false}return true}};var l,c=false;if(e.fn&&e.fn.jquery){l=e;c=true}else{l=t.Velocity.Utilities}if(i<=8&&!c){throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.")}else if(i<=7){jQuery.fn.velocity=jQuery.fn.animate;return}var p=400,d="swing";var f={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:r.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:false,calls:[]},CSS:{},Utilities:l,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:p,easing:d,begin:n,complete:n,progress:n,display:n,visibility:n,loop:false,delay:false,mobileHA:true,_cacheValues:true},init:function(e){l.data(e,"velocity",{isSVG:u.isSVG(e),isAnimating:false,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:false,version:{major:1,minor:2,patch:2},debug:false};if(t.pageYOffset!==n){f.State.scrollAnchor=t;f.State.scrollPropertyLeft="pageXOffset";f.State.scrollPropertyTop="pageYOffset"}else{f.State.scrollAnchor=r.documentElement||r.body.parentNode||r.body;f.State.scrollPropertyLeft="scrollLeft";
f.State.scrollPropertyTop="scrollTop"}function h(e){var t=l.data(e,"velocity");return t===null?n:t}function m(e){return function(t){return Math.round(t*e)*(1/e)}}function g(e,r,n,i){var a=4,o=.001,s=1e-7,u=10,l=11,c=1/(l-1),p="Float32Array"in t;if(arguments.length!==4){return false}for(var d=0;d<4;++d){if(typeof arguments[d]!=="number"||isNaN(arguments[d])||!isFinite(arguments[d])){return false}}e=Math.min(e,1);n=Math.min(n,1);e=Math.max(e,0);n=Math.max(n,0);var f=p?new Float32Array(l):new Array(l);function h(e,t){return 1-3*t+3*e}function m(e,t){return 3*t-6*e}function g(e){return 3*e}function v(e,t,r){return((h(t,r)*e+m(t,r))*e+g(t))*e}function b(e,t,r){return 3*h(t,r)*e*e+2*m(t,r)*e+g(t)}function y(t,r){for(var i=0;i<a;++i){var o=b(r,e,n);if(o===0)return r;var s=v(r,e,n)-t;r-=s/o}return r}function w(){for(var t=0;t<l;++t){f[t]=v(t*c,e,n)}}function C(t,r,i){var a,o,l=0;do{o=r+(i-r)/2;a=v(o,e,n)-t;if(a>0){i=o}else{r=o}}while(Math.abs(a)>s&&++l<u);return o}function S(t){var r=0,i=1,a=l-1;for(;i!=a&&f[i]<=t;++i){r+=c}--i;var s=(t-f[i])/(f[i+1]-f[i]),u=r+s*c,p=b(u,e,n);if(p>=o){return y(t,u)}else if(p==0){return u}else{return C(t,r,r+c)}}var x=false;function A(){x=true;if(e!=r||n!=i)w()}var T=function(t){if(!x)A();if(e===r&&n===i)return t;if(t===0)return 0;if(t===1)return 1;return v(S(t),r,i)};T.getControlPoints=function(){return[{x:e,y:r},{x:n,y:i}]};var I="generateBezier("+[e,r,n,i]+")";T.toString=function(){return I};return T}var v=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,r,n){var i={x:t.x+n.dx*r,v:t.v+n.dv*r,tension:t.tension,friction:t.friction};return{dx:i.v,dv:e(i)}}function r(r,n){var i={dx:r.v,dv:e(r)},a=t(r,n*.5,i),o=t(r,n*.5,a),s=t(r,n,o),u=1/6*(i.dx+2*(a.dx+o.dx)+s.dx),l=1/6*(i.dv+2*(a.dv+o.dv)+s.dv);r.x=r.x+u*n;r.v=r.v+l*n;return r}return function n(e,t,i){var a={x:-1,v:0,tension:null,friction:null},o=[0],s=0,u=1/1e4,l=16/1e3,c,p,d;e=parseFloat(e)||500;t=parseFloat(t)||20;i=i||null;a.tension=e;a.friction=t;c=i!==null;if(c){s=n(e,t);p=s/i*l}else{p=l}while(true){d=r(d||a,p);o.push(1+d.x);s+=16;if(!(Math.abs(d.x)>u&&Math.abs(d.v)>u)){break}}return!c?s:function(e){return o[e*(o.length-1)|0]}}}();f.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(e*4.5*Math.PI)*Math.exp(-e*6)}};l.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){f.Easings[t[0]]=g.apply(null,t[1])});function b(e,t){var r=e;if(u.isString(e)){if(!f.Easings[e]){r=false}}else if(u.isArray(e)&&e.length===1){r=m.apply(null,e)}else if(u.isArray(e)&&e.length===2){r=v.apply(null,e.concat([t]))}else if(u.isArray(e)&&e.length===4){r=g.apply(null,e)}else{r=false}if(r===false){if(f.Easings[f.defaults.easing]){r=f.defaults.easing}else{r=d}}return r}var y=f.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<y.Lists.colors.length;e++){var t=y.Lists.colors[e]==="color"?"0 0 0 1":"255 255 255 1";y.Hooks.templates[y.Lists.colors[e]]=["Red Green Blue Alpha",t]}var r,n,a;if(i){for(r in y.Hooks.templates){n=y.Hooks.templates[r];a=n[0].split(" ");var o=n[1].match(y.RegEx.valueSplit);if(a[0]==="Color"){a.push(a.shift());o.push(o.shift());y.Hooks.templates[r]=[a.join(" "),o.join(" ")]}}}for(r in y.Hooks.templates){n=y.Hooks.templates[r];a=n[0].split(" ");for(var e in a){var s=r+a[e],u=e;y.Hooks.registered[s]=[r,u]}}},getRoot:function(e){var t=y.Hooks.registered[e];if(t){return t[0]}else{return e}},cleanRootPropertyValue:function(e,t){if(y.RegEx.valueUnwrap.test(t)){t=t.match(y.RegEx.valueUnwrap)[1]}if(y.Values.isCSSNullValue(t)){t=y.Hooks.templates[e][1]}return t},extractValue:function(e,t){var r=y.Hooks.registered[e];if(r){var n=r[0],i=r[1];t=y.Hooks.cleanRootPropertyValue(n,t);return t.toString().match(y.RegEx.valueSplit)[i]}else{return t}},injectValue:function(e,t,r){var n=y.Hooks.registered[e];if(n){var i=n[0],a=n[1],o,s;r=y.Hooks.cleanRootPropertyValue(i,r);o=r.toString().match(y.RegEx.valueSplit);o[a]=t;s=o.join(" ");return s}else{return r}}},Normalizations:{registered:{clip:function(e,t,r){switch(e){case"name":return"clip";case"extract":var n;if(y.RegEx.wrappedValueAlreadyExtracted.test(r)){n=r}else{n=r.toString().match(y.RegEx.valueUnwrap);n=n?n[1].replace(/,(\s+)?/g," "):r}return n;case"inject":return"rect("+r+")"}},blur:function(e,t,r){switch(e){case"name":return f.State.isFirefox?"filter":"-webkit-filter";case"extract":var n=parseFloat(r);if(!(n||n===0)){var i=r.toString().match(/blur\(([0-9]+[A-z]+)\)/i);if(i){n=i[1]}else{n=0}}return n;case"inject":if(!parseFloat(r)){return"none"}else{return"blur("+r+")"}}},opacity:function(e,t,r){if(i<=8){switch(e){case"name":return"filter";case"extract":var n=r.toString().match(/alpha\(opacity=(.*)\)/i);if(n){r=n[1]/100}else{r=1}return r;case"inject":t.style.zoom=1;if(parseFloat(r)>=1){return""}else{return"alpha(opacity="+parseInt(parseFloat(r)*100,10)+")"}}}else{switch(e){case"name":return"opacity";case"extract":return r;case"inject":return r}}}},register:function(){if(!(i<=9)&&!f.State.isGingerbread){y.Lists.transformsBase=y.Lists.transformsBase.concat(y.Lists.transforms3D)}for(var e=0;e<y.Lists.transformsBase.length;e++){(function(){var t=y.Lists.transformsBase[e];y.Normalizations.registered[t]=function(e,r,i){switch(e){case"name":return"transform";case"extract":if(h(r)===n||h(r).transformCache[t]===n){return/^scale/i.test(t)?1:0}else{return h(r).transformCache[t].replace(/[()]/g,"")}case"inject":var a=false;switch(t.substr(0,t.length-1)){case"translate":a=!/(%|px|em|rem|vw|vh|\d)$/i.test(i);break;case"scal":case"scale":if(f.State.isAndroid&&h(r).transformCache[t]===n&&i<1){i=1}a=!/(\d)$/i.test(i);break;case"skew":a=!/(deg|\d)$/i.test(i);break;case"rotate":a=!/(deg|\d)$/i.test(i);break}if(!a){h(r).transformCache[t]="("+i+")"}return h(r).transformCache[t]}}})()}for(var e=0;e<y.Lists.colors.length;e++){(function(){var t=y.Lists.colors[e];y.Normalizations.registered[t]=function(e,r,a){switch(e){case"name":return t;case"extract":var o;if(y.RegEx.wrappedValueAlreadyExtracted.test(a)){o=a}else{var s,u={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};if(/^[A-z]+$/i.test(a)){if(u[a]!==n){s=u[a]}else{s=u.black}}else if(y.RegEx.isHex.test(a)){s="rgb("+y.Values.hexToRgb(a).join(" ")+")"}else if(!/^rgba?\(/i.test(a)){s=u.black}o=(s||a).toString().match(y.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}if(!(i<=8)&&o.split(" ").length===3){o+=" 1"}return o;case"inject":if(i<=8){if(a.split(" ").length===4){a=a.split(/\s+/).slice(0,3).join(" ")}}else if(a.split(" ").length===3){a+=" 1"}return(i<=8?"rgb":"rgba")+"("+a.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}})()}}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";if(i||f.State.isAndroid&&!f.State.isChrome){t+="|transform"}return new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(f.State.prefixMatches[e]){return[f.State.prefixMatches[e],true]}else{var t=["","Webkit","Moz","ms","O"];for(var r=0,n=t.length;r<n;r++){var i;if(r===0){i=e}else{i=t[r]+e.replace(/^\w/,function(e){return e.toUpperCase()})}if(u.isString(f.State.prefixElement.style[i])){f.State.prefixMatches[e]=i;return[i,true]}}return[e,false]}}},Values:{hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,n;e=e.replace(t,function(e,t,r,n){return t+t+r+r+n+n});n=r.exec(e);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:[0,0,0]},isCSSNullValue:function(e){return e==0||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){if(/^(rotate|skew)/i.test(e)){return"deg"}else if(/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)){return""}else{return"px"}},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();if(/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)){return"inline"}else if(/^(li)$/i.test(t)){return"list-item"}else if(/^(tr)$/i.test(t)){return"table-row"}else if(/^(table)$/i.test(t)){return"table"}else if(/^(tbody)$/i.test(t)){return"table-row-group"}else{return"block"}},addClass:function(e,t){if(e.classList){e.classList.add(t)}else{e.className+=(e.className.length?" ":"")+t}},removeClass:function(e,t){if(e.classList){e.classList.remove(t)}else{e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}}},getPropertyValue:function(e,r,a,o){function s(e,r){var a=0;if(i<=8){a=l.css(e,r)}else{var u=false;if(/^(width|height)$/.test(r)&&y.getPropertyValue(e,"display")===0){u=true;y.setPropertyValue(e,"display",y.Values.getDisplayType(e))}function c(){if(u){y.setPropertyValue(e,"display","none")}}if(!o){if(r==="height"&&y.getPropertyValue(e,"boxSizing").toString().toLowerCase()!=="border-box"){var p=e.offsetHeight-(parseFloat(y.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(y.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(y.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(y.getPropertyValue(e,"paddingBottom"))||0);c();return p}else if(r==="width"&&y.getPropertyValue(e,"boxSizing").toString().toLowerCase()!=="border-box"){var d=e.offsetWidth-(parseFloat(y.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(y.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(y.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(y.getPropertyValue(e,"paddingRight"))||0);c();return d}}var f;if(h(e)===n){f=t.getComputedStyle(e,null)}else if(!h(e).computedStyle){f=h(e).computedStyle=t.getComputedStyle(e,null)}else{f=h(e).computedStyle}if(r==="borderColor"){r="borderTopColor"}if(i===9&&r==="filter"){a=f.getPropertyValue(r)}else{a=f[r]}if(a===""||a===null){a=e.style[r]}c()}if(a==="auto"&&/^(top|right|bottom|left)$/i.test(r)){var m=s(e,"position");if(m==="fixed"||m==="absolute"&&/top|left/i.test(r)){a=l(e).position()[r]+"px"}}return a}var u;if(y.Hooks.registered[r]){var c=r,p=y.Hooks.getRoot(c);if(a===n){a=y.getPropertyValue(e,y.Names.prefixCheck(p)[0])}if(y.Normalizations.registered[p]){a=y.Normalizations.registered[p]("extract",e,a)}u=y.Hooks.extractValue(c,a)}else if(y.Normalizations.registered[r]){var d,m;d=y.Normalizations.registered[r]("name",e);if(d!=="transform"){m=s(e,y.Names.prefixCheck(d)[0]);if(y.Values.isCSSNullValue(m)&&y.Hooks.templates[r]){m=y.Hooks.templates[r][1]}}u=y.Normalizations.registered[r]("extract",e,m)}if(!/^[\d-]/.test(u)){if(h(e)&&h(e).isSVG&&y.Names.SVGAttribute(r)){if(/^(height|width)$/i.test(r)){try{u=e.getBBox()[r]}catch(g){u=0}}else{u=e.getAttribute(r)}}else{u=s(e,y.Names.prefixCheck(r)[0])}}if(y.Values.isCSSNullValue(u)){u=0}if(f.debug>=2)console.log("Get "+r+": "+u);return u},setPropertyValue:function(e,r,n,a,o){var s=r;if(r==="scroll"){if(o.container){o.container["scroll"+o.direction]=n}else{if(o.direction==="Left"){t.scrollTo(n,o.alternateValue)}else{t.scrollTo(o.alternateValue,n)}}}else{if(y.Normalizations.registered[r]&&y.Normalizations.registered[r]("name",e)==="transform"){y.Normalizations.registered[r]("inject",e,n);s="transform";n=h(e).transformCache[r]}else{if(y.Hooks.registered[r]){var u=r,l=y.Hooks.getRoot(r);a=a||y.getPropertyValue(e,l);n=y.Hooks.injectValue(u,n,a);r=l}if(y.Normalizations.registered[r]){n=y.Normalizations.registered[r]("inject",e,n);r=y.Normalizations.registered[r]("name",e)}s=y.Names.prefixCheck(r)[0];if(i<=8){try{e.style[s]=n}catch(c){if(f.debug)console.log("Browser does not support ["+n+"] for ["+s+"]")}}else if(h(e)&&h(e).isSVG&&y.Names.SVGAttribute(r)){e.setAttribute(r,n)}else{e.style[s]=n}if(f.debug>=2)console.log("Set "+r+" ("+s+"): "+n)}}return[s,n]},flushTransformCache:function(e){var t="";if((i||f.State.isAndroid&&!f.State.isChrome)&&h(e).isSVG){function r(t){return parseFloat(y.getPropertyValue(e,t))}var n={translate:[r("translateX"),r("translateY")],skewX:[r("skewX")],skewY:[r("skewY")],scale:r("scale")!==1?[r("scale"),r("scale")]:[r("scaleX"),r("scaleY")],rotate:[r("rotateZ"),0,0]};l.each(h(e).transformCache,function(e){if(/^translate/i.test(e)){e="translate"}else if(/^scale/i.test(e)){e="scale"}else if(/^rotate/i.test(e)){e="rotate"}if(n[e]){t+=e+"("+n[e].join(" ")+")"+" ";delete n[e]}})}else{var a,o;l.each(h(e).transformCache,function(r){a=h(e).transformCache[r];if(r==="transformPerspective"){o=a;return true}if(i===9&&r==="rotateZ"){r="rotate"}t+=r+a+" "});if(o){t="perspective"+o+" "+t}}y.setPropertyValue(e,"transform",t)}};y.Hooks.register();y.Normalizations.register();f.hook=function(e,t,r){var i=n;e=s(e);l.each(e,function(e,a){if(h(a)===n){f.init(a)}if(r===n){if(i===n){i=f.CSS.getPropertyValue(a,t)}}else{var o=f.CSS.setPropertyValue(a,t,r);if(o[0]==="transform"){f.CSS.flushTransformCache(a)}i=o}});return i};var w=function(){function e(){if(a){return I.promise||null}else{return o}}var i=arguments[0]&&(arguments[0].p||(l.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||u.isString(arguments[0].properties))),a,o,c;var d,m,g;if(u.isWrapped(this)){a=false;c=0;d=this;o=this}else{a=true;c=1;d=i?arguments[0].elements||arguments[0].e:arguments[0]}d=s(d);if(!d){return}if(i){m=arguments[0].properties||arguments[0].p;g=arguments[0].options||arguments[0].o}else{m=arguments[c];g=arguments[c+1]}var v=d.length,C=0;if(!/^(stop|finish|finishAll)$/i.test(m)&&!l.isPlainObject(g)){var A=c+1;g={};for(var T=A;T<arguments.length;T++){if(!u.isArray(arguments[T])&&(/^(fast|normal|slow)$/i.test(arguments[T])||/^\d/.test(arguments[T]))){g.duration=arguments[T]}else if(u.isString(arguments[T])||u.isArray(arguments[T])){g.easing=arguments[T]}else if(u.isFunction(arguments[T])){g.complete=arguments[T]}}}var I={promise:null,resolver:null,rejecter:null};if(a&&f.Promise){I.promise=new f.Promise(function(e,t){I.resolver=e;I.rejecter=t})}var E;switch(m){case"scroll":E="scroll";break;case"reverse":E="reverse";break;case"finish":case"finishAll":case"stop":l.each(d,function(e,t){if(h(t)&&h(t).delayTimer){clearTimeout(h(t).delayTimer.setTimeout);if(h(t).delayTimer.next){h(t).delayTimer.next()}delete h(t).delayTimer}if(m==="finishAll"&&(g===true||u.isString(g))){l.each(l.queue(t,u.isString(g)?g:""),function(e,t){if(u.isFunction(t)){t()}});l.queue(t,u.isString(g)?g:"",[])}});var P=[];l.each(f.State.calls,function(e,t){if(t){l.each(t[1],function(r,i){var a=g===n?"":g;if(a!==true&&t[2].queue!==a&&!(g===n&&t[2].queue===false)){return true}l.each(d,function(r,n){if(n===i){if(g===true||u.isString(g)){l.each(l.queue(n,u.isString(g)?g:""),function(e,t){if(u.isFunction(t)){t(null,true)}});l.queue(n,u.isString(g)?g:"",[])}if(m==="stop"){if(h(n)&&h(n).tweensContainer&&a!==false){l.each(h(n).tweensContainer,function(e,t){t.endValue=t.currentValue})}P.push(e)}else if(m==="finish"||m==="finishAll"){t[2].duration=1}}})})}});if(m==="stop"){l.each(P,function(e,t){x(t,true)});if(I.promise){I.resolver(d)}}return e();default:if(l.isPlainObject(m)&&!u.isEmptyObject(m)){E="start"}else if(u.isString(m)&&f.Redirects[m]){var k=l.extend({},g),M=k.duration,$=k.delay||0;if(k.backwards===true){d=l.extend(true,[],d).reverse()}l.each(d,function(e,t){if(parseFloat(k.stagger)){k.delay=$+parseFloat(k.stagger)*e}else if(u.isFunction(k.stagger)){k.delay=$+k.stagger.call(t,e,v)}if(k.drag){k.duration=parseFloat(M)||(/^(callout|transition)/.test(m)?1e3:p);k.duration=Math.max(k.duration*(k.backwards?1-e/v:(e+1)/v),k.duration*.75,200)}f.Redirects[m].call(t,t,k||{},e,v,d,I.promise?I:n)});return e()}else{var D="Velocity: First argument ("+m+") was not a property map, a known action, or a registered redirect. Aborting.";if(I.promise){I.rejecter(new Error(D))}else{console.log(D)}return e()}}var L={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null};var R=[];function N(){var e=this,i=l.extend({},f.defaults,g),a={},o;if(h(e)===n){f.init(e)}if(parseFloat(i.delay)&&i.queue!==false){l.queue(e,i.queue,function(t){f.velocityQueueEntryFlag=true;h(e).delayTimer={setTimeout:setTimeout(t,parseFloat(i.delay)),next:t}})}switch(i.duration.toString().toLowerCase()){case"fast":i.duration=200;break;case"normal":i.duration=p;break;case"slow":i.duration=600;break;default:i.duration=parseFloat(i.duration)||1}if(f.mock!==false){if(f.mock===true){i.duration=i.delay=1}else{i.duration*=parseFloat(f.mock)||1;i.delay*=parseFloat(f.mock)||1}}i.easing=b(i.easing,i.duration);if(i.begin&&!u.isFunction(i.begin)){i.begin=null}if(i.progress&&!u.isFunction(i.progress)){i.progress=null}if(i.complete&&!u.isFunction(i.complete)){i.complete=null}if(i.display!==n&&i.display!==null){i.display=i.display.toString().toLowerCase();if(i.display==="auto"){i.display=f.CSS.Values.getDisplayType(e)}}if(i.visibility!==n&&i.visibility!==null){i.visibility=i.visibility.toString().toLowerCase()}i.mobileHA=i.mobileHA&&f.State.isMobile&&!f.State.isGingerbread;function s(s){if(i.begin&&C===0){try{i.begin.call(d,d)}catch(c){setTimeout(function(){throw c},1)}}if(E==="scroll"){var p=/^x$/i.test(i.axis)?"Left":"Top",w=parseFloat(i.offset)||0,x,A,T;if(i.container){if(u.isWrapped(i.container)||u.isNode(i.container)){i.container=i.container[0]||i.container;x=i.container["scroll"+p];T=x+l(e).position()[p.toLowerCase()]+w}else{i.container=null}}else{x=f.State.scrollAnchor[f.State["scrollProperty"+p]];A=f.State.scrollAnchor[f.State["scrollProperty"+(p==="Left"?"Top":"Left")]];T=l(e).offset()[p.toLowerCase()]+w}a={scroll:{rootPropertyValue:false,startValue:x,currentValue:x,endValue:T,unitType:"",easing:i.easing,scrollData:{container:i.container,direction:p,alternateValue:A}},element:e};if(f.debug)console.log("tweensContainer (scroll): ",a.scroll,e)}else if(E==="reverse"){if(!h(e).tweensContainer){l.dequeue(e,i.queue);return}else{if(h(e).opts.display==="none"){h(e).opts.display="auto"}if(h(e).opts.visibility==="hidden"){h(e).opts.visibility="visible"}h(e).opts.loop=false;h(e).opts.begin=null;h(e).opts.complete=null;if(!g.easing){delete i.easing}if(!g.duration){delete i.duration}i=l.extend({},h(e).opts,i);var P=l.extend(true,{},h(e).tweensContainer);for(var k in P){if(k!=="element"){var M=P[k].startValue;P[k].startValue=P[k].currentValue=P[k].endValue;P[k].endValue=M;if(!u.isEmptyObject(g)){P[k].easing=i.easing}if(f.debug)console.log("reverse tweensContainer ("+k+"): "+JSON.stringify(P[k]),e)}}a=P}}else if(E==="start"){var P;if(h(e).tweensContainer&&h(e).isAnimating===true){P=h(e).tweensContainer}function $(t,r){var a=n,o=n,s=n;if(u.isArray(t)){a=t[0];if(!u.isArray(t[1])&&/^[\d-]/.test(t[1])||u.isFunction(t[1])||y.RegEx.isHex.test(t[1])){s=t[1]}else if(u.isString(t[1])&&!y.RegEx.isHex.test(t[1])||u.isArray(t[1])){o=r?t[1]:b(t[1],i.duration);if(t[2]!==n){s=t[2]}}}else{a=t}if(!r){o=o||i.easing}if(u.isFunction(a)){a=a.call(e,C,v)}if(u.isFunction(s)){s=s.call(e,C,v)}return[a||0,o,s]}l.each(m,function(e,t){if(RegExp("^"+y.Lists.colors.join("$|^")+"$").test(e)){var r=$(t,true),i=r[0],a=r[1],o=r[2];if(y.RegEx.isHex.test(i)){var s=["Red","Green","Blue"],u=y.Values.hexToRgb(i),l=o?y.Values.hexToRgb(o):n;for(var c=0;c<s.length;c++){var p=[u[c]];if(a){p.push(a)}if(l!==n){p.push(l[c])}m[e+s[c]]=p}delete m[e]}}});for(var D in m){var N=$(m[D]),U=N[0],F=N[1],O=N[2];D=y.Names.camelCase(D);var B=y.Hooks.getRoot(D),H=false;if(!h(e).isSVG&&B!=="tween"&&y.Names.prefixCheck(B)[1]===false&&y.Normalizations.registered[B]===n){if(f.debug)console.log("Skipping ["+B+"] due to a lack of browser support.");continue}if((i.display!==n&&i.display!==null&&i.display!=="none"||i.visibility!==n&&i.visibility!=="hidden")&&/opacity|filter/.test(D)&&!O&&U!==0){O=0}if(i._cacheValues&&P&&P[D]){if(O===n){O=P[D].endValue+P[D].unitType}H=h(e).rootPropertyValueCache[B]}else{if(y.Hooks.registered[D]){if(O===n){H=y.getPropertyValue(e,B);O=y.getPropertyValue(e,D,H)}else{H=y.Hooks.templates[B][1]}}else if(O===n){O=y.getPropertyValue(e,D)}}var q,G,_,W=false;function z(e,t){var r,n;n=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){r=e;return""});if(!r){r=y.Values.getUnitType(e)}return[n,r]}q=z(D,O);O=q[0];_=q[1];q=z(D,U);U=q[0].replace(/^([+-\/*])=/,function(e,t){W=t;return""});G=q[1];O=parseFloat(O)||0;U=parseFloat(U)||0;if(G==="%"){if(/^(fontSize|lineHeight)$/.test(D)){U=U/100;G="em"}else if(/^scale/.test(D)){U=U/100;G=""}else if(/(Red|Green|Blue)$/i.test(D)){U=U/100*255;G=""}}function j(){var n={myParent:e.parentNode||r.body,position:y.getPropertyValue(e,"position"),fontSize:y.getPropertyValue(e,"fontSize")},i=n.position===L.lastPosition&&n.myParent===L.lastParent,a=n.fontSize===L.lastFontSize;L.lastParent=n.myParent;L.lastPosition=n.position;L.lastFontSize=n.fontSize;var o=100,s={};if(!a||!i){var u=h(e).isSVG?r.createElementNS("http://www.w3.org/2000/svg","rect"):r.createElement("div");f.init(u);n.myParent.appendChild(u);l.each(["overflow","overflowX","overflowY"],function(e,t){f.CSS.setPropertyValue(u,t,"hidden")});f.CSS.setPropertyValue(u,"position",n.position);f.CSS.setPropertyValue(u,"fontSize",n.fontSize);f.CSS.setPropertyValue(u,"boxSizing","content-box");l.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){f.CSS.setPropertyValue(u,t,o+"%")});f.CSS.setPropertyValue(u,"paddingLeft",o+"em");s.percentToPxWidth=L.lastPercentToPxWidth=(parseFloat(y.getPropertyValue(u,"width",null,true))||1)/o;s.percentToPxHeight=L.lastPercentToPxHeight=(parseFloat(y.getPropertyValue(u,"height",null,true))||1)/o;s.emToPx=L.lastEmToPx=(parseFloat(y.getPropertyValue(u,"paddingLeft"))||1)/o;n.myParent.removeChild(u)}else{s.emToPx=L.lastEmToPx;s.percentToPxWidth=L.lastPercentToPxWidth;s.percentToPxHeight=L.lastPercentToPxHeight}if(L.remToPx===null){L.remToPx=parseFloat(y.getPropertyValue(r.body,"fontSize"))||16}if(L.vwToPx===null){L.vwToPx=parseFloat(t.innerWidth)/100;L.vhToPx=parseFloat(t.innerHeight)/100}s.remToPx=L.remToPx;s.vwToPx=L.vwToPx;s.vhToPx=L.vhToPx;if(f.debug>=1)console.log("Unit ratios: "+JSON.stringify(s),e);return s}if(/[\/*]/.test(W)){G=_}else if(_!==G&&O!==0){if(U===0){G=_}else{o=o||j();var V=/margin|padding|left|right|width|text|word|letter/i.test(D)||/X$/.test(D)||D==="x"?"x":"y";switch(_){case"%":O*=V==="x"?o.percentToPxWidth:o.percentToPxHeight;break;case"px":break;default:O*=o[_+"ToPx"]}switch(G){case"%":O*=1/(V==="x"?o.percentToPxWidth:o.percentToPxHeight);break;case"px":break;default:O*=1/o[G+"ToPx"]}}}switch(W){case"+":U=O+U;break;case"-":U=O-U;break;case"*":U=O*U;break;case"/":U=O/U;break}a[D]={rootPropertyValue:H,startValue:O,currentValue:O,endValue:U,unitType:G,easing:F};if(f.debug)console.log("tweensContainer ("+D+"): "+JSON.stringify(a[D]),e)}a.element=e}if(a.element){y.Values.addClass(e,"velocity-animating");R.push(a);if(i.queue===""){h(e).tweensContainer=a;h(e).opts=i}h(e).isAnimating=true;if(C===v-1){f.State.calls.push([R,d,i,null,I.resolver]);if(f.State.isTicking===false){f.State.isTicking=true;S()}}else{C++}}}if(i.queue===false){if(i.delay){setTimeout(s,i.delay)}else{s()}}else{l.queue(e,i.queue,function(e,t){if(t===true){if(I.promise){I.resolver(d)}return true}f.velocityQueueEntryFlag=true;s(e)})}if((i.queue===""||i.queue==="fx")&&l.queue(e)[0]!=="inprogress"){l.dequeue(e)}}l.each(d,function(e,t){if(u.isNode(t)){N.call(t)}});var k=l.extend({},f.defaults,g),U;k.loop=parseInt(k.loop);U=k.loop*2-1;if(k.loop){for(var F=0;F<U;F++){var O={delay:k.delay,progress:k.progress};if(F===U-1){O.display=k.display;O.visibility=k.visibility;O.complete=k.complete}w(d,"reverse",O)}}return e()};f=l.extend(w,f);f.animate=w;var C=t.requestAnimationFrame||a;if(!f.State.isMobile&&r.hidden!==n){r.addEventListener("visibilitychange",function(){if(r.hidden){C=function(e){return setTimeout(function(){e(true)},16)};S()}else{C=t.requestAnimationFrame||a}})}function S(e){if(e){var t=(new Date).getTime();var r=f.State.calls.length;if(r>1e4){f.State.calls=o(f.State.calls)}for(var i=0;i<r;i++){if(!f.State.calls[i]){continue}var a=f.State.calls[i],s=a[0],c=a[2],p=a[3],d=!!p,m=null;if(!p){p=f.State.calls[i][3]=t-16}var g=Math.min((t-p)/c.duration,1);for(var v=0,b=s.length;v<b;v++){var w=s[v],A=w.element;if(!h(A)){continue}var T=false;if(c.display!==n&&c.display!==null&&c.display!=="none"){if(c.display==="flex"){var I=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];l.each(I,function(e,t){y.setPropertyValue(A,"display",t)})}y.setPropertyValue(A,"display",c.display)}if(c.visibility!==n&&c.visibility!=="hidden"){y.setPropertyValue(A,"visibility",c.visibility)}for(var E in w){if(E!=="element"){var P=w[E],k,M=u.isString(P.easing)?f.Easings[P.easing]:P.easing;if(g===1){k=P.endValue}else{var $=P.endValue-P.startValue;k=P.startValue+$*M(g,c,$);if(!d&&k===P.currentValue){continue}}P.currentValue=k;if(E==="tween"){m=k}else{if(y.Hooks.registered[E]){var D=y.Hooks.getRoot(E),L=h(A).rootPropertyValueCache[D];if(L){P.rootPropertyValue=L}}var R=y.setPropertyValue(A,E,P.currentValue+(parseFloat(k)===0?"":P.unitType),P.rootPropertyValue,P.scrollData);if(y.Hooks.registered[E]){if(y.Normalizations.registered[D]){h(A).rootPropertyValueCache[D]=y.Normalizations.registered[D]("extract",null,R[1])}else{h(A).rootPropertyValueCache[D]=R[1]}}if(R[0]==="transform"){T=true}}}}if(c.mobileHA){if(h(A).transformCache.translate3d===n){h(A).transformCache.translate3d="(0px, 0px, 0px)";T=true}}if(T){y.flushTransformCache(A)}}if(c.display!==n&&c.display!=="none"){f.State.calls[i][2].display=false}if(c.visibility!==n&&c.visibility!=="hidden"){f.State.calls[i][2].visibility=false}if(c.progress){c.progress.call(a[1],a[1],g,Math.max(0,p+c.duration-t),p,m)}if(g===1){x(i)}}}if(f.State.isTicking){C(S)}}function x(e,t){if(!f.State.calls[e]){return false}var r=f.State.calls[e][0],i=f.State.calls[e][1],a=f.State.calls[e][2],o=f.State.calls[e][4];var s=false;for(var u=0,c=r.length;u<c;u++){var p=r[u].element;if(!t&&!a.loop){if(a.display==="none"){y.setPropertyValue(p,"display",a.display)}if(a.visibility==="hidden"){y.setPropertyValue(p,"visibility",a.visibility)}}if(a.loop!==true&&(l.queue(p)[1]===n||!/\.velocityQueueEntryFlag/i.test(l.queue(p)[1]))){if(h(p)){h(p).isAnimating=false;h(p).rootPropertyValueCache={};var d=false;l.each(y.Lists.transforms3D,function(e,t){var r=/^scale/.test(t)?1:0,i=h(p).transformCache[t];if(h(p).transformCache[t]!==n&&new RegExp("^\\("+r+"[^.]").test(i)){d=true;delete h(p).transformCache[t]}});if(a.mobileHA){d=true;delete h(p).transformCache.translate3d}if(d){y.flushTransformCache(p)}y.Values.removeClass(p,"velocity-animating")}}if(!t&&a.complete&&!a.loop&&u===c-1){try{a.complete.call(i,i)}catch(m){setTimeout(function(){throw m},1)}}if(o&&a.loop!==true){o(i)}if(h(p)&&a.loop===true&&!t){l.each(h(p).tweensContainer,function(e,t){if(/^rotate/.test(e)&&parseFloat(t.endValue)===360){t.endValue=0;t.startValue=360}if(/^backgroundPosition/.test(e)&&parseFloat(t.endValue)===100&&t.unitType==="%"){t.endValue=0;t.startValue=100}});f(p,"reverse",{loop:true,delay:a.delay})}if(a.queue!==false){l.dequeue(p,a.queue)}}f.State.calls[e]=false;for(var g=0,v=f.State.calls.length;g<v;g++){if(f.State.calls[g]!==false){s=true;break}}if(s===false){f.State.isTicking=false;delete f.State.calls;f.State.calls=[]}}e.Velocity=f;if(e!==t){e.fn.velocity=w;e.fn.velocity.defaults=f.defaults}l.each(["Down","Up"],function(e,t){f.Redirects["slide"+t]=function(e,r,i,a,o,s){var u=l.extend({},r),c=u.begin,p=u.complete,d={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},h={};if(u.display===n){u.display=t==="Down"?f.CSS.Values.getDisplayType(e)==="inline"?"inline-block":"block":"none"}u.begin=function(){c&&c.call(o,o);for(var r in d){h[r]=e.style[r];var n=f.CSS.getPropertyValue(e,r);d[r]=t==="Down"?[n,0]:[0,n]}h.overflow=e.style.overflow;e.style.overflow="hidden"};u.complete=function(){for(var t in h){e.style[t]=h[t]}p&&p.call(o,o);s&&s.resolver(o)};f(e,d,u)}});l.each(["In","Out"],function(e,t){f.Redirects["fade"+t]=function(e,r,i,a,o,s){var u=l.extend({},r),c={opacity:t==="In"?1:0},p=u.complete;if(i!==a-1){u.complete=u.begin=null}else{u.complete=function(){if(p){p.call(o,o)}s&&s.resolver(o)}}if(u.display===n){u.display=t==="In"?"auto":"none"}f(this,c,u)}});return f}(window.jQuery||window.Zepto||window,window,document)});if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var r=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var n=arguments[1];var i=0;while(i<r){var a=t[i];if(e.call(n,a,i,t)){return a}i++}return undefined},configurable:true,writable:true})}!function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,r=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=r&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,o=(r||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,s,u,l,c,p,d,f;if(!(t=e.match(a)))throw new Error("invalid data URI");for(o=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],u=e.slice(t[0].length),l=s?atob(u):decodeURIComponent(u),c=new ArrayBuffer(l.length),p=new Uint8Array(c),d=0;d<l.length;d+=1)p[d]=l.charCodeAt(d);return r?new Blob([n?p:c],{type:o}):((f=new i).append(c),f.getBlob(o))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,r,n){var i=this;setTimeout(function(){e(n&&t.toDataURL&&o?o(i.toDataURL(r,n)):i.mozGetAsFile("blob",r))})}:t.toDataURL&&o&&(t.toBlob=function(e,t,r){var n=this;setTimeout(function(){e(o(n.toDataURL(t,r)))})})),"function"==typeof define&&define.amd?define(function(){return o}):"object"==typeof module&&module.exports?module.exports=o:e.dataURLtoBlob=o}(window);(function(e){e.fn.eventTarget=function(e){return e.toElement||e.relatedTarget||e.target||function(){throw"Failed to attach an event target."}}})(jQuery);(function(){"use strict";function e(t,n){var i;n=n||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=n.touchBoundary||10;this.layer=t;this.tapDelay=n.tapDelay||200;this.tapTimeout=n.tapTimeout||700;if(e.notNeeded(t)){return}function a(e,t){
return function(){return e.apply(t,arguments)}}var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var s=this;for(var u=0,l=o.length;u<l;u++){s[o[u]]=a(s[o[u]],s)}if(r){t.addEventListener("mouseover",this.onMouse,true);t.addEventListener("mousedown",this.onMouse,true);t.addEventListener("mouseup",this.onMouse,true)}t.addEventListener("click",this.onClick,true);t.addEventListener("touchstart",this.onTouchStart,false);t.addEventListener("touchmove",this.onTouchMove,false);t.addEventListener("touchend",this.onTouchEnd,false);t.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){t.removeEventListener=function(e,r,n){var i=Node.prototype.removeEventListener;if(e==="click"){i.call(t,e,r.hijacked||r,n)}else{i.call(t,e,r,n)}};t.addEventListener=function(e,r,n){var i=Node.prototype.addEventListener;if(e==="click"){i.call(t,e,r.hijacked||(r.hijacked=function(e){if(!e.propagationStopped){r(e)}}),n)}else{i.call(t,e,r,n)}}}if(typeof t.onclick==="function"){i=t.onclick;t.addEventListener("click",function(e){i(e)},false);t.onclick=null}}var t=navigator.userAgent.indexOf("Windows Phone")>=0;var r=navigator.userAgent.indexOf("Android")>0&&!t;var n=/iP(ad|hone|od)/.test(navigator.userAgent)&&!t;var i=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent);var a=n&&/OS [6-7]_\d/.test(navigator.userAgent);var o=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled){return true}break;case"input":if(n&&e.type==="file"||e.disabled){return true}break;case"label":case"iframe":case"video":return true}return/\bneedsclick\b/.test(e.className)};e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return true;case"select":return!r;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}};e.prototype.sendClick=function(e,t){var r,n;if(document.activeElement&&document.activeElement!==e){document.activeElement.blur()}n=t.changedTouches[0];r=document.createEvent("MouseEvents");r.initMouseEvent(this.determineEventType(e),true,true,window,1,n.screenX,n.screenY,n.clientX,n.clientY,false,false,false,false,0,null);r.forwardedTouchEvent=true;e.dispatchEvent(r)};e.prototype.determineEventType=function(e){if(r&&e.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};e.prototype.focus=function(e){var t;if(n&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"){t=e.value.length;e.setSelectionRange(t,t)}else{e.focus()}};e.prototype.updateScrollParent=function(e){var t,r;t=e.fastClickScrollParent;if(!t||!t.contains(e)){r=e;do{if(r.scrollHeight>r.offsetHeight){t=r;e.fastClickScrollParent=r;break}r=r.parentElement}while(r)}if(t){t.fastClickLastScrollTop=t.scrollTop}};e.prototype.getTargetElementFromEventTarget=function(e){if(e.nodeType===Node.TEXT_NODE){return e.parentNode}return e};e.prototype.onTouchStart=function(e){var t,r,a;if(e.targetTouches.length>1){return true}t=this.getTargetElementFromEventTarget(e.target);r=e.targetTouches[0];if(n){a=window.getSelection();if(a.rangeCount&&!a.isCollapsed){return true}if(!i){if(r.identifier&&r.identifier===this.lastTouchIdentifier){e.preventDefault();return false}this.lastTouchIdentifier=r.identifier;this.updateScrollParent(t)}}this.trackingClick=true;this.trackingClickStart=e.timeStamp;this.targetElement=t;this.touchStartX=r.pageX;this.touchStartY=r.pageY;if(e.timeStamp-this.lastClickTime<this.tapDelay){e.preventDefault()}return true};e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],r=this.touchBoundary;if(Math.abs(t.pageX-this.touchStartX)>r||Math.abs(t.pageY-this.touchStartY)>r){return true}return false};e.prototype.onTouchMove=function(e){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e)){this.trackingClick=false;this.targetElement=null}return true};e.prototype.findControl=function(e){if(e.control!==undefined){return e.control}if(e.htmlFor){return document.getElementById(e.htmlFor)}return e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};e.prototype.onTouchEnd=function(e){var t,o,s,u,l,c=this.targetElement;if(!this.trackingClick){return true}if(e.timeStamp-this.lastClickTime<this.tapDelay){this.cancelNextClick=true;return true}if(e.timeStamp-this.trackingClickStart>this.tapTimeout){return true}this.cancelNextClick=false;this.lastClickTime=e.timeStamp;o=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(a){l=e.changedTouches[0];c=document.elementFromPoint(l.pageX-window.pageXOffset,l.pageY-window.pageYOffset)||c;c.fastClickScrollParent=this.targetElement.fastClickScrollParent}s=c.tagName.toLowerCase();if(s==="label"){t=this.findControl(c);if(t){this.focus(c);if(r){return false}c=t}}else if(this.needsFocus(c)){if(e.timeStamp-o>100||n&&window.top!==window&&s==="input"){this.targetElement=null;return false}this.focus(c);this.sendClick(c,e);if(!n||s!=="select"){this.targetElement=null;e.preventDefault()}return false}if(n&&!i){u=c.fastClickScrollParent;if(u&&u.fastClickLastScrollTop!==u.scrollTop){return true}}if(!this.needsClick(c)){e.preventDefault();this.sendClick(c,e)}return false};e.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};e.prototype.onMouse=function(e){if(!this.targetElement){return true}if(e.forwardedTouchEvent){return true}if(!e.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(e.stopImmediatePropagation){e.stopImmediatePropagation()}else{e.propagationStopped=true}e.stopPropagation();e.preventDefault();return false}return true};e.prototype.onClick=function(e){var t;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(e.target.type==="submit"&&e.detail===0){return true}t=this.onMouse(e);if(!t){this.targetElement=null}return t};e.prototype.destroy=function(){var e=this.layer;if(r){e.removeEventListener("mouseover",this.onMouse,true);e.removeEventListener("mousedown",this.onMouse,true);e.removeEventListener("mouseup",this.onMouse,true)}e.removeEventListener("click",this.onClick,true);e.removeEventListener("touchstart",this.onTouchStart,false);e.removeEventListener("touchmove",this.onTouchMove,false);e.removeEventListener("touchend",this.onTouchEnd,false);e.removeEventListener("touchcancel",this.onTouchCancel,false)};e.notNeeded=function(e){var t;var n;var i;var a;if(typeof window.ontouchstart==="undefined"){return true}n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(n){if(r){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1){return true}if(n>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(o){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(e.style.msTouchAction==="none"||e.style.touchAction==="manipulation"){return true}a=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(a>=27){t=document.querySelector("meta[name=viewport]");if(t&&(t.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)){return true}}if(e.style.touchAction==="none"||e.style.touchAction==="manipulation"){return true}return false};e.attach=function(t,r){return new e(t,r)};if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return e})}else if(typeof module!=="undefined"&&module.exports){module.exports=e.attach;module.exports.FastClick=e}else{window.FastClick=e}})();(function(){window.flexibility={};if(!Array.prototype.forEach){Array.prototype.forEach=function m(e){if(this===undefined||this===null){throw new TypeError(this+"is not an object")}if(!(e instanceof Function)){throw new TypeError(e+" is not a function")}var t=Object(this);var r=arguments[1];var n=t instanceof String?t.split(""):t;var i=Math.max(Math.min(n.length,9007199254740991),0)||0;var a=-1;while(++a<i){if(a in n){e.call(r,n[a],a,t)}}}}(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else if(typeof exports==="object"){module.exports=t()}else{e.computeLayout=t()}})(flexibility,function(){var e=function(){var e;var t="inherit";var r="ltr";var n="rtl";var i="row";var a="row-reverse";var o="column";var s="column-reverse";var u="flex-start";var l="center";var c="flex-end";var p="space-between";var d="space-around";var f="flex-start";var h="center";var m="flex-end";var g="stretch";var v="relative";var b="absolute";var y={row:"left","row-reverse":"right",column:"top","column-reverse":"bottom"};var w={row:"right","row-reverse":"left",column:"bottom","column-reverse":"top"};var C={row:"left","row-reverse":"right",column:"top","column-reverse":"bottom"};var S={row:"width","row-reverse":"width",column:"height","column-reverse":"height"};function x(e){if(!e.layout||e.isDirty){e.layout={width:undefined,height:undefined,top:0,left:0,right:0,bottom:0}}if(!e.style){e.style={}}if(!e.children){e.children=[]}if(e.style.measure&&e.children&&e.children.length){throw new Error("Using custom measure function is supported only for leaf nodes.")}e.children.forEach(x);return e}function A(e){return e===undefined}function T(e){return e===i||e===a}function I(e){return e===o||e===s}function E(e,t){if(e.style.marginStart!==undefined&&T(t)){return e.style.marginStart}var r=null;switch(t){case"row":r=e.style.marginLeft;break;case"row-reverse":r=e.style.marginRight;break;case"column":r=e.style.marginTop;break;case"column-reverse":r=e.style.marginBottom;break}if(r!==undefined){return r}if(e.style.margin!==undefined){return e.style.margin}return 0}function P(e,t){if(e.style.marginEnd!==undefined&&T(t)){return e.style.marginEnd}var r=null;switch(t){case"row":r=e.style.marginRight;break;case"row-reverse":r=e.style.marginLeft;break;case"column":r=e.style.marginBottom;break;case"column-reverse":r=e.style.marginTop;break}if(r!=null){return r}if(e.style.margin!==undefined){return e.style.margin}return 0}function k(e,t){if(e.style.paddingStart!==undefined&&e.style.paddingStart>=0&&T(t)){return e.style.paddingStart}var r=null;switch(t){case"row":r=e.style.paddingLeft;break;case"row-reverse":r=e.style.paddingRight;break;case"column":r=e.style.paddingTop;break;case"column-reverse":r=e.style.paddingBottom;break}if(r!=null&&r>=0){return r}if(e.style.padding!==undefined&&e.style.padding>=0){return e.style.padding}return 0}function M(e,t){if(e.style.paddingEnd!==undefined&&e.style.paddingEnd>=0&&T(t)){return e.style.paddingEnd}var r=null;switch(t){case"row":r=e.style.paddingRight;break;case"row-reverse":r=e.style.paddingLeft;break;case"column":r=e.style.paddingBottom;break;case"column-reverse":r=e.style.paddingTop;break}if(r!=null&&r>=0){return r}if(e.style.padding!==undefined&&e.style.padding>=0){return e.style.padding}return 0}function $(e,t){if(e.style.borderStartWidth!==undefined&&e.style.borderStartWidth>=0&&T(t)){return e.style.borderStartWidth}var r=null;switch(t){case"row":r=e.style.borderLeftWidth;break;case"row-reverse":r=e.style.borderRightWidth;break;case"column":r=e.style.borderTopWidth;break;case"column-reverse":r=e.style.borderBottomWidth;break}if(r!=null&&r>=0){return r}if(e.style.borderWidth!==undefined&&e.style.borderWidth>=0){return e.style.borderWidth}return 0}function D(e,t){if(e.style.borderEndWidth!==undefined&&e.style.borderEndWidth>=0&&T(t)){return e.style.borderEndWidth}var r=null;switch(t){case"row":r=e.style.borderRightWidth;break;case"row-reverse":r=e.style.borderLeftWidth;break;case"column":r=e.style.borderBottomWidth;break;case"column-reverse":r=e.style.borderTopWidth;break}if(r!=null&&r>=0){return r}if(e.style.borderWidth!==undefined&&e.style.borderWidth>=0){return e.style.borderWidth}return 0}function L(e,t){return k(e,t)+$(e,t)}function R(e,t){return M(e,t)+D(e,t)}function N(e,t){return $(e,t)+D(e,t)}function U(e,t){return E(e,t)+P(e,t)}function F(e,t){return L(e,t)+R(e,t)}function O(e){if(e.style.justifyContent){return e.style.justifyContent}return"flex-start"}function B(e){if(e.style.alignContent){return e.style.alignContent}return"flex-start"}function H(e,t){if(t.style.alignSelf){return t.style.alignSelf}if(e.style.alignItems){return e.style.alignItems}return"stretch"}function q(e,t){if(t===n){if(e===i){return a}else if(e===a){return i}}return e}function G(e,n){var i;if(e.style.direction){i=e.style.direction}else{i=t}if(i===t){i=n===undefined?r:n}return i}function _(e){if(e.style.flexDirection){return e.style.flexDirection}return o}function W(e,t){if(I(e)){return q(i,t)}else{return o}}function z(e){if(e.style.position){return e.style.position}return"relative"}function j(e){return z(e)===v&&e.style.flex>0}function V(e){return e.style.flexWrap==="wrap"}function Q(e,t){return e.layout[S[t]]+U(e,t)}function Y(e,t){return e.style[S[t]]!==undefined&&e.style[S[t]]>=0}function X(e,t){return e.style[t]!==undefined}function K(e){return e.style.measure!==undefined}function J(e,t){if(e.style[t]!==undefined){return e.style[t]}return 0}function Z(e,t,r){var n={row:e.style.minWidth,"row-reverse":e.style.minWidth,column:e.style.minHeight,"column-reverse":e.style.minHeight}[t];var i={row:e.style.maxWidth,"row-reverse":e.style.maxWidth,column:e.style.maxHeight,"column-reverse":e.style.maxHeight}[t];var a=r;if(i!==undefined&&i>=0&&a>i){a=i}if(n!==undefined&&n>=0&&a<n){a=n}return a}function ee(e,t){if(e>t){return e}return t}function te(e,t){if(e.layout[S[t]]!==undefined){return}if(!Y(e,t)){return}e.layout[S[t]]=ee(Z(e,t,e.style[S[t]]),F(e,t))}function re(e,t,r){t.layout[w[r]]=e.layout[S[r]]-t.layout[S[r]]-t.layout[C[r]]}function ne(e,t){if(e.style[y[t]]!==undefined){return J(e,y[t])}return-J(e,w[t])}function ie(t,r,n,x){var I=G(t,x);var k=q(_(t),I);var M=W(k,I);var D=q(i,I);te(t,k);te(t,M);t.layout.direction=I;t.layout[y[k]]+=E(t,k)+ne(t,k);t.layout[w[k]]+=P(t,k)+ne(t,k);t.layout[y[M]]+=E(t,M)+ne(t,M);t.layout[w[M]]+=P(t,M)+ne(t,M);var ie=t.children.length;var oe=F(t,D);var se=F(t,o);if(K(t)){var ue=!A(t.layout[S[D]]);var le=e;if(Y(t,D)){le=t.style.width}else if(ue){le=t.layout[S[D]]}else{le=r-U(t,D)}le-=oe;var ce=e;if(Y(t,o)){ce=t.style.height}else if(!A(t.layout[S[o]])){ce=t.layout[S[o]]}else{ce=n-U(t,D)}ce-=F(t,o);var pe=!Y(t,D)&&!ue;var de=!Y(t,o)&&A(t.layout[S[o]]);if(pe||de){var fe=t.style.measure(le,ce);if(pe){t.layout.width=fe.width+oe}if(de){t.layout.height=fe.height+se}}if(ie===0){return}}var he=V(t);var me=O(t);var ge=L(t,k);var ve=L(t,M);var be=F(t,k);var ye=F(t,M);var we=!A(t.layout[S[k]]);var Ce=!A(t.layout[S[M]]);var Se=T(k);var xe;var Ae;var Te;var Ie;var Ee=null;var Pe=null;var ke=e;if(we){ke=t.layout[S[k]]-be}var Me=0;var $e=0;var De=0;var Le=0;var Re=0;var Ne=0;while($e<ie){var Ue=0;var Fe=0;var Oe=0;var Be=0;var He=we&&me===u||!we&&me!==l;var qe=He?ie:Me;var Ge=true;var _e=ie;var We=null;var ze=null;var je=ge;var Ve=0;var Qe;var Ye;for(xe=Me;xe<ie;++xe){Te=t.children[xe];Te.lineIndex=Ne;Te.nextAbsoluteChild=null;Te.nextFlexChild=null;var Xe=H(t,Te);if(Xe===g&&z(Te)===v&&Ce&&!Y(Te,M)){Te.layout[S[M]]=ee(Z(Te,M,t.layout[S[M]]-ye-U(Te,M)),F(Te,M))}else if(z(Te)===b){if(Ee===null){Ee=Te}if(Pe!==null){Pe.nextAbsoluteChild=Te}Pe=Te;for(Ae=0;Ae<2;Ae++){Ie=Ae!==0?i:o;if(!A(t.layout[S[Ie]])&&!Y(Te,Ie)&&X(Te,y[Ie])&&X(Te,w[Ie])){Te.layout[S[Ie]]=ee(Z(Te,Ie,t.layout[S[Ie]]-F(t,Ie)-U(Te,Ie)-J(Te,y[Ie])-J(Te,w[Ie])),F(Te,Ie))}}}var Ke=0;if(we&&j(Te)){Fe++;Oe+=Te.style.flex;if(We===null){We=Te}if(ze!==null){ze.nextFlexChild=Te}ze=Te;Ke=F(Te,k)+U(Te,k)}else{Qe=e;Ye=e;if(!Se){if(Y(t,D)){Qe=t.layout[S[D]]-oe}else{Qe=r-U(t,D)-oe}}else{if(Y(t,o)){Ye=t.layout[S[o]]-se}else{Ye=n-U(t,o)-se}}if(De===0){ae(Te,Qe,Ye,I)}if(z(Te)===v){Be++;Ke=Q(Te,k)}}if(he&&we&&Ue+Ke>ke&&xe!==Me){Be--;De=1;break}if(He&&(z(Te)!==v||j(Te))){He=false;qe=xe}if(Ge&&(z(Te)!==v||Xe!==g&&Xe!==f||A(Te.layout[S[M]]))){Ge=false;_e=xe}if(He){Te.layout[C[k]]+=je;if(we){re(t,Te,k)}je+=Q(Te,k);Ve=ee(Ve,Z(Te,M,Q(Te,M)))}if(Ge){Te.layout[C[M]]+=Le+ve;if(Ce){re(t,Te,M)}}De=0;Ue+=Ke;$e=xe+1}var Je=0;var Ze=0;var et=0;if(we){et=ke-Ue}else{et=ee(Ue,0)-Ue}if(Fe!==0){var tt=et/Oe;var rt;var nt;ze=We;while(ze!==null){rt=tt*ze.style.flex+F(ze,k);nt=Z(ze,k,rt);if(rt!==nt){et-=nt;Oe-=ze.style.flex}ze=ze.nextFlexChild}tt=et/Oe;if(tt<0){tt=0}ze=We;while(ze!==null){ze.layout[S[k]]=Z(ze,k,tt*ze.style.flex+F(ze,k));Qe=e;if(Y(t,D)){Qe=t.layout[S[D]]-oe}else if(!Se){Qe=r-U(t,D)-oe}Ye=e;if(Y(t,o)){Ye=t.layout[S[o]]-se}else if(Se){Ye=n-U(t,o)-se}ae(ze,Qe,Ye,I);Te=ze;ze=ze.nextFlexChild;Te.nextFlexChild=null}}else if(me!==u){if(me===l){Je=et/2}else if(me===c){Je=et}else if(me===p){et=ee(et,0);if(Fe+Be-1!==0){Ze=et/(Fe+Be-1)}else{Ze=0}}else if(me===d){Ze=et/(Fe+Be);Je=Ze/2}}je+=Je;for(xe=qe;xe<$e;++xe){Te=t.children[xe];if(z(Te)===b&&X(Te,y[k])){Te.layout[C[k]]=J(Te,y[k])+$(t,k)+E(Te,k)}else{Te.layout[C[k]]+=je;if(we){re(t,Te,k)}if(z(Te)===v){je+=Ze+Q(Te,k);Ve=ee(Ve,Z(Te,M,Q(Te,M)))}}}var it=t.layout[S[M]];if(!Ce){it=ee(Z(t,M,Ve+ye),ye)}for(xe=_e;xe<$e;++xe){Te=t.children[xe];if(z(Te)===b&&X(Te,y[M])){Te.layout[C[M]]=J(Te,y[M])+$(t,M)+E(Te,M)}else{var at=ve;if(z(Te)===v){var Xe=H(t,Te);if(Xe===g){if(A(Te.layout[S[M]])){Te.layout[S[M]]=ee(Z(Te,M,it-ye-U(Te,M)),F(Te,M))}}else if(Xe!==f){var ot=it-ye-Q(Te,M);if(Xe===h){at+=ot/2}else{at+=ot}}}Te.layout[C[M]]+=Le+at;if(Ce){re(t,Te,M)}}}Le+=Ve;Re=ee(Re,je);Ne+=1;Me=$e}if(Ne>1&&Ce){var st=t.layout[S[M]]-ye;var ut=st-Le;var lt=0;var ct=ve;var pt=B(t);if(pt===m){ct+=ut}else if(pt===h){ct+=ut/2}else if(pt===g){if(st>Le){lt=ut/Ne}}var dt=0;for(xe=0;xe<Ne;++xe){var ft=dt;var ht=0;for(Ae=ft;Ae<ie;++Ae){Te=t.children[Ae];if(z(Te)!==v){continue}if(Te.lineIndex!==xe){break}if(!A(Te.layout[S[M]])){ht=ee(ht,Te.layout[S[M]]+U(Te,M))}}dt=Ae;ht+=lt;for(Ae=ft;Ae<dt;++Ae){Te=t.children[Ae];if(z(Te)!==v){continue}var mt=H(t,Te);if(mt===f){Te.layout[C[M]]=ct+E(Te,M)}else if(mt===m){Te.layout[C[M]]=ct+ht-P(Te,M)-Te.layout[S[M]]}else if(mt===h){var gt=Te.layout[S[M]];Te.layout[C[M]]=ct+(ht-gt)/2}else if(mt===g){Te.layout[C[M]]=ct+E(Te,M)}}ct+=ht}}var vt=false;var bt=false;if(!we){t.layout[S[k]]=ee(Z(t,k,Re+R(t,k)),be);if(k===a||k===s){vt=true}}if(!Ce){t.layout[S[M]]=ee(Z(t,M,Le+ye),ye);if(M===a||M===s){bt=true}}if(vt||bt){for(xe=0;xe<ie;++xe){Te=t.children[xe];if(vt){re(t,Te,k)}if(bt){re(t,Te,M)}}}Pe=Ee;while(Pe!==null){for(Ae=0;Ae<2;Ae++){Ie=Ae!==0?i:o;if(!A(t.layout[S[Ie]])&&!Y(Pe,Ie)&&X(Pe,y[Ie])&&X(Pe,w[Ie])){Pe.layout[S[Ie]]=ee(Z(Pe,Ie,t.layout[S[Ie]]-N(t,Ie)-U(Pe,Ie)-J(Pe,y[Ie])-J(Pe,w[Ie])),F(Pe,Ie))}if(X(Pe,w[Ie])&&!X(Pe,y[Ie])){Pe.layout[y[Ie]]=t.layout[S[Ie]]-Pe.layout[S[Ie]]-J(Pe,w[Ie])}}Te=Pe;Pe=Pe.nextAbsoluteChild;Te.nextAbsoluteChild=null}}function ae(e,t,n,i){e.shouldUpdate=true;var a=e.style.direction||r;var o=!e.isDirty&&e.lastLayout&&e.lastLayout.requestedHeight===e.layout.height&&e.lastLayout.requestedWidth===e.layout.width&&e.lastLayout.parentMaxWidth===t&&e.lastLayout.parentMaxHeight===n&&e.lastLayout.direction===a;if(o){e.layout.width=e.lastLayout.width;e.layout.height=e.lastLayout.height;e.layout.top=e.lastLayout.top;e.layout.left=e.lastLayout.left}else{if(!e.lastLayout){e.lastLayout={}}e.lastLayout.requestedWidth=e.layout.width;e.lastLayout.requestedHeight=e.layout.height;e.lastLayout.parentMaxWidth=t;e.lastLayout.parentMaxHeight=n;e.lastLayout.direction=a;e.children.forEach(function(e){e.layout.width=undefined;e.layout.height=undefined;e.layout.top=0;e.layout.left=0});ie(e,t,n,i);e.lastLayout.width=e.layout.width;e.lastLayout.height=e.layout.height;e.lastLayout.top=e.layout.top;e.lastLayout.left=e.layout.left}}return{layoutNodeImpl:ie,computeLayout:ae,fillNodes:x}}();if(typeof exports==="object"){module.exports=e}return function(t){e.fillNodes(t);e.computeLayout(t)}});!window.addEventListener&&window.attachEvent&&function(){Window.prototype.addEventListener=HTMLDocument.prototype.addEventListener=Element.prototype.addEventListener=function e(t,r){this.attachEvent("on"+t,r)};Window.prototype.removeEventListener=HTMLDocument.prototype.removeEventListener=Element.prototype.removeEventListener=function t(e,r){this.detachEvent("on"+e,r)}}();flexibility.detect=function g(){var e=navigator.userAgent.indexOf("MSIE");if(e>-1){var t=parseInt(navigator.userAgent.slice(e+5));if(t<=9){return false}}var r=document.createElement("p");try{r.style.display="flex";return r.style.display==="flex"}catch(n){return false}};try{if(!flexibility.detect()&&t()<=9){document.attachEvent("onreadystatechange",function(){flexibility.onresize({target:document.documentElement})})}}catch(e){}function t(){var e;return(e=navigator.userAgent.indexOf("MSIE"))>-1?parseInt(navigator.userAgent.slice(e+5)):false}flexibility.init=function v(e){var t=e.onlayoutcomplete;if(!t){t=e.onlayoutcomplete={node:e,style:{},children:[]}}var r;if(typeof e.currentStyle!=="undefined"){r=e.currentStyle["-js-display"]||e.currentStyle.display}else{r=document.defaultView.getComputedStyle(e,null).getPropertyValue("display")}t.style.display=r;return t};var r=1e3;var n=15;var i=document.documentElement;var a=0;var o=0;var s;flexibility.onresize=function b(e){if(i.clientWidth!==a||i.clientHeight!==o){a=i.clientWidth;o=i.clientHeight;clearTimeout(s);window.removeEventListener("resize",flexibility.onresize);var t=e.target&&e.target.nodeType===1?e.target:document.documentElement;flexibility.walk(t);s=setTimeout(function(){window.addEventListener("resize",flexibility.onresize)},r/n)}};var u={alignContent:{initial:"stretch",valid:/^(flex-start|flex-end|center|space-between|space-around|stretch)/},alignItems:{initial:"stretch",valid:/^(flex-start|flex-end|center|baseline|stretch)$/},boxSizing:{initial:"content-box",valid:/^(border-box|content-box)$/},flexDirection:{initial:"row",valid:/^(row|row-reverse|column|column-reverse)$/},flexWrap:{initial:"nowrap",valid:/^(nowrap|wrap|wrap-reverse)$/},justifyContent:{initial:"flex-start",valid:/^(flex-start|flex-end|center|space-between|space-around)$/}};flexibility.updateFlexContainerCache=function y(e){var t=e.style;var r=e.node.currentStyle;var n=e.node.style;var i={};(r["flex-flow"]||n["flex-flow"]||"").replace(/^(row|row-reverse|column|column-reverse)\s+(nowrap|wrap|wrap-reverse)$/i,function(e,t,r){i.flexDirection=t;i.flexWrap=r});for(var a in u){var o=a.replace(/[A-Z]/g,"-$&").toLowerCase();var s=u[a];var l=r[o]||n[o];t[a]=s.valid.test(l)?l:i[a]||s.initial}};var l={alignSelf:{initial:"auto",valid:/^(auto|flex-start|flex-end|center|baseline|stretch)$/},boxSizing:{initial:"content-box",valid:/^(border-box|content-box)$/},flexBasis:{initial:"auto",valid:/^((?:[-+]?0|[-+]?[0-9]*\.?[0-9]+(?:%|ch|cm|em|ex|in|mm|pc|pt|px|rem|vh|vmax|vmin|vw))|auto|fill|max-content|min-content|fit-content|content)$/},flexGrow:{initial:0,valid:/^\+?(0|[1-9][0-9]*)$/},flexShrink:{initial:0,valid:/^\+?(0|[1-9][0-9]*)$/},order:{initial:0,valid:/^([-+]?[0-9]+)$/}};flexibility.updateFlexItemCache=function w(e){var t=e.style;var r=e.node.currentStyle;var n=e.node.style;var i={};(r.flex||n.flex||"").replace(/^\+?(0|[1-9][0-9]*)/,function(e){i.flexGrow=e});for(var a in l){var o=a.replace(/[A-Z]/g,"-$&").toLowerCase();var s=l[a];var u=r[o]||n[o];t[a]=s.valid.test(u)?u:i[a]||s.initial;if(typeof s.initial==="number"){t[a]=parseFloat(t[a])}}};var c="border:0 solid;clip:rect(0 0 0 0);display:inline-block;font:0/0 serif;margin:0;max-height:none;max-width:none;min-height:0;min-width:0;overflow:hidden;padding:0;position:absolute;width:1em;";var p={medium:4,none:0,thick:6,thin:2};var d={borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,borderTopWidth:0,height:0,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,marginBottom:0,marginLeft:0,marginRight:0,marginTop:0,maxHeight:0,maxWidth:0,minHeight:0,minWidth:0,width:0};var f=/^([-+]?0|[-+]?[0-9]*\.?[0-9]+)/;var h=100;flexibility.updateLengthCache=function C(e){var t=e.node;var r=e.style;var n=t.parentNode;var i;var a;var o;var s=document.createElement("_");var u=s.runtimeStyle;var l=t.currentStyle;u.cssText=c+"font-size:"+l.fontSize;n.insertBefore(s,t.nextSibling);r.fontSize=s.offsetWidth;u.fontSize=r.fontSize+"px";for(var m in d){var g=l[m];if(f.test(g)||g==="auto"&&!/(width|height)/i.test(m)){if(/%$/.test(g)){if(/^(bottom|height|top)$/.test(m)){if(!a){a=n.offsetHeight}o=a}else{if(!i){i=n.offsetWidth}o=i}r[m]=parseFloat(g)*o/h}else{u.width=g;r[m]=s.offsetWidth}}else if(/^border/.test(m)&&g in p){r[m]=p[g]}else{delete r[m]}}n.removeChild(s);if(l.borderTopStyle==="none"){r.borderTopWidth=0}if(l.borderRightStyle==="none"){r.borderRightWidth=0}if(l.borderBottomStyle==="none"){r.borderBottomWidth=0}if(l.borderLeftStyle==="none"){r.borderLeftWidth=0}if(!r.width&&!r.minWidth){if(/flex/.test(r.display)){r.width=t.offsetWidth}else{r.minWidth=t.offsetWidth}}if(!r.height&&!r.minHeight){if(!/flex/.test(r.display)){r.minHeight=t.offsetHeight}}};flexibility.walk=function S(e){var t=flexibility.init(e);var r=t.style;var n=r.display;if(n==="none"){return{}}var i=n.match(/^(inline)?flex$/);if(i){flexibility.updateFlexContainerCache(t);e.runtimeStyle.cssText="display:"+(i[1]?"inline-block":"block");t.children=[]}Array.prototype.forEach.call(e.childNodes,function(e,n){if(e.nodeType===1){var a=flexibility.walk(e);var o=a.style;a.index=n;if(i&&a.node){flexibility.updateFlexItemCache(a);if(o.alignSelf==="auto"){o.alignSelf=r.alignItems}o.flex=o.flexGrow;e.runtimeStyle.cssText="display:inline-block";t.children.push(a)}}});if(i){t.children.forEach(function(e){flexibility.updateLengthCache(e)});t.children.sort(function(e,t){return e.style.order-t.style.order||e.index-t.index});if(/-reverse$/.test(r.flexDirection)){t.children.reverse();r.flexDirection=r.flexDirection.replace(/-reverse$/,"");if(r.justifyContent==="flex-start"){r.justifyContent="flex-end"}else if(r.justifyContent==="flex-end"){r.justifyContent="flex-start"}}flexibility.updateLengthCache(t);delete t.lastLayout;delete t.layout;var a=r.borderTopWidth;var o=r.borderBottomWidth;r.borderTopWidth=0;r.borderBottomWidth=0;r.borderLeftWidth=0;if(r.flexDirection==="column"){r.width-=r.borderRightWidth}flexibility.computeLayout(t);e.runtimeStyle.cssText="box-sizing:border-box;display:block;position:relative;width:"+(t.layout.width+r.borderRightWidth)+"px;height:"+(t.layout.height+a+o)+"px";var s=[];var u=1;var l=r.flexDirection==="column"?"width":"height";t.children.forEach(function(e){s[e.lineIndex]=Math.max(s[e.lineIndex]||0,e.layout[l]);u=Math.max(u,e.lineIndex+1)});t.children.forEach(function(e){var t=e.layout;if(e.style.alignSelf==="stretch"){t[l]=s[e.lineIndex]}e.node.runtimeStyle.cssText="box-sizing:border-box;display:block;position:absolute;margin:0;width:"+t.width+"px;height:"+t.height+"px;top:"+t.top+"px;left:"+t.left+"px"})}return t}})();if(!Array.prototype.includes){Array.prototype.includes=function(e){"use strict";if(this==null){throw new TypeError("Array.prototype.includes called on null or undefined")}var t=Object(this);var r=parseInt(t.length,10)||0;if(r===0){return false}var n=parseInt(arguments[1],10)||0;var i;if(n>=0){i=n}else{i=r+n;if(i<0){i=0}}var a;while(i<r){a=t[i];if(e===a||e!==e&&a!==a){return true}i++}return false}}if(!String.prototype.includes){String.prototype.includes=function(e,t){"use strict";if(typeof t!=="number"){t=0}if(t+e.length>this.length){return false}else{return this.indexOf(e,t)!==-1}}}function TinyDatePicker(e,t){"use strict";function r(){w||(s(v.parse(e.value)),S.appendChild(y),S.appendChild(C),setTimeout(function(){y.className+=" dp-visible",a()},1))}function n(){S.contains(y)&&(w=1,e.focus(),e.selectionEnd=e.selectionStart,S.removeChild(y),S.removeChild(C),y.className=y.className.replace(" dp-visible",""),setTimeout(function(){w=0},1))}function i(){y.innerHTML=f(b,v).innerHTML,a()}function a(){y.querySelector(".dp-selected").focus()}function o(t){e.value=t?v.format(t):"",s(t),n(),e.dispatchEvent(new x("change",{bubbles:!0}))}function s(e){e&&(b=e,i())}function u(e){return function(){b.setDate(b.getDate()+e),s(b)}}function l(e){return function(){var t=new Date(b);t.setDate(1),e>0&&t.setMonth(t.getMonth()+2),t.setDate(t.getDate()-1),b.getDate()<t.getDate()&&t.setDate(b.getDate()),s(t)}}function c(e){return function(t){var r=e[t.which];r&&/dp-selected/.test(t.target.className)&&(t.preventDefault(),r())}}function p(e){return function(t){t.target.className.split(/[\s]+/g).forEach(function(r){e[r]&&e[r](t)})}}function d(e){return m({format:function(e){return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()},parse:function(e){var t=new Date(e);return isNaN(t)?new Date:t},days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],today:"Today",clear:"Clear",close:"Close"},e)}function f(e,t){function r(){for(var e="",r=0;7>r;++r)e+='<span class="dp-day-of-week">'+t.days[r]+"</span>";return e}function n(){var t=new Date(e),r="";t.setDate(1),t.setDate(t.getDate()-t.getDay());for(var n=0;42>n;++n){var i=t.getDate(),a="dp-day",o=t.toDateString()==e.toDateString(),s=t.toDateString()===(new Date).toDateString(),u=t.getMonth()!==e.getMonth(),l=o?"a":"span";o&&(a+=" dp-selected"),u&&(a+=" dp-edge-day"),s&&(a+=" dp-day-today"),r+="<"+l+' href="#" class="'+a+'" data-dp="'+t.getTime()+'">'+i+"</"+l+">",t.setDate(i+1)}return r}return g('<div class="dp-wrapper"><div class="dp"><header class="dp-header"><button class="dp-prev"></button><span class="dp-month-year"><span class="dp-month">'+t.months[e.getMonth()]+'</span><span class="dp-year">'+e.getFullYear()+'</span></span><button class="dp-next"></button></header><div class="dp-body">'+r()+n()+'</div><footer class="dp-footer"><button class="dp-today">'+t.today+'</button><button class="dp-clear">'+t.clear+'</button><button class="dp-close">'+t.close+"</button></footer></div></div>")}function h(e,t,r){e.addEventListener(t,r,!0)}function m(e,t){for(var r in t)e[r]=t[r];return e}function g(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}var v=d(t),b=v.parse(e.value),y=f(b,v),w=!1,C=g('<button style="position: absolute; width: 1; height: 1; overflow: hidden; border: 0; background: transparent; top: 0;"></button>'),S=document.body,x=window.CustomEvent;e.readOnly=!0,function(){return"function"==typeof x?!1:(x=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),r},void(x.prototype=window.Event.prototype))}(),h(e,"focus",r),h(e,"click",r),h(y,"keydown",c({37:u(-1),38:u(-7),39:u(1),40:u(7),13:function(){o(b)},27:n})),h(y,"click",p({"dp-clear":function(){o()},"dp-close":n,"dp-wrapper":n,"dp-prev":l(-1),"dp-next":l(1),"dp-today":function(){o(new Date)},"dp-day":function(e){var t=e.target.getAttribute("data-dp");t&&o(new Date(parseInt(t)))}})),h(y,"mousedown",function(e){e.preventDefault()}),h(y,"blur",function(e){setTimeout(function(){y.contains(document.activeElement)||n()},1)})}"undefined"!=typeof module&&module.exports&&(module.exports=TinyDatePicker);const UPGRADE_AFTER_TIMEOUT=1e3;const UserRoles={StepByStep:0,TutoringAccess:1,Support:2,Admin:3,Affiliate:4,Tutor:5,TutorInTraining:6,SuperUserTool:7,Teacher:8,Student:9,OrgOwner:10,OrgAdmin:11,ExpertQA:12};const ResponseStatuses={NotSet:0,Unauthorized:-2,Failure:-1,Success:1,Custom:2};const ChatUserType={NoAccess:0,Student:1,Tutor:2,Admin:3,Monitor:4};const InviteReason={StepByStep:0,UnableToSolve:1};const InviteResponse={Pending:0,Accepted:1,Denied:2,TooSlow:4,TimedOut:8,UserCancelled:16};const TutorInviteSource={Bubble:1,TrialBubble:2,ViewSteps:3,TrialViewSteps:4,CreditsBubble:5,CreditsViewSteps:6,StudentBubble:7,StudentViewSteps:8};const ChatRoomType={Testing:0,Tutor:1,PeerToPeer:2};const ChatRoomLeaveReason={
None:0,Manual:1,Disconnect:2,Timeout:4,Unknown:8};const ChatSolveType={Regular:0,AtMathway:1,LocalSolve:2};const ImageType={ProfileImage:0,Whiteboard:1,FormulaPage:2,Other:3};const SubType={NotSet:0,Monthly:1,Yearly:2,MonthlyTutoring:3,YearlyTutoring:4,Quarterly:5,QuarterlyTutoring:6,MonthlyExpertQA:7,QuarterlyExpertQA:8,YearlyExpertQA:9};const SubSource={NotSet:0,Recurly:1,GooglePlay:2,iTunes:3,Amazon:4,ASecureCart:5};const SubStatus={NotSet:0,Active:1,Paused:2,Cancelled:3,Expired:4,NonVerified:5,PausePending:6};const CreditTransactionType={Unknown:0,Acquired:1,Consumed:2,Cancelled:3,Voided:4};var UpgradeSource={menu:0,bubble:1,tutorBubble:2,viewSteps:3,upgradeAfter:4,expertQA:5};const BubbleContext={Generic:0,Problem:1,Topic:2,SolutionSteps:3,SolutionNoSteps:4,Graph:5,Rating:6,Advert:7,TutorBubble:8,AppStore:9,Survey:10,AutoResolve:11,ErrorBubble:12,Loading:13,ExpertQA:14};var CreditType={Unknown:0,Tutoring:1,StepByStep:2};const EditorButtonsMode={main:0,graph:1,noImages:2,geometry:3,ExpertAdd:4,ExpertUpdate:5};const EditorButtonState={hidden:0,disabled:1,enabled:2};const TOPICS_PER_PAGE=30;const ErrorCode={NotSet:0,Generic:10,EmailEmpty:20,EmailInvalid:21,EmailTaken:22,EmailUnchanged:23,EmailTooLong:24,PasswordEmpty:30,PasswordInvalid:31,PasswordIncorrect:32,PasswordShort:33,PasswordMismatch:34,DateInvalid:35,PasswordOutdated:36,PasswordSimple:37,UserNotFound:40,FacebookEmailNotProvided:41,FailureUnauthorizedUser:42,CredentialsInvalid:43,InvalidUser:44,InactiveUser:45,FailureEmailUpdate:50,InvalidAffiliateCode:51,LoginFailed:60,EmailIsFacbookUser:61,InvalidGoogleAccessToken:62,RecurlySubscriptionNotFound:69,RecurlyGeneric:70,RecurlyCardDeclined:71,RecurlyFraud:72,RecurlyInvalidData:73,RecurlyFraudAttempts:74,RecurlyInsufficientFunds:75,RecurlyCardExpired:76,RecurlyCallIssuer:77,RecurlyDuplicateTrans:78,RecurlyBadPaymentMethod:79,RecurlyGatewayTimeout:80,RecurlyNotCancelled:81,SubscriptionUsed:82,BlockedIP:83,LoginAttemptThreshold:84,InvalidCreditType:85,InvalidCreditAmount:86,InvalidCreditTransactionType:87,RecaptchaChallenge:88,UserAlreadyOrgAdmin:100,InsufficientLicenses:101,StudentAlreadyExists:102,InsufficientTutoringLicenses:103,ClassroomTrialExpired:104,StudentHasSubscription:105,RecurlyAccountNotFound:106,GoogleIdVerificationFailure:107,ExpertQuestionHasBeenAnswered:108,ExpertTooManyQuestions:109,UserSessionExpired:110};var TestPersistenceType={Cookie:0,UserID:1};var ExpertQuestionSource={Unknown:0,Bubble:1,TrialBubble:2,ViewSteps:3,TrialViewSteps:4,StudentBubble:5,StudentViewSteps:6};var ExpertAnswerState={Unset:0,Pending:1,Abandoned:2,Answered:3,Viewed:4,Rated:5};var ExpertSectionStyle={None:0,GreyBorder:1};var WebStorage=function(){var e={};var t=function(e,t,r){this.key=e;this.strategy=t;this.json=r||false};t.prototype={get:function(){var e=this.strategy.get(this.key);if(this.json)e=JSON.parse(e);return e},set:function(e){if(this.json)e=JSON.stringify(e);this.strategy.set(this.key,e)},remove:function(){this.strategy.remove(this.key)}};var r=function(){};r.prototype={get:function(e){return window.localStorage.getItem(e)},set:function(e,t){try{window.localStorage.setItem(e,t)}catch(r){}},remove:function(e){window.localStorage.removeItem(e)}};var n=function(){};n.prototype={get:function(e){return window.sessionStorage.getItem(e)},set:function(e,t){try{window.sessionStorage.setItem(e,t)}catch(r){}},remove:function(e){window.sessionStorage.removeItem(e)}};var i=function(e){if(typeof e==="undefined")e=365;this.expires=e};i.prototype={get:function(e){var t=Cookies.get(e);if(typeof t==="undefined")t=null;return t},set:function(e,t){Cookies.set(e,t,{expires:this.expires})},remove:function(e){Cookies.remove(e)}};e.token=new t("token",new r);e.user=new t("user",new r,true);e.userState=new t("userstate",new r,true);e.chatState=new t("chatstate",new r,false);e.lastSubject=new t("Mathway.LastSubject",new i);e.mobileNag=new t("mobileNag",new n);e.languageNag=new t("languageNag",new n);e.dismissedTutorial=new t("dismissedTutorial",new r);e.dismissedSolveTutorial=new t("dismissedSolveTutorial",new r);e.culture=new t("Mathway.Culture",new i);e.incomingCulture=new t("Mathway.IncomingCulture",new i);e.userId=new t("Mathway.UserId",new i);e.anonUserId=new t("Mathway.AnonUserId",new i);e.PresetProblem=new t("Mathway.PresetProblem",new i);e.testId=new t("testId",new r);e.lastSolve=new t("lastSolve",new r,true);e.attemptResolve=new t("attemptResolve",new n);e.afterOfferUpgrade=new t("afterOfferUpgrade",new n);e.retryPurchase=new t("retryPurchase",new n);e.recurlyTest=new t("Mathway.PlancodeTestVariant",new i,true);e.tutoringCheckTest=new t("Mathway.TutoringCheckTestVariant",new i,true);e.tutoringFrameTest=new t("Mathway.TutoringFrameTestVariant",new i,true);e.upgradeAfterTest=new t("Mathway.UpgradeAfterTestVariant",new i,true);e.simpleUpgradeTest=new t("Mathway.SimpleUpgradeTestVariant",new i,true);e.altAnnualPriceTest=new t("Mathway.AltAnnualPriceTestVariant",new i,true);e.quarterlyTest=new t("Mathway.QuarterlyTestVariant",new i,true);e.oneOffPurchaseTest=new t("Mathway.OneOffPurchaseTestVariant",new i,true);e.upgradeGuarantee=new t("Mathway.UpgradeGuaranteeTestVariant",new i,true);e.yearlyInFocus=new t("Mathway.YearlyInFocusTestVariant",new i,true);e.creditPackPurchasing=new t("Mathway.CreditPackPurchasingTestVariant",new i,true);e.expertQA=new t("Mathway.ExpertQATestVariant",new i);e.tutorRoomId=new t("Tutor.RoomId",new n);e.tutorRoomSubject=new t("Tutor.RoomSubject",new n);e.tutorRoleInRoom=new t("Tutor.RoleInRoom",new n);e.tutorName=new t("Tutor.Name",new n);e.tutorInvite=new t("Tutor.Invite",new n,true);e.tutorRequestPending=new t("Tutor.RequestPending",new n,true);e.tutorRatingPending=new t("Tutor.RatingPending",new n);e.tutorRequestId=new t("Tutor.RequestId",new n);e.fromHelpPage=new t("Mathway.HelpPage",new n,true);e.displayedFinal=new t("Tutor.DisplayedFinal",new n);e.roomTimerElapsed=new t("Tutor.RoomTimerElapsed",new n);e.showUpgradeFromSettings=new t("Mathway.UpradeAfterFromSettings",new n);e.delayedSignUpTest=new t("Mathway.DelayedSignUpTest",new i,true);e.showTotalPriceTest=new t("Mathway.ShowTotalPriceTestVariant",new i,true);e.GDPR=new t("Mathway.GDPR",new i);e.tutorCredits=new t("Tutor.Credits",new r);e.location=new t("Mathway.Location",new i);e.loggedConnectionSlow=new t("loggedConnectionSlow",new n);e.anonPurchasing=new t("Mathway.AnonymousPurchasing",new i,true);e.addressCollection=new t("Mathway.AddressCollection",new i,true);e.staticAdsTest=new t("Mathway.StaticAdsTest",new i,true);e.showUpgradeAfterReload=new t("Mathway.UpradeAfterReload",new n);return e}();var API=function(e){var t={};t.topicsArray=null;var r=false;var n=function(n,a,o,s,u,l,c){if(u===undefined)u=0;if(l===undefined)l=2e4;if(!App.IsApps&&i()){s.call(this,{status:ResponseStatuses.Failure,message:Strings.General.SessionStale,error:null});return}if(App.Services.API===null)return;if(App.Services.Solver===null)return;var p={url:n,contentType:"application/json",dataType:"json",async:true,cache:false,timeout:l};if(o&&(!Auth.userstate||!Auth.userstate.token||Auth.userstate.token==="")){if(typeof s==="function"){s.call(this,{status:ResponseStatuses.Unauthorized,messageId:ErrorCode.FailureUnauthorizedUser,message:Strings.Errors.UnauthorizedUser})}return}if(c===null)c=false;if(c){p.method="POST";p.contentType=false;p.processData=false;p.data=a.blob;var d=new FormData;d.append("name",a.filename);d.append("type",a.imageType);d.append("file",a.blob);d.append("remove",a.removeImage);p.data=d}else{if(a!==null){p.method="POST";p.data=JSON.stringify(a)}else{p.method="GET"}if(o&&Auth.userstate!==null&&Auth.userstate.token!==null&&Auth.userstate.token!==""){p.beforeSend=function(e){e.setRequestHeader("Authorization",Auth.token);e.setRequestHeader("tok",Auth.userstate.token)}}}if(r)Debug.log("AJAX - Invoking - "+p.url+" ("+p.method+")",p.data);e.ajax(p).done(function(e){if(r)Debug.log("AJAX - Completed - "+p.url+" ("+p.method+")",e);if(typeof s==="function"){if(e.userState!==null&&e.userState!==undefined&&e.userState.token!==null&&e.userState.token!==undefined&&e.messageId!==ErrorCode.PasswordOutdated){WebStorage.userState.set(e.userState);Auth.userstate=e.userState}e.errorMessage="";if(e.messageId>0){e.errorMessage=t.serverError(e.messageId)}s.call(this,e)}}).fail(function(e,t,r){if(typeof s==="function"){s.call(this,{status:-1,message:t,error:r})}})};var i=function(){var e=1728e5;if(App.StartTime==="undefined"){return false}if(Util.TimeStamp()>App.StartTime+e){Popup.showModal(Strings.General.SessionStale,function(){document.location.reload()});return true}return false};t.logScriptError=function(e,t){n("/logError/",{url:t,errorMessage:e,platform:"web"},false,null,0)};t.logData=function(e,t){n("/logData/",{userID:Auth.userstate.userId,message:t,jsonData:e},false,null,0)};t.signInUS=function(e,t,r,i,a,o){n(App.Services.UserAPI+"/rest/signInAuth/",{device:App.deviceString(),email:e,password:t,anonUserId:WebStorage.anonUserId.get(),promoCode:r,widgetId:i,responseCode:a},false,o)};t.signInWithId=function(e,t){n(App.Services.UserAPI+"/rest/getUserStateByID/",{userId:e},true,t)};t.signUpUS=function(e,t,r,i,a,o){n(App.Services.UserAPI+"/rest/signUpAuth/",{device:App.deviceString(),email:e,password:t,anonUserId:WebStorage.anonUserId.get(),promoCode:r,widgetId:i,responseCode:a,version:App.Version},false,o)};t.signInFacebook=function(e,t,r){var i={userToken:e,anonUserId:WebStorage.anonUserId.get(),promoCode:t};n(App.Services.UserAPI+"/rest/signInFacebook/",i,false,r)};t.signInGoogle=function(e,t,r,i){var a={platform:"web",device:App.deviceString(),googleId:e,idToken:t,anonUserId:WebStorage.anonUserId.get(),promoCode:r};n(App.Services.UserAPI+"/rest/signInGoogle/",a,false,i)};t.signInApple=function(e,t,r){var i={platform:"web",device:App.deviceString(),userIdentifier:e,email:t,anonUserId:WebStorage.anonUserId.get()};n(App.Services.UserAPI+"/rest/signInApple/",i,false,r)};t.signUpEmail=function(e,t){n(App.Services.UserAPI+"/rest/signUpEmail/",{device:App.deviceString(),email:e,anonUserId:WebStorage.anonUserId.get()},false,t)};t.signOut=function(e){var t={userId:Auth.userstate.userId};n(App.Services.UserAPI+"/rest/signOut/",t,true,e)};t.changePassword=function(e,t,r,i){if(!u())return;n(App.Services.UserAPI+"/rest/updatePasswordSettings/",{anonUserId:WebStorage.anonUserId.get(),password:e,newpassword:t,userid:Auth.userstate.userId,newpasswordcheck:r,version:App.Version},true,i)};t.changeOutdatedPassword=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/changeOutdatedPassword/",{password:e,passwordMatch:t,userid:Auth.userstate.userId},true,r)};t.deleteAccount=function(e,t){if(!u())return;n(App.Services.API+"/rest/deleteAccount/",{userid:Auth.userstate.userId,password:e},true,t)};t.updateEmailSettings=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/updateEmailSettings/",{userid:Auth.userstate.userId,email:e,password:t},true,r)};t.resetPassword=function(e,t,r,i){if(!u())return;n(App.Services.UserAPI+"/rest/resetPassword/",{anonUserId:WebStorage.anonUserId.get(),newpassword:e,newpasswordcheck:t,userhash:r},false,i)};t.forgotPassword=function(e,t){n(App.Services.API+"/rest/forgotPassword/",{email:e},false,t)};t.deleteAccount=function(e,t){n(App.Services.UserAPI+"/rest/deleteAccount/",{password:e,userid:Auth.userstate.userId},true,t)};t.getTopics=function(e,t,r,i){n(App.Services.Topic+"/rest/getTopics/",{subject:e,inputtext:t,asciimath:r,culture:App.Culture.current},false,i,1)};t.getTopicsTiered=function(e,t,r,i){n(App.Services.Topic+"/rest/getTopicsTiered/",{subject:e,inputtext:t,asciimath:r,culture:App.Culture.current},false,i,1)};t.solveAnswer=function(e,t,r,i,a,o,s){var u=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")u=Auth.userstate.userId;var l=u>0;n(App.Services.Solver+"/rest/solveAnswer/",{userid:u,subject:e,topictext:t,topicid:r,asciitext:i,mathml:a,device:App.deviceString(),culture:App.Culture.header,language:App.Culture.current,version:App.Version,anonuserid:WebStorage.anonUserId.get(),fromexamples:o,affiliateid:App.affiliateId,save:true},l,s,1)};t.solveFull=function(e,t,r,i,a,o){var s=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")s=Auth.userstate.userId;var u=s>0;n(App.Services.Solver+"/rest/solveFull/",{userid:s,subject:e,topictext:t,topicid:r,asciitext:i,mathml:a,culture:App.Culture.header,language:App.Culture.current,save:false},u,o,1)};isRetry=function(){var e=WebStorage.retryPurchase.get();if(e===null)e=0;var t="false";if(e>0)t="true";WebStorage.retryPurchase.set(e+1);return t};t.subscribeRecurly=function(e,t,r,i){if(!u())return;var a=STM.Tests.Plans.get();n(App.Services.API+"/rest/subscribeRecurly/",{userid:Auth.userstate.userId,tokenid:e,plancode:t,couponcode:r,isretry:isRetry(),testVariantId:a===null?0:a.testVariantId},true,i,0,75e3)};t.subscribeRecurlyUS=function(e,t,r,i,a,o){if(!u())return;var s=STM.Tests.Plans.get();var l=Currency.GetDefaultCurrency().code;n(App.Services.UserAPI+"/rest/subscribeRecurly/",{purchasetype:e,userid:Auth.userstate.userId,tokenid:t,plancode:r,couponcode:i,isretry:isRetry(),testVariantId:s===null?0:s.testVariantId,suggestedCurrency:l,actualCurrency:a},true,o,0,75e3)};t.getTaxAndTotal=function(e,t){n(App.Services.UserAPI+"/rest/getTaxAndTotal",{userid:Auth.userstate.userId,plancode:e,currency:Currency.GetDefaultCurrency().code},true,t)};t.getCreditInfoForUser=function(e,t){n(App.Services.UserAPI+"/rest/getCreditInfoForUser",{UserID:Auth.userstate.userId,Type:e},true,t)};t.purchaseCreditsRecurly=function(e,t){if(!u())return;var r={userid:Auth.userstate.userId,plan:e,currency:Currency.GetDefaultCurrency().code};n(App.Services.UserAPI+"/rest/purchaseCreditsRecurly/",r,true,function(e){API.validateCredits(CreditType.Tutoring,function(r){t.call(this,e)})},0,75e3)};t.upgradeToExpertQA=function(e,t){if(!u())return;n(App.Services.UserAPI+"/rest/upgradeToExpertQARecurly/",{userid:Auth.userstate.userId,plancode:e},true,t,0,75e3)};t.upgradeToTutoring=function(e,t){if(!u())return;n(App.Services.UserAPI+"/rest/upgradeToTutoringRecurly/",{userid:Auth.userstate.userId,plancode:e},true,t,0,75e3)};t.purchaseGiftCard=function(e,t,r,i,a,o,s,u,l,c,p){n(App.Services.UserAPI+"/rest/purchaseGiftCard",{tokenId:e,userId:t,gifterName:r,gifterEmail:i,recipientFirstName:a,recipientLastName:o,personalMessage:s,recipientEmail:u,productCode:l,cardValue:c},true,p,0,75e3)};t.redeemGiftCard=function(e,t,r){n(App.Services.UserAPI+"/rest/redeemGiftCard",{userId:e,redemptionCode:t},true,r,0,75e3)};t.checkRecurlyCoupon=function(e,t){n(App.Services.API+"/rest/checkRecurlyCoupon",{tokenid:"",plancode:"",couponcode:e},true,t)};t.redeemCoupon=function(e,t){n(App.Services.API+"/rest/redeemCoupon",{tokenid:"",plancode:"",couponcode:e},true,t)};t.expandExampleNode=function(e,t,r,i){n(App.Services.Solver+"/rest/expandExampleNode/",{value:e,text:t,category:r},false,i)};t.generateExample=function(e,t,r,i){n(App.Services.Solver+"/rest/generateExample",{topicid:e,subject:t,category:r,culture:App.Culture.current,includeMathMl:true},false,i)};t.getAllExamples=function(e,t){n(App.Services.Solver+"/rest/getAllExamples",{subject:e,culture:App.Culture.current},false,t)};t.getGlossaryTerm=function(e,t){n(App.Services.Solver+"/rest/getGlossaryDefinition/"+e,null,false,t)};t.getGlossaryList=function(e){n(App.Services.Solver+"/rest/getGlossaryListFull",{culture:App.Culture.current,startsWith:""},false,e)};t.solutionFeedback=function(e,t,r,i){var a=0;var o=false;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined"){a=Auth.userstate.userId;o=true}if(o){n(App.Services.API+"/rest/solutionFeedback/",{userid:a,solutionid:e,rating:t,comment:r},true,i)}else{n(App.Services.API+"/rest/solutionFeedbackAnon/",{userid:0,solutionid:e,rating:t,comment:r},false,i)}};t.clickMoreSteps=function(e,t){var r=false;var i={solutionId:e};if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined"&&Auth.userstate.userId!==0){i["userId"]=Auth.userstate.userId;r=true}if(r)n(App.Services.API+"/rest/clickMoreSteps/",i,true,t);else n(App.Services.API+"/rest/clickMoreStepsAnon/",i,false,t)};t.clickViewSteps=function(e,t){if(typeof t==="undefined")t=false;var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.Chat+"/clickViewSteps",{state:a().state,userId:r,solutionId:e,adSbSUsed:t},false,function(e){if(e.state!==undefined&&e.state!=="")WebStorage.chatState.set(e.state)})};t.cancellationFeedback=function(e,t,r,i){n(App.Services.API+"/rest/cancellationFeedback/",{anonUserId:WebStorage.anonUserId.get(),answer:e,rating:t,comment:r,userid:Auth.userstate.userId},true,i)};t.getRecurlyBilling=function(e,t){};t.updateRecurlyBilling=function(e,t,r){if(!u())return;n(App.Services.API+"/rest/updateBillingSettings/",{UserID:e,Token:t},true,r)};t.cancelSubscription=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/cancelSubscription",{userId:e,subscriptionId:t},true,r,0,6e4)};t.pauseSubscription=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/pauseSubscription",{months:e,userId:Auth.userstate.userId,subscriptionId:Auth.userstate.subscriptionId,isCancel:t},true,r)};t.upgradeSubscription=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/upgradeSubscription",{userId:Auth.userstate.userId,planType:e,refundTimestamp:t},true,r,0,3e4)};t.reactivateSubscription=function(e,t,r){if(!u())return;n(App.Services.UserAPI+"/rest/reactivateSubscription",{userId:e,subscriptionId:t},true,r,0,3e4)};t.resumeSubscription=function(e){if(!u())return;n(App.Services.UserAPI+"/rest/resumeSubscription",{userId:Auth.userstate.userId,subscriptionId:Auth.userstate.subscriptionId},true,e)};t.getPromo=function(e,t){if(!u())return;n(App.Services.API+"/rest/getPromo/",{UserID:Auth.userstate.userId,PromoCode:e},true,t)};t.savePromo=function(e,t,r,i,a,o,s,l,c){if(!u())return;n(App.Services.API+"/rest/savePromo",{userId:Auth.userstate.userId,MWpromo:e,MWdays:t,MWmonths:r,MWrate:i,MWavailable:a,PayPalEmail:o,W9Status:s,LandingPageHTML:l},true,c)};t.getTotalOrdersForAffiliate=function(e,t,r,i){if(!u())return;n(App.Services.API+"/rest/getTotalOrdersByAffiliateID",{userId:Auth.userstate.userId,affiliateCode:e,startDate:t,endDate:r},true,i)};t.saveTopicSurvey=function(e,t,r,i,a){var o=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")o=Auth.userstate.userId;n(App.Services.API+"/rest/saveTopicSurvey/",{anonUserId:WebStorage.anonUserId.get(),userId:o,subject:e,inputText:t,presentationMathML:r,culture:App.Culture.current,comments:i},false,a)};t.anonymousUser=function(e,t){var r={sourcePath:e,device:App.deviceString(),culture:App.Culture.current,incomingCulture:WebStorage.incomingCulture.get(),ip:App.IP,userAgent:window.navigator.userAgent,geoLocation:WebStorage.location.get()};if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r.userId=Auth.userstate.userId;n(App.Services.API+"/rest/anonymousUser/",r,false,t)};t.getBlockedIpsByIp=function(e,t){n(App.Services.API+"/rest/getBlockedIPsByIp/",{ip:e},false,t)};t.refreshUserState=function(e){if(!u())return;n(App.Services.UserAPI+"/rest/refreshUserStateAuth/",{anonUserId:WebStorage.anonUserId.get(),userId:Auth.userstate.userId},true,function(e){if(e.status===ResponseStatuses.Unauthorized&&e.messageId===ErrorCode.UserSessionExpired&&!App.IsApps){Auth.logOut();Popup.showAndReload(Strings.Errors.UserSessionExpired)}})};t.getTranslatedPopularProblems=function(e,t,r){n(App.Services.Solver+"/rest/getTranslatedPopularProblems",{subject:e,pageNumber:t,pageSize:100,culture:App.Culture.current},false,r)};t.saveWorksheet=function(e,t){var r=false;var i=0;if(Auth.isLoggedIn()){r=true;i=Auth.userstate.userId}e.culture=App.Culture.current;e.userId=i;if(r){n(App.Services.API+"/rest/saveWorksheet/",e,true,t)}else{n(App.Services.API+"/rest/saveWorksheetAnon/",e,false,t)}};t.saveWorksheetProblem=function(e,t){n(App.Services.API+"/rest/saveWorksheetProblem/",e,true,t)};t.getMessagesOlder=function(e,t,r,i){var a=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")userId=Auth.userstate.userId;n(App.Services.Data+"/rest/getMessagesOlder",{sessionId:e,userId:userId,subject:t,count:r},true,function(e){s(e,i)})};t.getMessagesNewer=function(e,t,r,i){var a=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")userId=Auth.userstate.userId;n(App.Services.Data+"/rest/getMessagesNewer",{sessionId:e,userId:userId,subject:t,count:r},true,function(e){s(e,i)})};t.getMessagesMostRecent=function(e,t,r){var i=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")i=Auth.userstate.userId;n(App.Services.Data+"/rest/getMessagesMostRecent",{userId:i,subject:e,count:t},true,function(e){s(e,r)})};t.getSolutionById=function(e,t){n(App.Services.Data+"/rest/getSolution/"+e,null,false,t)};t.addTopicAbandon=function(e,t,r,i,a,o){n(App.Services.API+"/rest/addTopicAbandon/",{anonUserId:e,moreTopics:i,platform:"web",problemText:r,subject:t,searchText:a},false,o)};t.getValuesForSplitTests=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.API+"/getValuesForSplitTests",{testData:e,UserID:r},true,t)};t.getValuesForSplitTestsAnonymous=function(e,t){n(App.Services.API+"/getValuesForSplitTestsAnonymous",{testData:e},false,t)};t.logTestEvent=function(e,t,r,i){var a=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")a=Auth.userstate.userId;var o=STM.getLogData();n(App.Services.Data+"/rest/saveTestEvent",{UserID:a,TestData:o,EventName:e,ScreenIndex:t,SelectedPlanCode:r,AnonUserID:parseInt(WebStorage.anonUserId.get())},true,i)};t.setAdsTestVariant=function(e,t){n(App.Services.Data+"/rest/setAdsTestVariant",{TestVariantID:e,AnonUserID:parseInt(WebStorage.anonUserId.get())},false,t)};t.getTutorInvitesByDateRange=function(e,t,r){n(App.Services.Data+"/rest/getTutorInvitesByTutorID",{UserID:Auth.userstate.userId,StartTime:e,EndTime:t,ResultCode:1},true,function(e){if(typeof r==="function")r(e)})};t.getTutorRatingsByDateRange=function(e,t,r){n(App.Services.Data+"/rest/getTutorRatingsByTutorID",{UserID:Auth.userstate.userId,StartTime:e,EndTime:t},true,function(e){if(typeof r==="function")r(e)})};t.getTutorFormulas=function(e,t){n(App.Services.Data+"/rest/getTutorFormulas",{Subject:e},false,t)};t.chatBotEditor=function(e,r,i,o,s,u,l,c,p,d,f){var h=a();h.subject=e;h.asciiMath=r;h.mathML=i;h.allTopics=c;h.roomId=Tutor.getRoomId();h.topicStartIndex=p;h.topicCount=d;h.isOCR=o;h.asciiEdited=s;h.historyClick=u;h.isSpeech=l;n(App.Services.Chat+"/editor",h,false,function(e){if(App.IsApps){t.topicsArray=e}if(e.state!==undefined&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof f==="function")f(e)})};t.chatBotTopics=function(e,r,i,o,s,u,l,c,p,d,f,h,m){if(App.IsApps&&t.topicsArray!==null&&t.topicsArray.moreTopics&&i===null){var g=t.topicsArray.topics.filter(function(e){return e.topicText===r});if(g.length===0&&t.topicsArray.extraTopics){g=t.topicsArray.extraTopics.filter(function(e){return e.topicText===r})}if(g.length>0){i=g[0].CustomData}t.topicsArray=null}var v=a();v.topicId=e;v.topicText=r;v.customData=i;v.subject=typeof o==="string"?o:"";v.asciiMath=typeof s==="string"?s:"";v.mathML=typeof u==="string"?u:"";v.fromExamples=typeof f!=="undefined"&&f===true?"true":"false";v.roomId=Tutor.getRoomId();v.searchText=h;v.isOCR=l;v.asciiEdited=c;v.historyClick=p;v.isSpeech=d;n(App.Services.Chat+"/topics",v,false,function(e){if(typeof e.state!=="undefined"&&e.state!==""){WebStorage.chatState.set(e.state)}if(typeof m==="function"){m(e)}})};t.chatBotRating=function(e,t,r,i,s,u,l,c,p){var d=a(true);d.probDef=o(e,t,r,i,s,u);d.rating=l;d.comments=c;n(App.Services.Chat+"/rating",d,false,function(e){if(typeof e.state!=="undefined"&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof p==="function")p(e)})};t.chatBotSurvey=function(e,t,r,i){var o=a();o.surveyID=e;o.responseID=t;o.Detail=r?r:null;n(App.Services.Chat+"/survey",o,false,function(e){if(typeof e.state!=="undefined"&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof i==="function")i(e)})};t.chatBotViewSteps=function(e,t,r,i,o,s,u,l,c){var p=a();p.solutionId=e;p.topicId=t;p.topicText=r;p.customData=i;p.subject=typeof o==="string"?o:"";p.asciiMath=typeof s==="string"?s:"";p.mathML=typeof u==="string"?u:"";p.freeTrialToken=l;var d=Auth.isLoggedIn();n(App.Services.Chat+"/viewSteps",p,d,function(e){if(e.state!==undefined&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof c==="function")c(e)})};t.chatBotGreeting=function(e,t,r){var i=a();i.dismissedTutorial=!e;i.subject=typeof t==="string"?t:"";n(App.Services.Chat+"/greeting",i,false,function(e){if(e.state!==undefined&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof r==="function")r(e)})};t.chatBotTutorFinished=function(e,t,r,i){var o=a();o.fromFreeTrial=e;o.inTutorCreditPackTest=t;o.subject=typeof r==="string"?r:"";n(App.Services.Chat+"/TutorFinished",o,false,function(e){if(e.state!==undefined&&e.state!=="")WebStorage.chatState.set(e.state);if(typeof i==="function")i(e)})};t.savePasteData=function(e,t){var r=a();r.pasteText=t;r.subject=e;n(App.Services.Data+"/rest/savePasteLog",r,false,function(e){})};t.logNewRelic=function(e,t){n(App.Services.Chat+"/LogNewRelic",{Tag:e,Message:t},false,function(e){})};t.deleteBillingInfo=function(e,t){if(Auth.userstate!==null){n(App.Services.UserAPI+"/rest/deleteBillingInfo",{userId:Auth.userstate.userId},false,null,0)}};var a=function(e){var t=WebStorage.chatState.get();if(t===undefined||t===null)t="";return{state:t,metadata:{anonUserId:parseInt(WebStorage.anonUserId.get()),userId:Auth.isLoggedIn()?Auth.userstate.userId:0,UserRoles:Auth.userstate?Auth.userstate.UserRoles:0,deviceId:App.deviceString(),acceptLanguages:typeof App.Culture.acceptLanguages==="undefined"?App.Culture.current:App.Culture.acceptLanguages,route:typeof App.Culture.currentSmall==="undefined"?App.Culture.current.substr(0,2):App.Culture.currentSmall,version:App.Version,affiliateId:App.affiliateId,screen:{width:App.Screen.width,height:App.Screen.height,landscape:App.Screen.landscape,density:App.Screen.pixelRatio},isAndroidWeb:App.isAndroidDevice&&!App.isApps,isiOSWeb:App.isSafari||App.isMobile&&!App.isApps&&!App.isAndroidDevice,splitTests:STM.getValuesForChatbot()}}};var o=function(e,t,r,n,i,a){return{asciiMath:e,mathMl:t,subject:r,topic:{Id:n,Text:i,CustomData:a}}};t.addTutorApplication=function(e,t,r,i,a,o,s,u,l){n(App.Services.Data+"/rest/addTutorApplication/",{userId:Auth.userstate.userId,firstName:e,lastName:t,timeZone:r,contactEmail:i,contactPhone:a,contactAddress:o,subjects:s,schedule:u},true,l)};t.clearMessageHistory=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.Data+"/rest/clearMessageHistory",{userId:t},true,e)};t.getIsAvailable=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/getIsAvailable",{UserID:t},true,e)};t.setIsAvailable=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/setIsAvailable",{UserID:r,IsAvailable:e},true,t)};t.setFirstName=function(e){var t=0;var r="";if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined"){t=Auth.userstate.userId;r=Auth.userstate.firstName}n(App.Services.UserAPI+"/rest/setFirstName",{UserID:t,FirstName:r},true,e)};t.uploadBlobImage=function(e,t,r,i,a){n(App.Services.Blob+"/rest/uploadBlobImage",{filename:e,imageType:r,blob:t,removeImage:i},false,a,0,3e4,true)};t.getUpgradePlans=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/getUpgradePlans",{userId:t},true,e,0,3e4)};t.getExpertQAPrices=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/getExpertQAUpgradePrices",{userId:t,currency:Currency.chosenCurrency.code},true,e,3e4)};t.getTutoringPrices=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/getTutoringUpgradePrices",{userId:t,currency:Currency.chosenCurrency.code},true,e,0,3e4)};t.rateTutor=function(e,t){n(App.Services.UserAPI+"/rest/rateTutor",e,true,t,0,3e4)};t.validateCredits=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/validateCredits",{userid:r,creditType:e},true,function(e){if(e.status===ResponseStatuses.Success){WebStorage.tutorCredits.set(e.count);if(typeof t==="function")t(e)}},0,3e4)};t.consumeCredit=function(e,t,r,i){var a=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")a=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/consumeCredit",{userid:a,studentid:e,roomid:t,type:r},true,i,0,3e4)};t.logSpeechToText=function(e,t,r){n(App.Services.Data+"/rest/saveSpeechToTextLog",{anonuserid:WebStorage.anonUserId.get(),speechtotextresult:e,device:t},false,r)};t.createExpertQuestion=function(e,t){n(App.Services.API+"/rest/createExpertQuestion",e,true,t)};t.getPendingExpertQuestions=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.Data+"/rest/getPendingExpertQuestions",{UserID:t},true,e)};t.getExpertQuestionsFromTutor=function(e,t,r){var i=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")i=Auth.userstate.userId;n(App.Services.Data+"/rest/getExpertQuestionsFromTutor",{UserID:i,Page:e,ResultsPerPage:t},true,r)};t.createExpertAnswer=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.API+"/rest/createExpertAnswer",{UserID:r,QuestionID:e},true,t)};t.getExpertAnswerSections=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.Data+"/rest/getExpertAnswerSections",{UserID:r,AnswerID:e},true,t)};t.updateExpertAnswer=function(e,t,r,i){var a=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")a=Auth.userstate.userId;n(App.Services.Data+"/rest/updateExpertAnswer",{ID:e,QuestionID:t,UserID:a,AnswerState:r},true,i)};t.submitExpertAnswer=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/submitExpertAnswer",{ID:e,UserID:r},true,t)};t.addExpertAnswerSections=function(e,t,r){var i=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")i=Auth.userstate.userId;n(App.Services.Data+"/rest/addExpertAnswerSections",{UserID:i,Sections:e,InsertAt:t},true,r)};t.addExpertAnswerSection=function(e,t,r,i,a,o,s,u){var l=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")l=Auth.userstate.userId;n(App.Services.Data+"/rest/addExpertAnswerSection",{UserID:l,AnswerID:e,AsciiMath:t,HTML:r,GraphInput:o,Command:i,ImageURL:a,DisplayStyle:s},true,u)};t.updateExpertAnswerSection=function(e,t,r,i,a,o,s,u,l,c,p,d){var f=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")f=Auth.userstate.userId;n(App.Services.Data+"/rest/updateExpertAnswerSection",{UserID:f,ID:e,AnswerID:t,AsciiMath:r,FinalAnswerAsciiMath:l,CustomData:c,TopicID:p,HTML:i,GraphInput:s,Command:a,ImageURL:o,DisplayStyle:u},true,d)};t.deleteExpertAnswerSection=function(e,t,r){var i=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")i=Auth.userstate.userId;n(App.Services.Data+"/rest/deleteExpertAnswerSection",{UserID:i,ID:e,AnswerID:t},true,r)};t.getExpertAnswerCountByUserId=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;n(App.Services.Data+"/rest/getUnreadExpertAnswerCountByUserID",{UserID:t},true,e)};t.getExpertQuestionDtosByUserId=function(e,t,r){
var i=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")i=Auth.userstate.userId;n(App.Services.Data+"/rest/getExpertQuestionDtosByUserID",{UserID:i,Page:e,ResultsPerPage:t},true,r)};t.getExpertAnswerDetail=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.Data+"/rest/getExpertAnswerDetail",{userid:r,answerId:e},true,t)};t.rateExpertAnswer=function(e,t){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.Data+"/rest/rateExpertAnswer",{UserID:r,AnswerID:t,Rating:e},true,function(){})};t.getExpertQAState=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;if(t>0){n(App.Services.Data+"/rest/getExpertQAState",{UserID:t},true,e)}};t.logConnectionSlow=function(e,t){if(WebStorage.loggedConnectionSlow.get()==="true")return;WebStorage.loggedConnectionSlow.set("true");var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;n(App.Services.UserAPI+"/rest/logConnectionSlow",{userId:r},true,t,0,3e4)};t.getSettingsPageViewModel=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;var r=WebStorage.anonUserId.get();if(r===null){r=0}var i=window.location.href;i=i.substring(App.baseUrl.length,i.length);var a={anonUserId:r,userId:t,sourcePath:i,device:App.deviceString(),culture:App.Culture.current,incomingCulture:WebStorage.incomingCulture.get(),ip:App.IP,userAgent:window.navigator.userAgent,geoLocation:WebStorage.location.get(),testData:STM.getActiveData()};n(App.Services.UserAPI+"/rest/getSettingsPageViewModel",a,true,e,0,3e4)};var s=function(e,t){if(e.messages!==undefined){for(var r=0,n=e.messages.length;r<n;r++){e.messages[r].anonUserId=e.messages[r].anonUserId!=="0"?parseInt(e.messages[r].anonUserId):null;e.messages[r].id=parseInt(e.messages[r].id);e.messages[r].sessionId=parseInt(e.messages[r].sessionId);e.messages[r].solutionId=e.messages[r].solutionId!=="0"?parseInt(e.messages[r].solutionId):null;e.messages[r].timestamp=Date.parse(e.messages[r].timestamp+" UTC");e.messages[r].typeset=e.messages[r].typeset==="True"?true:false;e.messages[r].userId=e.messages[r].userId!=="0"?parseInt(e.messages[r].userId):null;e.messages[r].testContext=typeof e.messages[r].testContext!=="number"?parseInt(e.messages[r].testContext):BubbleContext.Generic}}t.call(this,e)};var u=function(){if(!App.IsApps){if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined"){if(Auth.userstate.userId===0){Auth.logOut();Util.Redirect("/?signIn=1");return false}}}return true};t.serverError=function(e){var t="";switch(e){case 20:t=Strings.Errors.EmailEmpty;break;case 21:t=Strings.Errors.EmailInvalid;break;case 23:t=Strings.Errors.EmailUnchanged;break;case 30:t=Strings.Errors.PasswordEmpty;break;case 31:t=Strings.Errors.PasswordInvalid;break;case 32:t=Strings.Errors.PasswordIncorrect;break;case 33:t=Strings.Errors.PasswordShort;break;case 34:t=Strings.Errors.PasswordMismatch;break;case 40:t=Strings.Errors.UserNotFound;break;case 41:t=Strings.Errors.FacebookEmailNotProvided;break;case 42:t=Strings.Errors.UnauthorizedUser;break;case 43:t=Strings.Errors.CredentialsInvalid;break;case 44:t=Strings.Errors.InvalidUser;break;case 50:t=Strings.Errors.EmailUpdate;break;case 51:t=Strings.Errors.InvalidAffiliateCode;break;case 60:t=Strings.Errors.LoginFailed;break;case 61:t=Strings.Errors.EmailIsFacbookUser;break;case 62:t=Strings.Errors.InvalidGoogleAccessToken;break;case 70:t=Strings.Errors.RecurlyGeneric;break;case 71:t=Strings.Errors.RecurlyCardDeclined;break;case 72:t=Strings.Errors.RecurlyFraud;break;case 73:t=Strings.Errors.RecurlyInvalidData;break;case 74:t=Strings.Errors.RecurlyFraudAttempts;break;case 75:t=Strings.Errors.RecurlyInsufficientFunds;break;case 76:t=Strings.Errors.RecurlyCardExpired;break;case 77:t=Strings.Errors.RecurlyCallIssuer;break;case 78:t=Strings.Errors.RecurlyDuplicateTrans;break;case 79:t=Strings.Errors.RecurlyBadPaymentMethod;break;case 80:t=Strings.Errors.RecurlyGatewayTimeout;break;case 81:t=Strings.Errors.RecurlyNotCancelled;break;case 82:t=Strings.Errors.SubscriptionUsed;break;case 83:t=Strings.Errors.UnauthorizedUser;break;default:t=Strings.Errors.Generic;break}return t};return t}(jQuery);var Auth=function(e){var t={};var r=e.query(".subscribed-icon");var n=e.query("#tutor-available");t.user=WebStorage.user.get();t.userstate=WebStorage.userState.get();t.token=WebStorage.token.get();t.state=null;t.facebook=false;t.google=false;t.apple=false;t.logIn=function(e,r){t.user=r;WebStorage.user.set(r)};t.logInUS=function(r,n){t.userstate=n;WebStorage.userState.set(n);STM.update();e.publish("auth/loggedin")};t.setUserState=function(e){t.userstate=e;WebStorage.userState.set(e)};t.logOut=function(){if(t.getChatUserType()===ChatUserType.Tutor){API.signOut()}t.user=null;WebStorage.user.remove();t.userstate=null;WebStorage.userState.remove();e.publish("auth/loggedout")};t.isLoggedIn=function(){if(!t.userstate)return false;return t.userstate.userId>0?true:false};t.hasExpertSubscription=function(){if(!t.isLoggedIn())return false;if(t.hasRole(UserRoles.ExpertQA))return true;if(t.hasRole(UserRoles.TutoringAccess))return true;return false};t.hasTutoringSubscription=function(){if(!t.isLoggedIn())return false;return t.hasRole(UserRoles.TutoringAccess)};t.hasSubscription=function(){if(!t.isLoggedIn())return false;return t.hasRole(UserRoles.StepByStep)};t.hadSubscription=function(){if(!t.isLoggedIn())return false;if(typeof t.user.MWSubscriptionEndDate==="undefined")return false;return parseInt(t.user.MWSubscriptionEndDate.substr(6))>0};t.hasMonthly=function(){if(!t.isLoggedIn()){return false}return t.userstate.MWSubscriptionType===SubType.Monthly||t.userstate.MWSubscriptionType===SubType.MonthlyExpertQA||t.userstate.MWSubscriptionType===SubType.MonthlyTutoring};t.migrateUserObject=function(){if(t.user!==null&&!t.isLoggedIn()){API.signInWithId(t.user.MWuserID,function(e){if(e.status===1&&e.userState!=null){Auth.logInUS(e.userState.token,e.userState);t.user=null;WebStorage.user.remove()}})}};t.hasRole=function(e){if(!t.isLoggedIn())return false;return(Math.pow(2,e)&t.userstate.UserRoles)==Math.pow(2,e)};t.getChatUserType=function(){if(t.hasRole(UserRoles.Tutor)||t.hasRole(UserRoles.TutorInTraining))return ChatUserType.Tutor;if(t.hasRole(UserRoles.TutoringAccess))return ChatUserType.Student;return ChatUserType.NoAccess};t.userHasRole=function(e,t){return(Math.pow(2,t)&e)==Math.pow(2,t)};t.currencyLocked=function(){if(t.isLoggedIn())return t.userstate.ActualCurrency!==""&&t.userstate.ActualCurrency!==null&&t.userstate.ActualCurrency!==undefined;else return false};t.hasSBSCredits=function(){return App.SBSCredits>0};t.isAnonymousSubscriber=function(){return t.hasRole(UserRoles.StepByStep)&&t.userstate.email.endsWith("@mathway")};t.hideCreditRenewal=function(){return t.hasMonthly()&&t.userstate.SubscriptionStatus===SubStatus.Cancelled};var i=function(){window.fbAsyncInit=function(){FB.init({appId:"407486582633925",version:"v5.0",cookie:true,xfbml:true})};var e="facebook-jssdk";var t=document.getElementsByTagName("script")[0];var r=document.createElement("script");r.id=e;r.async=true;r.src="//connect.facebook.net/en_US/sdk.js";t.parentNode.insertBefore(r,t)};var a=function(){if(t.hasSubscription())r.addClass("on");else r.removeClass("on")};e.subscribe("upgrade/anonPurchase",function(){a()});e.subscribe("auth/logout",function(e){t.logOut();if(typeof e==="function"){e.apply(this)}a()});e.subscribe("app/subscribed",function(){a()});e.subscribe("auth/facebook",function(r){var n=App.getQueryParam("affiliateid");if(n===false)n=App.getQueryParam("pr");if(n===false)n="";if(t.isLoggedIn())return;if(Util.IsNullOrEmpty(r)){e.publish("auth/loginfailed",[ErrorCode.FacebookEmailNotProvided]);return}API.signInFacebook(r,n,function(r){if(r.status===1&&r.userState!==null){t.facebook=true;t.logInUS(r.userState.token,r.userState)}else{e.publish("auth/loginfailed",[r.messageId])}})});e.subscribe("apps/logout",function(){t.logOut();e.publish("chat/clear");e.publish("ChatLibrary/StateCheck")});e.subscribe("auth/google",function(r){var n=r.getAuthResponse().id_token;var i=r.getBasicProfile();var a=i.getId();var o=App.getQueryParam("affiliateid");if(o===false)o=App.getQueryParam("pr");if(o===false)o="";Actions.Do(Actions.showSpinner);API.signInGoogle(a,n,o,function(r){Actions.Do(Actions.hideSpinner);if(r.status===1&&r.userState!==null){t.google=true;t.logInUS(r.userState.token,r.userState);if(typeof callback==="function"){callback.apply(this)}}else{e.publish("auth/loginfailed",[r.messageId])}})});e.subscribe("auth/apple",function(r){var n=r.id;var i=r.email;API.signInApple(n,i,function(r){Actions.Do(Actions.hideSpinner);if(r.status===1&&r.userState!==null){t.apple=true;t.logInUS(r.userState.token,r.userState);if(typeof callback==="function"){callback.apply(this)}}else{e.publish("auth/loginfailed",[r.messageId])}})});e.subscribe("auth/loggedin",function(){if(t.userstate.GoogleID){Auth.google=true}else if(t.userstate.fbid){Auth.facebook=true}if(Auth.getChatUserType()===ChatUserType.Tutor){Tutor.Hub.connect();Tutor.Notifier.init()}a()});e.subscribe("auth/refreshedUserState",function(){a()});e.subscribe("auth/loadFacebook",function(){i()});return t}(jQuery);const supportedCurrencies={UnitedStatesDollar:{code:"USD",symbol:"$",text:"United States Dollar"},ArgentineanPeso:{code:"ARS",symbol:"$",text:"Argentinean Peso"},AustralianDollar:{code:"AUD",symbol:"$",text:"Australian Dollar"},BritishPound:{code:"GBP",symbol:"£",text:"British Pound"},CanadianDollar:{code:"CAD",symbol:"$",text:"Canadian Dollar"},ColombianPeso:{code:"COP",symbol:"$",text:"Colombian Peso"},DanishKrone:{code:"DKK",symbol:"kr.",text:"Danish Krone"},Euro:{code:"EUR",symbol:"€",text:"Euro"},HongKongDollar:{code:"HKD",symbol:"HK$",text:"Hong Kong Dollar"},IndianRupee:{code:"INR",symbol:"₹",text:"Indian Rupee"},IsraeliSheqel:{code:"ILS",symbol:"₪",text:"Israeli Sheqel"},JapaneseYen:{code:"JPY",symbol:"¥",text:"Japanese Yen"},MexicanPeso:{code:"MXN",symbol:"$",text:"Mexican Peso"},NorwegianKrone:{code:"NOK",symbol:"kr",text:"Norwegian Krones"},NewZealandDollar:{code:"NZD",symbol:"$",text:"New Zealand Dollar"},RussianRuble:{code:"RUB",symbol:"₽",text:"Russian Ruble"},SingaporeanDollar:{code:"SGD",symbol:"$",text:"Singaporean Dollar"},SouthAfricanRand:{code:"ZAR",symbol:"R",text:"South African Rand"},SouthKoreanWon:{code:"KRW",symbol:"₩",text:"South Korean Won"},SwissFranc:{code:"CHF",symbol:"CHF",text:"Swiss Franc"}};var Currency=function(){var e={};e.chosenCurrency=supportedCurrencies.UnitedStatesDollar;e.wasChanged=false;e.GetDefaultCurrency=function(){var e=WebStorage.location.get();switch(e){case"US":return supportedCurrencies.UnitedStatesDollar;case"AR":return supportedCurrencies.ArgentineanPeso;case"CA":return supportedCurrencies.CanadianDollar;case"AU":return supportedCurrencies.AustralianDollar;case"GB":return supportedCurrencies.BritishPound;case"NZ":return supportedCurrencies.NewZealandDollar;case"IN":return supportedCurrencies.IndianRupee;case"ZA":return supportedCurrencies.SouthAfricanRand;case"SG":return supportedCurrencies.SingaporeanDollar;case"CO":return supportedCurrencies.ColombianPeso;case"MX":return supportedCurrencies.MexicanPeso;case"CH":return supportedCurrencies.SwissFranc;case"KR":return supportedCurrencies.SouthKoreanWon;case"JP":return supportedCurrencies.JapaneseYen;case"IL":return supportedCurrencies.IsraeliSheqel;case"RU":return supportedCurrencies.RussianRuble;case"DK":return supportedCurrencies.DanishKrone;case"HK":return supportedCurrencies.HongKongDollar;case"AT":case"BE":case"CY":case"EE":case"FI":case"FR":case"DE":case"GR":case"IE":case"IT":case"LV":case"LT":case"LU":case"MT":case"NL":case"PT":case"SK":case"SI":case"ES":return supportedCurrencies.Euro;default:return supportedCurrencies.UnitedStatesDollar}};e.SetCurrency=function(t){e.chosenCurrency=t};e.SetCurrencyByCode=function(r){e.SetCurrency(t().find(function(e){return e.code===r}))};e.CanChangeCurrency=function(){if(Auth.currencyLocked())return false;var e=WebStorage.incomingCulture.get();var t=e.split("-");var r=t[t.length-1];return WebStorage.location.get().toLowerCase()!==r.toLowerCase()};var t=function(){return Object.keys(supportedCurrencies).map(function(e){return supportedCurrencies[e]})};e.FormatCurrency=function(t,r){var n=(App.Culture.current==="en-US"?"en":App.Culture.current)+"-"+WebStorage.location.get();var i={style:"currency",currency:e.chosenCurrency.code};if(r===true&&t==parseInt(t,10)){i.minimumFractionDigits=0}var a=new Intl.NumberFormat(n,i);return a.format(t)};e.CreateCurrencyOptions=function(e){var r=document.createElement("select");var n=t();for(var i=0;i<n.length;i++){var a=document.createElement("option");a.value=n[i].code;a.text=n[i].symbol+" "+n[i].text+" ("+n[i].code+")";a.selected=e===n[i].code;r.appendChild(a)}return r};e.CanUseAmazonPay=function(){return e.chosenCurrency===supportedCurrencies.UnitedStatesDollar};e.CanUseApplePay=function(){return App.EnvironmentSupportsApplePay&&e.chosenCurrency===supportedCurrencies.UnitedStatesDollar&&App.isSafari};$.subscribe("auth/loggedin",function(){if(Auth.currencyLocked())e.SetCurrencyByCode(Auth.userstate.ActualCurrency);else{if(!e.wasChanged)e.SetCurrency(e.GetDefaultCurrency())}});return e}();var DateHelper=function(){var e=function(e,t){var r=t%4===0;switch(e){case 0:return 31;case 1:return r?29:28;case 2:return 31;case 3:return 30;case 4:return 31;case 5:return 30;case 6:return 31;case 7:return 31;case 8:return 30;case 9:return 31;case 10:return 30;case 11:return 31;default:return 0}};return{addMonths:function(e,t){return moment(e).add(t,"M").toDate()},format:function(e,t){var r=e.getMonth()+1;t=t.replace("mm",r);t=t.replace("dd",e.getDate());t=t.replace("yyyy",e.getFullYear());return t}}}();var Debug={assert:console?console.assert.bind(console):function(){},clear:console?console.clear.bind(console):function(){},error:console?console.error.bind(console):function(){},group:console?console.group.bind(console):function(){},groupCollapsed:console?console.groupCollapsed.bind(console):function(){},groupEnd:console?console.groupEnd.bind(console):function(){},info:console?console.info.bind(console):function(){},log:console?console.log.bind(console):function(){},trace:console?console.trace.bind(console):function(){},warn:console?console.warn.bind(console):function(){},image:function(e){if(console){var t=new Image;t.onload=function(){console.log("%c ","background: url("+e+") no-repeat; margin: 0; border: 0; padding: "+this.height+"px "+this.width+"px 0 0;")};t.src=e}}};var Devices=function(){const e=1,t=2,r=3;var n=function(e,t){var r=[];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){if(typeof t==="function"){t(r)}return}navigator.mediaDevices.enumerateDevices().then(function(n){for(var i=0;i<n.length;i++){var a=n[i];if(a.kind===e)r.push(a)}if(typeof t==="function"){t(r)}}).catch(function(e){Debug.log(e)})};var i=function(n,i){if(n===e)return i;var a=[];var o="";if(n===t)o="front";else if(n===r)o="back";i.forEach(function(e){if(e.label.toLowerCase().indexOf(o)>-1)a.push(e)});if(a.length===0)a=i;return a};return{ALL:e,FRONT:t,BACK:r,audioInput:function(e){n("audioinput",e)},audioOutput:function(e){n("audiooutput",e)},videoInput:function(e,t){n("videoinput",function(r){t(i(e,r))})},videoStream:function(e,t,r){if(t===null||t===undefined)t={width:600,height:340};t.deviceId={exact:e};navigator.mediaDevices.getUserMedia({audio:false,video:true}).then(function(e){r(e)})},filter:function(e,t){return i(e,t)}}}();var DtoHelper=function(e){var t={};t.ChatUserConnection=function(e){e=Util.Extend({UserId:0,Type:ChatUserType.NoAccess,DeviceString:App.deviceString(),AnonUserId:0},e||{});return e};t.ChatRoomUserConnection=function(e){e=Util.Extend({UserId:0,Type:ChatUserType.NoAccess,DeviceString:App.deviceString(),AnonUserId:0,RoomId:0,AvatarURL:App.DefaultAvatarUrl},e||{});return e};t.Topic=function(e){e=Util.Extend({Id:0,Text:"",CustomData:{}},e||{});return e};t.InviteRequest=function(e){var r=typeof e.Topic!=="undefined"&&e.Topic!==null?t.Topic(e.Topic):t.Topic({});e=Util.Extend({UserId:0,Type:"",DeviceString:App.deviceString(),AnonUserId:0,Id:0,Subject:"",Ascii:"",Topic:r,SolutionId:"",TutorRequestId:0,Reason:InviteReason.StepByStep,isInvite:true,Source:0,UserEmail:"",IsProblem:true,AltAscii:"",AnswerId:0,ImageURL:""},e||{});return e};t.InviteResponse=function(e){var t=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")t=Auth.userstate.userId;e=Util.Extend({UserId:0,Type:"",DeviceString:App.deviceString(),AnonUserId:0,Id:0,TutorRequestId:0,TutorId:t},e||{});return e};t.RatingRequest=function(e){e=Util.Extend({RoomId:0,TutorId:0},e||{});return e};t.RatingResponse=function(e){e=Util.Extend({RoomId:0,TutorId:0,UserId:0,Rating:0,EndSource:0,Comments:""},e||{});return e};t.StartTyping=function(e){e=Util.Extend({Local:false,AvatarURL:App.DefaultAvatarUrl},e||{});return e};t.StopTyping=function(e){e=Util.Extend({Local:false},e||{});return e};t.RemoveMessage=function(e){e=Util.Extend({TransactionId:0},e||{});return e};t.CreateExpertQuestion=function(e){var r=typeof e.Topic!=="undefined"&&e.Topic!==null?t.Topic(e.Topic):t.Topic({});e=Util.Extend({Id:0,UserId:0,DeviceString:App.deviceString(),AnonUserId:0,Subject:"",MathML:"",Ascii:"",Topic:r,SolutionId:"",Source:ExpertQuestionSource.Unknown,IsProblem:true,AltAscii:"",AltMathML:"",AnswerType:0,ImageURL:""},e||{});return e};return t}(jQuery);var HtmlEntitites=function(){var e={};var t;var r;var n;var i;var a=function(){n={};i={};o({"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":" "})};var o=function(e){var a=[];var o=[];var s,u;for(s in e){u=e[s];i[s]=u;n[u]=s;a.push(u);o.push(s)}t=new RegExp("("+a.join("|")+")","g");r=new RegExp("("+o.join("|")+"|&#[0-9]{1,5};"+")","g")};e.encode=function(e){var r=function(e,t){return n[t]};return!e?e:String(e).replace(t,r)};e.decode=function(e){var t=function(e,t){return t in i?i[t]:String.fromCharCode(parseInt(t.substr(2),10))};return!e?e:String(e).replace(r,t)};a();return e}();var ErrorLog=function(){var e={};e.TopicsTimeout=function(){Debug.log("TopicsTimeout");GoogleAnalytics.send({eventCategory:"TopicsTimeout",eventAction:"Temporarily Busy Error",eventLabel:"Frontend Topics Timeout"})};e.SolveTimeout=function(){Debug.log("SolveTimeout");GoogleAnalytics.send({eventCategory:"SolveTimeout",eventAction:"Temporarily Busy Error",eventLabel:"Frontend Solve Timeout"})};e.ChatBotTopics=function(){Debug.log("ChatBotTopics");GoogleAnalytics.send({eventCategory:"ChatBotTopics",eventAction:"Chatbot Topics Error",eventLabel:"Chatbot Topics Error"})};e.ChatBotSolve=function(){Debug.log("ChatBotSolve");GoogleAnalytics.send({eventCategory:"ChatBotSolve",eventAction:"Chatbot Solve Error",eventLabel:"Chatbot Solve Error"})};return e}();var GoogleAnalytics=function(){var e={};e.set=function(e,t){if(typeof ga==="undefined"||ga===null)return;if(typeof e==="undefined"||e===null)return;if(typeof t==="undefined"||t===null)return;ga("set",e,t)};e.send=function(e){if(typeof ga==="undefined"||ga===null)return;e=Util.Extend({hitType:"event",eventCategory:null,eventAction:null,eventLabel:null},e||{});if(e.eventCategory===null)return;if(e.eventAction===null)return;if(e.eventLabel===null)return;ga("send",e)};return e}();String.prototype.replaceAll=function(e,t){return this.replace(RegExp(e.escapeRegExp(),"g"),t)};String.prototype.Replace=function(e,t){return this.replace(RegExp(e.escapeRegExp(),"g"),t)};String.prototype.escapeRegExp=function(){return this.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};String.prototype.remove=function(e,t){if(t==null){return this.substring(0,e)}else{return this.substring(0,e)+this.substring(e+t)}};String.prototype.startsWith=function(e,t){if(t===null){t=0}return this.substr(t,e.length)==e};String.prototype.StartsWith=function(e){return this.substr(0,e.length)==e};String.prototype.endsWith=function(e){return this.slice(-e.length)==e};String.prototype.EndsWith=function(e){return this.slice(-e.length)==e};String.prototype.contains=function(e){return this.indexOf(e)>-1};String.prototype.Contains=function(e){return this.indexOf(e)>-1};String.prototype.insert=function(e,t){return this.substring(0,e)+t+this.substr(e)};String.prototype.isNumeric=function(){if(this=="."){return true}else if(this!=" "){return!isNaN(this)}else{return false}};String.prototype.isLetter=function(){return this.match(/[a-z\s]/i)!=null};String.prototype.IsLetter=function(){return this.match(/[a-z\s]/i)!=null};String.prototype.indicesOf=function(e){var t=0;var r;var n=[];while((r=this.indexOf(e,t))>-1){n.push(r);t=r+e.length}return n};String.prototype.ToCharArray=function(){return this.split("")};String.prototype.LastIndexOf=function(e){return this.lastIndexOf(e)};String.prototype.ToLower=function(){return this.toLowerCase()};String.prototype.Split=function(e,t){var r;if(t!=null){r=t}else{r=999999}return this.split(e,r)};String.prototype.Splice=function(e,t,r){return this.slice(0,e)+r+this.slice(e+t)};String.prototype.ReplaceBegEnd=function(e,t,r,n){var i=this;while(true){var a=i.indexOf(e);if(a==-1)break;var o=i.indexOf(t,a);if(o==-1)break;var s=i.substring(0,a);var u=i.substring(a+e.length);if(u.indexOf(e))u=u.ReplaceBegEnd(e,t,r,n);var l=u.replace(t,n);i=s+r+l}return i};function ExtractBetween(e,t,r){var n=e.indexOf(t);if(n>-1){var i=e.substring(n+1).indexOf(r);if(i>-1){return e.substring(n+1,n+i+1)}}return null}Array.prototype.removeAt=function(e){this.splice(e,1)};Array.prototype.remove=function(e,t){var r=this.slice((t||e)+1||this.length);this.length=e<0?this.length+e:e;return this.push.apply(this,r)};Array.prototype.unique=function(){var e=this;var t=[];for(var r=e.length;r--;){var n=e[r];if($.inArray(n,t)===-1){t.unshift(n)}}return t};Array.prototype.clone=function(){return JSON.parse(JSON.stringify(this))};Array.prototype.Contains=function(e){var t=false;for(var r=0;r<this.length;r++){if(this[r]==e){t=true;break}}return t};Array.prototype.deepCopy=function(){return $.extend(true,[],this)};Math.Max=function(e,t,r){return Math.max(e,t,r)};Math.Min=function(e,t,r){return Math.min(e,t,r)};Math.Round=function(e){return Math.round(e)};Math.Pow=function(e,t){return Math.pow(e,t)};Math.Abs=function(e){return Math.abs(e)};Math.Log=function(e){return Math.log(e)};Math.Log10=function(e){return Math.log(e)/Math.LN10};Math.getBaseLog=function(e,t){return Math.log(t)/Math.log(e)};Math.Sin=function(e){return Math.sin(e)};Math.Cos=function(e){return Math.cos(e)};Math.Tan=function(e){return Math.tan(e)};Math.Asin=function(e){return Math.asin(e)};Math.Acos=function(e){return Math.acos(e)};Math.Atan=function(e){return Math.atan(e)};Math.Sqrt=function(e){return Math.sqrt(e)};Math.Sinh=function(e){return Math.log(e+Math.sqrt(e*e+1))};Math.Cosh=function(e){return(Math.exp(e)+Math.exp(-e))/2};Math.Tanh=function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))};Date.dateDiff=function(e,t,r){e=e.toLowerCase();var n=r-t;var i={w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3};return Math.floor(n/i[e])};Number.prototype.pad=function(e){var t=String(this);while(t.length<(e||2)){t="0"+t}return t};var MathJaxConfig=function(){var e={};var t=[];var r=null;var n=function(){if(!r)r=MathJax.Hub;r.Startup.signal.Interest(function(e){for(var r=0,n=t.length;r<n;r++){t[r].apply(this,["Startup - ",e])}});r.signal.Interest(function(e){var r="Hub - "+e[0];if(e.length===3){r+=" ("+e[2]+")"}for(var n=0,i=t.length;n<i;n++){t[n].apply(this,[r,e[1]])}})};e.OnMessage=function(e){if(typeof e!=="function")return;if(t.length===0)n();t.push(e)};e.Preload=function(){if(!r)r=MathJax.Hub;var e=document.getElementById("preloader");if(e){r.Queue(["Typeset",MathJax.Hub,e])}};return e}();var MediaQuery=function(e){var t={};t.isPortrait=function(){return App.Screen.landscape?false:true};t.isLandscape=function(){return App.Screen.landscape?true:false};t.isLarge=function(){return App.Screen.width>1024?true:false};t.isMedium=function(){if(t.isLandscape())return App.Screen.width>=768&&App.Screen.width<=1024?true:false;else return App.Screen.width>640&&App.Screen.width<=1024?true:false};t.isSmall=function(){if(t.isLandscape()){var e=App.Screen.pixelRatio>=2.225?820:768;return App.Screen.width<e?true:false}else{return App.Screen.width<=640?true:false}};t.useGraphAltView=function(){if(App.IsApps){return App.isIpad?false:true}if(App.isMobile){if(App.isIpad)return false;return App.Screen.landscape?false:true}return App.Screen.landscape===false&&App.Screen.width<=768?true:false};t.minWidth=function(e){return e<=App.Screen.width?true:false};t.maxWidth=function(e){return e>=App.Screen.width?true:false};return t}(jQuery);var oAuthHandler=function(e,t){var e=e;var r=t;var n,i,a;this.getEmailAndIdFromAuth=function(e){var t={error:"",email:"",id:""};if(!o()){t.error=oAuthErrors.Invalid_Provider;return t}s(e);if(!u()){t.error=oAuthErrors.Invalid_State;return t}var r=l(a);t.email=r.email;t.id=r.id;return t};this.handleError=function(t){switch(e){case oAuthProviders.Apple:return p(t)}};var o=function(){return e==oAuthProviders.Apple};var s=function(e){n=e.code;i=e.state;a=e.id_token};var u=function(){return r===i};var l=function(t){switch(e){case oAuthProviders.Apple:return c(t)}};var c=function(e){var t=JSON.parse(atob(e.split(".")[1]));return{email:t.email,id:t.sub}};var p=function(e){var t=["user_cancelled_authorize","popup_closed_by_user"];var r=e.detail.error;var n={showMessage:false,message:Strings.Errors.Generic};if(t.indexOf(r)==-1)n.showMessage=true;return n}};var oAuthProviders={Apple:"apple"};var oAuthErrors={Invalid_Provider:"Invalid provider",Invalid_State:"Invalid state"};Recurly=function(){var e={StepByStep:1,Tutoring:2};var t="ewr1-CZxmZFvqcHuAbe2oij1yiN";var r={monthly:{code:null,price:null},monthlyExpertQA:{code:null,price:null,discount:null},monthlyTutoring:{code:null,price:null,discount:null},quarterly:{code:null,price:null,discount:null},quarterlyExpertQA:{code:null,price:null,discount:null},quarterlyTutoring:{code:null,price:null,discount:null},annual:{code:null,price:null,discount:null},annualExpertQA:{code:null,price:null,discount:null},annualTutoring:{code:null,price:null,discount:null},oneOffExpertPlan:{code:null,price:null,discount:null}};var n=null;var i="";var a=null;var o=null;var s=false;var u=function(e){e=typeof e!=="undefined"?e:false;if(recurly.configured&&!e)return;recurly.configure({publicKey:Recurly.key,fields:{card:{style:{placeholder:{content:{number:Strings.Upgrade.LabelCardNumber,expiry:Strings.Upgrade.LabelCardMMYY,cvv:Strings.Upgrade.LabelCardCVV}}}},tabIndex:0}});r.monthly.code=App.Plans.MonthlyStepByStep;r.quarterly.code=App.Plans.QuarterlyStepByStep;r.annual.code=App.Plans.AnnualStepByStep;r.monthlyExpertQA.code=App.Plans.MonthlyExpertQA;r.quarterlyExpertQA.code=App.Plans.QuarterlyExpertQA;r.annualExpertQA.code=App.Plans.AnnualExpertQA;r.monthlyTutoring.code=App.Plans.MonthlyTutoring;r.quarterlyTutoring.code=App.Plans.QuarterlyTutoring;r.annualTutoring.code=App.Plans.AnnualTutoring;r.oneOffExpertPlan.code=App.Plans.OneOffExpert};var l=function(e,t){var n=r[e].price;var i=r[t].price;var a=n*3;var o=1-i/a;return o.toFixed(2)};var c=function(e,t){var n=r[e].price;var i=r[t].price;var a=n*12;var o=1-i/a;return o.toFixed(2)};var p=function(e){var t=e.monthlyPlanCode.split("|");var n=e.monthlyExpertQAPlanCode.split("|");var i=e.monthlyTutoringPlanCode.split("|");var a=e.quarterlyPlanCode.split("|");var o=e.quarterlyExpertQAPlanCode.split("|");var s=e.quarterlyTutoringPlanCode.split("|");var u=e.annualPlanCode.split("|");var l=e.annualExpertQAPlanCode.split("|");var c=e.annualTutoringPlanCode.split("|");r.monthly.code=t[0];r.monthlyExpertQA.code=n[0];r.monthlyTutoring.code=i[0];r.quarterly.code=a[0];r.quarterlyExpertQA.code=o[0];r.quarterlyTutoring.code=s[0];r.annual.code=u[0];r.annualExpertQA.code=l[0];r.annualTutoring.code=c[0];r.oneOffExpertPlan.code="tutor-credits-id64-qty1"};var d=function(e){u();var t=recurly.Pricing();var n=0;var i=Object.keys(r);var a=function(){var o=r[i[n]];t.plan(o.code,{quantity:1}).currency(f()).catch(function(e){switch(e.code){case"invalid-currency":Currency.SetCurrency(supportedCurrencies.UnitedStatesDollar);a();break;default:API.logTestEvent("recurly-pricing-error",0,"Error Code: "+e.code+"; Plancode: "+o.code);Popup.showError(Strings.Errors.Generic)}}).done(function(t){o.price=parseFloat(t.now.total);if(++n===i.length){s=true;e(r)}else{a()}if(r.quarterly.price!==null)r.quarterly.discount=l("monthly","quarterly");if(r.quarterlyExpertQA.price!==null)r.quarterlyExpertQA.discount=l("monthlyExpertQA","quarterlyExpertQA");if(r.quarterlyTutoring.price!==null)r.quarterlyTutoring.discount=l("monthlyTutoring","quarterlyTutoring");if(r.annual.price!==null)r.annual.discount=c("monthly","annual");if(r.annualExpertQA.price!==null)r.annualExpertQA.discount=c("monthlyExpertQA","annualExpertQA");if(r.annualTutoring.price!==null)r.annualTutoring.discount=c("monthlyTutoring","annualTutoring")})};a()};var f=function(){return Currency.chosenCurrency.code};var h=function(){$.subscribe("auth/loggedin",function(){s=false});$.subscribe("auth/loggedout",function(){s=false})};h();return{init:function(e){u(true);payWithAmazon.on("login",function(){$.publish("amazon/login")});payWithAmazon.on("change",function(e){$.publish("amazon/change",[e])});if(typeof e==="function")e.call(this);return},PurchaseType:e,configure:u,getPrices:function(e,t){e=typeof e==="undefined"?false:e;if(e)s=false;p({monthlyPlanCode:STM.Tests.Plans.value,annualPlanCode:STM.Tests.Plans.value2,monthlyTutoringPlanCode:STM.Tests.Plans.value3,annualTutoringPlanCode:STM.Tests.Plans.value4,quarterlyPlanCode:STM.Tests.Plans.value5,quarterlyTutoringPlanCode:STM.Tests.Plans.value6,monthlyExpertQAPlanCode:STM.Tests.Plans.value7,quarterlyExpertQAPlanCode:STM.Tests.Plans.value8,annualExpertQAPlanCode:STM.Tests.Plans.value9});d(t)},getCoupon:function(){return i},updateBilling:function(e,t){u();recurly.token(e,function(e,r){if(typeof t==="function")t.call(this,e,r)})},paypal:function(e,t){u();a=recurly.PayPal({display:{displayName:e}});a.on("error",function(e){if(typeof t==="function")t.call(this,e,null)});a.on("token",function(e){if(typeof t==="function")t.call(this,null,e)});a.start()},applePay:function(e,t,r,n,a,s){u();var l=recurly.Pricing().plan(r,{quantity:1}).coupon(i).currency("USD").done();var c="";if(r.indexOf("tutoring")>-1)c="Step-by-Step Access + Live Tutoring";else if(r.indexOf("expertqa")>-1)c="Step-by-Step Access + Expert Q&A";else c="Step-by-Step Access";o=recurly.ApplePay({country:"US",label:c,currency:"USD",pricing:l});o.ready(function(){e.addClass("apple-pay-enabled");t.on("click",function(e){e.preventDefault();o.begin()});if(typeof s==="function")s()});o.on("error",function(e){n(e)});o.on("token",function(e){a(e.id)})},subscribe:function(e,t){API.subscribeRecurlyUS(e.purchasetype,e.tokenid,e.plancode,e.couponcode,e.actualcurrency,function(e){if(typeof t==="function")t.call(this,e)})},purchaseTutoringCredits:function(e,t){API.purchaseCreditsRecurly(e,function(e){if(typeof t==="function")t.call(this,e)})},upgradeToExpertQA:function(e,t){API.upgradeToExpertQA(e.plancode,function(e){if(typeof t==="function")t.call(this,e)})},upgradeToTutoring:function(e,t){API.upgradeToTutoring(e.plancode,function(e){if(typeof t==="function")t.call(this,e)})},giftcard:function(e,t){API.purchaseGiftCard(e.tokenid,e.userid,e.giftername,e.gifteremail,e.recipientfirstname,e.recipientlastname,e.personalmessage,e.recipientemail,e.productcode,e.cardvalue,function(e){if(typeof t==="function")t.call(this,e)})},redeemGiftCard:function(e,t){API.redeemGiftCard(e.userid,e.redemptionCode,function(e){if(typeof t==="function")t.call(this,e)})}}}();var Scheduler=function(e){var t={};var r=[];var n=false;var i=function(e){if(console)console.log(e)};var a=function(){App.seleniumReady=true};t.Add=function(e){
e=Util.Extend({label:"",priority:0,evalFn:null,execFn:null},e||{});var t=new u;t.label=e.label;t.priority=e.priority;t.evalFn=e.evalFn;t.execFn=e.execFn;r.push(t);if(n)i(t.toString());r.sort(function(e,t){return e.priority-t.priority})};e.subscribe("Scheduler/Next",function(){var e=r.shift();if(e==null){a();return}e.evaluate();if(n)i(e.toString());e.execute()});e.subscribe("Scheduler/debugToggle",function(){n=!n});var o={Created:1,Pending:2,ToSkip:3};var s=function(e){switch(e){case o.Created:return"Created";case o.Pending:return"Pending";case o.ToSkip:return"To Skip";default:return"(UNKNOWN)"}};var u=function(e){this.state=o.Created;this.label="";this.priority=0;this.evalFn=null;this.execFn=null};u.prototype.evaluate=function(){this.state=this.evalFn.apply(this)?o.Pending:o.ToSkip};u.prototype.execute=function(){if(this.state===o.Pending){this.execFn.apply(this)}else{e.publish("Scheduler/Next")}};u.prototype.toString=function(){return(this.label.length?this.label:"(unnamed)")+" ["+this.priority+"] "+s(this.state)};return t}(jQuery);var Strings={Auth:{},Cancellation:{},Chat:{},Date:{},Editor:{},Errors:{},ExpertQA:{},Examples:{},ForgotPassword:{},General:{},Graph:{},GiftCards:{},Prompt:{},RateSolution:{},Search:{},Settings:{},Topics:{},Tutorials:{},Upgrade:{},ViewSteps:{},Tutor:{},Currency:{}};var Tabbing=function(e){var t={};var r=0;var n=[];t.addFields=function(e,t){for(var i=0,o=e.length;i<o;i++){if(e[i].substring(7,0)=="HOSTED-"){n.push(e[i])}else{a(document.querySelector(e[i]))}}if(!t)n[r].focus()};t.addField=function(e){if(e.substring(7,0)=="HOSTED-"){n.push(_fields[i])}else{a(document.querySelector(e))}};t.addFieldsFromSelector=function(e){var t=document.querySelectorAll(e);for(var r=0,n=t.length;r<n;r++){a(t[r])}};var a=function(e){if(e==null)return;e.addEventListener("focus",function(){for(var e=0,t=n.length;e<t;e++){if(n[e]===this){r=e;break}}});n.push(e);r=0};t.removeAllFields=function(){n.length=0;r=0};var o=function(t){if(typeof n[r]!=="string")n[r].blur();r=t;if(typeof n[r]==="string"){var i=n[r].substring(7);e.publish("tabbing/hosted",[i]);r=t;return}n[r].focus()};var s=function(){if(r===n.length-1){o(0)}else{o(r+1)}};var u=function(){if(r===0){o(n.length-1)}else{o(r-1)}};e.subscribe("document/keydown",function(e){if(n.length===0)return;if(e.keyCode===9||e.which===9){e.preventDefault();if(e.shiftKey===true){u()}else{s()}}});return t}(jQuery);var Util={location:window.location};Util.Redirect=function(e,t){if(typeof e!=="undefined"){if(t){window.open(e,"_blank")}else{this.location.href=e}}};Util.RedirectToSettings=function(e){e=typeof e==="string"?"#"+e:"";var t=!App.Culture.isEnglish()?"/"+App.Culture.current.substring(0,2):"";Util.Redirect(t+"/settings"+e)};Util.reload=function(){this.location.reload()};Util.RandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};Util.LoadScript=function(e,t){t=$.extend(t||{},{dataType:"script",cache:true,url:e});return $.ajax(t)};Util.isRFC2822Email=function(e){return/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(e)};Util.addQueryParam=function(e,t,r){e+=e.indexOf("?")!==-1?"&":"?";e+=t+"="+r;return e};Util.friendlyUrl=function(e){return e.toLowerCase().replace("'","").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"-").replace(/^-+|-+$/g,"")};Util.nodeSiblings=function(e){if(typeof e==="undefined"||typeof e.children==="undefined")return[];return Array.prototype.filter.call(e.parentNode.children,function(t){return t!==e})};Util.formatDate=function(e){var t=e.getDay();var r=e.getDate();var n=e.getMonth();var i=e.getFullYear();return Strings.Date.DaysOfWeek[t]+", "+Strings.Date.Months[n]+" "+r+", "+i};Util.formatDateShort=function(e){var t=e.getDay();var r=e.getDate();var n=e.getMonth();var i=e.getFullYear();return n+1+"/"+r+"/"+i};Util.formatDateWithTime=function(e){var t=new Date(e);var r=" AM";var n=t.getHours();if(n>=12){r=" PM"}if(n>12){n-=12}var i=t.getMonth()+1+"/"+t.getDate()+"/"+(t.getYear()+1900);var a=n+":"+Util.LeftPad(t.getMinutes(),2)+r;return i+" "+a};Util.centerDialog=function(e){var t=Math.floor((App.Screen.width-e.outerWidth())/2);var r=Math.floor((App.Screen.height-e.outerHeight())/2);e.css("top",r+"px");e.css("left",t+"px");e.css("margin-top",0);e.css("margin-left",0)};Util.deselectAll=function(){if(document.selection){document.selection.empty()}else if(window.getSelection){window.getSelection().removeAllRanges()}};Util.Extend=function(e){e=e||{};for(var t=1;t<arguments.length;t++){var r=arguments[t];if(!r)continue;for(var n in r){if(r.hasOwnProperty(n)){if(r[n]==null){e[n]=null}else if(typeof r[n]==="object"){e[n]=Util.Extend(e[n],r[n])}else{e[n]=r[n]}}}}return e};Util.RandomChance=function(e){if(typeof e==="undefined")e=50;return Util.RandomInt(1,100)<=e?true:false};Util.ArrayClone=function(e){return e.slice(0)};Util.Debounce=function(e,t,r){var n;return function(){var i=this;var a=arguments;var o=function(){n=null;if(!r)e.apply(i,a)};var s=r&&!n;clearTimeout(n);n=setTimeout(o,t);if(s)e.apply(i,a)}};Util.TimeStamp=function(e){if(typeof e==="undefined"){return Date.now()}return e.getTime()};Util.CreateElement=function(e){e=Util.Extend({tagName:"div",className:null,id:null,content:null,attributes:[]},e||{});var t=document.createElement(e.tagName);if(e.className!==null){t.className=e.className}if(e.id!==null){t.setAttribute("id",e.id)}for(var r=0,n=e.attributes.length;r<n;r++){t.setAttribute(e.attributes[r].key,e.attributes[r].value)}if(e.content!==null){t.innerHTML=e.content}return t};Util.LeftPad=function(e,t){var r=e+"";while(r.length<t){r="0"+r}return r};Util.HasId=function(e,t){if(!t)return false;if(typeof t.hasAttribute!=="function")return false;if(!t.hasAttribute("id"))return false;return t.attributes["id"].value===e};Util.HasClass=function(e,t){if(!t)return false;var r=false;if(typeof t.classList!=="undefined")r=t.classList.contains(e);else r=new RegExp("(^| )"+e+"( |$)","gi").test(t.className)?true:false;return r};Util.AddClass=function(e,t){if(!t)return;if(t.classList)t.classList.add(e);else t.className+=" "+e};Util.RemoveClass=function(e,t){if(!t)return;if(t.classList)t.classList.remove(e);else t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")};Util.HasClassInDom=function(e,t){if(!t)return false;if(Util.HasClass(e,t)){return true}else if(t===document.body){return false}else{return Util.HasClassInDom(e,t.parentNode)}};Util.HasIdInDom=function(e,t){if(!t)return false;if(Util.HasId(e,t)){return true}else if(t===document.body){return false}else{return Util.HasIdInDom(e,t.parentNode)}};Util.HasParentInDom=function(e,t){if(!t)return false;if(t===e){return true}else if(t===document.body){return false}else{return Util.HasParentInDom(e,t.parentNode)}};Util.Measure=function(e,t){var r=window.performance;var n=e+"_start";var i=e+"_end";r.mark(n);t();r.mark(i);r.measure(e,n,i);var a=r.getEntriesByName(e)[0];Debug.log(e+" took "+a.duration.toFixed(2)+" ms");r.clearMarks(n);r.clearMarks(i);r.clearMeasures(e)};Util.IsEmpty=function(e){if(!e)return true;return e.children().length===0};Util.Remove=function(e){if(App.isIE&&typeof e.parentNode.removeChild==="function")e.parentNode.removeChild(e);else e.remove()};Util.OpenWindowWithPost=function(e,t,r,n){var i=document.createElement("form");i.setAttribute("method","post");i.setAttribute("action",e);i.setAttribute("target",r);for(var a in n){if(n.hasOwnProperty(a)){var o=document.createElement("input");o.type="hidden";o.name=a;o.value=n[a];i.appendChild(o)}}document.body.appendChild(i);window.open("",r,t);i.submit();document.body.removeChild(i)};Util.NormalizeSubject=function(e){return e.toLowerCase().replace("-","")};Util.ProcessImageData=function(e,t,r,n){if(typeof r!=="number")r=1e3;if(r>2e3)r=2e3;if(r<250)r=250;var i=r;var a=r;var o=new Image;o.src=e;o.onload=function(){var e=o.width;var r=o.height;if(t!=6){if(e>i){r*=i/e;e=i}}else{if(r>a){e*=a/r;r=a}}var s=document.createElement("canvas");s.width=e;s.height=r;var u=s.getContext("2d");u.save();var l=s.width;var c=s.style.width;var p=s.height;var d=s.style.height;if(t>1){if(t>4){s.width=p;s.style.width=d;s.height=l;s.style.height=c}switch(t){case 2:u.translate(l,0);u.scale(-1,1);break;case 3:u.translate(l,p);u.rotate(Math.PI);break;case 4:u.translate(0,p);u.scale(1,-1);break;case 5:u.rotate(.5*Math.PI);u.scale(1,-1);break;case 6:u.rotate(.5*Math.PI);u.translate(0,-p);break;case 7:u.rotate(.5*Math.PI);u.translate(l,-p);u.scale(-1,1);break;case 8:u.rotate(-.5*Math.PI);u.translate(-l,0);break}}u.drawImage(this,0,0,e,r);u.restore();n.apply(this,[s])}};Util.CropFromImage=function(e,t,r,n,i,a){if(typeof a!=="number")a=1;var o=document.createElement("canvas");var s=o.getContext("2d");o.width=t;o.height=r;var u=document.createElement("canvas");var l=u.getContext("2d");u.width=e.naturalWidth;u.height=e.naturalHeight;l.drawImage(e,0,0);s.drawImage(u,n*a,i*a,t*a,r*a,0,0,t,r);return o};Util.IsNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};Util.IsInteger=function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e};Util.FixupBubbleTimestamps=function(e){var t=[];for(var r=0,n=e.length;r<n;r++){var i=e[r];i.timestamp=Date.now();t.push(i)}return t};Util.IsNullOrEmpty=function(e){if(typeof e==="undefined")return true;if(e===null)return true;if(e==="")return true;return false};Util.Clamp=function(e,t,r){if(e<t)return t;if(e>r)return r;return e};PlatformInterface=function(e){var t=this;e=Util.Extend({platform:null},e||{});if(e.platform===null){Debug.log("Can't initialize interface without a platform.");return}var r=function(e){if(typeof e==="string"){switch(e.toLowerCase()){case"web":return App.Platform.Web;case"ios":return App.Platform.IOS;case"amazon":case"android":return App.Platform.Android}}return e};var n=r(e.platform);switch(n){case App.Platform.Web:return PlatformInterface.Web;case App.Platform.IOS:return PlatformInterface.IOS;case App.Platform.Android:case App.Platform.Amazon:return PlatformInterface.Android}};Actions={showSpinner:"ShowLoading",hideSpinner:"HideLoading",showKeyboard:"ShowKeyboard",hideKeyboard:"HideKeyboard",editorChange:"EditorState",editorFocus:"EditorFocus",showTopics:"ShowTopics",showTopicsInfinite:"ShowTopicsInfinite",rateSolution:"ShowRateSolution",openGlossary:"OpenGlossary",openCamera:"OpenCamera",openSteps:"OpenSteps",openGraph:"OpenGraph",openExamples:"OpenExamples",viewStepsClick:"ViewStepsClick",showSignIn:"ShowLogin",showLogin:"ShowLogin",showLoginUpgrade:"ShowLoginUpgrade",showSignUp:"ShowSignUp",showSignUpUpgrade:"ShowSignUpUpgrade",chatTapped:"ChatTapped",startTutorial:"StartTutorial",appStore:"AppStore",showUpgrade:"ShowUpgrade",pageLoaded:"PageLoaded",graphDone:"GraphDone",definitionInserted:"DefinitionInserted",gaEvent:"GoogleAnalyticsEvent",nextTopicPage:"NextTopicPage",topicsForSearch:"TopicsForSearch",showTutorMacros:"ShowTutorMacros",showTutorFormulas:"ShowTutorFormulas",submitProblem:"SubmitProblem",showSignUpUpgradeDelayed:"ShowSignUpUpgradeDelayed",showInAppRating:"ShowInAppRating",surveyOpenDialog:"SurveyOpenDialog",surveySubmit:"SurveySubmit",surveyCancel:"SurveyCancel",startSpeechToText:"StartSpeechToText",signOut:"SignOut",appShare:"AppShareBubble",createExpertQuestion:"CreateExpertQuestion",submitExpertQuestion:"SubmitExpertQuestion",askOurExperts:"AskOurExperts",showAskExperts:"ShowAskExperts",showInterstitial:"ShowInterstitial",problemSolved:"ProblemSolved",tutorConnect:"tutorConnect",tutorDisconnect:"tutorDisconnect",studentRequestsTutor:"studentRequestsTutor",studentCancelsRequest:"StudentCancelsRequest",studentRequestTimesOut:"StudentRequestTimesOut",tutorDeclineInvite:"TutorDeclineInvite",tutorAcceptsInvite:"TutorAcceptsInvite",leaveRoom:"LeaveRoom",userSendsMessage:"UserSendsMessage",userSendsSolution:"UserSendsSolution",userStartsTyping:"UserStartsTyping",userStopsTyping:"UserStopsTyping",ratingSent:"RatingSent",loadWhiteboard:"LoadWhiteboard",requestTutorInvite:"RequestTutorInvite",cancelTutorInvite:"CancelTutorInvite",cancelStudentRequest:"CancelStudentRequest",cancelRequestUserFraud:"CancelRequestUserFraud",cancelRequestAlreadyInRoom:"CancelRequestAlreadyInRoom",cancelRequestMissedRoom:"CancelRequestMissedRoom",messages:"Messages",tutorAcceptedInvite:"TutorAcceptedInvite",tutorStartRoom:"TutorStartRoom",tutorResumeRoom:"TutorResumeRoom",showRateTutor:"ShowRateTutor",roomFinishedTutor:"RoomFinishedTutor",roomFinishedStudent:"RoomFinishedStudent",userStartedTyping:"UserStartedTyping",userStoppedTyping:"UserStoppedTyping",continueTimer:"ContinuerTimer",userDisconnected:"UserDisconnected",studentReconnected:"StudentReconnected",removeMessage:"RemoveMessage",messageWasRemoved:"MessageWasRemoved",placeInLineResponse:"PlaceInLineResponse",tutorRequestCreated:"TutorRequestCreated",waitingForStudent:"WaitingForStudent",tutorRoomError:"TutorRoomError"};Actions.Do=function(e,t){if(typeof App.Interface==="undefined"){Debug.log("No platform interface has been defined to perform the action: "+e);Debug.log(t);return}App.Interface.call(e,t)};PlatformInterface.Web={openSteps:function(e){var t=function(t){API.clickViewSteps(e.solutionId,t)};var r=false;if(Auth.hasSubscription()||e.freeTrialToken)r=true;if(ChatBridge.affiliateMode&&!r){t(false);$.publish("ChatLibrary/Redirect",[e])}else if(r||e.presetProblem){t(false);$.publish("ChatLibrary/ViewSteps",[e])}else if(Auth.isLoggedIn()){API.getCreditInfoForUser(CreditType.StepByStep,function(r){if(r.status===1&&r.Credits>0){App.SBSCredits=r.Credits;t(false);$.publish("ChatLibrary/ViewSteps",[e])}else{Popup.onLoaded(t);Actions.Do(Actions.showUpgrade,e)}})}else{Popup.onLoaded(t);Actions.Do(Actions.showUpgrade,e)}},studentCancelsRequest:function(e){$.publish("ChatLibrary/ClearTutorLoading");if(e){var t=Chat.CreateBubble({content:Strings.Tutor.NoTutors,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble});$.publish("ChatLibrary/Insert",[{bubbles:[t]},{immediate:false,fromUser:false}]);Tutor.Hub.studentRequestTimesOut(DtoHelper.ChatUserConnection({UserId:Auth.userstate.userId}))}else{Tutor.Hub.studentCancelsRequest(DtoHelper.ChatUserConnection({UserId:Auth.userstate.userId}))}},call:function(e,t){switch(e){case Actions.showSpinner:Popup.spinner();break;case Actions.hideSpinner:Popup.hideSpinner();break;case Actions.showKeyboard:$.publish("drawer/open");break;case Actions.hideKeyboard:$.publish("drawer/close");break;case Actions.rateSolution:Popup.showRateSolution(t);break;case Actions.openSteps:this.openSteps(t);break;case Actions.openGraph:Popup.showGraph(t.graphInput);break;case Actions.showLogin:Popup.showLogin();break;case Actions.showLoginUpgrade:Popup.showLogin({onAuthUpgrade:true});break;case Actions.showSignUp:Popup.showSignUp();break;case Actions.showSignUpUpgrade:Popup.showSignUp({onAuthUpgrade:true});break;case Actions.showSignUpUpgradeDelayed:Popup.showSignUp({onAuthUpgradeDelayed:true});break;case Actions.showUpgrade:App.upgrade(t);break;case Actions.openExamples:$.publish("examples/open");break;case Actions.startTutorial:$.publish("tutorial/run",t);break;case Actions.appStore:$.publish("apps/appStore");break;case Actions.openGlossary:$.publish("glossary/open",t);break;case Actions.gaEvent:GoogleAnalytics.send(t);break;case Actions.submitProblem:$.publish("chat/getTopics");break;case Actions.dispatchRating:$.publish("chat/dispatchRating",[t]);break;case Actions.surveyText:case Actions.surveyOpenDialog:Popup.showSurveyText(t);break;case Actions.surveySubmit:$.publish("surveyText/surveySubmit",[t]);break;case Actions.surveyCancel:$.publish("surveyText/surveyCancel",[t]);break;case Actions.surveyAnswer:$.publish("surveyText/surveyAnswer",[t]);break;case Actions.createExpertQuestion:ExpertQA.CreateQuestion(t);break;case Actions.submitExpertQuestion:ExpertQA.SubmitQuestion(t);break;case Actions.askOurExperts:ExpertQA.Ask(t);break;case Actions.showAskExperts:Popup.showAskExperts(t);break;case Actions.signOut:$.publish("auth/logout",[function(){Util.Redirect(App.getHomeLink())}]);break;case Actions.showInterstitial:Popup.Ad.show();break;case Actions.showSetPassword:Popup.showSetPassword(t);break;case Actions.tutorConnect:Tutor.Connect();break;case Actions.tutorDisconnect:Tutor.Disconnect();break;case Actions.studentRequestsTutor:Tutor.Hub.studentRequestsTutor(t);break;case Actions.studentCancelsRequest:this.studentCancelsRequest(false);break;case Actions.studentRequestTimesOut:this.studentCancelsRequest(true);break;case Actions.tutorDeclineInvite:Tutor.Hub.tutorDeclineInvite(t);break;case Actions.tutorAcceptsInvite:Tutor.Hub.tutorAcceptsInvite(t);break;case Actions.leaveRoom:Tutor.Hub.leaveRoom(t);break;case Actions.userSendsMessage:Tutor.Hub.userSendsMessage(t);break;case Actions.userSendsSolution:Tutor.Hub.userSendsSolution(t);break;case Actions.userStartsTyping:Tutor.Hub.userStartsTyping();break;case Actions.userStopsTyping:Tutor.Hub.userStopsTyping();break;case Actions.ratingSent:Tutor.Hub.ratingSent(t);break;case Actions.loadWhiteboard:$.publish("Tutor/Whiteboard",[t]);break;case Actions.requestTutorInvite:Tutor.RequestTutorInvite(t);break;case Actions.cancelTutorInvite:Tutor.CancelTutorInvite(t);break;case Actions.cancelStudentRequest:Tutor.CancelStudentRequest();break;case Actions.cancelRequestUserFraud:Tutor.CancelRequestUserFraud();break;case Actions.cancelRequestMissedRoom:Tutor.CancelRequestMissedRoom();break;case Actions.tutorRoomError:Tutor.TutorRoomError();break;case Actions.cancelRequestAlreadyInRoom:Tutor.CancelRequestAlreadyInRoom();break;case Actions.waitingForStudent:Tutor.WaitingForStudent();break;case Actions.messages:Tutor.Messages(t);break;case Actions.tutorAcceptedInvite:Tutor.TutorAcceptedInvite(t);break;case Actions.tutorRequestCreated:Tutor.TutorRequestCreated(t);break;case Actions.tutorStartRoom:Tutor.TutorStartRoom(t);break;case Actions.tutorResumeRoom:Tutor.TutorResumeRoom(t);break;case Actions.showRateTutor:Tutor.ShowRateTutor(t);break;case Actions.roomFinishedTutor:Tutor.RoomFinishedTutor(t);break;case Actions.roomFinishedStudent:Tutor.RoomFinishedStudent(t);break;case Actions.userStartedTyping:Tutor.UserStartedTyping(t);break;case Actions.userStoppedTyping:Tutor.UserStoppedTyping(t);break;case Actions.continueTimer:Tutor.ContinueTimer();break;case Actions.userDisconnected:Tutor.UserDisconnected();break;case Actions.studentReconnected:Tutor.StudentReconnected();break;case Actions.removeMessage:Tutor.Hub.removeMessage(t);break;case Actions.messageWasRemoved:Tutor.MessageWasRemoved(t,true);break;case Actions.placeInLineResponse:Tutor.PlaceInLineResponse(t);break;case Actions.showTutorMacros:$.publish("Tutor/OpenMacros");break;case Actions.showTutorFormulas:$.publish("Tutor/OpenFormulas");break}}};var App=function(e){var t={};t.Version="";t.Platform={Web:0,IOS:1,Android:2,Amazon:3,WindowsPhone:4};t.Config={Platform:t.Platform.Web};t.Interface=null;t.Services={API:null,Data:null,Solver:null};t.Plans={MonthlyStepByStep:"monthly-premium-5",MonthlyExpertQA:"monthly-premium-expertqa",MonthlyTutoring:"monthly-premium-tutoring",QuarterlyStepByStep:"quarterly-premium",QuarterlyExpertQA:"quarterly-premium-expertqa",QuarterlyTutoring:"quarterly-premium-tutoring",AnnualStepByStep:"annual-premium-4",AnnualExpertQA:"annual-premium-expertqa",AnnualTutoring:"annual-premium-tutoring"};t.Model=null;t.Screen={};t.debug=true;t.isIE=false;t.isFirefox=false;t.isModern=true;t.isEdge=false;t.isAndroidDevice=/Android/i.test(navigator.userAgent);t.isConnected=true;t.isBot=false;t.baseUrl="";t.lastSolution={};t.urlPrefix="/";t.Culture={acceptLanguages:"en-US",current:"en-US",header:"en-US",mismatch:false,hint:"",isEnglish:function(){return this.current.substring(0,2)==="en"}};t.deviceName="";t.isSafari=false;t.isIpad=false;t.isMobile=false;t.CurrentEditor=null;t.CurrentDocumentEditor=null;t.CurrentSubject="Algebra";t.StartTime=Util.TimeStamp();t.LocalBubbles=10;t.MaxScrollableValue=1e9;t.TimeOffset=0;t.IsApps=false;t.AppsTesting=false;t.DrawerOpen=false;t.seleniumReady=false;t.DefaultAvatarUrl="/images/userAvatarDefault.png";t.TutoringCredits=0;t.SBSCredits=0;t.UnreadExpertAnswers=0;t.OriginalTutorBubbleSequence=null;t.EnvironmentSupportsApplePay=false;t.Environment="Release";t.isProduction=true;t.iOSversion=function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(e[1],10),minor:parseInt(e[2],10)}}return 0};t.iOSLessThanTenThree=function(){var e=t.iOSversion();if(e===0)return false;if(e.major<10)return true;return e.major===10&&e.minor<3};t.voiceSupported=function(){var e=t.iOSversion();if(e!==0){if(e.major<10)return false}return App.IsApps&&App.Culture.isEnglish()&&n(t.Version,"3.3.6")>0};t.isAndroidNexus6Chrome51=function(){var e=navigator.userAgent.match(/Nexus 6.*Chrome\/([\d]+).*/);if(e===null)return false;if(e.length!==2)return false;return parseInt(e[1])<=51};t.WKWebviewSupported=function(){return n(t.Version,"3.3.28")>=0};t.Validator={widgetUp:null,widgetIn:null,key:"",on:false,process:function(){t.Validator.widgetIn=grecaptcha.render("login-verify-signin",{sitekey:t.Validator.key})}};t.deviceString=function(){var e;var r="large";var n=t.Screen.pixelRatio;var i=";";if(t.Screen.landscape){e="landscape";if(t.Screen.width<=767){r="small"}else if(t.Screen.width<=1024){r="medium"}}else{e="portrait";if(t.Screen.width<=640){r="small"}else if(t.Screen.width<=1024){r="medium"}}return t.deviceName+i+r+i+e+i+n};t.IsAutoCompleteActive=function(){return true};t.ShowUpgradeInViewStepsApps=function(){return n(t.Version,"3.1.12")>0};t.NeedsTieredTopicsApps=function(){return n(t.Version,"3.2.9")<0};t.CanShowPreTutorCameraApps=function(){return n(t.Version,"3.2.10")>0};t.HasSurveryTextDialog=function(){return n(t.Version,"3.3.8")>0};var r=function(e){if(typeof e!="string"){return false}var t=e.split(".");var r=parseInt(t[0])||0;var n=parseInt(t[1])||0;var i=parseInt(t[2])||0;return{major:r,minor:n,patch:i}};var n=function(e,t,r){var n=r&&r.lexicographical,i=r&&r.zeroExtend,a=e.split("."),o=t.split(".");function s(e){return(n?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}if(!a.every(s)||!o.every(s)){return NaN}if(i){while(a.length<o.length)a.push("0");while(o.length<a.length)o.push("0")}if(!n){a=a.map(Number);o=o.map(Number)}for(var u=0;u<a.length;++u){if(o.length==u){return 1}if(a[u]==o[u]){continue}else if(a[u]>o[u]){return 1}else{return-1}}if(a.length!=o.length){return-1}return 0};t.getQueryParam=function(e){var t=window.location.search.substring(1);var r=t.split("&");for(var n=0,i=r.length;n<i;n++){var a=r[n].split("=");if(decodeURIComponent(a[0])===e){return decodeURIComponent(a[1])}}return false};t.affiliateId="";tmpAffId=t.getQueryParam("affiliateid");if(tmpAffId){t.affiliateId=tmpAffId}t.isAffiliateWidget=function(){return window.location.href.toLowerCase().indexOf("problemwidget.aspx")>-1};t.onContentPage=function(){return e("#return-link").html()!=null};t.onGraphPage=function(){return e("#gpc-container").html()!=null};t.getHomeLink=function(e){e=e||false;var r=t.baseUrl+t.urlPrefix;var n=WebStorage.lastSubject.get();if(n!==null){if(e)r+="ProblemWidget.aspx?subject=";r+=n}return r};t.getAffiliateSubject=function(){var e=WebStorage.lastSubject.get();if(e===null){e=t.getQueryParam("subject")}if(e===null){var r=WebStorage.lastSolve.get();if(r!==null&&typeof r.subject==="string"){e=r.subject}}if(e===null){e="Algebra"}return e};t.depth=0;t.upgrade=function(t){if(App.IsApps){e.publish("dialog/open",["upgradeStepped",t]);return}if(!Auth.isLoggedIn()){Actions.Do(Actions.hideSpinner);if(STM.Tests.AnonymousPurchasing.enabled()){Popup.showUpgrade(e.extend({anonPurchase:true},t||{}))}else{Actions.Do(Actions.showSignUpUpgrade)}return}if(Auth.isLoggedIn()){if(Auth.userstate.SubscriptionStatus===SubStatus.Paused){Popup.showError(Strings.Errors.NeedToUnpause);return}if(!Auth.hasRole(UserRoles.TutoringAccess)){if(Auth.hasRole(UserRoles.StepByStep)){if(Auth.userstate.MWSubscriptionSource!==SubSource.Recurly){var r=Strings.Errors.IncompatibleUpgradeDefault;if(Auth.hasRole(UserRoles.Student)){r=Strings.Errors.IncompatibleUpgradeStudent}else if(Auth.hasRole(UserRoles.Teacher)){r=Strings.Errors.TeacherUpgradeError}else{switch(Auth.userstate.MWSubscriptionSource){case SubSource.iTunes:r=Strings.Errors.IncompatibleUpgradeiOS;break;case SubSource.GooglePlay:r=Strings.Errors.IncompatibleUpgradeAndroid;break}}Popup.showError(r);return}}Popup.showUpgrade(t);return}else{Popup.showUpgrade(t);return}}else{Popup.showUpgrade(t)}};t.upgradeAllowed=function(){if(Auth.userstate===null)return true;if(Auth.hasRole(UserRoles.TutoringAccess))return false;if(Auth.hasRole(UserRoles.StepByStep)){if(Auth.userstate.MWSubscriptionType===SubType.NotSet)return false;return Auth.userstate.MWSubscriptionSource===SubSource.Recurly&&t.Culture.isEnglish()}return true};t.postAffiliateMessage=function(e,t,r){e=e||"";t=t||"";r=r||"";try{parent.postMessage('{ "data": "'+r+'", "topic": "'+t+'", "url": "'+e+'", "mathwayMessage": true}',"*")}catch(n){Debug.warn(n)}};t.isSafariBrowser=function(e){return!!e.match(/Version\/[\d\.]+.*Safari/)&&!e.match(/Chrome\/[\d\.]+/)};t.isInFrame=function(){return window!=window.top?true:false};t.canEditorTakeFocus=function(){if(window.jasmine)return true;if(t.IsApps)return true;return window.document.hasFocus()};t.fromUnitedStates=function(){var e=WebStorage.location.get();return e.toUpperCase()==="US"?true:false};var i=function(){if(navigator.userAgent.indexOf("MSIE")!==-1||navigator.appVersion.indexOf("Trident/")>0){e.query("body").addClass("ie");t.isIE=true}if(navigator.userAgent.indexOf("Firefox")!==-1){t.isFirefox=true}if(!e.query("body").hasClass("browser-modern")){t.isModern=false}if(!e.query("body").hasClass("browser-edge")){t.isEdge=true}t.isSafari=t.isSafariBrowser(navigator.userAgent);if(t.isSafari){e.query("body").addClass("safari")}if(navigator.userAgent.match("CriOS")){e.query("body").addClass("safari");t.isSafari=true}t.isMobile=h();if(navigator.userAgent.indexOf("iPad")!==-1){e.query("body").addClass("ipad");t.isIpad=true}};var a=function(){var e=window.location.href;var r=e.split("/");t.baseUrl=r[0]+"//"+r[2]};var o=function(){window.onerror=function(e){Debug.warn(e)};e(document).focus(function(){if(t.isInFrame()&&t.CurrentEditor){t.CurrentEditor.updateView(true)}});e(document).ready(function(){e.publish("document/ready")});window.addEventListener("load",function(){e.publish("window/load")});e(window).resize(function(t){t.target=t.target?t.target:t.srcElement;e.publish("window/resize",[t])});e(document).mousedown(function(t){if(App.StartTime+150>=Util.TimeStamp())return;t.target=t.target?t.target:t.srcElement;e.publish("document/mousedown",[t])});if(t.isSafari){e("#chat-area").css("cursor","pointer");e(window).mouseup(function(t){if(App.StartTime+150>=Util.TimeStamp())return;t.target=t.target?t.target:t.srcElement;e.publish("document/mouseup",[t])})}else{e(document).mouseup(function(t){if(App.StartTime+150>=Util.TimeStamp())return;t.target=t.target?t.target:t.srcElement;e.publish("document/mouseup",[t])})}e(document).keyup(function(t){if(App.StartTime+150>=Util.TimeStamp())return;t.target=t.target?t.target:t.srcElement;e.publish("document/keyup",[t])});e(document).keydown(function(t){t.target=t.target?t.target:t.srcElement;e.publish("document/keydown",[t])});e(document).keypress(function(t){t.target=t.target?t.target:t.srcElement;e.publish("document/keypress",[t])});e(document).mousemove(function(t){e.publish("mouseMove",[t])});e(document).on("paste",function(t){var r=(t.originalEvent||t).clipboardData.getData("text/plain");e.publish("document/paste",[r,true])});e(document).on("cut",function(t){var r={};e.publish("document/cut",[r]);if(typeof r.text=="string"){t.stopPropagation();t.preventDefault();if(t.originalEvent.clipboardData){t.originalEvent.clipboardData.setData("text/plain",r.text)}else{window.prompt(Strings.Prompt.Clipboard,r.text)}}});e(document).on("copy",function(t){var r={};e.publish("document/copy",[r]);if(typeof r.text=="string"&&r.text!==""){t.stopPropagation();t.preventDefault();if(t.originalEvent.clipboardData){t.originalEvent.clipboardData.setData("text/plain",r.text)}else{window.prompt(Strings.Prompt.Clipboard,r.text)}}});e.subscribe("window/disableSelection",function(){e.query("body").addClass("no-selection");Util.deselectAll()});e.subscribe("window/enableSelection",function(){e.query("body").removeClass("no-selection")});window.addEventListener("orientationchange",function(){var t="portrait";switch(window.orientation){case-90||90:t="landscape";break}e.publish("mobile/rotated",[t])});window.addEventListener("focus",function(){e.publish("window/focus")});window.addEventListener("blur",function(){e.publish("window/blur")})};var s=function(){t.Screen={width:window.innerWidth,height:window.innerHeight,landscape:window.innerWidth>window.innerHeight?true:false,pixelRatio:window.devicePixelRatio||1}};var u=function(){e.subscribe("window/resize",function(){s()});s()};var l=function(){t.isBot=/bot|crawler|baiduspider|80legs|ia_archiver|voyager|curl|wget|yahoo! slurp|mediapartners-google/i.test(navigator.userAgent)};var c=function(){if(t.isBot){e.publish("app/authinfosynced");return}if(WebStorage.anonUserId.get()!==null&&WebStorage.testId.get()!==null){e.publish("app/authinfosynced");return}sourcePage=window.location.href;sourcePage=sourcePage.substring(t.baseUrl.length,sourcePage.length);API.anonymousUser(sourcePage,function(t){if(t.status===1){WebStorage.anonUserId.set(t.AnonUserId);WebStorage.testId.set(t.TestId)}e.publish("app/authinfosynced")})};var p=function(){if(!Date.now){Date.now=function(){return(new Date).getTime()}}if(Number.parseFloat===void 0)Number.parseFloat=parseFloat;if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(e){if(this==null){throw new TypeError('"this" is null or not defined')}var t=Object(this);var r=t.length>>>0;if(typeof e!=="function"){throw new TypeError("predicate must be a function")}var n=arguments[1];var i=0;while(i<r){var a=t[i];if(e.call(n,a,i,t)){return a}i++}return undefined},configurable:true,writable:true});if(!Math.sign){Math.sign=function(e){return(e>0)-(e<0)||+e}}Number.isInteger=Number.isInteger||function(e){return typeof e==="number"&&isFinite(e)&&Math.floor(e)===e}}};var d=function(){var e=new XMLHttpRequest;e.open("GET",App.Services.API+"/rest/alive",true);e.onload=function(){if(e.readyState===4&&e.status===200){var r=e.getResponseHeader("Date");var n=Date.parse(new Date(Date.parse(r)).toUTCString());var i=Date.parse((new Date).toUTCString());t.TimeOffset=n-i}};e.send()};var f=function(){try{t.IsApps=Util.HasClass("apps",document.querySelector("body"));document.getElementById("did-you-mean").style.display="block"}catch(e){t.IsApps=false}};var h=function(){var e=false;(function(t){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))e=true;
})(navigator.userAgent||navigator.vendor||window.opera);return e};var m=function(){setTimeout(function(){if(t.DrawerOpen===false)e.publish("drawer/open")},1200)};i();a();o();u();l();p();m();f();Scheduler.Add({label:"Determine Anonymous User ID",priority:0,evalFn:function(){if(t.isBot)return false;if(WebStorage.anonUserId.get()!==null)return false;return true},execFn:function(){var r=window.location.href;r=r.substring(t.baseUrl.length,r.length);if(App.IsApps){e.publish("Scheduler/Next");return}API.anonymousUser(r,function(t){if(t.status===1){WebStorage.anonUserId.set(t.AnonUserId);WebStorage.testId.set(t.TestId)}e.publish("Scheduler/Next")})}});e.subscribe("document/ready",function(){e.publish("Scheduler/Next")});return t}(jQuery);if(typeof PlatformInterface!=="undefined"){App.Interface=PlatformInterface({platform:App.Config.Platform})}var UI=UI||{};var Component=Component||{};var Page=Page||{};var Pages={};Component.Apps=Component.Apps||{};var Popup=function(){const e={full:"popup-style-full",hybrid:"popup-style-hybrid",collapse:"popup-style-collapse"};const t={ok:"popup-button-ok",yes:"popup-button-yes",no:"popup-button-no",cancel:"popup-button-cancel"};const r=5e3;const n=300;var i=[],a={},o,s,u,l,c=null,p={},d=null,f=0,h=0,m=false;var g=function(t,r,n,a,c){if(typeof t!=="string"&&typeof t!=="object"){Debug.error("Invalid content option supplied to Popup.push(options).  Must be a string or HTML node.");return}if(typeof a==="string"){if(p.hasOwnProperty(a))return;p[a]=true}r=Util.Extend({style:e.collapse,showX:true,closeOnX:true,closeOnOverlay:true,closeCountdown:0,padding:true,maxWidth:0,margins:false,title:"",secondaryIcon:null,alternateStyle:false},r||{});n=Util.Extend({beforeShow:function(){},afterShow:function(){},beforeHide:function(){},afterHide:function(){},onX:function(){},onSecondary:function(){},onOk:null,onYes:null,onNo:null,onCancel:null},n||{});var d=new Popup.Layer(t,r,n,T(),a);i.push(d);if(i.length===1){s=$.subscribe("document/mousedown",function(e){u=Util.HasClass("popup-container",e.target)});o=$.subscribe("document/mouseup",function(e){if(l){l=false;return}v(e,b())});d.container.addEventListener("touchstart",function(e){l=true;u=Util.HasClass("popup-container",e.target)});d.container.addEventListener("touchend",function(e){v(e,b())});I()}if(typeof c==="function"){Popup.spinner();c(function(){Popup.hideSpinner();d.show()})}else{d.show()}};var v=function(e,t){if(Util.HasClass("popup-container",e.target)||Util.HasClassInDom("popup-close",e.target)){e.preventDefault();if(t)t.clicked(e,u);u=false}};var b=function(){return i[i.length-1]};var y=function(e,t){t=t===undefined?false:t;if(i.length===0)return;var r=w();if(e)r.remove();else r.hide();delete p[r.uniqueId];if(i.length===0){$.unsubscribe(s);$.unsubscribe(o);E()}else if(t){e=true;y(e,t)}};var w=function(){for(var e=i.length-1;e>=0;e--)if(!Util.HasClass("popup-spinner",i[e].container)&&!Util.HasClass("popup-ad",i[e].container))return i.splice(e,1)[0]};var C=function(){if(Popup.spinnerDelay!==null){clearTimeout(Popup.spinnerDelay);Popup.spinnerDelay=null;return}var e=false;for(var t=i.length-1;t>=0;t--){if(Util.HasClass("popup-spinner",i[t].container)){i.splice(t,1)[0].remove();e=true}}if(e&&i.length===0){$.unsubscribe(s);$.unsubscribe(o);E()}};var S=function(){if(h>0){return}var e=false;for(var t=i.length-1;t>=0;t--){if(Util.HasClass("popup-ad",i[t].container)){i.splice(t,1)[0].remove();e=true}}if(e&&i.length===0){$.unsubscribe(s);$.unsubscribe(o);E()}};var x=function(){var e=b();if(e.hasMultiContent)e.flip()};var A=function(){if(App.isIE||App.iOSLessThanTenThree()||App.isAndroidNexus6Chrome51()){var e=b();if(e)e.center()}};var T=function(){return r+i.length};var I=function(){Util.AddClass("popup-open",document.body);$.publish("popup/open")};var E=function(){Util.RemoveClass("popup-open",document.body);$.publish("popup/done")};var P=function(e){if(typeof a[e]!=="string"){var t=document.getElementById(e);a[e]=t.innerHTML;Util.Remove(t)}return a[e]};var k=function(e){f=e;h=e;$(".popup-ad .popup-close").text(e);d=setInterval(M,1e3)};var M=function(){var e=$(".popup-ad .popup-close");if(h===1){h=0;clearInterval(d);m=true;e.html('<i class="mw mw-close"></i>')}else{e.text(--h)}};var D=function(){if(m){m=false;return true}return false};$.subscribe("popup/center",function(){$.publish("window/resize");A()});return{show:function(e,t,r,n,i){g(e,t,r,n,i)},hide:function(e){e=e===undefined?false:e;y(e)},hideAll:function(e){e=e===undefined?false:e;var t=true;y(e,t)},hideSpinner:C,hideAd:S,flip:function(){x()},center:function(){A()},onLoaded:function(e){c=e},doOnLoaded:function(e){if(c!==null){c();c=null}},active:function(){return i.length>0},startCloseCountdown:k,countdownDone:D,getCached:P,styles:e,buttons:t,transitionTimeout:n,spinnerDelay:null}}();var Accordion=function(e){var t=e.children();t.each(function(e,t){$(t).children().first().on("click",function(e){e.preventDefault();var t=$(this).parent();t.siblings(".on").removeClass("on").children().last().slideUp();t.toggleClass("on");t.children().last().slideToggle()})})};UI.alert=function(e,t){if(typeof e!=="undefined"){alert.call(window,e);if(typeof t==="function"){t.call(this)}}};UI.confirm=function(e,t){if(typeof e!=="undefined"){var r=confirm.call(window,e);if(typeof t==="function"){t.call(this,r)}}};var Pagination=function(){var e={};e.LeftArrow="«";e.RightArrow="»";e.Ellipses="…";e.Ranged=function(e,t){var r=2,n=null,i=e-r,a=e+r+1,o=[],s=[];for(var u=1;u<=t;u++){if(u===1||u===t||u>i&&u<a){o.push(u)}}for(var u=0,l=o.length;u<l;u++){if(n){if(o[u]-n===2){s.push(n+1)}else if(o[u]-n!==1){s.push(null)}}s.push(o[u]);n=o[u]}return s};return e}();Popup.Ad=function(){const e="mathway_300x250_300x600_160x600_300x100";var t=null;var r=false;var n=5;return{show:function(){if($(".popup-ad").length>0||App.isAffiliateWidget()){return}var t=this;var r='<div id="'+e+'"></div>';Popup.show(r,{style:Popup.styles.hybrid,isAd:true,title:Strings.Ad.Title,closeOnOverlay:true,closeCountdown:n},{beforeShow:function(){var e=document.querySelectorAll(".popup-container");Util.AddClass("popup-ad",e[e.length-1])},afterShow:function(){t.load()}})},load:function(){if(typeof freestar!=="undefined"){if(typeof freestar.newAdSlots==="function"){t=freestar.newAdSlots([{placementName:e,slotId:e}])}}Popup.startCloseCountdown(n)},hide:function(){Popup.hideAd()}}}();Popup.spinner=function(e){const t="spinner-template";var r=document.querySelector(".popup-spinner")!==null;var n=typeof e==="string";var i=function(){var t=document.getElementById("spinner-message");t.innerText=e;Util.AddClass("on",t)};if(r&&n){i();return}else if(r)return;Popup.spinnerDelay=setTimeout(function(){Popup.spinnerDelay=null;Popup.show(Popup.getCached(t),{closeOnOverlay:false,closeOnX:false,showX:false,padding:false},{beforeShow:function(){var e=document.querySelectorAll(".popup-container");Util.AddClass("popup-spinner",e[e.length-1]);if(n)i()}})},150)};Popup.showAndReload=function(e){this.show(e,{},{onOk:function(){Popup.hide()},beforeHide:function(){Util.reload()}})};Popup.showConfirm=function(e,t,r){this.show(e,{},{onOk:function(){if(typeof t==="function")t();Popup.hide()},onCancel:function(){if(typeof r==="function")r();Popup.hide()},onX:function(){if(typeof r==="function")r()}})};Popup.showYesNo=function(e,t,r){this.show(e,{},{onYes:function(){if(typeof t==="function")t();Popup.hide()},onNo:function(){if(typeof r==="function")r();Popup.hide()},onX:function(){if(typeof r==="function")r()}})};Popup.showModal=function(e,t){this.show(e,{showX:false,closeOnOverlay:false},{onOk:function(){Popup.hide()},afterHide:function(){if(typeof t==="function")t()}})};Popup.showError=function(e){this.show(e,{},{onOk:function(){Popup.hide()}})};Popup.showSignUp=function(e){e=Util.Extend({closeOnOverlay:true,closeOnX:true,state:"signup",onAuthUpgrade:false,onAuthUpgradeDelayed:false,onAuthReload:false,onX:function(){}},e||{});const t="signup-template";this.show(this.getCached(t),{style:this.styles.hybrid,closeOnX:e.closeOnX,closeOnOverlay:e.closeOnOverlay},{onX:e.onX,beforeShow:function(){$.publish("login/beforeShow",[e])},afterShow:function(){$.publish("login/afterShow")},beforeHide:function(){$.publish("login/beforeHide")}},"signinup-template")};Popup.showLogin=function(e){e=Util.Extend({closeOnOverlay:true,closeOnX:true,state:"signin",onAuthUpgrade:false,onAuthUpgradeDelayed:false,onAuthReload:false,onX:function(){}},e||{});const t="signin-template";this.show(this.getCached(t),{style:this.styles.hybrid,closeOnX:e.closeOnX,closeOnOverlay:e.closeOnOverlay},{onX:e.onX,beforeShow:function(){$.publish("login/beforeShow",[e])},afterShow:function(){$.publish("login/afterShow")},beforeHide:function(){$.publish("login/beforeHide")}},"signinup-template")};Popup.showViewSteps=function(e){const t="viewsteps-template";this.show(this.getCached(t),{title:e,style:Popup.styles.full,padding:false,margins:true,maxWidth:1e3},{beforeShow:function(){$.publish("viewsteps/beforeShow")}},t)};Popup.showUpgrade=function(e){const t="upgrade-template";var r=this;STM.update(function(){r.show(r.getCached(t),{style:r.styles.hybrid},{beforeShow:function(){$.publish("upgrade/beforeShow",[e])},beforeHide:function(){$.publish("upgrade/beforeHide")}},t)})};Popup.showUpgradeSuccess=function(e){const t="upgrade-success-template";var r=$("#settings-tab-container").length===1;this.show(Popup.getCached(t),{style:this.styles.collapse},{afterHide:function(){$.publish("app/subscribed");Popup.hideAll(true);if(typeof e==="function"){e()}if(r){Util.reload();return}},onOk:function(){Popup.hide()}},t)};Popup.showGlossary=function(e){const t="glossary-template";this.show(Popup.getCached(t),{},{beforeShow:function(){var t=$(".glossary-container:last");t.html(e);MathJax.Hub.Queue(["Typeset",MathJax.Hub,t[0],function(){Popup.center()}])}})};Popup.showLink=function(e){const t="link-template";this.show(Popup.getCached(t),{title:Strings.ViewSteps.LinkTitle},{beforeShow:function(){$.publish("problemLink/beforeShow",[e])},afterHide:function(){$.publish("problemLink/afterHide")}},t)};Popup.showForgotPassword=function(e){e=Util.Extend({security:false},e||{});const t="forgot-password-template";this.show(this.getCached(t),{},{beforeShow:function(){$.publish("forgotPassword/beforeShow",[e])},afterShow:function(){$.publish("forgotPassword/afterShow")}},t)};Popup.showTopics=function(){const e="topics-template";this.show(Popup.getCached(e),{title:Strings.Topics.Header,padding:false,maxWidth:525,maxHeight:324,secondary:"mw-examples"},{beforeShow:function(){$.publish("topics/beforeShow")},afterShow:function(){$.publish("topics/afterShow")},afterHide:function(){$.publish("topics/afterHide")},onSecondary:function(){Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"Topic Search",eventAction:"click",eventLabel:"from: topic dialog"});$.publish("topics/searchToggle")}},e)};Popup.showSuggestTopic=function(e,t,r){const n="suggest-topic-template";this.show(this.getCached(n),{title:Strings.Topics.SuggestHeader},{beforeShow:function(){$.publish("suggestTopic/beforeShow",[e,t,r])}},n)};Popup.showCancellationSurvey=function(){const e="cancellation-survey-template";this.show(this.getCached(e),{style:this.styles.hybrid},{beforeShow:function(){$.publish("cancellationSurvey/beforeShow")},afterHide:function(){Util.reload()}},e)};Popup.showAvatar=function(e){const t="avatar-template";this.show(this.getCached(t),{style:this.styles.hybrid,padding:false},{beforeShow:function(){$.publish("avatar/beforeShow",[e])},afterHide:function(){$.publish("avatar/afterHide")}},t)};Popup.showCamera=function(e){const t="camera-template";this.show(this.getCached(t),{style:this.styles.hybrid,padding:false},{beforeShow:function(){$.publish("camera/beforeShow",[e])},afterHide:function(){$.publish("camera/afterHide")}},t)};Popup.showImageCrop=function(e,t,r){const n="ocr-template";this.show(this.getCached(n),{style:Popup.styles.full,title:Strings.OCR.Title,padding:false,margins:true,maxWidth:1e3,showX:true,alternateStyle:true},{afterShow:function(){$.publish("ocr/afterShow",[e,t,r])},afterHide:function(){$.publish("ocr/afterHide")}},n)};Popup.showTutorInvite=function(e,t){const r="tutor-invite-template";var n="";switch(e.Source){case TutorInviteSource.StudentViewSteps:case TutorInviteSource.StudentBubble:n="CLASSROOM USER";break;case TutorInviteSource.TrialViewSteps:case TutorInviteSource.TrialBubble:n="FREE TRIAL";break;case TutorInviteSource.CreditsBubble:case TutorInviteSource.CreditsViewSteps:n="1 CREDIT";break}this.show(this.getCached(r),{title:n,closeOnOverlay:!t,showX:!t},{beforeShow:function(){$.publish("tutorInvite/beforeShow",[e])}},r)};Popup.showRateTutor=function(e){const t="rate-tutor-template";var r=DtoHelper.RatingRequest(e);this.show(this.getCached(t),{title:Strings.Tutor.RateTitle,showX:true,closeOnOverlay:false},{beforeShow:function(){$.publish("rateTutor/beforeShow",[r])}},t)};Popup.showGraph=function(e){const t="graph-template";this.show(this.getCached(t),{style:this.styles.full,margins:true,padding:false},{beforeShow:function(){$.publish("graph/beforeShow",[e])},afterHide:function(){$.publish("graph/afterHide",[e])}},t)};Popup.showRateSolution=function(e){const t="rate-solution-template";this.show(this.getCached(t),{title:Strings.Chat.RateSolutionTitle},{beforeShow:function(){$.publish("rateSolution/beforeShow",[e])},afterHide:function(){$.publish("rateSolution/afterHide")}},t)};Popup.showMatrix=function(){const e="matrix-template";this.show(this.getCached(e),{},{beforeShow:function(){$.publish("matrix/beforeShow")}},e)};Popup.showTrig=function(){const e="trig-template";this.show(this.getCached(e),{showX:false,padding:false},{beforeShow:function(){$.publish("trig/beforeShow")}},e)};Popup.showPeriodicTable=function(){const e="periodic-table-template";this.show(this.getCached(e),{},{beforeShow:function(){$.publish("periodicTable/beforeShow")}},e)};Popup.showTutorLearnMore=function(){const e="tutor-learn-more-template";this.show(this.getCached(e),{},{onOk:function(){Popup.hide()},afterShow:function(){var e=$("#learn-more-video");var t=parseInt(e.attr("width"));var r=e.parent().width();if(t>r){e.attr({width:r,height:r*.5625})}}},e)};Popup.showTutorPreSession=function(e,t,r){const n="tutor-pre-session-template";if(e&&ExpertQA.CurrentPending>0){$.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:ExpertQA.QuestionLimitString(),testContext:BubbleContext.ExpertQA})]},{commitMessages:true}]);return}else if(Tutor.inChatRoom()){return}this.show(this.getCached(n),{style:App.isIpad?Popup.styles.full:Popup.styles.hybrid,title:e?Strings.ExpertQA.PreSessionTitle:Strings.Tutor.PreSessionTitle,padding:false},{beforeShow:function(){$.publish("tutorPreSession/beforeShow",[e,t,r])},beforeHide:function(){$.publish("tutorPreSession/beforeHide")}},n)};Popup.showCancelConfirm=function(e){const t="cancel-confirm-1-template";const r="cancel-confirm-2-template";this.show([this.getCached(t),this.getCached(r)],{style:this.styles.hybrid},{beforeShow:function(){$.publish("cancelconfirm/beforeShow",[e])}},"cancel-confirm-template")};Popup.showAddStudent=function(e){const t="add-student-template";this.show(this.getCached(t),{style:Popup.styles.hybrid},{beforeShow:function(){$.publish("addStudent/beforeShow",[e])}},t)};Popup.showManageClassroom=function(e,t){const r="manage-classroom-template";this.show(this.getCached(r),{style:Popup.styles.hybrid},{beforeShow:function(){$.publish("manageClassroom/beforeShow",[e,t])}},r)};Popup.showAddClassroom=function(e){const t="add-classroom-template";this.show(this.getCached(t),{style:Popup.styles.hybrid},{beforeShow:function(){$.publish("addClassroom/beforeShow",[e])}},t)};Popup.showCreditConsume=function(e){this.show(Strings.Tutor.ConsumeUserCredit,{style:this.styles.hybrid,showX:false,closeOnX:false,closeOnOverlay:false,showX:false},{onYes:function(){e();Popup.hide()},onNo:function(){e(CreditTransactionType.Acquired);Popup.hide()}},"show-credit-consume")};Popup.showPauseAsk=function(){const e="pause-ask-template";this.show(this.getCached(e),{style:this.styles.hybrid,closeOnX:true,closeOnOverlay:true},{beforeShow:function(){$.publish("pauseAsk/beforeShow")},beforeHide:function(){Util.reload()}},e)};Popup.showSurveyText=function(e){const t="survey-text-template";this.show(this.getCached(t),{},{beforeShow:function(){$.publish("surveyText/beforeShow",[e])},afterShow:function(){$.publish("surveyText/afterShow")},afterHide:function(){$.publish("surveyText/afterHide")}},t)};Popup.showAskExperts=function(e){if(Tutor.inChatRoom())return;const t="ask-experts-template";this.show(Popup.getCached(t),{title:Strings.ExpertQA.Title,style:Popup.styles.hybrid,padding:true},{beforeShow:function(){$.publish("askExperts/beforeShow",[e])},beforeHide:function(){$.publish("askExperts/beforeHide")}},t)};Popup.showTutorVideo=function(){const e="tutor-video-template";this.show(Popup.getCached(e),{},{beforeShow:function(){$.publish("tutorVideo/beforeShow")},afterHide:function(){$.publish("tutorVideo/afterHide")}},e)};Popup.showExpertVideo=function(){const e="expert-video-template";this.show(Popup.getCached(e),{},{beforeShow:function(){$.publish("expertVideo/beforeShow")},afterHide:function(){$.publish("expertVideo/afterHide")}},e)};Popup.showSetPassword=function(e){const t="set-password-template";this.show(this.getCached(t),{showX:false,closeOnOverlay:false},{beforeShow:function(){$.publish("setPassword/beforeShow",[e])},afterShow:function(){$.publish("setPassword/afterShow")},afterHide:function(){$.publish("setPassword/afterHide")}},t)};Popup.showPasswordOutdated=function(){this.show(Strings.Errors.PasswordOutdated,{},{onOk:function(){Popup.hide()},afterHide:function(){var e=!App.Culture.isEnglish()?"/"+App.Culture.current.substring(0,2):"";Util.Redirect(e+"/settings#password")}})};Popup.Layer=function(e,t,r,n,i){const a=50;this.domDelay=a;this.options=t;this.handlers=r;this.uniqueId=i;var o=t.margins?" popup-margins":"";this.container=document.createElement("div");this.container.className="popup-container "+t.style+o;this.container.style.zIndex=++n;this.hasMultiContent=false;if(Array.isArray(e))this.hasMultiContent=e.length>1;e=Array.isArray(e)?e:[e];for(var s=0;s<e.length;s++){var u=e[s];var l=document.createElement("div");l.className="popup-wrap";if(t.maxWidth>0){l.style.maxWidth=t.maxWidth+"px";l.className+=" popup-max-width"}this.titleBar=null;if(t.title!==""){this.titleBar=document.createElement("div");this.titleBar.className="popup-title";this.titleBar.innerHTML=t.title;l.appendChild(this.titleBar)}var c=document.createElement("div");c.className="popup-pad";if(t.padding===false){Util.AddClass("popup-no-padding",this.container)}var p=document.createElement("div");p.className="popup-content";var d=typeof u;if(d==="string")p.innerHTML=u;else p.appendChild(u);c.appendChild(p);l.appendChild(c);if(t.secondary!==null&&t.secondary!==undefined){var f=document.createElement("div");f.className="popup-secondary";var h=document.createElement("i");h.className="mw "+t.secondary;f.appendChild(h);f.addEventListener("click",function(){r.onSecondary()});if(this.titleBar!==null)this.titleBar.appendChild(f);else l.appendChild(f)}if(t.closeCountdown>0){t.showX=true}if(t.showX===true){var m=document.createElement("div");m.className="popup-close";if(t.closeCountdown>0){m.innerText=t.closeCountdown}else{var g=document.createElement("i");g.className="mw mw-close";m.appendChild(g)}if(this.titleBar!==null)this.titleBar.appendChild(m);else l.appendChild(m)}if(t.alternateStyle===true){Util.AddClass("popup-alternate",this.container)}if(this.hasButtons()){var v=document.createElement("div");v.className="popup-buttons";if(this.handlers.onOk!==null){v.appendChild(this.createButton(Popup.buttons.ok,this.handlers.onOk))}if(this.handlers.onYes!==null){v.appendChild(this.createButton(Popup.buttons.yes,this.handlers.onYes))}if(this.handlers.onNo!==null){v.appendChild(this.createButton(Popup.buttons.no,this.handlers.onNo))}if(this.handlers.onCancel!==null){v.appendChild(this.createButton(Popup.buttons.cancel,this.handlers.onCancel))}Util.AddClass("popup-has-buttons",this.container);p.appendChild(v)}this.container.appendChild(l)}};Popup.Layer.prototype={clicked:function(e,t){var r=e.target,n=$(r).closest(".popup-ad").length>0;var i=Util.HasClassInDom("popup-close",r);var a=r===this.container;if(this.options.closeCountdown>0&&!Popup.countdownDone()){return}if(i){this.handlers.onX();if(this.options.closeOnX){if(n){Popup.hideAd()}else{Popup.hide()}}}else if(a&&this.options.closeOnOverlay&&t){if(n){Popup.hideAd()}else{Popup.hide()}}},show:function(){document.body.appendChild(this.container);if(this.hasMultiContent)Util.AddClass("popup-flip",this.container);Popup.center();this.handlers.beforeShow();var e=this;setTimeout(function(){Util.AddClass("popup-on",e.container);setTimeout(function(){Popup.center();e.handlers.afterShow();Popup.doOnLoaded()},Popup.transitionTimeout)},this.domDelay)},hide:function(){var e=this;e.handlers.beforeHide();Util.RemoveClass("popup-on",e.container);setTimeout(function(){e.remove();e.handlers.afterHide()},Popup.transitionTimeout)},flip:function(){if(Util.HasClass("popup-flipped",this.container))Util.RemoveClass("popup-flipped",this.container);else Util.AddClass("popup-flipped",this.container)},remove:function(){Util.Remove(this.container)},hasButtons:function(){return this.handlers.onOk!==null||this.handlers.onYes!==null||this.handlers.onNo!==null||this.handlers.onCancel!==null},createButton:function(e,t){var r=document.createElement("button");switch(e){case Popup.buttons.ok:r.className=e+" btn-primary";r.innerHTML=Strings.General.Ok;break;case Popup.buttons.yes:r.className=e+" btn-primary";r.innerHTML=Strings.General.Yes;break;case Popup.buttons.no:r.className=e+" btn-secondary";r.innerHTML=Strings.General.No;break;case Popup.buttons.cancel:r.className=e+" btn-secondary";r.innerHTML=Strings.General.Cancel;break}r.addEventListener("click",function(e){e.preventDefault();t()});return r},center:function(){var e=this.options.style===Popup.styles.collapse,t=this.options.style===Popup.styles.hybrid,r=this.options.style===Popup.styles.full;var n=this.container.querySelectorAll(".popup-wrap");for(var i=0;i<n.length;i++){var a=n[i];topPad=a.style.paddingTop===""?0:parseInt(a.style.paddingTop),bottomPad=a.style.paddingBottom===""?0:parseInt(a.style.paddingBottom);var o=document.querySelector(".popup-style-full .popup-wrap.popup-max-width")!==null;if(e||t||App.isIE&&o){var s=a.style.paddingLeft===""?0:parseInt(a.style.paddingLeft);var u=a.style.paddingRight===""?0:parseInt(a.style.paddingRight);var l=a.clientWidth+s+u;var c=Math.floor((App.Screen.width-l)/2);a.style.left=c+"px"}if(e||t&&App.Screen.width>550){var p=a.clientHeight+topPad+bottomPad;var d=Math.floor((App.Screen.height-p)/2);a.style.top=d+"px"}}}};UI.buildSpinnerDOM=function(){if(App.isModern){return $("<div></div>").addClass("spinner").append($("<div></div>").addClass("bounce1")).append($("<div></div>").addClass("bounce2")).append($("<div></div>").addClass("bounce3"))}else{return $("<div></div>").addClass("spinner").append($("<div></div>").addClass("bounce1").velocity({opacity:1},{duration:640,loop:true}).velocity("reverse")).append($("<div></div>").addClass("bounce2").delay(160).velocity({opacity:1},{duration:640,loop:true}).velocity("reverse")).append($("<div></div>").addClass("bounce3").delay(160).velocity({opacity:1},{duration:640,loop:true}).velocity("reverse"))}};var Tabset=function(e,t){this.ele=e;this.tabs=[];this.callback=t};Tabset.prototype.add=function(e){e.parent=this;this.tabs.push(e)};Tabset.prototype.switchTo=function(e){for(var t=0,r=this.tabs.length;t<r;t++){var n=this.ele.querySelector(".mw-single-tab[data-tab-id='"+this.tabs[t].getId()+"']");if(this.tabs[t].getId()===e){this.tabs[t].activate();Util.AddClass("mw-active",n)}else{this.tabs[t].deactivate();Util.RemoveClass("mw-active",n)}}if(typeof this.callback==="function"){this.callback.call(this,e)}};var Tab=function(e,t){this.ele=e;this.callback=t;this.parent=null;var r=this;this.ele.addEventListener("click",function(e){e.preventDefault();r.parent.switchTo(r.getId());if(typeof r.callback==="function"){r.callback.call(this)}})};Tab.prototype.getId=function(){return this.ele.getAttribute("data-tab-id")};Tab.prototype.activate=function(){Util.AddClass("mw-active",this.ele)};Tab.prototype.deactivate=function(){Util.RemoveClass("mw-active",this.ele)};var STM=function(e,t,r){var n=e.get();var i=0;if(n!==null)i=typeof n.testVarientId!=="undefined"?n.testVarientId:n.testVariantId;this.storage=e;this.id=t;this.variantId=i;this.value=null;this.value2=null;this.value3=null;this.value4=null;this.value5=null;this.value6=null;this.value7=null;this.value8=null;this.value9=null;this.enabledFunc=r};STM.prototype={enabled:function(){if(typeof this.enabledFunc!=="function")return false;return this.enabledFunc(this.value)},set:function(e){this.variantId=e.testVariantId;if(typeof e.value!=="undefined")this.value=e.value;if(typeof e.value2!=="undefined")this.value2=e.value2;if(typeof e.value3!=="undefined")this.value3=e.value3;if(typeof e.value4!=="undefined")this.value4=e.value4;if(typeof e.value5!=="undefined")this.value5=e.value5;if(typeof e.value6!=="undefined")this.value6=e.value6;if(typeof e.value7!=="undefined")this.value7=e.value7;if(typeof e.value8!=="undefined")this.value8=e.value8;if(typeof e.value9!=="undefined")this.value9=e.value9;this.storage.set({testId:e.testId,testVariantId:e.testVariantId})},get:function(e){e=typeof e==="undefined"?false:e;if(e){var t=this.storage.get();this.id=t.testId;this.variantId=t.testVariantId}return{testId:this.id,testVariantId:this.variantId}}};STM.getActiveData=function(){var e=[];STM.ActiveTests.forEach(function(t){e.push({testId:t.id,variantId:t.get()===null?0:t.variantId})});return e};STM.getLogData=function(){var e=[];STM.LogTests.forEach(function(t){if(t.get()!==null){e.push({testId:t.id,variantId:t.variantId})}});return e};STM.getValuesForChatbot=function(){var e={};STM.ActiveTests.forEach(function(t){if(t.id===1)return;var r=t.id.toString();var n=t.get()===null?"":t.value;e[r]=n});return e};STM.update=function(e){if(STM.ActiveTests.length===0){if(typeof e==="function")e();return}var t=function(t){if(t.status===ResponseStatuses.Success){t.tests.forEach(function(e){STM.ActiveTests.forEach(function(t){if(t.id===e.testId){t.set(e)}})})}if(typeof e==="function")e()};if(!Auth.isLoggedIn()){API.getValuesForSplitTestsAnonymous(STM.getActiveData(),t)}else{API.getValuesForSplitTests(STM.getActiveData(),t)}};Scheduler.Add({label:"Get values for split tests",priority:0,evalFn:function(){return true},execFn:function(){if(App.IsApps||$(".settings-page.poc").length>0){$.publish("Scheduler/Next");return}STM.update(function(){$.publish("splitTest/update");$.publish("Scheduler/Next")})}});STM.Tests={Plans:new STM(WebStorage.recurlyTest,1),TutorCheck:new STM(WebStorage.tutoringCheckTest,4),TutorFrame:new STM(WebStorage.tutoringFrameTest,5),SimpleUpgrade:new STM(WebStorage.simpleUpgradeTest,7),UpgradeAfter:new STM(WebStorage.upgradeAfterTest,6),DelayedSignUp:new STM(WebStorage.delayedSignUpTest,9,function(e){return e==="delayed sign-up"}),AltAnnualPrice:new STM(WebStorage.altAnnualPriceTest,11),ShowTotalPrice:new STM(WebStorage.showTotalPriceTest,16,function(e){return e==="on"}),OneOffPurchase:new STM(WebStorage.oneOffPurchaseTest,13,function(e){return e==="on"&&!Auth.hasRole(UserRoles.TutoringAccess)}),Quarterly:new STM(WebStorage.quarterlyTest,12,function(e){if(Auth.isLoggedIn()){if(Auth.userstate.MWSubscriptionType===SubType.Yearly)return false}return e==="on"}),UpgradeGuarantee:new STM(WebStorage.upgradeGuarantee,22,function(e){return e==="on"}),CreditPackPurchase:new STM(WebStorage.creditPackPurchasing,18,function(e){return e==="on"&&!Auth.hasRole(UserRoles.TutoringAccess)}),AnonymousPurchasing:new STM(WebStorage.anonPurchasing,29,function(e){return e==="on"}),CheggStaticAds:new STM(WebStorage.staticAdsTest,33,function(e){return e!=="chat-only"})};STM.ActiveTests=[STM.Tests.Plans,STM.Tests.OneOffPurchase,STM.Tests.Quarterly,STM.Tests.UpgradeGuarantee,STM.Tests.CreditPackPurchase,STM.Tests.AnonymousPurchasing,STM.Tests.CheggStaticAds];STM.LogTests=[STM.Tests.Plans,STM.Tests.OneOffPurchase,STM.Tests.Quarterly,STM.Tests.UpgradeGuarantee,STM.Tests.CreditPackPurchase,STM.Tests.AnonymousPurchasing,STM.Tests.CheggStaticAds];var Head=function(e,t){this.next=this;this.prev=this;this.parent=e;if(Array.isArray(t)){for(var r=0;r<t.length;r++){var n=t[r];if(typeof n==="string"){n=new Character(n)}this.Push(n)}}};Head.prototype.CloneRange=function(e,t){var r=new Head;if(IsNull(e)||e instanceof Head){e=this.First()}if(IsNull(t)){t=this}if(e===t){return r}var n=e;do{r.Push(n.Clone());n=n.next}while(n!==t&&!(n instanceof Head));return r};Head.prototype.Clone=function(){return this.CloneRange()};Head.prototype.CheckIntegrity=function(){if(this.next===this&&this.prev===this){return true}var e=false;var t=this;var r=this.next;while(!(r instanceof Head)&&t!==r){if(IsGrouper(r)){var n=GetGrouperChildren(r);for(var i=0;i<n.length;i++){var a=n[i];if(a.parent!==r){return"Bad parent"}var o=a.CheckIntegrity();if(!o){return o}}}if(r.prev.next!==r){return"Bad prev"}if(e){t=t.next}e=!e;r=r.next}if(r===this){return true}if(t===r){return"Loop detected"}return"Two heads"};Head.prototype.Push=function(e){AddBefore(this,e);return this};Head.prototype.Unshift=function(e){AddAfter(this,e);return this};Head.prototype.Last=function(){return this.prev};Head.prototype.First=function(){return this.next};Head.prototype.ToArray=function(e){var t=[];var r=this;while(r!==this.Last()){t.push(r);if(e)r=r.next;else r=MoveCursorRight(r)}t.push(r);return t};Head.prototype.SetIds=function(e){if(IsNull(e)){e="elem"}var t=this.ToArray();for(var r=0;r<t.length;r++){t[r].id=e+r.toString()}return t};Head.prototype.IsEmpty=function(){return this.next===this&&this.prev===this};Head.prototype.Delete=function(){if(IsNull(this.parent))return this;else if(IsGrouper(this.parent))return this.parent.Delete(this);throw"Deleting head with unknown parent."};Head.prototype.Any=function(){return this.next!==this};Head.prototype.RightMostInLine=function(e){var t=GetChildInRoot(e);while(t.next!==this&&!Character.IsNewLine(t.next)){t=t.next}return t};Head.prototype.LeftMostInLine=function(e){var t=GetChildInRoot(e);while(t.prev!==this.Last()&&!Character.IsNewLine(t)){t=t.prev}return t};Head.prototype.Between=function(e,t){if(e===t)return[t];var r=[];var n=this.next;if(e!==this){while(!(n instanceof Head)&&n!==e)n=n.next}if(n instanceof Head)return[];while(!(n instanceof Head)&&n!==t){r.push(n);n=n.next}r.push(t);if(n!==t)throw"Found nodeA but not nodeB in Head.Between";return r};Head.prototype.IsABeforeB=function(e,t){var r=this.next;if(e===t){return false}if(e===this)return true;else if(t===this)return false;while(!(r instanceof Head)){if(r===e)return true;else if(r===t)return false;r=r.next}throw"Neither A or B found in Head.IsABeforeB"};Head.prototype.IsMultiLine=function(){return this.FindChar(NewLine)!==this};Head.prototype.Contains=function(e){if(e===this)return true;var t=this.next;while(t!==this){if(t===e)return true;t=t.next}return false};Head.prototype.FindChar=function(e){var t=this.next;while(!(t instanceof Head)&&!(t.value===e)){t=t.next}return t};Head.prototype.Splice=function(e,t){var r=this.Last();var n=e.prev;var i=IsNull(t)?this:t.next;n.next=i;i.prev=n;var a=new Head;a.next=e;a.prev=IsNull(t)?r:t;e.prev=a;if(IsNull(t))r.next=a;else t.next=a;return a};Head.prototype.Split=function(e,t){var r=[];r.push(new Head);var n=0;var i=this.next;while(!(i instanceof Head)){var a=i.next;if(t&&Character.IsOpenParen(i)){n++}else if(t&&Character.IsCloseParen(i)){n--}if(n===0&&i.value===e){r.push(new Head)}else{r[r.length-1].Push(i)}i=a}return r};Head.prototype.Clear=function(){this.next=this;this.prev=this};Head.prototype.ForEach=function(e){var t=this.next;while(t!==this){if(e(t)===false)return;t=t.next}};function GetHead(e){while(e!==null){if(e instanceof Head){return e}else e=e.next;
}return null}function AddAfter(e,t){if(IsNull(e)||IsNull(t))return false;if(typeof t==="string")t=new Character(t);var r=t;if(t instanceof Head){r=t.Last();if(r===t){return true}t=t.next}var n=e.next;e.next=t;t.prev=e;n.prev=r;r.next=n;return true}function AddBefore(e,t){if(IsNull(e)||IsNull(t))return false;if(typeof t==="string")t=new Character(t);if(Array.isArray(t)){for(var r=0;r<t.length;r++){AddBefore(e,t[r])}return true}var n=t;if(t instanceof Head){n=t.Last();if(n===t){return true}t=t.next}var i=e.prev;e.prev=n;n.next=e;i.next=t;t.prev=i;return true}function IsNull(e){return IsUndefined(e)||e===null}function IsUndefined(e){return typeof e==="undefined"}var Subject={ALGEBRA:{str:"algebra"},BASICMATH:{str:"basicmath"},CALCULUS:{str:"calculus"},CHEMISTRY:{str:"chemistry"},FINITEMATH:{str:"finitemath"},LINEARALGEBRA:{str:"linearalgebra"},PREALGEBRA:{str:"prealgebra"},PRECALCULUS:{str:"precalculus"},STATISTICS:{str:"statistics"},TRIGONOMETRY:{str:"trigonometry"},FromString:function(e){if(!IsNull(e))for(var t in this)if(this.hasOwnProperty(t)&&this[t].str===e.toLowerCase().replace(/-/g,"").replace(/ /g,""))return this[t];return Subject.ALGEBRA}};function MakeHead(e,t){if(IsNull(t)){t=[]}if(typeof t==="string"){t=[t]}if(Array.isArray(t)){return new Head(e,t)}return t}var Character=function(e,t){this.value=e;this.grey=false;if(!IsNull(t)){this.grey=t}};Character.prototype.Clone=function(){return new Character(this.value,this.grey)};Character.DecimalSeparator=".";var otherLetters=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","∞","x̄"];var NewlineString="↵";Character.IsDigit=function(e){if(!IsNull(e.value)){e=e.value}return e==="0"||e==="1"||e==="2"||e==="3"||e==="4"||e==="5"||e==="6"||e==="7"||e==="8"||e==="9"};Character.prototype.IsDigit=function(){return Character.IsDigit(this.value)};Character.IsLetter=function(e){if(!IsNull(e.value)){e=e.value}return typeof e==="string"&&e.length===1&&(e[0]>="a"&&e[0]<="z"||e[0]>="A"&&e[0]<="Z")};Character.prototype.IsLetter=function(){return Character.IsLetter(this.value)};Character.IsDecimalSeparator=function(e){if(!IsNull(e.value)){e=e.value}return e===Character.DecimalSeparator};Character.IsOperator=function(e){if(!IsNull(e.value)){e=e.value}return e==="*"||e==="×"||e==="÷"||e==="+"||e==="-"||e==="∩"||e==="∪"||e==="="||e==="<"||e===">"||e==="≤"||e==="≥"||e==="≠"||e==="→"||e==="°"||e==="'"||e==='"'||e==="%"||e===","||e==="?"||e==="."||e==="/"||e==="_"||e==="^"||e==="±"||e==="∠"||e==="⊙"||e==="△"||e==="□"||e==="≅"||e==="∥"||e==="⟂"};Character.prototype.IsOperator=function(){return Character.IsOperator(this.value)};Character.IsFactorial=function(e){if(!IsNull(e.value)){e=e.value}return e==="!"};Character.prototype.IsFactorial=function(){return Character.IsFactorial(this.value)};Character.IsSymbol=function(e){if(!IsNull(e.value)){e=e.value}return e===":"||e==="~"||e==="@"||e==="#"||e==="$"||e==="&"||e===";"};Character.prototype.IsSymbol=function(){return Character.IsSymbol(this.value)};Character.IsInequality=function(e){if(!IsNull(e.value)){e=e.value}return e==="<"||e==="≤"||e===">"||e==="≥"||e==="≠"};Character.prototype.IsInequality=function(e){return Character.IsInequality(this.value)};Character.IsAbs=function(e){if(!IsNull(e.value)){e=e.value}return e==="|"};Character.IsParen=function(e){if(!IsNull(e.value)){e=e.value}return Character.IsOpenParen(e)||Character.IsCloseParen(e)||Character.IsAbs(e)};Character.IsOpenParen=function(e){if(!IsNull(e.value)){e=e.value}return e==="("||e==="["||e==="{"};Character.IsCloseParen=function(e){if(!IsNull(e.value)){e=e.value}return e===")"||e==="]"||e==="}"};Character.IsShape=function(e){if(!IsNull(e.value)){e=e.value}return ShapeType.FromCharacter(e)!==null};Character.prototype.IsShape=function(){return Character.IsShape(this.value)};Character.IsSpace=function(e){if(!IsNull(e.value)){e=e.value}return e===" "||e==="	"};Character.prototype.IsSpace=function(){return Character.IsSpace(this.value)};Character.IsIdentifier=function(e){if(!IsNull(e.value)){e=e.value}return Character.IsLetter(e)||otherLetters.indexOf(e)>=0};Character.prototype.IsIdentifier=function(){return Character.IsIdentifier(this.value)};Character.IsNewLine=function(e){if(!IsNull(e)&&!IsNull(e.value)){e=e.value}return e===NewlineString};Character.prototype.IsNewLine=function(){return Character.IsNewLine(this.value)};Character.IsComma=function(e){if(!IsNull(e)&&!IsNull(e.value)){e=e.value}return e===","};Character.IsNormalizeSafe=function(e){if(!IsNull(e)&&!IsNull(e.value)){e=e.value}return Character.IsDigit(e)||Character.IsIdentifier(e)||Character.IsSpace(e)||Character.IsComma(e)||e==="."||e==="-"};Character.IsHighSurrogate=function(e){if(!IsNull(e)&&!IsNull(e.value)){e=e.value}return typeof e==="string"&&/^[\ud800-\udbff]$/.test(e)};Character.IsLowSurrogate=function(e){if(!IsNull(e)&&!IsNull(e.value)){e=e.value}return typeof e==="string"&&/^[\udc00-\udfff]$/.test(e)};var TrigLog=function(e){this.value=e};TrigLog.prototype.Clone=function(){return new TrigLog(this.value)};var Placeholder=function(){};Placeholder.prototype.Clone=function(){return new Placeholder};var Fraction=function(e,t){this.numerator=MakeHead(this,e);this.numerator.parent=this;this.denominator=MakeHead(this,t);this.denominator.parent=this};Fraction.prototype.Clone=function(){return new Fraction(this.numerator.Clone(),this.denominator.Clone())};Fraction.IsPulled=function(e){if(e instanceof Character){return Character.IsLetter(e)||Character.IsDigit(e)||Character.IsDecimalSeparator(e)}return e instanceof Superscript||e instanceof Subscript};Fraction.prototype.IsEmpty=function(){return!this.numerator.Any()&&!this.denominator.Any()};var Superscript=function(e){this.contents=MakeHead(this,e);this.contents.parent=this};Superscript.prototype.Clone=function(){return new Superscript(this.contents.Clone())};var Subscript=function(e){this.contents=MakeHead(this,e);this.contents.parent=this};Subscript.prototype.Clone=function(){return new Subscript(this.contents.Clone())};var Accent=function(e,t){this.contents=MakeHead(this,e);this.contents.parent=this;this.accent=t};Accent.types={"\\overline":"&#x2c9;","\\overrightarrow":"&#x2192;","\\overleftrightarrow":"&#x2194;","\\overfrown":"&#x23dc;"};Accent.prototype.Clone=function(){return new Accent(this.contents.Clone(),this.accent)};Accent.prototype.IsEmpty=function(){return!this.contents.Any()};var Limit=function(e){this.contents=MakeHead(this,e);this.contents.parent=this};Limit.prototype.Clone=function(){return new Limit(this.contents.Clone())};Limit.prototype.IsEmpty=function(){if(this.contents.IsEmpty())return true;if(this.contents.next instanceof Character&&this.contents.next.value==="→")return this.contents.next.next===this.contents;return this.contents.next instanceof Placeholder&&(this.contents.next.next instanceof Character&&this.contents.next.next.value==="→")&&this.contents.next.next.next instanceof Placeholder&&this.contents.next.next.next.next===this.contents};var Integral=function(e,t,r){this.lowerBound=MakeHead(this,e);this.lowerBound.parent=this;this.upperBound=MakeHead(this,t);this.upperBound.parent=this;this.placeholders=r};Integral.prototype.Clone=function(){return new Integral(this.lowerBound.Clone(),this.upperBound.Clone(),this.placeholders)};var Summation=function(e,t){this.lowerBound=MakeHead(this,e);this.lowerBound.parent=this;this.upperBound=MakeHead(this,t);this.upperBound.parent=this;this.placeholders=true};Summation.prototype.Clone=function(){return new Summation(this.lowerBound.Clone(),this.upperBound.Clone())};Integral.prototype.IsEmpty=Summation.prototype.IsEmpty=function(){return this.upperBound.IsEmpty()&&this.lowerBound.IsEmpty()};var Radical=function(e,t,r){this.index=MakeHead(this,e);this.index.parent=this;this.radicand=MakeHead(this,t);this.radicand.parent=this;this.placeholders=r};Radical.prototype.Clone=function(){return new Radical(this.index.Clone(),this.radicand.Clone())};Radical.prototype.HasIndex=function(){return this.index.next!==this.index};Radical.IsPulled=Fraction.IsPulled;Radical.prototype.IsEmpty=function(){return this.radicand.IsEmpty()};var PermComb=function(e,t,r){this.letter=e;this.left=MakeHead(this,t);this.left.parent=this;this.right=MakeHead(this,r);this.right.parent=this};PermComb.prototype.Clone=function(){return new PermComb(this.letter,this.left.Clone(),this.right.Clone())};PermComb.prototype.IsEmpty=function(){return this.left.IsEmpty()&&this.right.IsEmpty()};var Table=function(e,t){this.children=[];e=MakeHead(this,e);this.children.push(e);e.parent=this;t=MakeHead(this,t);this.children.push(t);t.parent=this;for(var r=0;r<6;r++){this.children.push(new Head(this))}};Table.prototype.Clone=function(){var e=new Table;e.children=[];for(var t=0;t<this.children.length;t++){e.children[t]=this.children[t].Clone();e.children[t].parent=e}return e};var Matrix=function(e,t){this.children=[];this.numRows=e;this.numCols=t;for(var r=0;r<e;r++){for(var n=0;n<t;n++){this.children.push(new Head(this))}}};Matrix.prototype.Clone=function(){var e=new Matrix(this.numRows,this.numCols);for(var t=0;t<this.children.length;t++){e.children[t]=this.children[t].Clone();e.children[t].parent=e}return e};Matrix.prototype.Cell=function(e,t){return this.children[e*this.numCols+t]};var Piecewise=function(e){if(IsNull(e))e=2;this.children=[];for(var t=0;t<e;t++){this.children.push(new Head(this))}};Piecewise.prototype.Clone=function(){var e=new Piecewise(0);for(var t=0;t<this.children.length;t++){var r=this.children[t].Clone();e.children.push(r);r.parent=e}return e};var ShapeTable=function(e){this.type=ShapeType.FromString(e);this.labels=[];this.children=[];for(var t=0;t<this.type.labels.length;t++){var r=this.type.labels[t];if((t===0||t===1)&&this.type===ShapeType.TRAPEZOID){r[1]=new Subscript(new Head(null,[""+(t+1)]))}this.labels.push(new Head(this,r));this.children.push(new Head(this))}};ShapeTable.prototype.Clone=function(){var e=new ShapeTable(this.type.type);for(var t=0;t<this.children.length;t++){e.children[t]=this.children[t].Clone();e.children[t].parent=e}return e};var ShapeType={RECTANGLE:{type:"rectangle","char":"&#xF127;",width:4.09375,labels:[["l","="],["w","="]]},CIRCLE:{type:"circle","char":"&#xF126;",width:3.6875,labels:[["r","="]]},TRIANGLE:{type:"triangle","char":"&#xF130;",width:3.5625,labels:[["h","="],["b","="]]},PARALLELOGRAM:{type:"parallelogram","char":"&#xF128;",width:4.96875,labels:[["h","="],["b","="]]},TRAPEZOID:{type:"trapezoid","char":"&#xF129;",width:3.125,labels:[["b","_1","="],["b","_2","="],["h","="]]},BOX:{type:"box","char":"&#xF131;",width:4.34375,labels:[["h","="],["l","="],["w","="]]},SPHERE:{type:"sphere","char":"&#xF135;",width:4.625,labels:[["r","="]]},CONE:{type:"cone","char":"&#xF132;",width:3.625,labels:[["h","="],["r","="]]},CYLINDER:{type:"cylinder","char":"&#xF133;",width:3.65625,labels:[["h","="],["r","="]]},PYRAMID:{type:"pyramid","char":"&#xF134;",width:4.9375,labels:[["h","="],["l","="],["w","="]]},TRI:{type:"tri","char":"&#xF140;",width:4,labels:[["b","="],["A","="],["c","="],["B","="],["a","="],["C","="]]},FromCharacter:function(e){for(var t in this)if(this.hasOwnProperty(t)&&typeof this[t]!=="function"&&this[t].char===e)return this[t];return null},FromString:function(e){for(var t in this)if(this.hasOwnProperty(t)&&typeof this[t]!=="function"&&this[t].type===e.toLowerCase())return this[t];return null},FromCharString:function(e){for(var t in this)if(this.hasOwnProperty(t)&&typeof this[t]!=="function"&&this[t].char.toLowerCase()===e.toLowerCase())return this[t];return null},GetCharacter:function(e){return new Character(this.FromString(e).char)}};Character.prototype.RemoveHighlight=TrigLog.prototype.RemoveHighlight=Placeholder.prototype.RemoveHighlight=function(){RemoveHighlight(this)};Fraction.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.numerator.RemoveHighlight();this.denominator.RemoveHighlight()};Integral.prototype.RemoveHighlight=Summation.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.lowerBound.RemoveHighlight();this.upperBound.RemoveHighlight()};Radical.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.index.RemoveHighlight();this.radicand.RemoveHighlight()};PermComb.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.left.RemoveHighlight();this.right.RemoveHighlight()};Superscript.prototype.RemoveHighlight=Subscript.prototype.RemoveHighlight=Accent.prototype.RemoveHighlight=Limit.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.contents.RemoveHighlight()};Table.prototype.RemoveHighlight=Matrix.prototype.RemoveHighlight=Piecewise.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.children.forEach(function(e){e.RemoveHighlight()})};ShapeTable.prototype.RemoveHighlight=function(){RemoveHighlight(this);this.labels.forEach(function(e){e.RemoveHighlight()});this.children.forEach(function(e){e.RemoveHighlight()})};Head.prototype.RemoveHighlight=function(){RemoveHighlight(this);var e=this.next;while(e!==this){e.RemoveHighlight();e=e.next}};Superscript.prototype.DoesSplit=Subscript.prototype.DoesSplit=Limit.prototype.DoesSplit=Fraction.prototype.DoesSplit=Radical.prototype.DoesSplit=Table.prototype.DoesSplit=Matrix.prototype.DoesSplit=ShapeTable.prototype.DoesSplit=function(e){return Character.IsNewLine(e)||Character.IsShape(e)||e instanceof ShapeTable||e instanceof Table||e.value==="="||Character.IsInequality(e)};Piecewise.prototype.DoesSplit=function(e){return Character.IsNewLine(e)||Character.IsShape(e)||e instanceof ShapeTable||e instanceof Table};PermComb.prototype.DoesSplit=function(e){return!Character.IsDigit(e)};Integral.prototype.DoesSplit=Summation.prototype.DoesSplit=function(e){return Character.IsNewLine(e)||Character.IsShape(e)||e instanceof ShapeTable||e instanceof Table||Character.IsComma(e)};var ParenDoesSplit=function(e,t){return Character.IsNewLine(e)||Character.IsShape(e)||e instanceof ShapeTable||e instanceof Table||(e.value==="="||Character.IsInequality(e))&&(IsNull(t)||!t.some(function(e){return e instanceof Character&&e.value==="{"}))};Accent.prototype.DoesSplit=function(e){return!(e instanceof Character)||!Character.IsNormalizeSafe(e)&&!Character.IsLetter(e)};function IsGrouper(e){return e instanceof Fraction||e instanceof Superscript||e instanceof Subscript||e instanceof Limit||e instanceof Integral||e instanceof Summation||e instanceof Radical||e instanceof PermComb||e instanceof Table||e instanceof Matrix||e instanceof Piecewise||e instanceof ShapeTable||e instanceof Accent}function GetChildInRoot(e){var t=GetHead(e),r=e;while(!IsNull(t.parent)){r=t.parent;t=GetHead(r)}return r}function GetGrouperChildren(e){if(e instanceof Fraction){return[e.numerator,e.denominator]}else if(e instanceof PermComb){return[e.left,e.right]}else if(e instanceof Radical){return[e.index,e.radicand]}else if(e.hasOwnProperty("lowerBound")){return[e.lowerBound,e.upperBound]}else if(e.hasOwnProperty("contents")){return[e.contents]}else if(e.hasOwnProperty("children")){return e.children}else return[]}function IsNInGrouper(e,t){if(!IsGrouper(e)&&e!==t)return false;var r=GetGrouperChildren(e);for(var n=0;n<r.length;n++){var i=r[n].ToArray();if(i.includes(t))return true}return false}function GetFracFromDenomOrNumer(e,t){var r=GetHead(e);var n=true;while(n){if(IsNull(r.parent)){return null}else if(r.parent instanceof Fraction){if(r.parent.hasOwnProperty(t)&&r.parent[t]===r){return r.parent}}r=GetHead(r.parent)}}function GetPiecewiseOrTable(e){var t=GetHead(e);var r=true;while(r){if(IsNull(t.parent))return null;if(t.parent instanceof Piecewise){var n={obj:t.parent};var i=t.parent.children.indexOf(t);n.above=i<1?null:t.parent.children[i-1];n.below=i>t.parent.children.length-2?null:t.parent.children[i+1];return n}else if(t.parent instanceof Table){n={obj:t.parent};i=t.parent.children.indexOf(t);n.above=i<2?null:t.parent.children[i-2];n.below=i>t.parent.children.length-3?null:t.parent.children[i+2];return n}t=GetHead(t.parent)}}function SplitHeadOnNewLineAndFind(e,t){if(!(e instanceof Head))throw"Invalid SplitHeadOnNewLineAndFind use";var r=[],n=[],i={index:-1};var a=e.next;var o=e.ToArray();for(var s=0;s<o.length;s++){a=o[s];if(Character.IsNewLine(a)){r.push(n);n=[]}n.push(a);if(a===t)i.index=r.length}r.push(n);i.array=r;return i}function IsBackspaceSoft(e){if(e instanceof Head){if(e.parent instanceof Fraction){return e.parent.numerator===e&&!e.IsEmpty()}else if(e.parent instanceof Table){return e.parent.children.indexOf(e)%2===1&&!e.parent.IsEmpty()}else if(e.parent instanceof Piecewise){return e.parent.children.indexOf(e)===0&&!e.parent.IsEmpty()}else if(e.parent instanceof Limit||e.parent instanceof Integral||e.parent instanceof Summation||e.parent instanceof PermComb||e.parent instanceof Matrix){return!e.parent.IsEmpty()}else{return false}}else if(e instanceof Character){return Character.IsParen(e)&&e.grey}else if(e instanceof Superscript||e instanceof Subscript){return!e.contents.IsEmpty()}else if(e instanceof Placeholder||e instanceof ShapeTable||e instanceof TrigLog){return false}else{return!e.IsEmpty()}}function IsDeleteSoft(e){if(e instanceof Head){if(e.parent instanceof Fraction){return e.parent.numerator===e&&!e.parent.IsEmpty()}else if(e.parent instanceof Table){return e.parent.children.indexOf(e)%2===1&&!e.parent.IsEmpty()}else if(e.parent instanceof Piecewise){return e.parent.children.indexOf(e)===0&&!e.parent.IsEmpty()}else if(e.parent instanceof Limit||e.parent instanceof Integral||e.parent instanceof Summation||e.parent instanceof PermComb||e.parent instanceof Matrix){return!e.parent.IsEmpty()}else{return false}}else if(e instanceof Character){return Character.IsParen(e)&&e.grey}else if(e instanceof Superscript||e instanceof Subscript){return!e.contents.IsEmpty()}else if(e instanceof Placeholder||e instanceof ShapeTable||e instanceof TrigLog){return false}else{return!e.IsEmpty()}}function PushNodesIntoList(e,t){if(IsNull(e)||IsNull(t))throw"Improper PushNodesIntoList use";var r=e;var n=t;while((!(r instanceof Head)||r===e)&&!(n instanceof Head)){var i=n.next;AddAfter(r,n);r=n;n=i}return r}function Delete(e){if(IsNull(e))return null;var t=e.prev;var r=e.next;t.next=r;r.prev=t;return t}Character.prototype.Delete=Placeholder.prototype.Delete=TrigLog.prototype.Delete=function(){return Delete(this)};Fraction.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);if(e===this.numerator){return MoveCursorLeft(this.numerator)}else if(e===this.denominator){var t;if(this.numerator.IsEmpty())t=MoveCursorLeft(this.numerator.First());else t=this.numerator.Last();var r=PushNodesIntoList(this.prev,this.numerator.First());PushNodesIntoList(r,this.denominator.First());Delete(this);return t}return IsNull(e)?this:e};Superscript.prototype.Delete=Subscript.prototype.Delete=function(e){if(this.contents.IsEmpty()){return Delete(this)}if(e===this.contents){var t=MoveCursorLeft(this.contents);Delete(this);PushNodesIntoList(t,this.contents.First());return t}return IsNull(e)?this:e};Accent.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);var t=this.prev;PushNodesIntoList(this.prev,this.contents.First());Delete(this);return t};Limit.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);else if(e===this.contents){var t=MoveCursorLeft(this.contents);return t}return IsNull(e)?this:e};Integral.prototype.Delete=Summation.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);if(e===this.upperBound||e===this.lowerBound)return MoveCursorLeft(e);return IsNull(e)?this:e};Radical.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);var t=this.prev;AddAfter(this.prev,this.radicand);Delete(this);return t};PermComb.prototype.Delete=function(e){if(IsNull(e))return MoveCursorLeft(this).Delete();if(!this.left.Any()&&!this.right.Any())return Delete(this);if(e===this.right||e===this.left)return MoveCursorLeft(e);return IsNull(e)?this:e};Table.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);var t=this.children.indexOf(e);if(t===-1)throw"Node not found in table to delete";if(t%2===0){var r=MoveCursorLeft(e);if(!this.children[t].Any()&&!this.children[t+1].Any())this.children.splice(t,2);return r}else{return MoveCursorLeft(e)}};Matrix.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);if(this.children.indexOf(e)>0)return MoveCursorLeft(e);return IsNull(e)?this:e};Piecewise.prototype.Delete=function(e){if(this.IsEmpty())return Delete(this);var t=this;for(var r=0;r<this.children.length;r++){if(e===this.children[r]){this.children[r].parent=null;if(r>0){t=this.children[r-1].Last();this.children[r-1].Push(this.children[r])}this.children.splice(r,1);if(this.children.length===0)return Delete(this);return t}}return IsNull(e)?this:e};ShapeTable.prototype.Delete=function(e){if(IsNull(e))return Delete(this);return e};Table.prototype.IsEmpty=Matrix.prototype.IsEmpty=Piecewise.prototype.IsEmpty=function(){for(var e=this instanceof Table?2:0;e<this.children.length;e++)if(this.children[e].Any())return false;return true};Head.prototype.ApplyInput=Character.prototype.ApplyInput=TrigLog.prototype.ApplyInput=Fraction.prototype.ApplyInput=Superscript.prototype.ApplyInput=Subscript.prototype.ApplyInput=Accent.prototype.ApplyInput=Limit.prototype.ApplyInput=Integral.prototype.ApplyInput=Summation.prototype.ApplyInput=Radical.prototype.ApplyInput=PermComb.prototype.ApplyInput=Table.prototype.ApplyInput=Matrix.prototype.ApplyInput=Piecewise.prototype.ApplyInput=ShapeTable.prototype.ApplyInput=function(e){if(IsNull(e))return this;if(this.next instanceof Placeholder){Delete(this.next)}AddAfter(this,e);return this.next};Placeholder.prototype.ApplyInput=function(e){AddAfter(this,e);var t=this.next;Delete(this);return t};function NodeTo$(e){return IdTo$(e.id)}function IdTo$(e){var t=$("#"+e);if(t.length===0){console.error("JQuery element ID not found: #"+e);if(window.__karma__)fail("JQuery element ID not found: #"+e);return null}return t}function GetWidth(e,t){if(typeof e.GetWidth==="function"){return e.GetWidth(t)}return t.width()}function MinDistance(e,t,r,n,i){var a=[];if(e instanceof Head){a=e.ToArray();a.shift()}else if(IsGrouper(e)){a=GetGrouperChildren(e)}else if(e instanceof Array){a=e;e=a.shift()}var o=e.GetCursorPos(n);if(o===null)return null;if(!IsNull(i)&&!i(o)){o=null}else{var s=o.y-o.size/2;o.elem=e;o.distance=Math.pow(t-o.x,2)+Math.pow(r-s,2)}return a.reduce(function(e,a){var o=IsNull(e)?Number.POSITIVE_INFINITY:e.distance;var s=IsNull(a)?{distance:Number.POSITIVE_INFINITY}:MinDistance(a,t,r,n,i);var u=IsNull(s)?Number.POSITIVE_INFINITY:s.distance;if(u<o)return s;return e},o)}Head.prototype.GetCursorPos=function(e){var t={};var r=NodeTo$(this);if(r===null)return null;var n=r.length>0?r.offset():{top:0,left:0};var i=r.height();t.y=n.top+i;var a=0;if(r.length>0){a=parseInt(r.css("padding-left"),10)}t.x=n.left+a;var o;if(i===0){if(!IsNull(this.parent)&&!IsNull(this.parent.id)){var s=NodeTo$(this.parent,e);if(s===null)return null;t.size=parseFloat(s.css("font-size"))*.8;t.y=s.offset().top+t.size}else{var u=$("#"+e);var l=u.offset();t.size=parseFloat(u.css("font-size"));t.y+=u.height()/2+t.size/2}return t}else if(this.Any()){var c=MoveCursorRight(this);if(!Character.IsNewLine(c)){if(!IsNull(c.parent)&&IsGrouper(c.parent)){var p=r.css("font-size");t.size=parseFloat(p)*.8;t.y=n.top+i/2+t.size/2;t.elem=this;return t}else{o=c.GetCursorPos(e);o.x=t.x;return o}}}p=parseFloat(r.css("font-size"));if(!this.NeedsPlaceholder()){t.x=n.left;t.y=n.top+i*.8}if(this.parent&&(this.parent instanceof Summation||this.parent instanceof Integral)){if(this.parent.placeholders&&this.IsEmpty()){t.y+=p*.15}}t.size=p*.8;t.elem=this;return t};Character.prototype.GetCursorPos=TrigLog.prototype.GetCursorPos=Placeholder.prototype.GetCursorPos=Fraction.prototype.GetCursorPos=Superscript.prototype.GetCursorPos=Subscript.prototype.GetCursorPos=Accent.prototype.GetCursorPos=Limit.prototype.GetCursorPos=Integral.prototype.GetCursorPos=Summation.prototype.GetCursorPos=Radical.prototype.GetCursorPos=PermComb.prototype.GetCursorPos=Table.prototype.GetCursorPos=Matrix.prototype.GetCursorPos=Piecewise.prototype.GetCursorPos=ShapeTable.prototype.GetCursorPos=function(e){var t={};var r=NodeTo$(this);if(r===null)return t;var n=r.offset();var i=GetWidth(this,r);t.x=n.left+i;var a=r.height();if(this.next instanceof Placeholder){var o=NodeTo$(this.next);a=o.height();n.top=o.offset().top}var s=parseFloat(r.css("font-size"));t.size=s*.8;if(IsGrouper(this)){t.y=n.top+a/2+t.size/2}else{t.y=n.top+a}t.elem=this;if(this instanceof Limit){t.x+=s*.2}else if(this instanceof Character&&!Character.IsNewLine(this)&&!r.get(0).className.startsWith("mjx")){t.y-=s*.25;t.x-=s*.05}else if(Character.IsNewLine(this)){t.x=n.left;t.y=n.top+a*.75}else if(Character.IsParen(this)){t.y=n.top+a/2+t.size/2}else if(this instanceof Piecewise){t.x+=s*1.25}else if(this instanceof Integral){t.x+=s*.5}else if(this instanceof Summation){t.x+=s*.15}else if(this instanceof Placeholder){t.y+=s*.05}if(this.next instanceof Placeholder)t.y+=s*.05;return t};function MoveCursorRight(e){var t=e.next;if(t instanceof Fraction){return t.numerator}else if(t instanceof PermComb){return t.left}else if(t instanceof Radical){return t.index}else if(t instanceof Summation){return t.lowerBound}else if(t.hasOwnProperty("lowerBound")){return t.lowerBound}else if(t.hasOwnProperty("contents")){return t.contents}else if(t.hasOwnProperty("children")){if(t.children.length>0){return t.children[0]}return t}else if(t instanceof Head){var r=t.parent;if(IsNull(r)){return e}else if(r instanceof Fraction){if(r.numerator===t){return r.denominator}}else if(r instanceof PermComb){if(r.left===t){return r.right}}else if(r instanceof Radical){if(r.index===t){return r.radicand}}else if(r.hasOwnProperty("upperBound")&&r.hasOwnProperty("lowerBound")){if(r.lowerBound===t){return r.upperBound}}else if(r.hasOwnProperty("children")){var n=r.children.indexOf(t);if(n+1<r.children.length){return r.children[n+1]}}else if(r instanceof Subscript&&r.next instanceof Superscript){return r.next.contents}return r}return t}function MoveCursorLeft(e){if(e instanceof Head){var t=e.parent;if(IsNull(t)){return e}else if(t instanceof Fraction){if(t.denominator===e){return t.numerator.Last()}}else if(t.hasOwnProperty("upperBound")&&t.hasOwnProperty("lowerBound")){if(t.upperBound===e){return t.lowerBound.Last()}}else if(t instanceof PermComb){if(t.right===e){return t.left.Last()}}else if(t instanceof Radical){if(t.radicand===e){return t.index.Last()}}else if(t.hasOwnProperty("children")){var r=t.children.indexOf(e);if(r>0){return t.children[r-1].Last()}}else if(t instanceof Superscript&&t.prev instanceof Subscript){return t.prev.contents.Last()}return t.prev}else if(e instanceof Fraction){return e.denominator.Last()}else if(e.hasOwnProperty("upperBound")){return e.upperBound.Last()}else if(e instanceof PermComb){return e.right.Last()}else if(e instanceof Radical){return e.radicand.Last()}else if(e.hasOwnProperty("contents")){return e.contents.Last()}else if(e.hasOwnProperty("children")){return e.children[e.children.length-1].Last()}var n=e.prev;return n}function Between(e,t){if(e===t)return[];var r=ArrayToRootHead(e);var n=ArrayToRootHead(t);var i=0;while(r[i]===n[i])i++;e=r[i];t=n[i];if(GetHead(e)!==GetHead(t)){return[r[i-1]]}var a=GetHead(e);var o=r.length>i+1;if(a.IsABeforeB(t,e)){var s=e;e=t;t=s;o=n.length>i+1}var u=a.Between(e,t);if(o||e instanceof Head)return u;else return u.slice(1)}function RemoveHighlight(e){var t=$("#"+e.id);t.removeClass("highlight");t.removeClass("highlightSubSup")}function ArrayToRootHead(e){var t=[e],r=e,n=GetHead(e);while(!IsNull(n.parent)){r=n.parent;n=GetHead(r);t.unshift(r)}return t}var FindMatchingParen=function(e){var t=null;if(Character.IsOpenParen(e)){t=function(e){return MoveCursorRight(e)};incWhen=function(e){return Character.IsOpenParen(e)};decWhen=function(e){return Character.IsCloseParen(e)}}if(Character.IsCloseParen(e)){t=function(e){return MoveCursorLeft(e)};incWhen=function(e){return Character.IsCloseParen(e)};decWhen=function(e){return Character.IsOpenParen(e)}}if(t===null){return null}var r=e;var n=1;do{r=t(r);if(incWhen(r)){n++}else if(decWhen(r)){n--}}while(n>0);return r};var UnitTypes=[{type:"kL",names:["kiloliters","kilolitres","kiloliter","kilolitre","kL"]},{type:"hL",names:["hectoliters","hectolitres","hectoliter","hectolitre","hL"]},{type:"daL",names:["decaliters","decalitres","decaliter","decalitre","dekaliters","dekaliter","daL"]},{type:"L",names:["liters","litres","liter","litre"]},{type:"dL",names:["deciliters","decilitres","deciliter","decilitre","dL"]},{type:"cL",names:["centiliters","centilitres","centiliter","centilitre","cL"]},{type:"mL",names:["milliliters","millilitres","milliliter","millilitre","ml","mL"]},{type:"km",names:["kilometers","kilometres","kilometer","kilometre","km"]},{type:"hm",names:["hectometers","hectometres","hectometer","hectometre"]},{type:"dam",names:["decameters","decametres","decameter","decametre","dekameters","dekameter"]},{type:"m",names:["meters","metres","meter","metre"]},{type:"dm",names:["decimeters","decimetres","decimeter","decimetre"]},{type:"cm",names:["centimeters","centimetres","centimeter","centimetre","cm"]},{type:"mm",names:["millimeters","millimetres","millimeter","millimetre","mm"]},{type:"Mg",names:["tonnes","tonne","megagrams","megagram"]},{type:"kg",names:["kilograms","kilogram","kg"]},{type:"hg",names:["hectograms","hectogram"]},{type:"dag",names:["decagrams","decagram","dekagrams","dekagram"]},{type:"g",names:["grams","gram"]},{type:"dg",names:["decigrams","decigram"]},{type:"cg",names:["centigrams","centigram","cg"]},{type:"mg",names:["milligrams","milligram","mg"]},{type:"s",names:["seconds"]},{type:"hr",names:["hours","hour","hr"]},{type:"gal",names:["gallons","gallon","gals","gal"]},{type:"qt",names:["quarts","quart","qts","qt"]},{type:"pt",names:["pints","pint","pts","pt"]},{type:"c",names:["cups","cup"]},{type:"mi",names:["miles","mile","mi"]},{type:"yd",names:["yards","yard","yds","yd"]},{type:"ft",names:["feets","foots","feet","foot","ft"]},{type:"in",names:["inches","inch"]},{type:"ton",names:["tons","ton"]},{type:"lb",names:["pounds","pound","lbs","lb"]},{type:"oz",names:["ounces","ounce","oz"]}];var allunitnames=[];var allunittypes=[];function InitializeUnitArrays(){allunitnames=[];allunittypes=[];for(var e=0;e<UnitTypes.length;e++){var t=UnitTypes[e].type;var r=UnitTypes[e].names;for(var n=0;n<r.length;n++){allunitnames.push(r[n]);allunittypes.push(t)}}}function GetAllUnits(){if(allunitnames.length==0){InitializeUnitArrays()}return allunitnames}function GetUnitTypeByName(e){if(allunitnames.length==0){InitializeUnitArrays()}for(var t=0;t<allunitnames.length;t++){if(allunitnames[t]===e){return allunittypes[t]}}return"unknown"}function IsUnit(e){return InArray(e,GetAllUnits())}var FlatListMatch=function(e){this.func=e};FlatListMatch.Digit=function(){return FlatListMatch.IsTrue(function(e){return Character.IsDigit(e)})};FlatListMatch.Letter=function(){return FlatListMatch.IsTrue(function(e){return Character.IsLetter(e)})};FlatListMatch.Identifier=function(){return FlatListMatch.IsTrue(function(e){return Character.IsIdentifier(e)})};FlatListMatch.NonletterIdentifier=function(){return FlatListMatch.IsTrue(function(e){return!Character.IsLetter(e)&&Character.IsIdentifier(e)})};FlatListMatch.Oper=function(){return FlatListMatch.IsTrue(function(e){return Character.IsOperator(e)})};FlatListMatch.Factorial=function(){return FlatListMatch.IsTrue(function(e){return Character.IsFactorial(e)})};FlatListMatch.Variable=function(){return FlatListMatch.IsTrue(function(e){return Character.IsLetter(e)&&e.value!=="e"})};FlatListMatch.DecimalSep=function(){return FlatListMatch.IsTrue(function(e){return Character.IsDecimalSeparator(e)})};FlatListMatch.PlusMinus=function(){return FlatListMatch.IsTrue(function(e){return e instanceof Character&&(e.value==="+"||e.value==="-")})};FlatListMatch.DecimalTwo=function(){return FlatListMatch.IsTrue(function(e){
return Character.IsDigit(e)&&e.value==="2"})};FlatListMatch.Any=function(){return FlatListMatch.IsTrue(function(){return true})};FlatListMatch.Grey=function(){return new FlatListMatch(function(e){if(e.grey){return e}return null})};FlatListMatch.NotGrey=function(){return new FlatListMatch(function(e){if(!e.grey){return e}return null})};FlatListMatch.SpecificCharacter=function(e,t){return FlatListMatch.IsTrue(function(r){return r instanceof Character&&(t?r.value.toUpperCase()===e.toUpperCase():r.value===e)})};FlatListMatch.LeftParen=function(){return FlatListMatch.SpecificCharacter("(")};FlatListMatch.RightParen=function(){return FlatListMatch.SpecificCharacter(")")};FlatListMatch.Factorial=function(){return FlatListMatch.SpecificCharacter("!")};FlatListMatch.NaturalNumber=function(){return FlatListMatch.Digit().Many()};FlatListMatch.Integer=function(){return FlatListMatch.PlusMinus().Opt().Con(FlatListMatch.NaturalNumber())};FlatListMatch.Decimal=function(){return FlatListMatch.Integer().Con(FlatListMatch.DecimalSep().Con(FlatListMatch.NaturalNumber()).Opt())};FlatListMatch.Number=function(){return FlatListMatch.NaturalNumber().Con(FlatListMatch.DecimalSep().Con(FlatListMatch.NaturalNumber()).Opt()).Or(FlatListMatch.DecimalSep().Con(FlatListMatch.NaturalNumber()))};FlatListMatch.SubSup=function(){return FlatListMatch.Subscript().Con(FlatListMatch.Superscript())};FlatListMatch.DecimalFraction=function(){return FlatListMatch.Fraction(FlatListMatch.Decimal(),FlatListMatch.Decimal())};FlatListMatch.DecimalSuper=function(){return FlatListMatch.Superscript(FlatListMatch.Decimal())};FlatListMatch.Coff=function(){return FlatListMatch.Decimal().Or(FlatListMatch.DecimalFraction())};FlatListMatch.PolyVarTerm=function(){return FlatListMatch.PlusMinus().Opt().Con(FlatListMatch.Coff().Opt()).Con(FlatListMatch.Letter()).Con(FlatListMatch.DecimalSuper().Opt())};FlatListMatch.Poly2OrMore=function(){return FlatListMatch.PolyVarTerm().Con(FlatListMatch.PlusMinus().Con(FlatListMatch.PolyVarTerm().Or(FlatListMatch.Coff())).Many())};FlatListMatch.SuperTwo=function(){return FlatListMatch.Superscript(FlatListMatch.DecimalTwo())};FlatListMatch.QuadraticTerm=function(){return FlatListMatch.PlusMinus().Opt().Con(FlatListMatch.Coff().Opt()).Con(FlatListMatch.Letter()).Con(FlatListMatch.SuperTwo().Opt())};FlatListMatch.ConstantTerm=function(){return FlatListMatch.PlusMinus().Opt().Con(FlatListMatch.Coff())};FlatListMatch.DefectiveQuadraticPoly=function(){return FlatListMatch.QuadraticTerm().Con(FlatListMatch.ConstantTerm()).Con(FlatListMatch.ConstantTerm())};FlatListMatch.FuncNames=["arcsin","arcsen","arccos","arctan","arccsc","arcsec","arccot","sinh","cosh","tanh","csch","sech","coth","sqrt","abs","sin","sen","cos","tan","csc","sec","cot","log","ln"];FlatListMatch.FuncName=function(){var e=new FlatListMatch(function(){return null});for(var t=0;t<FlatListMatch.FuncNames.length;t++){e=e.Or(FlatListMatch.SpecificWord(FlatListMatch.FuncNames[t]))}return e};FlatListMatch.FuncNameAndScript=function(){return FlatListMatch.FuncName().Con(FlatListMatch.Superscript().Or(FlatListMatch.Subscript()).Opt())};FlatListMatch.FunctionWithParenArg=function(){return FlatListMatch.FuncNameAndScript().Con(FlatListMatch.ParenGroup())};FlatListMatch.SpecificWord=function(e,t){var r=FlatListMatch.Epsilon();for(var n=0;n<e.length;n++){r=r.Con(FlatListMatch.SpecificCharacter(e.charAt(n),t))}return r};FlatListMatch.NonfunctionLetterSequence=function(){var e=FlatListMatch.Letter().Many();return new FlatListMatch(function(t){var r=e.func(t);if(IsNull(r)){return r}var n="";for(var i=t;i!==r;i=FlatListMatch.NextToken(i)){n+=i.value}if(FlatListMatch.FuncNames.some(function(e){return n.includes(e)})){return null}return r})};FlatListMatch.Word=function(e){var t=FlatListMatch.Epsilon().Lookahead(FlatListMatch.WordFinalPunctuation().Or(FlatListMatch.SpecificCharacter(" ",true))).Or(FlatListMatch.Epsilon().Lookahead(FlatListMatch.IsTrue(function(e){return e instanceof Head})));var r=FlatListMatch.Letter().Con(FlatListMatch.WordMiddlePunctuation().Opt()).Many(3).Or(FlatListMatch.TwoLetterWord().Con(t)).Or(FlatListMatch.SpecialWord());if(!e){r=r.Or(FlatListMatch.OneLetterWord().Con(t))}var n=FlatListMatch.WordFinalPunctuation().Many().Or(FlatListMatch.Epsilon().Lookahead(FlatListMatch.IsFalse(function(e){return e instanceof Superscript||e instanceof Subscript})));return FlatListMatch.WordInitialPunctuation().Opt().Con(r).Con(n)};FlatListMatch.twoLengthWordWhiteList=["of","to","in","it","is","be","as","at","so","we","he","by","or","on","do","if","me","my","up","an","go","no","us","am","i'd","i'm","hi","ok","ty","np","Im","pc"];FlatListMatch.TwoLetterWord=function(){var e=new FlatListMatch(function(){return null});for(var t=0;t<FlatListMatch.twoLengthWordWhiteList.length;t++){e=e.Or(FlatListMatch.SpecificWord(FlatListMatch.twoLengthWordWhiteList[t],true))}return e};FlatListMatch.OneLetterWord=function(){return FlatListMatch.CapitalIWord().Or(FlatListMatch.WeakOneLetterWord())};FlatListMatch.CapitalIWord=function(){return FlatListMatch.SpecificCharacter("I").Lookahead(new FlatListMatch.IsFalse(function(e){return Character.IsLetter(e)}))};FlatListMatch.WeakOneLetterWord=function(){return FlatListMatch.SpecificCharacter("a",true).Or(FlatListMatch.SpecificCharacter("i",true)).Lookahead(FlatListMatch.SpecificCharacter(" ").Many().Con(FlatListMatch.Word(true)))};FlatListMatch.SpecialWords=["y-intercept","y-int","slope-intercept","x-int","x-intercept","x intercept","y intercept"].sort().reverse();FlatListMatch.SpecialWord=function(){var e=FlatListMatch.Null();for(var t=0;t<FlatListMatch.SpecialWords.length;t++){e=e.Or(FlatListMatch.SpecificWord(FlatListMatch.SpecialWords[t]),true)}return e};FlatListMatch.WordInitialPunctuation=function(){return FlatListMatch.SpecificCharacter("'").Or(FlatListMatch.SpecificCharacter('"'))};FlatListMatch.WordMiddlePunctuation=function(){return FlatListMatch.SpecificCharacter("'")};FlatListMatch.WordFinalPunctuation=function(){return FlatListMatch.SpecificCharacter("!").Or(FlatListMatch.SpecificCharacter("?")).Or(FlatListMatch.SpecificCharacter(".").Lookahead(new FlatListMatch.IsFalse(function(e){return Character.IsDigit(e)}))).Or(FlatListMatch.SpecificCharacter(",")).Or(FlatListMatch.SpecificCharacter('"')).Or(FlatListMatch.Epsilon().Lookahead(FlatListMatch.SmileyString(),true).Con(FlatListMatch.SpecificCharacter(":").Or(FlatListMatch.SpecificCharacter(";"))))};FlatListMatch.PermComb=function(){return FlatListMatch.NaturalNumber().Con(FlatListMatch.SpecificCharacter("P").Or(FlatListMatch.SpecificCharacter("C"))).Con(FlatListMatch.NaturalNumber())};FlatListMatch.Unit=function(){var e=FlatListMatch.Null();var t=GetAllUnits();for(var r=0;r<t.length;r++){e=e.Or(FlatListMatch.SpecificWord(t[r]))}return e.Lookahead(FlatListMatch.UnitFollow())};FlatListMatch.UnitFollow=function(){return FlatListMatch.WordFinalPunctuation().Or(FlatListMatch.IsTrue(function(e){return e instanceof Head||e instanceof Superscript||Character.IsSpace(e)||Character.IsNewLine(e)||Character.IsSymbol(e)||Character.IsParen(e)||Character.IsAbs(e)}))};FlatListMatch.ChemElementArr=["Nh","Mc","Ts","Og","Uue","Ac","Ag","Al","Am","Ar","As","At","Au","Ba","Be","Bh","Bi","Bk","Br","Ca","Cd","Ce","Cf","Cl","Cm","Cn","Co","Cr","Cs","Cu","Db","Ds","Dy","Er","Es","Eu","Fe","Fl","Fm","Fr","Ga","Gd","Ge","He","Hf","Hg","Ho","Hs","In","Ir","Kr","La","Li","Lr","Lu","Lv","Md","Mg","Mn","Mo","Mt","Na","Nb","Nd","Ne","Ni","No","Np","Os","Pa","Pb","Pd","Ph","Pm","Po","Pr","Pt","Pu","Ra","Rb","Re","Rf","Rg","Rh","Rn","Ru","Sb","Sc","Se","Sg","Si","Sm","Sn","Sr","Ta","Tb","Tc","Te","Th","Ti","Tl","Tm","Xe","Yb","Zn","Zr","B","C","F","H","I","K","N","O","P","S","U","V","W","Y"];FlatListMatch.ChemCompound=function(){return FlatListMatch.NaturalNumber().Opt().Con(FlatListMatch.ChemIon().Or(FlatListMatch.ChemCompoundItem().Many())).Lookahead(FlatListMatch.ChemFollow())};FlatListMatch.ChemCompoundItem=function(){return FlatListMatch.ChemElementAndSubscript().Or(FlatListMatch.LeftParen().Con(FlatListMatch.ChemElementAndSubscript().Many()).Con(FlatListMatch.RightParen()).Con(FlatListMatch.Subscript(FlatListMatch.NaturalNumber().Opt())))};FlatListMatch.ChemElementAndSubscript=function(){return FlatListMatch.ChemElement().Con(FlatListMatch.Subscript(FlatListMatch.NaturalNumber()).Opt())};FlatListMatch.ChemIon=function(){return FlatListMatch.ChemElement().Con(FlatListMatch.Superscript(FlatListMatch.PlusMinus().Con(FlatListMatch.NaturalNumber().Opt()).Or(FlatListMatch.NaturalNumber().Con(FlatListMatch.PlusMinus()))))};FlatListMatch.ChemElement=function(){var e=FlatListMatch.Null();for(var t=0;t<FlatListMatch.ChemElementArr.length;t++){e=e.Or(FlatListMatch.SpecificWord(FlatListMatch.ChemElementArr[t]))}return e};FlatListMatch.ChemFollow=function(){return FlatListMatch.WordFinalPunctuation().Or(FlatListMatch.IsTrue(function(e){return e instanceof Head||Character.IsSpace(e)||Character.IsNewLine(e)||Character.IsOperator(e)||Character.IsSymbol(e)}))};FlatListMatch.ParenGroup=function(){return new FlatListMatch(function(e){if(!Character.IsOpenParen(e)){return null}var t=1;e=FlatListMatch.NextToken(e);while(!(e instanceof Head)&&!(t===1&&Character.IsCloseParen(e))){if(Character.IsOpenParen(e)){t++}else if(Character.IsCloseParen(e)){t--}if(t<0){return null}e=FlatListMatch.NextToken(e)}if(t===1&&Character.IsCloseParen(e)){return FlatListMatch.NextToken(e)}return null})};FlatListMatch.PullInFractionNumerator=function(){return FlatListMatch.ParenGroup().Or(FlatListMatch.FunctionWithParenArg()).Or(FlatListMatch.NonfunctionLetterSequence()).Or(FlatListMatch.NonletterIdentifier()).Or(FlatListMatch.Digit()).Or(FlatListMatch.DecimalSep()).Or(FlatListMatch.Superscript()).Or(FlatListMatch.Subscript()).Or(FlatListMatch.Radical()).Or(FlatListMatch.Factorial()).Many(1)};FlatListMatch.PullInFractionDenominator=function(){return FlatListMatch.ParenGroup().Or(FlatListMatch.Identifier()).Or(FlatListMatch.Digit()).Or(FlatListMatch.DecimalSep()).Or(FlatListMatch.Variable()).Or(FlatListMatch.Superscript()).Or(FlatListMatch.Subscript()).Or(FlatListMatch.Radical()).Or(FlatListMatch.Factorial()).Many(1)};FlatListMatch.FractionString=function(){return FlatListMatch.CaptureGroups(FlatListMatch.PullInFractionNumerator().Opt(),FlatListMatch.SpecificCharacter("/"),FlatListMatch.PullInFractionDenominator().Opt())};FlatListMatch.SmileyString=function(){var e=new FlatListMatch(function(e){if(e===null)return null;if(!(e.prev instanceof Character))return null;if(e.prev.value===" ")return e;else return null});var t=FlatListMatch.SpecificCharacter(":").Or(FlatListMatch.SpecificCharacter(";")).Con(FlatListMatch.SpecificCharacter("-").Opt()).Con(FlatListMatch.NotGrey().Con(FlatListMatch.SpecificCharacter(")")).Or(FlatListMatch.NotGrey().Con(FlatListMatch.SpecificCharacter("("))));return FlatListMatch.Start().Or(e).Con(t).Con(FlatListMatch.SpecificCharacter(" ").Or(FlatListMatch.End()))};FlatListMatch.Command=function(){return FlatListMatch.CaptureGroups(FlatListMatch.SpecificCharacter("@"),FlatListMatch.Letter().Many(),FlatListMatch.SpecificCharacter(" ").Many(0))};FlatListMatch.NextToken=function(e){if(e instanceof Head){return e}return e.next};FlatListMatch.IsTrue=function(e){return new FlatListMatch(function(t){if(e(t)){return FlatListMatch.NextToken(t)}return null})};FlatListMatch.IsFalse=function(e){return FlatListMatch.IsTrue(function(t){return!e(t)})};FlatListMatch.prototype.Con=function(e){var t=this;return new FlatListMatch(function(r){var n=t.func(r);if(n===null){return null}return e.func(n)})};FlatListMatch.prototype.Or=function(e){var t=this;return new FlatListMatch(function(r){var n=t.func(r);if(n!==null){return n}return e.func(r)})};FlatListMatch.prototype.Lookahead=function(e,t){var r=this;if(!t){t=false}return new FlatListMatch(function(n){var i=r.func(n);if(i===null){return null}var a=e.func(i);if(!t&&a===null)return null;if(t&&a!==null)return null;return i})};FlatListMatch.prototype.Opt=function(){return this.Many(0,1)};FlatListMatch.prototype.Many=function(e,t){if(IsNull(e)){e=1}if(IsNull(t)){t=Number.POSITIVE_INFINITY}var r=this;return new FlatListMatch(function(n){var i=0;var a=true;while(i<t&&a&&!(n instanceof Head)){var o=r.func(n);if(o===null){a=false}else{i++;n=o}}if(i>=e&&i<=t){return n}return null})};FlatListMatch.Epsilon=function(){return new FlatListMatch(function(e){return e})};FlatListMatch.Null=function(){return new FlatListMatch(function(){return null})};FlatListMatch.Fraction=function(e,t){if(IsNull(e)){e=FlatListMatch.Any().Many(0)}if(IsNull(t)){t=FlatListMatch.Any().Many(0)}return new FlatListMatch(function(r){if(r instanceof Fraction){if(e.func(r.numerator.next)instanceof Head&&t.func(r.denominator.next)instanceof Head){return FlatListMatch.NextToken(r)}}return null})};FlatListMatch.Radical=function(e,t){if(IsNull(e)){e=FlatListMatch.Any().Many(0)}if(IsNull(t)){t=FlatListMatch.Any().Many(0)}return new FlatListMatch(function(r){if(r instanceof Radical){if(e.func(r.index.next)instanceof Head&&t.func(r.radicand.next)instanceof Head){return FlatListMatch.NextToken(r)}}return null})};FlatListMatch.Superscript=function(e){if(IsNull(e)){e=FlatListMatch.Any().Many(0)}return new FlatListMatch(function(t){if(t instanceof Superscript){if(e.func(t.contents.next)instanceof Head){return FlatListMatch.NextToken(t)}}return null})};FlatListMatch.Subscript=function(e){if(IsNull(e)){e=FlatListMatch.Any().Many(0)}return new FlatListMatch(function(t){if(t instanceof Subscript){if(e.func(t.contents.next)instanceof Head){return FlatListMatch.NextToken(t)}}return null})};FlatListMatch.CaptureGroups=function(){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}return new FlatListMatch(function(t,r){var n=t;var i;var a={};for(var o=0;o<e.length;o++){i=e[o].func(n);if(i===null){return null}a["$"+(o+1)]={start:n,end:i};n=i}if(typeof r==="object"){for(var s in a){if(a.hasOwnProperty(s)){r[s]=a[s]}}}return i})};FlatListMatch.Start=function(){return new FlatListMatch(function(e){if(e===null)return null;return e.prev instanceof Head?e:null})};FlatListMatch.End=function(){return new FlatListMatch(function(e){if(e===null)return null;return e instanceof Head?e:null})};function EnumerateUntil(e,t){var r=[];for(var n=e;!(n instanceof Head)&&n!==t;n=n.next){r.push(n)}return r}var AutoFuncs={ChemElement:FlatListMatch.ChemElement(),ChemCompound:FlatListMatch.ChemCompound(),Number:FlatListMatch.Number(),FuncName:FlatListMatch.FuncName(),Unit:FlatListMatch.Unit(),Word:FlatListMatch.Word(),SubSup:FlatListMatch.SubSup(),Smiley:FlatListMatch.SmileyString()};function Automaton(e,t,r,n,i){var a="";var o=null;if(t.length>0){o=t[t.length-1].type}if(!IsNull(n)&&n.inChemical){var s=AutoFuncs.ChemElement.func(e);if(s!==null){a='<mstyle mathvariant="normal">';var u=EnumerateUntil(e,s);for(var l=0;l<u.length;l++){var c=u[l];a+=c.ToHtml("mi",i)}a+="</mstyle>";t.push({node:s,html:a,inMath:true,type:"chemElement"});return}}if(n===Subject.CHEMISTRY&&(o===null||o==="space"||o==="oper"||o==="newline")){var p=AutoFuncs.ChemCompound.func(e);if(p!==null){var d=RunAutomaton(e,true,{str:Subject.CHEMISTRY.str,inChemical:true},function(e){return e===p},i);a=d.map(function(e){return e.html}).join("");t.push({node:p,html:a,inMath:true,type:"chem"});return}}var f=AutoFuncs.Number.func(e);if(f!==null){u=EnumerateUntil(e,f);a="";for(l=0;l<u.length;l++){c=u[l];if(i)a+=c.value;else a+=c.ToHtml("mn",i)}if(i)a="<mn>"+a+"</mn>";t.push({node:f,html:a,inMath:true,type:"number"});return}if(o===null||o==="number"||o==="space"){var h=AutoFuncs.Unit.func(e);if(h!==null){var m="";var g="";u=EnumerateUntil(e,h);for(l=0;l<u.length;l++){c=u[l];g+=c.value;if(i)m+=c.value;else m+=c.ToHtml("mi",i)}if(i)m="<mi>"+m+"</mi>";a='<mstyle mathvariant="normal" class="unit '+GetUnitTypeByName(g)+'">'+m+"</mstyle>";t.push({node:h,html:a,inMath:true,type:"unit"});return}}var v=AutoFuncs.Smiley.func(e);if(v!==null){u=EnumerateUntil(e,v);var b=r?"mtext":"span";a="<"+b+">";for(l=0;l<u.length;l++){c=u[l];a+=c.ToHtml(b,i)}a+="</"+b+">";t.push({node:v,html:a,inMath:r,type:"smiley"});return}if(o!=="letter"){var y=AutoFuncs.Word.func(e);if(y!==null){b=r?"mtext":"span";a="<"+b+">";u=EnumerateUntil(e,y);var w="";for(l=0;l<u.length;l++){c=u[l];w+=c.value;if(i)a+=c.value;else a+=c.ToHtml(b,i)}a+="</"+b+">";var C=false;for(l=t.length-1;l>=0;l--){var S=false;switch(t[l].type){case"space":S=true;break;case"word":C=true;break}if(!S){break}}if(IsAcceptableWord(w,r,C)){t.push({node:y,html:a,inMath:r,type:"word"});return}}}var x=AutoFuncs.FuncName.func(e);if(x!==null){a="<mi>";if(i)a=StartTag("mi",e,i,{mathvariant:"normal"});u=EnumerateUntil(e,x);for(l=0;l<u.length;l++){c=u[l];if(i)a+=c.value;else a+=c.ToHtml("mi",i,{mathvariant:"normal"})}a+="</mi>";var A="<mo>"+FunctionApplicationSymbol+"</mo>";t.push({node:x,html:a+A,inMath:true,type:"func",preHtml:a,postHtml:A});return}var T=AutoFuncs.SubSup.func(e);if(T!==null){var I;if(IsBaseType(o)){I=t.pop().html}else{I=PlaceholderString}t.push({node:T,html:MakeSubSup(I,T.prev.prev,T.prev,i),inMath:true,type:"subsup"});return}if(e instanceof Character){if(e.IsOperator()){if(e.value==="'"){a=e.ToHtml("mo",i,{},UnicodeToHex["′"])}else if(e.value==='"'){a=e.ToHtml("mo",i,{},UnicodeToHex["″"])}else if(e.value==="*"){a=e.ToHtml("mo",i,{},UnicodeToHex["*"])}else if(e.value===":"&&!r){a=e.ToHtml("span",i,{},":");t.push({node:e.next,html:a,inMath:false,type:"oper",inMathHtml:""});return}else{a=e.ToHtml("mo",i)}D=e.value===","?"comma":"oper"}else if(e.IsFactorial()){a=e.ToHtml("mo",i);D="factorial"}else if(e.IsSymbol()){b=r?"mtext":"span";a=e.ToHtml(b,i);t.push({node:e.next,html:a,inMath:r,type:"symbol"});return}else if(e.IsIdentifier()){a=e.ToHtml("mi",i);D="letter"}else if(e.IsShape()){a=e.ToHtml("span",i,{"class":ShapeType.FromCharacter(e.value).type});t.push({node:e.next,html:a,inMath:false,type:"shape"});return}else if(e.IsSpace()){var E=e.ToHtml("mtext",i,{},NonBreakingSpace);if(r){a=E}else{a=e.ToHtml("span",i,{}," "+ZeroWidthNonBreakingSpace)}t.push({node:e.next,html:a,inMath:r,type:"space",inMathHtml:E});return}else if(Character.IsOpenParen(e)||Character.IsAbs(e)){if(!Character.IsAbs(e)){d=RunAutomaton(e.next,true,n,function(e){return Character.IsCloseParen(e)},i)}else{d=RunAutomaton(e.next,true,n,function(e){return Character.IsAbs(e)},i);var P=d.length>0?d[d.length-1].node:e.next;if(!Character.IsAbs(P)){t.push({node:e.next,html:e.ToHtml("mo",i),inMath:true,type:"oper"});return}}m=e.ToHtml("mo",i)+d.map(function(e){return e.html}).join("");var k=null;if(d.length>0){closeParen=d[d.length-1].node}else{closeParen=e.next}if(!Character.IsCloseParen(closeParen)&&!Character.IsAbs(closeParen)){closeParen=closeParen.prev}t.push({node:closeParen.next,html:"<mrow>"+m+closeParen.ToHtml("mo",i)+"</mrow>",inMath:true,type:"paren"});return}else if(Character.IsNewLine(e)){t.push({node:e.next,html:"</div>"+StartTag("div",e,i,{"class":"editorLine"}),inMath:false,type:"newline"});return}else{var M="";if(!IsNull(e.id)&&!i){M+=' id="'+e.id+'"'}if(e.grey&&!i){M+=' class="greyParen"'}a="<mi"+M+">"+GetHexForUnicode(e.value)+"</mi>";D="letter"}}else if(e instanceof Superscript||e instanceof Subscript){var $="",D=GrouperToString(e);if(t.length===0){a=e.ToHtml(PlaceholderString,i);t.push({node:e.next,html:a,inMath:true,type:D});return}if(IsBaseType(o)){if(o==="func"){var L=t.pop();a=e.ToHtml(L.preHtml,i)+L.postHtml}else{a=e.ToHtml(t.pop().html,i)}}else{a=e.ToHtml(PlaceholderString,i)}t.push({node:e.next,html:a,inMath:true,type:D});return}else if(e instanceof TrigLog){var R=e.ToPreHtml(i);var N=e.ToPostHtml();t.push({node:e.next,html:R+N,inMath:true,type:"func",preHtml:R,postHtml:N});return}else if(e instanceof Piecewise){a=e.ToHtml(i);D=GrouperToString(e)}else{a=e.ToHtml(i);D=GrouperToString(e)}t.push({node:e.next,html:a,inMath:true,type:D})}function IsAcceptableWord(e,t,r){var n=(!StartsWithOptionalVariableAndFuncName(e)||IsTriggyWord(e,r))&&!IsBlacklistedWord(e)&&(HasVowel(e)||IsWordWithoutVowel(e));if(t){n=n&&!ContainsFuncName(e)}return n}function StartsWithOptionalVariableAndFuncName(e){for(var t=0;t<FlatListMatch.FuncNames.length;t++){var r=FlatListMatch.FuncNames[t];if(e.startsWith(r)||e.startsWith("x"+r)||e.startsWith("y"+r)||e.startsWith("z"+r)||e.startsWith("i"+r)||e.startsWith("r"+r)||e.startsWith("t"+r)||e.startsWith("n"+r)){return true}}return false}function IsBlacklistedWord(e){return e==="xyz"||e==="abc"}var TriggyWords=["second","tangent","seconds","costs","coterminal","single","cosine","sector","send","logarithmic","sent","section","since","sections","sentence","secant","logarithms","logarithm","senior","tangente","costing","cosecant","seniors","tanget","sinusoidal","cotangent","tanque","tangents","logaritmo","sentences","tanks","tanto","sentido","sending","sense","cosines","coseno","logistic","security","costara","sines","cotains","cotton","costos","costado","singers","costumes","costaba","secret","costume","secured","secound","sinus","seccion","senor","sectional","logaritmos","secounds","singing","senora","coterminales","tangency","sinking","sends","cotangente","cosiente","cosecante","singular","secuencia","coterminals","logic","logged"];var VeryTriggyWords=["cost","tank","sink","sing"];function IsTriggyWord(e,t){e=TrimPunctuation(e);for(var r=0;r<TriggyWords.length;r++){if(e===TriggyWords[r]){return true}}if(t){for(r=0;r<VeryTriggyWords.length;r++){if(e===VeryTriggyWords[r]){return true}}}return false}function ContainsFuncName(e){for(var t=0;t<FlatListMatch.FuncNames.length;t++){var r=FlatListMatch.FuncNames[t];if(e.includes(r)){return true}}return false}function HasVowel(e){e=e.toUpperCase();return e.includes("A")||e.includes("E")||e.includes("I")||e.includes("O")||e.includes("U")}var WordsWithNoVowels=["by","my","cry","dry","fly","fry","glyph","gym","gyms","shy","try","why","sqrt","lcm","gcf","hcf","lcd","hmm","hmmm","hmmmm","btw","ty","np","Im","PC"];function IsWordWithoutVowel(e){e=TrimPunctuation(e).toUpperCase();for(var t=0;t<WordsWithNoVowels.length;t++){if(e===WordsWithNoVowels[t].toUpperCase()){return true}}return false}function TrimPunctuation(e){return e.replace(/^\W+/g,"").replace(/\W+$/g,"")}function IsBaseType(e){switch(e){case"number":case"func":case"letter":case"paren":case"factorial":case"matrix":case"unit":case"chemElement":case"placeholder":return true;default:return false}}Head.prototype.NeedsPlaceholder=function(){if(this.IsEmpty()&&this.parent!==null){return this.parent instanceof Matrix||this.parent instanceof Fraction||this.parent instanceof Piecewise||this.parent instanceof Table||this.parent instanceof ShapeTable||this.parent instanceof Superscript||this.parent instanceof Subscript||this.parent instanceof Accent||this.parent instanceof Radical||this.parent instanceof PermComb||this.parent instanceof Limit}return false};function StartTag(e,t,r,n){var i="<"+e;if(!IsNull(t.id)&&!r){i+=' id="'+t.id+'"'}if(!IsNull(n)){for(var a in n){if(n.hasOwnProperty(a)){i+=" "+a+'="'+n[a]+'"'}}}i+=">";return i}function GrouperToString(e){if(e instanceof Fraction){return"fraction"}else if(e instanceof Superscript){return"superscript"}else if(e instanceof Subscript){return"subscript"}else if(e instanceof Limit){return"limit"}else if(e instanceof Integral){return"integral"}else if(e instanceof Summation){return"summation"}else if(e instanceof Radical){return"radical"}else if(e instanceof PermComb){return"permcomb"}else if(e instanceof Table){return"table"}else if(e instanceof Matrix){return"matrix"}else if(e instanceof Piecewise){return"piecewise"}else if(e instanceof ShapeTable){return"shapetable"}else if(e instanceof Placeholder){return"placeholder"}return null}Head.prototype.ToHtml=function(e,t){if(IsNull(e))e=false;var r="";var n;var i;if(IsNull(this.parent)){n=false;i=false;r+=StartTag("div",this,e,{"class":"editorLine"})}else{n=true;i=true}if(this.NeedsPlaceholder()){return PlaceholderString}else if((this.parent instanceof Summation||this.parent instanceof Integral)&&this.IsEmpty()){if(this.parent.placeholders)return PlaceholderString;else return"<mphantom>"+StartTag("mi",this,e)+ZeroWidthNonBreakingSpace+"</mi></mphantom>"}else{var a=RunAutomaton(this.next,i,t,null,e);if(!i){MathSpacesToMathML(a)}for(var o=0;o<a.length;o++){var s=a[o];if(!i){if(n&&!s.inMath){r+="</mrow></math></script>"}if(!n&&s.inMath){r+='<script type="math/mml"><math><mrow>'}n=s.inMath}r+=s.html}}if(IsNull(this.parent)){if(n){r+="</mrow></math></script>"}r+="</div>"}return r};function RunAutomaton(e,t,r,n,i){if(IsNull(n)){n=function(){return false}}var a=e,o=[];while(!(a instanceof Head)&&!n(a)){Automaton(a,o,t,r,i);var s=o[o.length-1];a=s.node}return o}function MathSpacesToMathML(e){var t=null;for(var r=0;r<e.length;r++){if(e[r].type==="space"){if(!IsNull(t)){t.push(e[r])}}else{if(e[r].inMath){if(IsNull(t)){t=[]}while(t.length>0){var n=t.pop();n.html=n.inMathHtml;n.inMath=true}}else{t=null}}}}var FunctionApplicationSymbol="&#x2061;";var IntegralSymbol="&#x222b;";var SummationSymbol="&#x2211;";var NonBreakingSpace="&#x00a0;";var ZeroWidthNonBreakingSpace="&#xfeff;";var NewLine="↵";var UnicodeToHex={"°":"&#x00b0;","′":"&#x2032;","″":"&#x2033;","*":"&#x22c5;","α":"&#x03b1;","β":"&#x03b2;","γ":"&#x03b3;","δ":"&#x03b4;","ε":"&#x03b5;","ζ":"&#x03b6;","η":"&#x03b7;","θ":"&#x03b8;","ι":"&#x03b9;","κ":"&#x03ba;","λ":"&#x03bb;","μ":"&#x03bc;","ν":"&#x03bd;","ξ":"&#x03be;","ο":"&#x03bf;","π":"&#x03c0;","ρ":"&#x03c1;","σ":"&#x03c3;","τ":"&#x03c4;","υ":"&#x03c5;","φ":"&#x03c6;","χ":"&#x03c7;","ψ":"&#x03c8;","ω":"&#x03c9;","→":"&#x2192;","÷":"&#x00f7;","≤":"&#x2264;","≥":"&#x2265;","≠":"&#x2260;","<":"&#x003c;",">":"&#x003e;","&":"&#x0026;","∪":"&#x222a;","∩":"&#x2229;","±":"&#x00b1;","∫":"&#x222b;","∑":"&#x2211;","∠":"&#x2220;","⊙":"&#x2299;","△":"&#x25b3;","□":"&#x25a1;","≅":"&#x2245;","∥":"&#x2225;","⟂":"&#x27c2;"};var GetHexForUnicode=function(e){var t="";for(var r=0;r<e.length;r++){t+="&#x"+("000"+e.charCodeAt(r).toString(16)).substr(-4)+";"}return t};var NameToHex={degree:"&#x00b0;",minute:"&#x2032;",second:"&#x2033;",mult:"&#x22c5;",alpha:"&#x03b1;",mu:"&#x03bc;",arrow:"&#x2192;",division:"&#x00f7;",lte:"&#x2264;",gte:"&#x2265;",ne:"&#x2260;",lt:"&#x003c;",gt:"&#x003e;",amp:"&#x0026;",union:"&#x222a;",inter:"&#x2229;",plusminus:"&#x00b1;",integral:"&#x222b;",summation:"&#x2211;"};var PlaceholderString='<mo class="Placeholder">?</mo>';Character.prototype.ToHtml=function(e,t,r,n){var i="";if(!IsNull(this.id)&&!t){i+=' id="'+this.id+'"'}if(this.grey&&!t){i+=' class="greyParen"'}for(var a in r){if(r.hasOwnProperty(a)){i+=" "+a+'="'+r[a]+'"'}}var o=typeof n==="string"?n:this.value;if(UnicodeToHex.hasOwnProperty(o)){o=UnicodeToHex[o]}if(this.value==="x̄"){o='<mover accent="true"><mi>x</mi><mo>&#x203e;</mo></mover>'}return"<"+e+i+">"+o+"</"+e+">"};TrigLog.prototype.ToHtml=function(e){return this.ToPreHtml(e)+this.ToPostHtml()};TrigLog.prototype.ToPreHtml=function(e){var t=StartTag("mi",this,e);var r="";if(e){r=this.value;t=StartTag("mi",this,e,{mathvariant:"normal"})}else{for(var n=0;n<this.value.length;n++){r+='<mi mathvariant="normal">'+this.value[n]+"</mi>"}}var i="</mi>";return t+r+i};TrigLog.prototype.ToPostHtml=function(){return"<mo>"+FunctionApplicationSymbol+"</mo>"};Placeholder.prototype.ToHtml=function(e){return StartTag("mo",this,e,{"class":"Placeholder"})+"?</mo>"};Fraction.prototype.ToHtml=function(e){var t=StartTag("mfrac",this,e)+StartTag("mrow",this.numerator,e);t+=this.numerator.ToHtml(e);t+="</mrow>"+StartTag("mrow",this.denominator,e);t+=this.denominator.ToHtml(e);t+="</mrow></mfrac>";return t};Superscript.prototype.ToHtml=function(e,t){var r=StartTag("msup",this,t)+"<mrow>"+e+"</mrow>"+StartTag("mrow",this.contents,t);r+=this.contents.ToHtml(t);r+="</mrow></msup>";return r};Subscript.prototype.ToHtml=function(e,t){var r=StartTag("msub",this,t)+"<mrow>"+e+"</mrow>"+StartTag("mrow",this.contents,t);r+=this.contents.ToHtml(t);r+="</mrow></msub>";return r};function MakeSubSup(e,t,r,n){var i=StartTag("msubsup",r,n);i+="<mrow>"+e+"</mrow>";i+=StartTag("mrow",t.contents,n)+t.contents.ToHtml(n)+"</mrow>";i+=StartTag("mrow",r.contents,n)+r.contents.ToHtml(n)+"</mrow></msubsup>";return i}Accent.prototype.ToHtml=function(e){var t=StartTag("mover",this,e,{accent:true,stretchy:true})+StartTag("mrow",this.contents,e);t+=this.contents.ToHtml(e)+"</mrow><mo>"+Accent.types[this.accent]+"</mo>";t+="</mover>";return t};Limit.prototype.ToHtml=function(e){var t="<munder>"+StartTag("mo",this,e)+"lim</mo>"+StartTag("mrow",this.contents,e);t+=this.contents.ToHtml(e);t+="</mrow></munder>";return t};Integral.prototype.ToHtml=Summation.prototype.ToHtml=function(e){var t='<mstyle displaystyle="true"><munderover>'+StartTag("mo",this,e)+(this instanceof Integral?IntegralSymbol:SummationSymbol)+"</mo>";t+=StartTag("mrow",this.lowerBound,e);if(!this.lowerBound.Any()&&this.placeholders)t+=PlaceholderString;else t+=this.lowerBound.ToHtml(e);t+="</mrow>";t+=StartTag("mrow",this.upperBound,e);if(!this.upperBound.Any()&&this.placeholders)t+=PlaceholderString;else t+=this.upperBound.ToHtml(e);t+="</mrow>";t+="</munderover></mstyle>";return t};Radical.prototype.ToHtml=function(e){var t=StartTag("mroot",this,e)+StartTag("mrow",this.radicand,e)+this.radicand.ToHtml(e)+'<mspace width="thinmathspace"></mspace></mrow>';if(this.HasIndex()){t+=StartTag("mrow",this.index,e)+this.index.ToHtml(e)+"</mrow>"}else if(this.placeholders){t+=StartTag("mrow",this.index,e)+PlaceholderString+"</mrow>"}else{t+="<mrow>"+StartTag("mphantom",this.index,e)+"<mn>2</mn></mphantom></mrow>"}t+="</mroot>";return t};Matrix.prototype.ToHtml=function(e){var t=StartTag("mrow",this,e)+"<mo>[</mo><mtable>";for(var r=0;r<this.children.length;r+=this.numCols){var n=this.children.slice(r,r+this.numCols);var i=n.map(function(t){return"<mtd>"+StartTag("mrow",t,e)+t.ToHtml(e)+"</mrow></mtd>"}).join("");t+="<mtr>"+i+"</mtr>"}t+="</mtable><mo>]</mo></mrow>";return t};PermComb.prototype.ToHtml=function(e){var t=StartTag("mmultiscripts",this,e)+"<mi>"+this.letter+"</mi>";t+=StartTag("mrow",this.right,e)+this.right.ToHtml(e)+"</mrow><none/><mprescripts/>";t+=StartTag("mrow",this.left,e)+this.left.ToHtml(e)+"</mrow><none/></mmultiscripts>";return t};Table.prototype.ToHtml=function(e){var t=IsNull(this.id)||e?"":' id="'+this.id+'"';var r="<mtable"+t+' rowalign="center" columnalign="left" rowlines="dashed none" columnlines="solid">';for(var n=0;n<this.children.length;n=n+2){r+="<mtr>"+StartTag("mtd",this.children[n],e);r+=this.children[n].ToHtml(e);r+="</mtd>"+StartTag("mtd",this.children[n+1],e);r+=this.children[n+1].ToHtml(e);r+="</mtd></mtr>"}r+="</mtable>";return r};Piecewise.prototype.ToHtml=function(e){var t="<mrow><mo>{</mo>"+StartTag("mtable",this,e);for(var r=0;r<this.children.length;r++){var n=this.SplitRow(r,e);t+="<mtr>";for(var i=0;i<n.length;i++){var a="",o="";if(n.length===1||n.length===2){a="<mtd>";o="</mrow></mtd>";if(i===0){a+=StartTag("mrow",this.children[r],e)}else{a+="<mrow>"}}else if(n.length>2){if(i===0){a="<mtd>"+StartTag("mrow",this.children[r],e);o="</mrow></mtd><mtd><mrow>"}else if(i===n.length-1){a="</mrow></mtd><mtd><mrow>";o="</mrow></mtd>"}}t+=a+n[i]+o}t+="</mtr>"}t+='</mtable><mspace width="em"></mspace></mrow>';return t};Piecewise.prototype.SplitRow=function(e,t){var r=[],n=this.children[e].next;if(this.children[e].NeedsPlaceholder()){return[this.children[e].ToHtml(t)]}var i=RunAutomaton(n,true,null,null,t);r.push("");for(var a=0;a<i.length;a++){r[r.length-1]+=i[a].html;var o=i[a].type;if(o==="word"||o==="space"||o==="comma"){r.push("")}}if(r[r.length-1]==="")r.pop();return r};ShapeTable.prototype.ToHtml=function(e){var t=!IsNull(this.id)&&!e?' id="'+this.id+'"':"";if(this.type.type!=="tri"){var r="<mtable"+t+' class="shapeTable" rowalign="center" columnalign="right" rowlines="dashed" columnlines="none">';var n="";for(var i=0;i<this.labels.length;i++){n+="<mtr><mtd><mrow>";n+=this.labels[i].ToHtml(e);n+="</mrow></mtd>"+"<mtd>"+StartTag("mrow",this.children[i],e);n+=this.children[i].ToHtml(e);n+="</mrow></mtd></mtr>"}}else{r="<mtable"+t+' class="shapeTable" columnlines="solid" rowlines="solid">';
var a="<mtable>";var o="<mtable>";for(i=0;i<this.labels.length;i+=2){a+="<mtr><mtd><mrow>";a+=this.labels[i].ToHtml(e);a+="</mrow></mtd><mtd>"+StartTag("mrow",this.children[i],e);a+=this.children[i].ToHtml(e);a+="</mrow></mtd></mtr>";o+="<mtr><mtd><mrow>";o+=this.labels[i+1].ToHtml(e);o+="</mrow></mtd><mtd>"+StartTag("mrow",this.children[i+1],e);o+=this.children[i+1].ToHtml(e);o+="</mrow></mtd></mtr>"}a+="</mtable>";o+="</mtable>";return r+"<mtr><mtd><mi>Side</mi></mtd><mtd><mi>Angle</mi></mtd></mtr><mtr><mtd>"+a+"</mtd><mtd>"+o+"</mtd></mtr></mtable>"}return r+n+"</mtable>"};Head.prototype.ToAsciiMath=function(){return this.ToAsciiMathRange()};Head.prototype.ToAsciiMathRange=function(e,t){if(IsNull(e)){e=this.next}if(IsNull(t)){t=this}var r="";var n=e;while(n!==t&&!(n instanceof Head)){r+=n.ToAsciiMath();n=n.next}return r};Character.prototype.ToAsciiMath=function(){for(var e=0;e<AllCharacterTokens.length;e++){if(this.value===AllCharacterTokens[e][0]){var t=AllCharacterTokens[e][1];if(t.startsWith("\\"))t=t+" ";return t}}if(this.value===NewlineString)return Tokens.NewLine[0][1];return this.value};TrigLog.prototype.ToAsciiMath=function(){return"\\"+this.value+" "};Placeholder.prototype.ToAsciiMath=function(){return""};Fraction.prototype.ToAsciiMath=function(){return"("+this.numerator.ToAsciiMath()+")/("+this.denominator.ToAsciiMath()+")"};Superscript.prototype.ToAsciiMath=Subscript.prototype.ToAsciiMath=function(){var e="("+this.contents.ToAsciiMath()+")";return(this instanceof Superscript?"^":"_")+e};Accent.prototype.ToAsciiMath=function(){return this.accent+"{"+this.contents.ToAsciiMath()+"}"};Limit.prototype.ToAsciiMath=function(){return"\\lim_("+this.contents.ToAsciiMath()+")"};Integral.prototype.ToAsciiMath=Summation.prototype.ToAsciiMath=function(){var e="",t="";if(this.lowerBound.Any()){e=this.lowerBound.ToAsciiMath();if(e.length>1)e="("+e+")";e="_"+e}if(this.upperBound.Any()){t=this.upperBound.ToAsciiMath();if(t.length>1)t="("+t+")";t="^"+t}return(this instanceof Integral?"\\int":"\\sum")+e+t+" "};Radical.prototype.ToAsciiMath=function(){var e=this.radicand.ToAsciiMath(),t="";if(this.index.Any()){t+="\\root("+this.index.ToAsciiMath()+")("}else{t+="\\sqrt("}return t+e+")"};Matrix.prototype.ToAsciiMath=function(){var e="[";for(var t=0;t<this.numRows;t++){if(t!==0){e+=","}e+="[";for(var r=0;r<this.numCols;r++){if(r!==0){e+=","}var n=this.children[t*this.numCols+r].ToAsciiMath();if(n.indexOf(",")!==-1)n="("+n+")";e+=n}e+="]"}e+="]";return e};Table.prototype.ToAsciiMath=function(){var e="\\table[";for(var t=0;t<this.children.length;t++){var r=this.children[t].ToAsciiMath();if(r.indexOf(",")!==-1)r="("+r+")";if(t%2===0){e+="["+r}else{e+=","+r+"]";if(t!==this.children.length-1){e+=","}}}e+="]";return e};PermComb.prototype.ToAsciiMath=function(){return"\\"+(this.letter==="P"?"Perm":"Comb")+"{"+this.left.ToAsciiMath()+"}{"+this.right.ToAsciiMath()+"}"};Piecewise.prototype.ToAsciiMath=function(){var e="{";for(var t=0;t<this.children.length;t++){if(t!==0){e+=","}e+="("+this.children[t].ToAsciiMath()+")"}e+=":}";return e};ShapeTable.prototype.ToAsciiMath=function(){var e=[];for(var t=0;t<this.labels.length;t++){var r=this.children[t].ToAsciiMath();if(r.indexOf(",")!==-1)r="("+r+")";e.push("["+this.labels[t].ToAsciiMath()+","+r+"]")}var n="shape";if(this.type===ShapeType.TRI){n="tri"}return"\\"+n+"Table["+e.join(",")+"]"};function GreekNameToLetter(e){switch(e){case"alpha":return"α";case"beta":return"β";case"gamma":return"γ";case"delta":return"δ";case"epsilon":return"ε";case"zeta":return"ζ";case"eta":return"η";case"theta":return"θ";case"iota":return"ι";case"kappa":return"κ";case"lamda":case"lambda":return"λ";case"mu":return"μ";case"nu":return"ν";case"xi":return"ξ";case"omicron":return"ο";case"pi":return"π";case"rho":return"ρ";case"sigma":return"σ";case"tau":return"τ";case"upsilon":return"υ";case"phi":return"φ";case"chi":return"χ";case"psi":return"ψ";case"omega":return"ω";default:return null}}Head.prototype.ToKeystrokeFormat=function(e){var t=e===this?"\\|":"";for(var r=this.next;r!==this;r=r.next){t+=r.ToKeystrokeFormat(e)}return t};Character.prototype.ToKeystrokeFormat=function(e){var t=this.ToAsciiMath();if(e===this){t+="\\|"}return t};TrigLog.prototype.ToKeystrokeFormat=function(e){var t=this.value;if(e===this){t+="\\|"}return t};Placeholder.prototype.ToKeystrokeFormat=function(e){return e===this?"\\|":""};Fraction.prototype.ToKeystrokeFormat=function(e){var t="\\{frac}";t+=this.numerator.ToKeystrokeFormat(e);t+="\\>";t+=this.denominator.ToKeystrokeFormat(e);t+="\\>";if(e===this){t+="\\|"}return t};Superscript.prototype.ToKeystrokeFormat=function(e){var t="^";t+=this.contents.ToKeystrokeFormat(e);t+="\\>";if(e===this){t+="\\|"}return t};Subscript.prototype.ToKeystrokeFormat=function(e){var t="_";t+=this.contents.ToKeystrokeFormat(e);t+="\\>";if(e===this){t+="\\|"}return t};Accent.prototype.ToKeystrokeFormat=function(e){return this.accent};Limit.prototype.ToKeystrokeFormat=function(e){var t="\\{lim}";var r="";var n=false;var i="";for(var a=this.contents.next;a!==this.contents;a=a.next){if(!n&&a instanceof Character&&a.value==="→"){n=true;if(e===a){i+="\\|"}}else{var o=a.ToKeystrokeFormat(e);if(n){i+=o}else{r+=o}}}t+=r+"\\>"+i+"\\>";if(e===this){t+="\\|"}return t};Integral.prototype.ToKeystrokeFormat=function(e){var t="\\{int}";if(this.lowerBound.Any()||this.upperBound.Any()){t+="\\<\\<";t+=this.lowerBound.ToKeystrokeFormat(e);t+="\\>";t+=this.upperBound.ToKeystrokeFormat(e);t+="\\>"}if(e===this){t+="\\|"}return t};Summation.prototype.ToKeystrokeFormat=function(e){var t="\\{sum}";if(this.lowerBound.Any()||this.upperBound.Any()){t+="\\<\\<";t+=this.lowerBound.ToKeystrokeFormat(e);t+="\\>";t+=this.upperBound.ToKeystrokeFormat(e);t+="\\>"}if(e===this){t+="\\|"}return t};Radical.prototype.ToKeystrokeFormat=function(e){var t="\\{rad}";if(this.index.Any()){t+="\\<";t+=this.index.ToKeystrokeFormat(e);t+="\\>"}t+=this.radicand.ToKeystrokeFormat(e);t+="\\>";if(e===this){t+="\\|"}return t};PermComb.prototype.ToKeystrokeFormat=function(e){var t=this.letter==="P"?"\\{perm}":"\\{comb}";t+=this.left.ToKeystrokeFormat(e);t+="\\>";t+=this.right.ToKeystrokeFormat(e);t+="\\>";if(e===this){t+="\\|"}return t};Table.prototype.ToKeystrokeFormat=function(e){return"\\{table}"};Matrix.prototype.ToKeystrokeFormat=function(e){return"\\{matrix}"};Piecewise.prototype.ToKeystrokeFormat=function(e){return"\\{piecewise}"};ShapeTable.prototype.ToKeystrokeFormat=function(e){return"\\{shapetable}"};"use strict";var NormFuncs={PermComb:FlatListMatch.PermComb(),NatNum:FlatListMatch.NaturalNumber(),Decimal:FlatListMatch.Decimal(),Variables:FlatListMatch.Variable(),Operators:FlatListMatch.Oper(),FracStr:FlatListMatch.FractionString(),FuncScript:FlatListMatch.FuncNameAndScript(),Smiley:FlatListMatch.SmileyString()};Head.prototype.Normalize=function(e){if(this.skipNormalize){this.skipNormalize=false;return e}var t=this.next;while(!(t instanceof Head)){if(Character.IsHighSurrogate(t)&&Character.IsLowSurrogate(t.next)){var r=new Placeholder;AddBefore(t,r);t.next.Delete();t.Delete();t=r}else if(Character.IsHighSurrogate(t)||Character.IsLowSurrogate(t)){r=new Placeholder;AddBefore(t,r);t.Delete();t=r}t=t.next}t=this.next;while(!(t instanceof Head)){if(IsGrouper(t)){GetGrouperChildren(t).forEach(function(t){e=t.Normalize(e)})}t=t.next}e=this.NormalizeNewlineInTablePiecewise(e);e=this.NormalizeMultiOper(e);e=this.FeedRadicals(e);e=this.NormalizeSubSup(e);var n=NormFuncs.PermComb;var i=NormFuncs.NatNum;var a=NormFuncs.Decimal;var o=NormFuncs.Variables;t=this.next;while(!(t instanceof Head)){var s={};if(NormFuncs.FracStr.func(t,s)!==null){var u=s["$1"].start;var l=s["$1"].end;var c=s["$2"].start;var p=s["$3"].start;var d=s["$3"].end;var f;var h;if(u instanceof Subscript&&u.prev instanceof TrigLog)u=u.next;if(u!==l){f=this.Splice(u,l.prev)}else{f=new Head}Delete(c);if(p!==d){h=this.Splice(p,d.prev)}else{h=new Head}var m=new Fraction(f,h);AddBefore(d,m);t=m;if(e===c){e=m.denominator}}else{var g=NormFuncs.FuncScript.func(t);if(IsNull(g)){t=t.next}else{t=g}}}e=this.NormalizeFactorial(e);var v;var b;var y=false;t=this.next;while(!(t instanceof Head)){if(t.value==="P"&&t.next.value==="(")y=true;if(n.func(t)!==null){var w=i.func(t);var C=i.func(w.next);var S=this.Splice(t);var x=S.Splice(w);Delete(x.next);var A=null;if(!(x instanceof Head)){A=x.Splice(C)}var T=new PermComb(w.value,S,x);this.Push(T);t=T;if(A!==null){this.Push(A)}if(e===w){e=x}}else if((v=a.func(t))!==null){t=v}else if((b=o.func(t))!==null){t=b}else if(!IsNull(this.parent)&&this.parent.DoesSplit(t)){if(y&&(t.value==="="||Character.IsInequality(t))){t=t.next}else{A=this.Splice(t);AddAfter(this.parent,A);t=this}}else{t=t.next}}e=this.NormalizeParen(e);return e};Head.prototype.NormalizeMultiOper=function(e){var t=this.next;while(t!==this){if(t instanceof Character&&t.next instanceof Character){if(t.value==="-"&&t.next.value===">"){if(e===t.next)e=t;t.next.Delete();t.value="→"}else if(t.value==="<"&&t.next.value==="="){if(e===t.next)e=t;t.next.Delete();t.value="≤"}else if(t.value===">"&&t.next.value==="="){if(e===t.next)e=t;t.next.Delete();t.value="≥"}}t=t.next}return e};Head.prototype.NormalizeParen=function(e){var t=[];var r=this.next;var n={")":"(","]":"[","}":"{"};var i={"(":")","[":"]","{":"}","|":"|"};var a=function(e,t){if((e.value==="("||e.value==="[")&&(t.value===")"||t.value==="]")){return true}if(e.value==="{"&&t.value==="}"){return true}return false};var o=function(e,t){return e.value==="{"&&t.value==="{"||(e.value==="("||e.value==="[")&&(t.value==="("||t.value==="[")};var s=null;var u=function(t){if(e===t){s=e.next;e=e.prev}Delete(t)};var l=this;while(r!==this){var c=l.next.value==="P"&&l.next.next.value==="(";var p=!ParenDoesSplit(r,t)||c&&(varCur=NormFuncs.Operators.func(r))!==null;while(r!==this&&p){if(Character.IsParen(r)){var d=null;if(t.length===0)d=l;else d=t[t.length-1];if(Character.IsAbs(r)){if((IsNull(d)||d.value!=="{")&&!(d.value==="("&&d.prev.value==="P")){if(Character.IsAbs(d)){t.pop()}else if(!r.grey)t.push(r);else u(r)}else{if(r.grey)u(r)}}else if(Character.IsOpenParen(r)){if(r.grey&&!(Character.IsOpenParen(r.prev)||Character.IsAbs(r.prev)||r.prev.grey||r.prev instanceof Head||ParenDoesSplit(r.prev,t))){r.grey=false}if(r.grey)u(r);else t.push(r)}else if(Character.IsCloseParen(r)){if(r.grey&&!(Character.IsCloseParen(r.next)||Character.IsAbs(r.next)||r.next.grey||r.next instanceof Head||ParenDoesSplit(r.next,t))){r.grey=false}if(!r.grey){if(a(d,r)){t.pop()}else{if(d instanceof Head&&NormFuncs.Smiley.func(d.next)!==null)AddAfter(d,new Character(" "));AddAfter(d,new Character(n[r.value],true))}}else{if(a(d,r)){if(d.grey&&r.grey){u(d);u(r);t.pop()}else if(a(d,r.next)&&!r.next.grey){u(r)}else t.pop()}else{u(r)}}}}var f=NormFuncs.Smiley.func(r);if(f!==null)r=f;else r=r.next;p=!ParenDoesSplit(r,t)||c&&(varCur=NormFuncs.Operators.func(r))!==null}l=r;if(ParenDoesSplit(r,t)){r=r.next}if(t.length>0&&l instanceof Head&&f!==null)AddBefore(l,new Character(" "));while(t.length>0){var h=t.pop();if(h.grey)u(h);else AddBefore(l,new Character(i[h.value],true))}}if(!IsNull(s)){e=s.prev}return e};Head.prototype.NormalizeFactorial=function(e){function t(e){return!IsNull(e.value)&&e.value==="!"}function r(e){return Character.IsLetter(e)||Character.IsDigit(e)}var n=this.next;while(n!==this){if(n instanceof Fraction){if(t(n.numerator.next)){var i=n.prev;var a=n.numerator.next;while(r(i)){Delete(i);AddBefore(a,i);a=n.numerator.next;i=n.prev}}}n=n.next}return e};Head.prototype.NormalizeSubSup=function(e){function t(e){return!IsNull(e.value)&&e.value==="_"}function r(e){return!IsNull(e.value)&&e.value==="^"}function n(e){return e==="number"||e==="unit"||e==="letter"||e==="paren"||e==="operator"||e==="factorial"}function i(e){return Character.IsLetter(e)||Character.IsDigit(e)||Character.IsParen(e)}var a=this.next;while(a!==this){var o=false;if(t(a)||r(a)){o=true;var s=new Head;var u=t(a)?new Subscript(s):new Superscript(s);var l=a.next;if(e===a)e=s;var c=[];Automaton(l,c,false);var p=c.shift();AddBefore(a,u);Delete(a);if(!IsNull(p)&&n(p.type)&&!Character.IsCloseParen(l)){var d=l;while(d!==p.node){var f=d.next;Delete(d);s.Push(d);d=f}a=d}a=u}a=o?u.next:a.next;if(a.prev instanceof Subscript&&a.prev.prev instanceof Superscript&&!(a.prev.prev.prev instanceof Subscript)){var h=a.prev;var m=a.prev.prev;Delete(h);AddBefore(m,h)}if(a.prev instanceof Superscript&&a.prev.prev instanceof Fraction&&i(a.prev.prev.denominator.next)&&o){h=a.prev;m=a.prev.prev;Delete(h);AddBefore(m.denominator,h)}}return e};Head.prototype.NormalizeNewlineInTablePiecewise=function(e){if(this.parent instanceof Piecewise||this.parent instanceof Table){var t=this.next;while(t!==this){if(!Character.IsNewLine(t)){t=t.next;continue}var r=this.parent.children.indexOf(this);var n;if(t.next===this)n=new Head(this.parent);else n=this.Splice(t.next);n.parent=this.parent;this.parent.children.splice(r+1,0,n);if(this.parent instanceof Table)this.parent.children.splice(r+2,0,new Head(this.parent));if(e===t)e=n;Delete(t);break}}return e};Head.prototype.FeedRadicals=function(e){var t=this.next;while(t!==this){if(t instanceof Radical&&t.hungry){var r=t.next;while(Radical.IsPulled(r)||Character.IsOpenParen(r))r=Character.IsOpenParen(r)?FindMatchingParen(r).next:r.next;if(r!==t.next){t.radicand.Push(this.Splice(t.next,r.prev));break}t.hungry=false}t=t.next}return e};"use strict";var ParserState=function(){this.isInAbsVal=false;this.stopChars=[];this.isInMatrix=false};ParserState.prototype.IsClosingParen=function(e){return Character.IsCloseParen(e)||this.isInAbsVal&&Character.IsAbs(e)};ParserState.prototype.IsLetter=function(e){if(this.IsStopChar(e)){return false}return Character.IsLetter(e)};ParserState.prototype.IsStopChar=function(e){for(var t=0;t<this.stopChars.length;t++){if(this.stopChars[t]===e){return true}}return false};var Tokens={Char:[["α","\\alpha","𝛼"],["β","\\beta","𝛽"],["γ","\\gamma","𝛾"],["δ","\\delta","Δ","𝛿"],["ε","\\epsilon","𝜀"],["ζ","\\zeta","𝜁"],["η","\\eta","𝜂"],["θ","\\theta","Θ","𝜃"],["ι","\\iota","𝜄"],["κ","\\kappa","𝜅"],["λ","\\lambda","𝜆"],["μ","\\mu","𝜇"],["ν","\\nu","𝜈"],["ξ","\\xi","𝜉"],["ο","\\omicron","𝜊"],["π","\\pi","Π","𝜋"],["ρ","\\rho","𝜌"],["σ","\\sigma","𝜎"],["τ","\\tau","𝜏"],["υ","\\upsilon","𝜐"],["φ","\\phi","Φ","𝜑"],["χ","\\chi","𝜒"],["ψ","\\psi","𝜓"],["ω","\\omega","𝜔"],["→","->","↦"],["°","\\deg"],["x̄","\\bar{x}"],["∞","\\infty"],["∠","\\angle"],["⊙","\\geocircle"],["△","\\geotriangle"],["□","\\geoquad"],["≅","\\cong"],["∥","\\|"],["⟂","\\bot"],["a","a","𝑎"],["b","b","𝑏"],["c","c","𝑐"],["d","d","𝑑"],["e","e","𝑒"],["f","f","𝑓","ƒ"],["g","g","𝑔"],["h","h","ℎ"],["i","i","𝑖"],["j","j","𝑗"],["k","k","𝑘"],["l","l","𝑙","ℓ"],["m","m","𝑚"],["n","n","𝑛"],["o","o","𝑜"],["p","p","𝑝"],["q","q","𝑞"],["r","r","𝑟"],["s","s","𝑠"],["t","t","𝑡"],["u","u","𝑢"],["v","v","𝑣"],["w","w","𝑤"],["x","x","𝑥"],["y","y","𝑦"],["z","z","𝑧"]],Oper:[["×","\\times"],["≤","<="],["≥",">="],["≠","!="],["÷","-:"],["±","\\pm"],["∪","\\cup"],["∩","\\cap"],["-","-","‐","‑","‒","–","—","−","⎯"],["+","+","⁤"],["/","/","\\","⁄"],["*","*","•","⁢","·","⋅","∙","∗"],["'","'","’","′"],['"','"',"”","“"],["|","|","∣"],[",",",","‚"]],Root:["\\root",["\\sqrt","√"]],Trig:["sin","sinh","arcsin","cos","cosh","arccos","tan","tanh","arctan","cot","coth","arccot","sec","sech","arcsec","csc","csch","arccsc"],Func:["log","ln"],TrigLog:["\\sin","\\sinh","\\arcsin","\\cos","\\cosh","\\arccos","\\tan","\\tanh","\\arctan","\\cot","\\coth","\\arccot","\\sec","\\sech","\\arcsec","\\csc","\\csch","\\arccsc","\\log","\\ln"],Lim:["\\lim"],Smiley:[":-)",":-(",";-)",":)",":(",";)",";("],Shape:[["&#xF127;","\\rectangle"],["&#xF126;","\\circle"],["&#xF130;","\\triangle"],["&#xF128;","\\parallelogram"],["&#xF129;","\\trapezoid"],["&#xF131;","\\box"],["&#xF135;","\\sphere"],["&#xF132;","\\cone"],["&#xF133;","\\cylinder"],["&#xF134;","\\pyramid"],["&#xF140;","\\tri"]],PermComb:["\\Perm","\\Comb"],Int:[["∫","\\int"]],Sum:[["∑","\\sum","Σ"]],Table:["\\table","\\shapeTable","\\triTable"],NewLine:[[NewlineString,"\n","\r\n","\n\r","\\n"]],PiecewiseClose:[":}"],Accent:["\\overline","\\overrightarrow","\\overleftrightarrow","\\overfrown"],Space:[[" "," ","​"," "," "," "," "]],OpenParen:[["(","(","〖","〈","⟨"]],CloseParen:[[")",")","〗","〉","⟩"]],LongestToken:function(e,t){var r={cat:null,str:null};for(var n in Tokens){if(Tokens.hasOwnProperty(n)&&Tokens[n]instanceof Array){for(var i=0;i<Tokens[n].length;i++){var a=Tokens[n][i];if(typeof a==="string"){a=[a]}var o=a[0];for(var s=0;s<a.length;s++){if(e.startsWith(a[s],t)){if(r.str===null||r.str.length<a[s].length){r={cat:n.toString(),str:o,orig:a[s]}}}}}}}if(!IsNull(r.orig)&&r.orig.startsWith("\\")&&t+r.orig.length<e.length&&e[t+r.orig.length]===" "){r.orig+=" "}return r}};var AllCharacterTokens=Tokens.Char.concat(Tokens.Oper).concat(Tokens.Shape);var Parser=function(e,t){this.str=e;if(!IsNull(t)){this.pos=t}else{this.pos=0}this.root=new Head;this.tokens=[]};Parser.prototype.PreLex=function(){this.str=this.str.replace(/½/g,"(1)/(2)").replace(/⅓/g,"(1)/(3)").replace(/⅔/g,"(2)/(3)").replace(/…/g,"...").replace(/²/g,"^2").replace(/³/g,"^3").replace(/⁴/g,"^4").replace(/⁵/g,"^5").replace(/∈/g," in ")};Parser.prototype.Lex=function(){this.PreLex();var e=0;while(e<this.str.length){var t=Tokens.LongestToken(this.str,e);if(t.cat==="Smiley"){var r=this.tokens.length===0||this.tokens[this.tokens.length-1].cat==="Space";var n=e+t.orig.length===this.str.length||Tokens.LongestToken(this.str,e+t.orig.length).cat==="Space";if(!r||!n){t.str=null}}if(IsNull(t.str)){var i=this.str[e];if(Character.IsLetter(i)){this.tokens.push({cat:"Char",str:i});e++}else if(Character.IsDigit(i)){var a="";while(e<this.str.length&&(Character.IsDigit(this.str[e])||this.str[e]==="."&&a.indexOf(".")===-1)){a+=this.str[e];e++}this.tokens.push({cat:"Num",str:a})}else if(Character.IsSpace(i)){this.tokens.push({cat:"Space",str:" "});e++}else if(Character.IsOpenParen(i)){this.tokens.push({cat:"OpenParen",str:i});e++}else if(Character.IsCloseParen(i)){this.tokens.push({cat:"CloseParen",str:i});e++}else if(Character.IsOperator(i)){this.tokens.push({cat:"Oper",str:i});e++}else if(Character.IsFactorial(i)){this.tokens.push({cat:"Factorial",str:i});e++}else if(i==="⁡"||i==="‬"){e++}else{this.tokens.push({cat:"Char",str:i});e++}}else{e+=t.orig.length;this.tokens.push(t)}}};Parser.prototype.NextToken=function(){if(this.tokens.length<=this.pos){return{cat:"",str:"",orig:""}}return this.tokens[this.pos]};Parser.prototype.ParseChar=function(e){var t=new Head(null);var r=this.NextToken();while(this.pos<this.tokens.length&&r.cat==="Space"){this.pos++;t.Push(new Character(r.str));r=this.NextToken()}if(!e.IsStopChar(r.str)){switch(r.cat){case"Char":case"Oper":case"Factorial":case"NewLine":t.Push(r.str);this.pos++;break;case"Num":t.Push(r.str.split(""));this.pos++;break}}return t};Parser.prototype.ParseTrigLog=function(){var e=this.NextToken();if(e.cat==="TrigLog"){this.pos++;return new TrigLog(e.str.substring(1))}return null};Parser.prototype.ParseSmiley=function(){var e=this.NextToken();if(e.cat==="Smiley"){this.pos++;return new Head(null,e.str.split(""))}return null};Parser.prototype.ParseSuperscript=function(e){if(this.NextToken().str==="^"){this.pos++;var t;if("+-".indexOf(this.NextToken().str)>-1){var r=new ParserState;r.isInMatrix=e.isInMatrix;t=this.ParseSimpleExpression(r);if(IsNull(t))return null;if(this.pos<this.tokens.length&&"+-→".indexOf(this.NextToken().str)<0){r=new ParserState;r.isInMatrix=e.isInMatrix;var n=this.ParseSimpleExpression(r);if(IsNull(n))return null;t.Push(n)}else{}}else{r=new ParserState;r.isInMatrix=e.isInMatrix;t=this.ParseSimpleExpression(r);if(IsNull(t))return null;t=RemoveOuterParens(t)}return new Superscript(t)}return null};Parser.prototype.ParseSubscript=function(e){if(this.NextToken().str==="_"){this.pos++;var t=new ParserState;t.isInMatrix=e.isInMatrix;var r=this.ParseSimpleExpression(t);if(IsNull(r))return null;r=RemoveOuterParens(r);return new Subscript(r)}return null};Parser.prototype.ParseAccent=function(e){var t=this.NextToken();if(t.cat==="Accent"){this.pos++;var r=new ParserState;r.isInMatrix=e.isInMatrix;var n=this.ParseSimpleExpression(r);if(IsNull(n))return null;n=RemoveOuterParens(n);return new Accent(n,t.str)}return null};Parser.prototype.ParseUnary=function(e){var t=this.NextToken().str;this.pos++;var r=new Head;for(var n=0;n<t.length;n++){r.Push(new Character(t[n]))}var i=this.ParseSubscript(e);if(i!==null){r.Push(i)}var a=this.ParseSuperscript(e);if(a!==null){r.Push(a)}return r};Parser.prototype.ParseRadical=function(e){var t,r;var n;if(this.NextToken().str==="\\sqrt"){this.pos++;var i=new ParserState;i.isInMatrix=e.isInMatrix;r=RemoveOuterParens(this.ParseSimpleExpression(i));if(IsNull(r))return null;n=new Radical(null,r)}else{this.pos++;i=new ParserState;i.isInMatrix=e.isInMatrix;t=RemoveOuterParens(this.ParseSimpleExpression(i));if(IsNull(t))return null;i=new ParserState;i.isInMatrix=e.isInMatrix;r=RemoveOuterParens(this.ParseSimpleExpression(i));if(IsNull(r))return null;n=new Radical(t,r)}return n};Parser.prototype.ParseArray=function(e,t,r,n){var i=this.pos;var a=[];var o=this.NextToken().str;if(o===e){var s=true;while(this.pos<this.tokens.length&&(o===t||s&&o===e)){s=false;this.pos++;var u=new ParserState;u.isInMatrix=!!n;u.stopChars.push(t);var l=this.ParseExpression(u);if(IsNull(l))return null;a.push(l);o=this.NextToken().str}if(o!==r){this.pos=i;return null}this.pos++;return a}return null};Parser.prototype.ParseTable=function(){var e=this.NextToken().str;var t=this.pos-1;this.pos++;var r=this.ParseMatrix();if(r===null)return null;switch(e){case"\\table":var n=new Table(null,null);n.children=[];for(var i=0;i<r.children.length;i++){var a=r.children[i];n.children.push(a);a.parent=n}return n;case"\\triTable":case"\\shapeTable":if(t===-1)return null;var o=ShapeType.FromCharString(this.tokens[t].str);if(o!==null){n=new ShapeTable(o.type);for(var s=0;s<r.numRows&&s<n.children.length;s++){n.children[s]=r.Cell(s,1);n.children[s].parent=n}return n}break}return null};Parser.prototype.ParseMatrix=function(){var e=this.pos;var t=null;if(this.NextToken().str==="["){this.pos++;var r=true;var n=[];var i=true;while(i){if(!r){var a=this.NextToken().str;if(a===","){this.pos++}else if(a==="]"){this.pos++;var o=n.length;var s=0;for(var u=0;u<n.length;u++){s=Math.max(s,n[u].length)}t=new Matrix(o,s);for(var l=0;l<n.length;l++){for(var c=0;c<n[l].length;c++){t.Cell(l,c).Push(RemoveOuterParens(n[l][c]))}}i=false;continue}else{i=false;continue}}var p=this.ParseArray("[",",","]",true);if(p===null){i=false;continue}n.push(p);r=false}}if(t===null){this.pos=e}return t};Parser.prototype.MakePiecewise=function(e){var t=e.Split(",",true);var r=new Piecewise(t.length);for(var n=0;n<t.length;n++){r.children[n].Push(RemoveOuterParens(t[n]))}return r};Parser.prototype.ParseLimit=function(e){this.pos++;var t=this.ParseSubscript(e);var r=new Head;if(t!==null){r.Push(t.contents)}return new Limit(r)};Parser.prototype.ParseIntegral=function(e){this.pos++;var t=null;var r=null;if(this.NextToken().str==="_"){var n=this.ParseSubscript(e);if(n!==null){t=n.contents}}if(this.NextToken().str==="^"){var i=this.ParseSuperscript(e);if(i!==null){r=i.contents}}if(this.NextToken().str===" "){this.pos++}return new Integral(t,r)};Parser.prototype.ParseSummation=function(e){this.pos++;var t=null;var r=null;if(this.NextToken().str==="_"){var n=this.ParseSubscript(e);if(n!==null){t=n.contents}}if(this.NextToken().str==="^"){var i=this.ParseSuperscript(e);if(i!==null){r=i.contents}}if(this.NextToken().str===" "){this.pos++}return new Summation(t,r)};Parser.prototype.ParseFunction=function(e){if(this.pos>=this.tokens.length)return null;var t=this.ParseUnary(e);var r=this.ParseExpression(e);if(!IsNull(r)){t.Push(r);return t}return null};Parser.prototype.ParseSimpleExpression=function(e){if(this.pos>=this.tokens.length){return new Head}var t=null;switch(this.NextToken().cat){case"Trig":case"Func":t=this.ParseFunction(e);break;case"TrigLog":t=this.ParseTrigLog();break;case"Root":t=this.ParseRadical(e);break;case"Table":t=e.isInMatrix?null:this.ParseTable();break;case"OpenParen":var r=e.isInMatrix?null:this.ParseMatrix();if(r!==null){t=r;break}var n=this.NextToken();this.pos++;var i=new ParserState;i.isInAbsVal=n.str==="|";i.isInMatrix=!!e.isInMatrix;var a=this.ParseExpression(i);if(IsNull(a))return null;var o=this.NextToken();if(i.IsClosingParen(o.str)){this.pos++;t=new Head(null,[new Character(n.str),a,new Character(o.str)])}else if(n.str==="{"&&o.str===":}"){this.pos++;t=this.MakePiecewise(a)}break;case"Lim":t=this.ParseLimit(e);break;case"Int":t=this.ParseIntegral(e);break;case"Sum":t=this.ParseSummation(e);break;case"Char":case"Num":case"Oper":case"Factorial":case"Space":case"NewLine":t=this.ParseChar(e);break;case"Smiley":t=this.ParseSmiley(e);break;case"Shape":t=this.ParseShape(e);break;case"PermComb":t=this.ParsePermComb(e);break;case"Accent":t=this.ParseAccent(e);break}if(t!==null){if(t instanceof Head){return t}return(new Head).Push(t)}console.error("parse error: unexpected '"+this.NextToken().str+"' in "+this.str+" at token position "+this.pos);return null};Parser.prototype.ParseShape=function(e){var t=ShapeType.FromCharString(this.NextToken().str);this.pos++;var r=new Character(t.char);return r};Parser.prototype.ParsePermComb=function(e){var t;if(this.NextToken().orig.substring(1)==="Perm")t="P";else t="C";this.pos++;var r=RemoveOuterParens(this.ParseSimpleExpression(e));if(IsNull(r))return null;var n=RemoveOuterParens(this.ParseSimpleExpression(e));if(IsNull(n))return null;return new PermComb(t,r,n)};Parser.prototype.ParseIntermediateExpression=function(e){var t;if(this.NextToken().str==="_"||this.NextToken().str==="^"){t=new Head(null)}else t=this.ParseSimpleExpression(e);if(IsNull(t))return null;while(!(this.pos>=this.tokens.length||e.IsClosingParen(this.NextToken().str)||this.NextToken().str===":}"||e.IsStopChar(this.NextToken().str))){if(this.NextToken().str==="_"){var r=this.ParseSubscript(e);if(IsNull(r))return null;t.Push(r)}else if(this.NextToken().str==="^"){var n=this.ParseSuperscript(e);if(IsNull(n))return null;t.Push(n)}else break}return t};Parser.prototype.ParseExpression=function(e,t){if(IsNull(t)){t=new Head(null)}while(!(this.pos>=this.tokens.length||e.IsClosingParen(this.NextToken().str)||this.NextToken().str===":}"||e.IsStopChar(this.NextToken().str))){var r=this.ParseIntermediateExpression(e);if(IsNull(r))return null;if(this.NextToken().str==="/"||this.NextToken().str==="\\"){this.pos++;var n=RemoveOuterParens(r);var i=this.ParseIntermediateExpression(e);if(IsNull(i))return null;i=RemoveOuterParens(i);t.Push(new Fraction(n,i))}else t.Push(r)}return t};function RemoveOuterParens(e){if(e===null)return null;if(Character.IsOpenParen(e.First())&&Character.IsCloseParen(e.Last())){Delete(e.First());Delete(e.Last())}return e}Parser.prototype.Parse=function(){this.Lex();var e=this.ParseExpression(new ParserState);if(IsNull(e))return null;e.Normalize();return e};var KeystrokeTokens=["(",")","[","\\<","\\>","\\{comb}","\\{frac}","\\{int}","\\{lim}","\\{matrix}","\\{perm}","\\{piecewise}","\\{rad}","\\{shapetable}","\\{sum}","\\{table}","\\bar{x} ","\\|","]","^","_","{","|","}"];var KeystrokeTrie=null;var KeystrokeFormatParser=function(e){this.str=e;if(KeystrokeTrie===null){KeystrokeTrie=BuildTrie(KeystrokeTokens)}};KeystrokeFormatParser.prototype.Parse=function(){var e=new Head(null,[]);var t=e;var r=Tokenize(this.str,KeystrokeTrie);for(var n=0;n<r.length;n++){var i=r[n];switch(i){case"(":t=t.ApplyInput("(");break;case")":t=t.ApplyInput(")");break;case"[":t=t.ApplyInput("[");break;case"\\<":t=MoveCursorLeft(t);break;case"\\>":t=MoveCursorRight(t);break;case"\\{comb}":t=t.ApplyInput(new PermComb("C")).left;break;case"\\{frac}":t=t.ApplyInput(new Fraction).numerator;break;case"\\{int}":t=t.ApplyInput(new Integral);break;case"\\{lim}":var a=new Head(null,[new Placeholder,"→",new Placeholder]);t=t.ApplyInput(new Limit(a)).contents;break;case"\\{matrix}":throw"Cannot parse matrix";case"\\{perm}":t=t.ApplyInput(new PermComb("P")).left;break;case"\\{piecewise}":throw"Cannot parse piecewise";case"\\{rad}":t=t.ApplyInput(new Radical).radicand;break;case"\\{shapetable}":throw"Cannot parse shapetable";case"\\{sum}":t=t.ApplyInput(new Summation);break;case"\\{table}":throw"Cannot parse table";case"\\bar{x} ":t=t.ApplyInput("x̄");break;case"\\|":this.cursor=t;break;case"]":t=t.ApplyInput("]");break;case"^":t=t.ApplyInput(new Superscript).contents;break;case"_":t=t.ApplyInput(new Subscript).contents;break;case"{":t=t.ApplyInput("{");break;case"|":t=t.ApplyInput("|");break;case"}":t=t.ApplyInput("}");break;default:var o=new Parser(i);var s=o.Parse();if(IsNull(s))return null;var u=s.prev;t.ApplyInput(s);t=u;break}}return e};function BuildTrie(e){var t={children:{},isWord:false};for(var r=0;r<e.length;r++){AddToTrie(e[r],t)}return t}function AddToTrie(e,t){if(e.length>0){var r=e[0];var n=e.substring(1);if(typeof t.children[r]!=="object"){t.children[r]=BuildTrie([])}AddToTrie(n,t.children[r])}else{t.isWord=true}}function Tokenize(e,t){var r=[];var n=[];var i=0;while(i<e.length){var a=NextToken(e,i,t);if(a===null){n.push(e[i++])}else{if(n.length>0){r.push(n.join(""));n=[]}r.push(a);i+=a.length}}if(n.length>0){r.push(n.join(""))}return r}function NextToken(e,t,r){var n="";var i="";var a=r;for(var o=t;o<e.length;o++){i+=e[o];if(typeof a.children[e[o]]==="object"){a=a.children[e[o]]}else{break}if(a.isWord){n=i}}return n.length>0?n:null}function parseToRpn(e){if(IsNull(e)){return[]}if(e.indexOf("r")>=0&&e.indexOf("T")>=0){e=e.replace(/T/g,"\\theta")}e=e.trim().replace(/^[a-zA-Z]\([a-zA-Z]\)/,"y");try{var t=new Parser(e).Parse();if(t===null){return null}return parseFlatList(t)}catch(r){}return null}function changeVariables(e){var t=e.some(function(e){return e==="x"});var r=e.some(function(e){return e==="y"});var n=e.some(function(e){return e==="r"});var i=e.some(function(e){return/^[a-df-qs-wzA-QS-WZ]$/.test(e)});if(t&&r){if(!["=","<",">","≤","≥"].some(function(t){return e.some(function(e){return e===t})}))return null;else return e}else if(e.some(function(e){return e==="θ"})){if(!["=","<",">","≤","≥"].some(function(t){return e.some(function(e){return e===t})})){e=e.map(function(e){return e==="θ"?"x":e});return["y"].concat(e).concat(["="])}else if(r){return e.map(function(e){return e==="θ"?"x":e})}else return e}else if(t){var a=e.find(function(e){return/^[a-df-wyzA-WYZ]$/.test(e)});if(a)e=e.map(function(e){return e===a?"y":e})}else if(r){a=e.find(function(e){return/^[a-df-xzA-XZ]$/.test(e)});if(a)e=e.map(function(e){return e===a?"x":e})}else if(n&&!i)return e;else{a=e.find(function(e){return/^[a-df-xzA-XZ]$/.test(e)});if(a)e=e.map(function(e){return e===a?"x":e});a=e.find(function(e){return/^[a-df-wyzA-WYZ]$/.test(e)});if(a)e=e.map(function(e){return e===a?"y":e})}if(!["=","<",">","≤","≥"].some(function(t){return e.some(function(e){return e===t})})){if(e.some(function(e){return e==="y"||e==="Y"})&&!e.some(function(e){return e==="x"||e==="X"}))e=e.map(function(e){return e==="y"||e==="Y"?"x":e});e=["y"].concat(e).concat(["="])}return e}function parseFlatList(e){var t=tokenizeFlatList(e,true);return parseTokens(t)}function parseTokens(e){var t=[[]];for(var r=0;r<e.length;r++){if(e[r].type==="logic"){t.push([e[r]]);t.push([])}else t[t.length-1].push(e[r])}if(t.length%2===0)return null;for(r=0;r<t.length;r+=2){t[r]=parseNonLogic(t[r]);if(t[r]===null)return null}if(t.length===1)return t[0];var n=t[0];for(r=1;r<t.length;r+=2){n=n.concat(t[r+1]);n.push(t[r][0].str)}return n}function parseNonLogic(e){var t=[[]];for(var r=0;r<e.length;r++){if(e[r].type==="equality"){t.push([e[r]]);t.push([])}else t[t.length-1].push(e[r])}if(t.length%2===0)return null;if(t.length>3&&t.some(function(e){return e.length===0||e[0].str==="="}))return null;for(r=0;r<t.length;r+=2){t[r]=makeAddition({tok:t[r],pos:0});if(t[r]===null)return null}if(t.length===1)return t[0];var n=[];
for(r=0;r+2<t.length;r+=2){n.push([t[r],t[r+2],t[r+1][0].str].reduce(function(e,t){return e.concat(t)}))}return n.reduce(function(e,t){return[e,t,["and"]].reduce(function(e,t){return e.concat(t)})})}function tokenizeFlatList(e,t){var r=[{ascii:".2",num:"1",denom:"5"},{ascii:".4",num:"2",denom:"5"},{ascii:".6",num:"3",denom:"5"},{ascii:".8",num:"4",denom:"5"}];var n=[];var a="";for(var o=e.next;o!==e;o=o.next){if(o instanceof Character){a+=o.value}else{cur=o;if(cur instanceof Superscript){sup_str="";cur=cur.contents.next;while(cur instanceof Character){sup_str+=cur.value;cur=cur.next}sup_sign=sup_str!==""&&sup_str[0]==="-"?"-":"";if(sup_sign!=="")sup_str=sup_str.substring(1);sup_whole="";sup_str=sup_str.split(".");if(sup_str.length===2&&/^-?\d*$/.test(sup_str[0])){sup_whole=sup_str[0];sup_str="."+sup_str[1]}else sup_str="";sup_map=null;for(i=0;i<r.length;i++){if(r[i].ascii==sup_str)sup_map=r[i]}if(cur instanceof Head&&sup_map){sup_num=Number(sup_whole)*Number(sup_map.denom)+Number(sup_map.num);cur=new Superscript([new Fraction(sup_sign+sup_num,sup_map.denom)])}else cur=o}if(a){var s=tokenizeStr(a,t);if(s===null){return null}n=n.concat(s);a=""}if(cur instanceof TrigLog){n=n.concat(tokenizeStr(cur.value,false))}else{n.push({item:cur,type:"grouper"})}}}if(a){s=tokenizeStr(a,t);if(s===null){return null}n=n.concat(s)}return n}function tokenizeStr(e,t){var r=e;var n=[];var i=[{type:"space",regex:/^\s+/},{type:"comma",regex:/^,/},{type:"trig",regex:/^(arc)?(sin|sen|cos|tan|csc|sec|cot)h?|^ln|^sqrt/},{type:"log",regex:/^log/},{type:"logic",regex:/^(and|or)/},{type:"number",regex:/^\d+(\.\d*)?|^\.\d+|^\\infty|^∞ ?/},{type:"letter",regex:/^[a-zA-Zα-ω]/},{type:"equality",regex:/^[=≠<>≤≥]/},{type:"multiplication",regex:/^\*|^÷/},{type:"addition",regex:/^[\+\-]/},{type:"lparen",regex:/^\(/},{type:"rparen",regex:/^\)/},{type:"abs",regex:/^\|/}];while(r.length>0){var a=false;for(var o=0;o<i.length;o++){var s=r.match(i[o].regex);if(s!==null){var u=s[0];if(i[o].type!=="space"||!t){n.push({str:u,type:i[o].type})}r=r.substring(u.length);a=true;break}}if(!a){return null}}return n}function makeEquation(e){var t=makeAddition(e);if(t===null){return null}if(e.pos+1<e.tok.length){var r=e.tok[e.pos];if(r.type==="equality"){var n=e.pos;e.pos++;var i=makeAddition(e);if(i===null){e.pos=n}else{return t.concat(i,[r.str])}}}return t}function makeAddition(e){var t=makeMultiplication(e);if(t===null){return null}while(e.pos+1<e.tok.length){var r=e.tok[e.pos];if(r.type==="addition"){var n=e.pos;e.pos++;var i=makeMultiplication(e);if(i===null){e.pos=n;break}else{t=t.concat(i,[r.str])}}else break}return t}function makeMultiplication(e){var t=makeFactor(e);if(t===null){return null}var r=e.pos;while(e.pos<e.tok.length){var n="*";var i=false;if(e.tok[e.pos].type==="multiplication"){n=e.tok[e.pos].str;i=true;e.pos++}var a=null;if(e.pos<e.tok.length){var o=e.pos>0?e.tok[e.pos-1]:null;var s=e.tok[e.pos];a=i?makeFactor(e):makeBareFactor(e);if(!i&&s.item instanceof Fraction&&o!==null&&tokenIsInteger(o)){var u=tokenizeFlatList(s.item.numerator,false);var l=tokenizeFlatList(s.item.denominator,false);if(u.length===1&&l.length===1&&tokenIsInteger(u[0])&&tokenIsInteger(l[0])){t[t.length-1]=t[t.length-1]+Number(u[0].str)/Number(l[0].str);e.pos++;return t}}}if(a===null){break}else{r=e.pos;t=t.concat(a,[n.replace("÷","/")])}}e.pos=r;return t}function tokenIsInteger(e){return e.type==="number"&&e.str.match(/^[0-9]*$/)!==null}function makeFactor(e){if(e.pos>=e.tok.length){return null}var t=e.pos;if(e.tok[e.pos].type==="addition"){var r=e.tok[e.pos];e.pos++;var n=makeFactor(e);if(n===null){e.pos=t;return null}if(r.str==="-"){n=n.concat(["neg"])}return n}return makeBareFactor(e)}function makeBareFactor(e){var t=e.pos;var r=makeFunction(e);if(r!==null){return r}e.pos=t;var n=makeIntermediateExpr(e);if(n!==null){return n}e.pos=t;return null}function makeFunction(e){var t=e.pos;if(e.tok[e.pos].type==="trig"||e.tok[e.pos].type==="log"){var r=e.tok[e.pos];var n=[];var i=e.tok[e.pos].type==="log";var a=i?[10]:[];e.pos++;if(e.pos>=e.tok.length){e.pos=t;return null}if(e.tok[e.pos].type==="grouper"){if(e.tok[e.pos].item instanceof Superscript){var o=parseFlatList(e.tok[e.pos].item.contents);if(o===null){e.pos=t;return null}n=n.concat(o,["^"]);e.pos++}else if(e.tok[e.pos].item instanceof Subscript){var s=parseFlatList(e.tok[e.pos].item.contents);if(s===null){e.pos=t;return null}if(i){a=s}else{n=n.concat(s,["_"])}e.pos++}}if(e.pos>=e.tok.length){e.pos=t;return null}var u=makeFunctionArg(e);if(u!==null){return a.concat(u,[r.str.replace("sen","sin")],n)}}e.pos=t;return null}function makeFunctionArg(e){var t=e.pos;var r=makeParen(e);if(r!==null){return r}e.pos=t;r=makeNonparenthesizedFunctionArg(e);if(r!==null){return r}e.pos=t;return null}function makeNonparenthesizedFunctionArg(e){var t=makeNonfunctionBareFactorNoParen(e);if(t===null){return null}var r=e.pos;while(e.pos<e.tok.length){var n=makeIntermediateExpr(e);if(n!==null){t=t.concat(n,["*"]);r=e.pos}else break}e.pos=r;return t}function makeNonfunctionBareFactorNoParen(e){var t=makeTerminal(e);if(t===null){return null}return addSubSups(t,e)}function makeIntermediateExpr(e){var t=makeSimpleExpr(e);if(t===null){return null}return addSubSups(t,e)}function addSubSups(e,t){var r=t.pos;while(t.pos<t.tok.length){var n=t.tok[t.pos];if(n.type==="grouper"){if(n.item instanceof Superscript){var i=parseFlatList(n.item.contents);if(i===null){t.pos=r;return null}e=e.concat(i,["^"]);t.pos++}else if(n.item instanceof Subscript){i=parseFlatList(n.item.contents);if(i===null){t.pos=r;return null}e=e.concat(i,["_"]);t.pos++}else break}else break}return e}function makeSimpleExpr(e){var t=e.pos;var r=makeParen(e);if(r!==null){return r}e.pos=t;return makeTerminal(e)}function makeParen(e){var t=e.pos;if(e.tok[e.pos].type==="lparen"){e.pos++;if(e.pos<e.tok.length){var r=makeAddition(e);if(r!==null&&e.pos<e.tok.length&&e.tok[e.pos].type==="rparen"){e.pos++;return r}}}e.pos=t;if(e.tok[e.pos].type==="abs"){var n=0;var i=e.pos;var a=i+1;var o=-1;for(;o<0&&a<e.tok.length;a++){switch(e.tok[a].type){case"lparen":n++;break;case"rparen":n--;break;case"abs":if(n===0){o=a}break}}if(o>i+1){r=e.tok.slice(i+1,o);var s={tok:r,pos:0};var u=makeAddition(s);if(s.pos>=s.tok.length){e.pos=o+1;return u.concat(["abs"])}}}e.pos=t;return null}function makeTerminal(e){var t=e.tok[e.pos];switch(t.type){case"number":e.pos++;return[t.str.startsWith("\\infty")|t.str==="∞"?Infinity:Number(t.str)];case"letter":e.pos++;return[t.str];case"grouper":if(t.item instanceof Fraction){var r=parseFlatList(t.item.numerator);var n=parseFlatList(t.item.denominator);if(r===null||n===null){return null}e.pos++;return r.concat(n,["/"])}else if(t.item instanceof Radical){var i=parseFlatList(t.item.radicand);if(i===null){return null}var a=[];var o="sqrt";if(t.item.HasIndex()){o="root";a=parseFlatList(t.item.index);if(a===null){return null}}e.pos++;return a.concat(i,[o])}else if(t.item instanceof Piecewise){var s=[];for(var u=0;u<t.item.children.length;u++){var l=t.item.children[u];var c=tokenizeFlatList(l,false);if(c===null){return null}var p=-1;var d=-1;for(var f=0;f<c.length;f++){if(c[f].type==="comma"||c[f].type==="space"){if(p<0){p=f}d=f}}if(p<0&&d<0){return null}var h=c.slice(0,p);var m=c.slice(d+1,c.length);var g=parseTokens(h);var v=parseTokens(m);if(g===null||v===null){return null}s=s.concat(v,g)}if(s){s.push("undef")}for(u=0;u<t.item.children.length;u++){s.push("{")}e.pos++;return s}else return null;default:return null}}var iconPath="./Images/";var Editor=function(e,t,r){r=$.extend({isGraph:false,isWorksheet:false,graphId:false,deferFocus:false},r||{});var n=this;this.isSpeech=false;this.isOCR=false;this.asciiEdited=null;this.historyClick=null;this.root=new Head;this.root.subject=App.CurrentSubject;this.startCursor=this.endCursor=this.root;this.selectedElems=[];this.editElem=e;if(IsNull(t)||IsNull(t.Empty))this.emptyText="Enter a problem...";else this.emptyText=t.Empty;this.displayCount=0;this.displayHtml=null;this.displayCursor=null;this.isMouseDown=false;this.history=new Array;this.MAX_HISTORY=200;this.historyIndex=0;this.AllowDrawerFocus=false;this.neverUpdated=true;this.isGraph=r.isGraph;this.isWorksheet=r.isWorksheet;this.graphId=r.graphId;this.deferFocus=r.deferFocus;this.states={clean:"clean",free:"free",locked:"locked",focused:"focused"};this.state=this.states.clean;this.isProcessingMathJax=0;this.onFree=r.onFree;this.onLock=r.onLock;this.onFocus=r.onFocus;this.onBlur=r.onBlur;if(!IsNull(MathJax)){MathJax.Hub.processSectionDelay=0}if(!IsNull(this.editElem)){this.editElem.empty();this.editorPrefix=this.editElem.attr("id");this.cursorElem=$('<span id="'+this.editorPrefix+'_cursor" class="cursor"></span>');this.editElem.append(this.cursorElem);this.currentFrame=$('<div id="'+this.editorPrefix+'_frame"></div>').css("outline","none");this.editElem.append(this.currentFrame);this.historyIndex=-1;this.updateView();n.keydownHandle=$.subscribe("document/keydown",function(e){if(n.Locked())return;if(n.Free())n.TakeFocus();if(n.Focused())n.KeyDown(e)});n.keypressHandle=$.subscribe("document/keypress",function(e){if(n.Locked())return;if(n.Focused())n.KeyPress(e)});$.subscribe("dymReplace",function(e){n.Replace(e.asciimath);n.TakeFocus()},true);$.subscribe("solving/start",function(){n.Clear()});$.subscribe("pages/subject",function(e){App.CurrentSubject=Subject.FromString(e);n.root.subject=App.CurrentSubject},true);$.subscribe("subject/set",function(e){App.CurrentSubject=Subject.FromString(e);n.root.subject=App.CurrentSubject});$.subscribe("chat/problem",function(e,t){if(IsNull(e)||IsNull(e.ascii))return;n.asciiEdited=false;n.historyClick=true;n.Replace(e.ascii);t=t===undefined?false:t;if(t)n.RemoveFocus();else n.TakeFocus()});$.subscribe("example/problem",function(e,t){if(IsNull(e))return;t=$.extend({focus:true,editor:null},t||{});if(t.editor===null||t.editor===n){n.Replace(e);if(t.focus===true){n.TakeFocus()}}});$.subscribe("ocr/result",function(e){if(IsNull(e))return;n.Replace(e);n.TakeFocus()});$.subscribe("mathpix/result",function(e){if(IsNull(e))return;n.InsertMathPix(e);n.TakeFocus()});$.subscribe("speechToText/result",function(e){if(IsNull(e))return;n.InsertSpeechToText(e.text);n.TakeFocus()});$.publish("editorContentUpdate",[n]);$.publish("editorDYMUpdate",[n,n.GetDidYouMean()]);this.editElem.mousedown(function(e){n.isMouseDown=true;n.UnSelect();n.Click(e);e.stopPropagation();e.preventDefault()});this.editElem.mousemove(function(e){if(n.isMouseDown){n.UnSelect();n.endCursor=n.FindNodeNearPoint(e.clientX,e.clientY);n.Select()}});this.editElem.mouseup(function(){if(n.isMouseDown&&!n.Focused()){n.TakeFocus()}n.isMouseDown=false});this.updateViewInternal()}};Editor.prototype.Delete=function(){$.unsubscribe(this.keydownHandle);$.unsubscribe(this.keypressHandle);if(typeof this.Buttons==="object"){this.Buttons.Delete();delete this.Buttons}};Editor.prototype.ShowInsertionPoint=function(){if(!IsNull(this.cursorElem)&&!this.cursorElem.hasClass("on")){this.cursorElem.addClass("on")}};Editor.prototype.HideInsertionPoint=function(){if(!IsNull(this.cursorElem))this.cursorElem.removeClass("on")};Editor.prototype.TakeFocus=function(){if(!App.canEditorTakeFocus||App.canEditorTakeFocus()===false)return;this.AllowDrawerFocus=true;this.state=this.states.focused;if(this.neverUpdated){this.neverUpdated=false;this.updateView()}this.ShowInsertionPoint();if(typeof this.onFocus==="function")this.onFocus.call(this,this)};Editor.prototype.RemoveFocus=function(e){e=e===undefined?false:e;this.state=e?this.states.free:this.states.locked;this.HideInsertionPoint();if(typeof this.onBlur==="function")this.onBlur.call(this,this)};Editor.prototype.MakeFree=function(){if(App.canEditorTakeFocus()===false)return;this.state=this.states.free};Editor.prototype.Clean=function(){if(App.canEditorTakeFocus()===false)return;return this.state===this.states.clean};Editor.prototype.Free=function(){if(App.canEditorTakeFocus()===false)return;return this.state===this.states.free};Editor.prototype.Focused=function(){if(App.canEditorTakeFocus()===false)return;return this.state===this.states.focused};Editor.prototype.Locked=function(){if(App.canEditorTakeFocus()===false)return;return this.state===this.states.locked};Editor.prototype.EditorInput=function(e){var t=this;if(t.selectedElems.length>0){t.startCursor=t.endCursor=t.DeleteSelected()}else if(this.IsNormalizeSafe(e)){this.root.skipNormalize=true}t.startCursor=t.endCursor=t.startCursor.ApplyInput(e);t.updateView()};Editor.prototype.InsertObject=function(e){var t=this;if(t.selectedElems.length>0){t.startCursor=t.endCursor=t.DeleteSelected()}var r=t.startCursor;switch(e.id){case"matrix":matrix=new Matrix(e.row,e.col);t.startCursor.ApplyInput(matrix);r=matrix.children[0];break;case"table":case"xPxTable":var n=new Table(e.header1.split(""),e.header2.split(""));t.startCursor.ApplyInput(n);r=n.children[2];break;case"function":var i=new Head(null,e.name.split(""));t.startCursor.ApplyInput(i);r=i.Last();break;case"piecewise":var a=new Piecewise;t.startCursor.ApplyInput(new Head(null,[a]));r=a.children[0];break;case"muXBar":i=new Head(null,["μ","_","x̄"]);t.startCursor.ApplyInput(i);r=i.Last();break;case"sigmaXBar":i=new Head(null,["σ","_","x̄"]);t.startCursor.ApplyInput(i);r=i.Last();break;case"combination":case"permutation":var o=new PermComb(e.id==="permutation"?"P":"C");t.startCursor.ApplyInput(o);r=o.left;break;case"log":var s=new TrigLog("log");t.startCursor.ApplyInput(new Head(null,[s,new Placeholder]));r=s;break;case"nlog":s=new Head(null);t.startCursor.ApplyInput(new Head(null,[new TrigLog("log"),new Subscript(s),new Placeholder]));r=s;break;case"trig":case"ln":var u=e.name.match(/^([a-z]*)([^a-z]*)$/);if(u){var l=u[1];var c=u[2];var p=c.split("");p.unshift(new TrigLog(l));i=new Head(null,p);t.startCursor.ApplyInput(i);r=i.Last()}break;case"lim":var d=new Placeholder;var f=new Head(null,[d,"→",new Placeholder]);t.startCursor.ApplyInput(new Limit(f));r=d;break;case"mixed":t.startCursor.ApplyInput("/");t.startCursor.ApplyInput(new Placeholder);break;case"scientific":t.startCursor.ApplyInput(new Head(null,[new Placeholder,"×","1","0",new Superscript]));break;case"point":case"set_open":case"set_close":var h=e.id==="set_close"?"[":"(";var m=e.id==="set_open"?"]":")";r=t.startCursor.ApplyInput(new Head(null,[h,new Placeholder,",",new Placeholder,m]));break;case"shape":var g=new ShapeTable(e.type);i=new Head(null,[ShapeType.GetCharacter(e.type),g]);t.startCursor.ApplyInput(i);r=g.children[0];break;case"positiveIon":t.startCursor.ApplyInput(new Superscript(new Head(null,["+"])));break;case"negativeIon":t.startCursor.ApplyInput(new Superscript(new Head(null,["-"])));break;case"arrow":r=t.startCursor.ApplyInput("→");break;case"fraction":var v=new Fraction;t.startCursor.ApplyInput(v);r=v.numerator;break;case"defIntegral":case"indefIntegral":r=t.startCursor.ApplyInput(new Integral(new Head,new Head,e.id==="defIntegral"));break;case"summation":r=t.startCursor.ApplyInput(new Summation(new Head,new Head));break;case"sqrt":var b=new Radical;b.hungry=true;t.startCursor.ApplyInput(b);r=b.radicand;break;case"nthrt":var y=new Radical(null,null,true);y.hungry=true;t.startCursor.ApplyInput(y);r=y.index;break;case"element":var w=new Head(null,e.symbol.split(""));t.startCursor.ApplyInput(w);r=w.Last();break;case"accent":var C=new Accent(new Head,"\\"+e.name);t.startCursor.ApplyInput(C);r=C.contents;break}t.startCursor=t.endCursor=r;t.updateView()};Editor.prototype.InsertOperation=function(e){var t=this;switch(e.id){case"backspace":t.Backspace();break;case"erase":t.Clear();break;case"left_arrow":t.LeftArrow(false);break;case"right_arrow":t.RightArrow(false);break}};Editor.prototype.KeyPress=function(e){var t=String.fromCharCode(e.which);if(t==="\\"){t="/"}else if(e.which===13){t=NewlineString}if(Character.IsDigit(t)||Character.IsLetter(t)||Character.IsSpace(t)||Character.IsNewLine(t)||Character.IsIdentifier(t)||Character.IsOperator(t)||Character.IsParen(t)||Character.IsSymbol(t)||Character.IsFactorial(t)){this.asciiEdited=true;if(this.selectedElems.length>0){this.startCursor=this.endCursor=this.DeleteSelected()}else if(this.IsNormalizeSafe(t)){this.root.skipNormalize=true}this.startCursor=this.endCursor=this.startCursor.ApplyInput(t);this.root.skipNormalize=this.root.skipNormalize&&this.IsNormalizeSafeSmileys();this.updateView()}};Editor.prototype.IsNormalizeSafe=function(e){if(!Character.IsNormalizeSafe(e))return false;else return this.IsNormalizeSafeSmileys()};Editor.prototype.IsNormalizeSafeSmileys=function(){var e=this.startCursor;while(!(e instanceof Head))e=e.next;var t=e.next;while(t!==e){var r=FlatListMatch.SmileyString().func(t);if(r!==null){var n=t.prev===this.startCursor;var i=t;while(i!==e){n=n||i===this.startCursor;if(i===r)break;i=i.next}if(n)return false}t=t.next}return true};Editor.prototype.GetSolverStrings=function(){var e=this.root.GetSolverStrings();this.root.SetIds(this.editorPrefix);return e};Editor.prototype.GetAsciiMath=function(e){return this.root.ToAsciiMath(e)};Editor.prototype.GetKeystrokes=function(e){var t=this.root.ToKeystrokeFormat(this.startCursor);if(t.length===2){this.autosuggestLockedPrefix=null}if(e&&typeof this.autosuggestLockedPrefix==="string"){var r=t.split("\\|");if(r.length===2&&this.autosuggestLockedPrefix.startsWith(r[0])&&(r[0]+r[1]).startsWith(this.autosuggestLockedPrefix)){t=r[0]+"\\/"+r[1]}}return t};Editor.prototype.GetDidYouMean=function(){return this.root.GetDidYouMean(this.startCursor)};Editor.prototype.UnSelect=function(){var e=Between(this.root,this.root.Last());this.selectedElems=[];while(e.length>0){var t=e.pop();t.RemoveHighlight()}this.cursorElem.addClass("cursor");this.endCursor=this.startCursor};Editor.prototype.Select=function(){this.selectedElems=Between(this.startCursor,this.endCursor);for(var e=0;e<this.selectedElems.length;e++){var t=this.selectedElems[e];var r="highlight";if(t instanceof Subscript||t instanceof Superscript){r="highlightSubSup"}if(!Character.IsNewLine(t))$("#"+t.id).addClass(r)}if(this.selectedElems.length>0){this.cursorElem.removeClass("cursorBlinking");this.cursorElem.removeClass("cursor")}else{this.cursorElem.addClass("cursor")}};Editor.prototype.ReSelect=function(){while(this.selectedElems.length>0){var e=this.selectedElems.pop();$("#"+this.editorPrefix+"elem"+e.id).removeClass("highlight");$("#"+this.editorPrefix+"elem"+e.id).removeClass("highlightSubSup")}this.Select()};Editor.prototype.DeleteSelected=function(){var e=this;if(e.selectedElems.length===0)return e.root;var t=e.selectedElems[0].prev;if(e.selectedElems.includes(e.root))t=e.root;for(var r=0;r<e.selectedElems.length;r++){Delete(e.selectedElems[r])}e.selectedElems=[];e.cursorElem.addClass("cursor");return t};Editor.prototype.Click=function(e){this.startCursor=this.FindNodeNearPoint(e.clientX,e.clientY);this.updateCursor()};Editor.prototype.KeyboardInput=function(e){var t=this;this.asciiEdited=true;if(t.state!==t.states.focused)t.TakeFocus();e.char=e.character;switch(e.id){case"backspace":case"erase":case"left_arrow":case"right_arrow":t.InsertOperation({id:e.id,keyCode:parseInt(e.code)});break;case"table":t.InsertObject({id:"table",header1:"x",header2:"y"});break;case"xPxTable":t.InsertObject({id:"xPxTable",header1:"x",header2:"P(x)"});break;case"log":t.InsertObject({id:"log",name:"log"});break;case"nlog":t.InsertObject({id:"nlog",name:"log_"});break;case"ln":t.InsertObject({id:"ln",name:"ln"});break;case"function":t.InsertObject({id:"function",name:"f(x)"});break;case"permutation":t.InsertObject({id:"permutation",type:"P"});break;case"combination":t.InsertObject({id:"combination",type:"C"});break;case"set_open":case"set_close":case"piecewise":case"muXBar":case"sigmaXBar":case"lim":case"mixed":case"scientific":case"point":case"positiveIon":case"negativeIon":case"arrow":case"fraction":case"indefIntegral":case"defIntegral":case"summation":case"sqrt":case"nthrt":t.InsertObject({id:e.id});break;case"element":t.InsertObject({id:"element",symbol:e.symbol});break;case"rectangle":case"circle":case"triangle":case"parallelogram":case"trapezoid":case"box":case"sphere":case"cone":case"cylinder":case"pyramid":case"tri":t.InsertObject({id:"shape",type:e.id});break;case"matrix":t.InsertObject({id:"matrix",row:e.row,col:e.col});break;case"trig":t.InsertObject({id:"trig",name:e.name,sup:e.sup});break;case"accent":t.InsertObject({id:"accent",name:e.name});break;case"infinity":t.EditorInput("∞");break;case"pi":t.EditorInput("π");break;case"times":t.EditorInput("×");break;case"division":t.EditorInput("÷");break;case"plus_minus":t.EditorInput("±");break;case"sub":t.EditorInput("_");break;case"caret":t.EditorInput("^");break;case"pow":t.EditorInput("^");break;case"euler":t.EditorInput("e");break;case"intersect":t.EditorInput("∩");break;case"union":t.EditorInput("∪");break;case"imaginary":t.EditorInput("i");break;case"degree":t.EditorInput("°");break;case"space":t.EditorInput(" ");break;case"return":t.EditorInput("↵");break;case"xBar":t.EditorInput("x̄");break;case"tilde":t.EditorInput("~");break;case"at":t.EditorInput("@");break;case"hash":t.EditorInput("#");break;case"dollar":t.EditorInput("$");break;case"ampersand":t.EditorInput("&");break;case"semicolon":t.EditorInput(";");break;case"underscore":t.EditorInput("_");break;case"apostrophe":t.EditorInput("'");break;case"gte":t.EditorInput("≥");break;case"lte":t.EditorInput("≤");break;case"alpha":t.EditorInput("α");break;case"mu":t.EditorInput("μ");break;case"sigma":t.EditorInput("σ");break;case"theta":t.EditorInput("θ");break;case"asterisk":t.EditorInput("*");break;case"x":t.EditorInput(e.id);break;case"y":t.EditorInput(e.id);break;case"z":t.EditorInput(e.id);break;case"sin":t.InsertObject({id:"trig",name:"sin"});break;case"cos":t.InsertObject({id:"trig",name:"cos"});break;case"tan":t.InsertObject({id:"trig",name:"tan"});break;default:t.EditorInput(e.char);break}};Editor.prototype.KeyDown=function(e){var t=this;switch(e.which){case 8:e.preventDefault();t.Backspace();e.stopPropagation();break;case 13:e.stopPropagation();e.preventDefault();if(e.shiftKey||e.ctrlKey){t.EditorInput(NewlineString)}else{if(t.root.Any())t.Buttons.forceSubmit()}break;case 35:e.stopPropagation();e.preventDefault();if(e.shiftKey){t.startCursor=t.root.RightMostInLine(t.startCursor);t.ReSelect()}else{t.startCursor=t.endCursor=t.root.RightMostInLine(t.startCursor);t.updateCursor()}break;case 36:e.stopPropagation();e.preventDefault();if(e.shiftKey){t.startCursor=t.root.LeftMostInLine(t.startCursor);t.ReSelect()}else{t.startCursor=t.endCursor=t.root.LeftMostInLine(t.startCursor);t.updateCursor()}break;case 37:t.LeftArrow(e.shiftKey);e.stopPropagation();e.preventDefault();break;case 38:e.preventDefault();e.stopPropagation();if(e.shiftKey){t.startCursor=t.FindUp(t.startCursor);t.ReSelect()}else{t.startCursor=t.endCursor=t.FindUp(t.startCursor);t.updateCursor()}break;case 9:case 39:t.RightArrow(e.shiftKey);e.preventDefault();e.stopPropagation();break;case 40:e.preventDefault();e.stopPropagation();if(e.shiftKey){t.startCursor=t.FindDown(t.startCursor);t.ReSelect()}else{t.startCursor=t.endCursor=t.FindDown(t.startCursor);t.updateCursor()}break;case 46:if(t.selectedElems.length===0){var r=MoveCursorRight(t.startCursor);if(IsDeleteSoft(r)){t.startCursor=t.endCursor=r}else if(r!==t.startCursor){t.startCursor=t.endCursor=r.Delete()}}else{t.startCursor=t.endCursor=t.DeleteSelected();t.cursorElem.addClass("cursor")}t.updateView();e.stopPropagation();break;case 65:if(e.ctrlKey){e.preventDefault();e.stopPropagation();t.startCursor=t.root;t.endCursor=t.root.Last();t.Select()}return;case 89:if(e.ctrlKey&&t.redoEnabled){e.stopPropagation();t.Redo()}return;case 90:if(e.ctrlKey&&t.CanUndo){e.stopPropagation();t.Undo()}return;case 191:if(!e.shiftKey&&App.isFirefox){e.preventDefault();t.EditorInput("/")}return;case 222:if(!e.shiftKey&&App.isFirefox){e.preventDefault();t.EditorInput("'")}return;default:return}};Editor.prototype.Backspace=function(){var e=this;if(e.selectedElems.length===0){if(IsBackspaceSoft(e.startCursor)){e.startCursor=e.endCursor=MoveCursorLeft(e.startCursor)}else{if(e.startCursor instanceof TrigLog&&e.startCursor.value==="log"&&e.startCursor.next instanceof Placeholder){e.startCursor=e.endCursor=e.startCursor.next.Delete()}e.startCursor=e.endCursor=e.startCursor.Delete()}}else{e.startCursor=e.endCursor=e.DeleteSelected();e.cursorElem.addClass("cursor")}e.updateView()};Editor.prototype.LeftArrow=function(e){if(e){this.startCursor=MoveCursorLeft(this.startCursor);this.ReSelect()}else{this.startCursor=this.endCursor=MoveCursorLeft(this.startCursor);this.updateCursor()}};Editor.prototype.RightArrow=function(e){if(e){this.startCursor=MoveCursorRight(this.startCursor);this.ReSelect()}else{this.startCursor=this.endCursor=MoveCursorRight(this.startCursor);this.updateCursor()}};Editor.prototype.Copy=function(){return this.selectedElems.map(function(e){return e.ToAsciiMath()}).join("")};Editor.prototype.Replace=function(e){var t=this;Editor.AsciiToMathml("x+y");if(e==="")t.Clear();e=e.replace(/^\s+|\s+$/g,"");var r=new Parser(e);var n=r.Parse();if(!IsNull(n)){t.root.Clear();t.root.ApplyInput(n);t.startCursor=t.endCursor=t.root.Last();t.selectedElems=[];t.updateView()}};Editor.prototype.ReplaceKeystrokes=function(e,t){var r=this;this.asciiEdited=true;var n=new KeystrokeFormatParser(e);var i=n.Parse();if(IsNull(i))return;if(t){r.autosuggestLockedPrefix=e.split("\\|")[0]}r.root.Clear();r.root.ApplyInput(i);if(typeof n.cursor==="undefined"){r.startCursor=r.endCursor=r.root.Last()}else{r.startCursor=r.endCursor=n.cursor}r.selectedElems=[];r.updateView()};Editor.prototype.Paste=function(e,t){var r=this;e=String(e);if(e==="")return;if(t)API.savePasteData(this.root.subject.str||"str:"+this.root.subject,e);this.asciiEdited=!!this.asciiEdited;this.historyClick=!!this.historyClick;e=e.replace(/^\s+|\s+$/g,"");var n=new Parser(e);if(!IsNull(this.selectedElems)&&this.selectedElems.length!==0){this.startCursor=this.endCursor=this.DeleteSelected();this.cursorElem.addClass("cursor")}var i=n.Parse();if(!IsNull(i)){var a=i.prev;this.startCursor.ApplyInput(i);this.startCursor=this.endCursor=a;this.updateView()}};Editor.prototype.InsertMathPix=function(e){e=Editor.CleanMathPix(e);var t=new Parser(e);var r=t.Parse();this.Clear();this.isOCR=true;this.asciiEdited=false;this.historyClick=false;this.startCursor.ApplyInput(r);this.startCursor=this.endCursor=this.root.Last();this.updateView()};Editor.prototype.InsertSpeechToText=function(e){e=Editor.CleanSpeechToText(e);var t=new Parser(e);var r=t.Parse();this.Clear();this.isOCR=false;this.isSpeech=true;this.asciiEdited=false;this.historyClick=false;this.startCursor.ApplyInput(r);this.startCursor=this.endCursor=this.root.Last();this.updateView()};Editor.TokenRegx=/(root|oo|sqrt|abs|int|sum|lim|alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega) ?/gi;var SpeechElementList=[["Hydrogen","H"],["Helium","He"],["Lithium","Li"],["Beryllium","Be"],["Boron","B"],["Carbon","C"],["Nitrogen","N"],["Oxygen","O"],["Fluorine","F"],["Neon","Ne"],["Sodium","Na"],["Magnesium","Mg"],["Aluminum","Al"],["Silicon","Si"],["Phosphorus","P"],["Sulfur","S"],["Chlorine","Cl"],["Argon","Ar"],["Potassium","K"],["Calcium","Ca"],["Scandium","Sc"],["Titanium","Ti"],["Vanadium","V"],["Chromium","Cr"],["Manganese","Mn"],["Iron","Fe"],["Cobalt","Co"],["Nickel","Ni"],["Copper","Cu"],["Zinc","Zn"],["Gallium","Ga"],["Germanium","Ge"],["Arsenic","As"],["Selenium","Se"],["Bromine","Br"],["Krypton","Kr"],["Rubidium","Rb"],["Strontium","Sr"],["Yttrium","Y"],["Zirconium","Zr"],["Niobium","Nb"],["Molybdenum","Mo"],["Technetium","Tc"],["Ruthenium","Ru"],["Rhodium","Rh"],["Palladium","Pd"],["Silver","Ag"],["Cadmium","Cd"],["Indium","In"],["Antimony","Sb"],["Tellurium","Te"],["Iodine","I"],["Xenon","Xe"],["Cesium","Cs"],["Barium","Ba"],["Lanthanum","La"],["Cerium","Ce"],["Praseodymium","Pr"],["Neodymium","Nd"],["Promethium","Pm"],["Samarium","Sm"],["Europium","Eu"],["Gadolinium","Gd"],["Terbium","Tb"],["Dysprosium","Dy"],["Holmium","Ho"],["Erbium","Er"],["Thulium","Tm"],["Ytterbium","Yb"],["Lutetium","Lu"],["Hafnium","Hf"],["Tantalum","Ta"],["Tungsten","W"],["Rhenium","Re"],["Osmium","Os"],["Iridium","Ir"],["Platinum","Pt"],["Gold","Au"],["Mercury","Hg"],["Thallium","Tl"],["Lead","Pb"],["Bismuth","Bi"],["Polonium","Po"],["Astatine","At"],["Radon","Rn"],["Francium","Fr"],["Radium","Ra"],["Actinium","Ac"],["Thorium","Th"],["Protactinium","Pa"],["Uranium","U"],["Neptunium","Np"],["Plutonium","Pu"],["Americium","Am"],["Curium","Cm"],["Berkelium","Bk"],["Californium","Cf"],["Einsteinium","Es"],["Fermium","Fm"],["Mendelevium","Md"],["Nobelium","No"],["Lawrencium","Lr"],["Rutherfordium","Rf"],["Dubnium","Db"],["Seaborgium","Sg"],["Bohrium","Bh"],["Hassium","Hs"],["Meitnerium","Mt"],["Darmstadtium","Ds"],["Roentgenium","Rg"],["Copernicium","Cn"],["Nihonium","Nh"],["Flerovium","Fl"],["Moscovium","Mc"],["Livermorium","Lv"],["Tennessine","Ts"],["Oganesson","Og"],["Tin","Sn"]];var SpeechRegexList=[["ask","x"],["why","y"],["exquisite","x ^ 2"],["negative","-"],["plus","+"],["minus|takeaway","-"],["take away","-"],["times","*"],["divided by","/"],["over","/"],["to theta","2 theta"],["greater than or equal to",">="],["less than or equal to","<="],["equals","="],["equal","="],["equal to","="],["greater than",">"],["less than","<"],["([0-9]+) (?:pick|pic|permute) ([0-9]+)","\\Perm{$1}{$2}"],["pie","\\pi"],["pi","\\pi"],["euler's number|euler","e"],["alpha","\\alpha"],["beta","\\beta"],["delta","\\delta"],["mu|mew","\\mu"],["sigma","\\sigma"],["theta","\\theta"],["omega","\\omega"],["negative infinity","-\\infty"],["infinity","\\infty"],["to the power of","^"],["cubed","^ 3"],["squared","^ 2"],["squired","^ 2"],["quired","^ 2"],["caret to","^2"],["(?:caret|carrot)","^"],["cosine","cos"],["sine","sin"],["sign","sin"],["tangent","tan"],["cotangent","cot"],["cotan","cot"],["arctangent","arctan"],["arcsine","arcsin"],["cosecant","csc"],["secant","sec"],["factorial","!"],["natural log","ln"],["square root","\\sqrt"],["(?:cube|cubic) root","\\root(3)"],["√","\\sqrt"],["one","1"],["two","2"],["three","3"],["four","4"],["five","5"],["six","6"],["seven","7"],["eight","8"],["nine","9"],["zero","0"],["first","1st"],["second","2nd"],["third","3rd"],["fourth","4th"],["fifth","5th"],["sixth","6th"],["half","1/2"],["sfx","f(x)"],["ffx","f(x)"],["fx","f(x)"],["age of x","h(x)"],["gfx","g(x)"],["f of x","f(x)"],["g of x","g(x)"],["h of x","h(x)"],["f of ([a-z])(?: |$)","f($1)"],["(-?[0-9]+) by (-?[0-9]+)","$1*$2"],["diy by the x","(dy)/(dx)"],["diy by dax","(dy)/(dx)"],["dyi by dax","(dy)/(dx)"],["dydx","(dy)/(dx)"],["dy by dx","(dy)/(dx)"],["dx by dy","(dy)/(dx)"],["dx by dt","(dy)/(dx)"],["/ (?:the )?quantity ([0-9 a-z^]+ [+-] [0-9 a-z^]+(?: [+-] [0-9 a-z^]+)?)","/($1)"],["(?:the )?absolute value (?:of )?([-0-9 a-z^.]+(?: [+-])?[0-9 a-z^]+(?: [+-] [0-9 a-z^]+)?)","|$1|"],["/ ([0-9a-z \\^]+)","/($1)"],[" degrees","\\deg"],["radians","rad"],["inverse","^(-1)"],["ddx","(d)/(dx)"],["ddy","(d)/(dy)"],["d d y","(d)/(dy)"],["([a-z]) derivative","(d)/(d$1)"],["derivative of (.*) with respect to ([a-z])","(d)/(d$2)$1"],["derivative","(d)/(dx)"],["integrate","\\int"],["integral","\\int"],["(\\d+)(?:nd|th|rd|st)","$1"],["union","\\cup"],["intersect","\\cap"],["point (\\d+)","0.$1"],["matrix","[[,,],[,,],[,,]]"],["function of ([a-z])","f($1)"],["absolute value of","abs"],["absolute value","|"],["log ?base ?([0-9]*)(?: of )","log_($1)"],["(?:the )?(\\d*) root(?: of )?","\\root($1)"],["(?:the )?(sin|cos|cot|tan|arctan|csc|sec|ln|log|abs|factorial|\\cup|\\cap|\\\\sqrt|\\\\root\\(\\d*\\)|\\(d\\)/\\(d[x|y]\\)|\\\\int) (?:of)? ","$1"],["\\s?root ","\\sqrt"],["(sin|cos|arctan|tan|csc|sec|ln|log|abs|factorial|\\\\sqrt|\\\\root\\(\\d*\\))(-s?[0-9.]*)","$1($2)"],["to the (\\d?[a-z]?)(?: power)?","^ $1"],["power","^"],["(\\d+) choose (\\d+)","\\Comb[$1][$2]"],["([0-9|a-z|>|<|/|+|-|*|)|(]+|^)to","$1 to"],["([0-9|a-z|>|<|/|+|-|*|)|(|^]+)as","$1 as"],[" ?([\\\\+\\-\\*\\^/<>|<=|>=|!]) ?","$1"],["(?:the )?(?:summation|sum) of ([0-9|a-z|>|<|/|+|-|*|)|(|^]+) as in goes from ([a-z0-9]+) to ([a-z0-9]+)","\\sum_(n=$2)^($3) $1"],["(?:the )?(?:summation|sum) of ([0-9|a-z|>|<|/|+|-|*|)|(|^]+) as ([a-z]) goes from ([a-z0-9]+) to ([a-z0-9]+)","\\sum_($2=$3)^($4) $1"],["(?:the )?(?:summation|sum) as ([a-z]) goes from ([a-z0-9]+) to ([a-z0-9]+) of ([0-9|a-z|>|<|/|+|-|*|)|(|^]+)","\\sum_($1=$2)^($3) $4"],["sub in","sub n"],["([a-z]) sub ([a-z0-9])","$1_$2"],["([0-9]+) ([a-z]+)","$1$2"],["x ([0-9])","x$1"],["([a-z0-9\\.]+)parentheses","$1 parentheses"],["parentheses([+\\-*/^]+)","parentheses $1"],["(?:open|beginning) parenthes(e|i)s ","( "],[" (close(d)?|clothes) parenthes(e|i)s"," )"],["/ends"," parens"],["(?:the )?(?:quantity ?)(.*[a-z|\\d])(/|\\^|\\*)","($1)$2"],["(?:the )?(?:quantity ?)(.*[a-z|\\d])","($1)"],["(?:the )?limit as ([a-z]) (?:approaches |goes to )?([0-9|a-z|+|-]+|\\\\infty|-\\\\infty)of ([0-9|a-z|>|<|/|+|-|*|)|(]+)","\\lim_($1->$2)$3"],["(?:the )?limit of ([0-9|a-z|>|<|/|+|-|*|)|(]+) as ([a-z]) (?:approaches |goes to)?([0-9|a-z|+|-]+|\\\\infty|-\\\\infty)","\\lim_($2->$3)$1"],["(sin|cos|cot|arctan|tan|csc|sec|ln|log) ","$1"],["abs(([a-z0-9.-]+))","|$1|"],["f x","f(x)"]];
var SpeechPhraseList=[["to","two"],["square","\\rectangle \\shapeTable[[l=,],[w=,]]"],["triangle","\\triangle \\shapeTable[[h=,],[b=,]]"],["circle","\\circle \\shapeTable[[r=,]]"],["sphere","\\sphere \\shapeTable[[r=,]]"],["box","\\box \\shapeTable[[h=,],[l=,],[w=,]]"],["sum","\\sum "]];Editor.CleanSpeechToText=function(e){e=e.toLowerCase();for(var t=0;t<SpeechRegexList.length;t++){e=e.replace(new RegExp(SpeechRegexList[t][0],"g"),SpeechRegexList[t][1])}for(t=0;t<SpeechElementList.length;t++){e=e.replace(new RegExp(SpeechElementList[t][0].toLowerCase(),"g"),SpeechElementList[t][1])}var r=e.split(" ");var n="";var i=false;var a=false;for(t=0;t<r.length;t++){if(r[t]==="parens"||r[t]==="parentheses"||r[t]==="parenthesis"||r[t]==="ends"){if(!a){n+="("}else{n+=")"}a=!a}else if(r[t]==="|"){n+="|";i=!i}else{n+=r[t]+" "}if(r[t]==="("){a=true}else if(r[t]===")"){a=false}}if(i)n+="|";if(a)n+=")";n=n.replace(/\s?\(\s?/g,"(").replace(/\s?\)\s?/g,")").replace(/\|\|/g,"|").trim();for(t=0;t<SpeechPhraseList.length;t++){if(SpeechPhraseList[t][0]===n){n=SpeechPhraseList[t][1];break}}return n};Editor.CleanMathPix=function(e){e=e.replace(/({\[[^\]]*\](?:,\[[^\]]*\])*)$/g,"$1:}");var t=Editor.GetQuoteParts(e);var r=e.endsWith(":}");for(var n=0;n<t.length;n+=2){if(t[n].match(/^\{?\[[^\[\]]*\](,\[[^\[\]]*\])*$/)!==null){var i=1;if(t[n].startsWith("{")){i=2}t[n]=t[n].substring(i,t[n].length-1);var a=t[n].split("],[");t[n]=a.join("\\n")}t[n]=t[n].replace(Editor.TokenRegx,"\\$1\\space").replace(/\\root\\space/g,"\\root").replace(/\\sqrt\\space/g,"\\sqrt").replace(/uu ?/g,"\\cup\\space").replace(/nn ?/g,"\\cap\\space").replace(/\\oo\\space\)/g,"\\infty\\space)").replace(/(\\)?times ?/g,"\\times\\space").replace(/X/g,"x").replace(/rarr ?/g,"->").replace(/quad ?/g,",").replace(/\s+/g,"").replace(/\\space/g," ").replace(/\^\(@\)/g,"\\deg ").replace(/,,+/g,",").replace(/square/g,"").replace(/\^\(\\arcsec\)/g,'"').replace(/=\?/g,"=");if(r){t[n]=t[n].replace(/f\(x\)=\(/,"f(x)={").replace(/^,/g,"").replace(/,$/g,"")}}var o=t.join("");if(o.startsWith("{:")&&o.endsWith(":}")){o=o.replace(/\],\[/g,"\n").replace(/^\{:?\[/,"").replace(/\]:\}$/,"")}return o};Editor.GetQuoteParts=function(e){var t=e.split('"');var r=[];for(var n=0;n<t.length;n++){if(t[n].endsWith("\\")&&n<t.length-1){r.push(t[n].substring(0,t[n].length-1)+'"'+t[n+1]);n++}else{r.push(t[n])}}return r};Editor.prototype.CanUndo=function(){return this.historyIndex>0};Editor.prototype.Undo=function(){if(this.CanUndo()){var e=this.history[this.historyIndex-1];this.historyIndex--;this.root=e.root;this.startCursor=this.endCursor=e.startcursor;this.updateView(true);e.root=this.root.Clone();e.startcursor=FindCursorFromClone(this.root,e.root,e.startcursor)}this.editElem.focus()};Editor.prototype.CanRedo=function(){return this.historyIndex<this.history.length-1};Editor.prototype.Redo=function(){if(this.CanRedo()){var e=this.history[this.historyIndex+1];this.historyIndex++;this.root=e.root;this.startCursor=this.endCursor=e.startcursor;this.updateView(true);this.updateCursor();e.root=this.root.Clone();e.startcursor=FindCursorFromClone(this.root,e.root,e.startcursor)}this.editElem.focus()};Editor.prototype.PushIntoHistory=function(e,t){if(this.history.length>this.historyIndex+1){this.history=this.history.slice(0,this.historyIndex+1)}if(this.history.length>=this.MAX_HISTORY){this.history.shift();this.historyIndex--}var r=e.Clone();var n=FindCursorFromClone(e,r,t);var i={root:r,startcursor:n};this.history.push(i);this.historyIndex++};Editor.prototype.CreateMathML=function(e){e=String(e);var t=new Parser(e);var r=t.Parse();return r.ToHtml(true,this.root.subject)};Editor.prototype.CreateMathMLFromKeystrokes=function(e){e=String(e);var t=new KeystrokeFormatParser(e);var r=t.Parse();r.Normalize();var n=r.ToHtml(true,this.root.subject);n=n.replace(/ displaystyle="true"/g,"");n=n.replace(/\<mphantom\>.*?\<\/mphantom\>/g,"");return n};Editor.prototype.CanClear=function(){return this.root.Any()};Editor.prototype.Clear=function(e){this.isOCR=false;this.isSpeech=false;this.asciiEdited=null;this.historyClick=null;this.root.Clear();this.startCursor=this.endCursor=this.root;this.updateView(e)};Editor.prototype.FindUpOrDown=function(e,t){var r=this;var n=function(t){return t.elem!==e&&a.y-t.y>s&&(a.y-t.y)*5>Math.abs(a.x-t.x)};var i=function(t){return t.elem!==e&&t.y-a.y>s&&(t.y-a.y)*5>Math.abs(a.x-t.x)};var a=e.GetCursorPos(this.editorPrefix),o="";if(t){o="denominator"}else{o="numerator"}var s=a.size/4;var u=GetFracFromDenomOrNumer(e,o);var l=GetPiecewiseOrTable(e);var c=GetHead(e);if(!IsNull(u)){c=t?u.numerator:u.denominator}else if(!IsNull(l)){c=t?IsNull(l.above)?c:l.above:IsNull(l.below)?c:l.below}else if(this.root.IsMultiLine()){var p=SplitHeadOnNewLineAndFind(this.root,e);var d=p.array,f=p.index;if(f!==-1){if(t&&f>0)c=d[f-1];else if(!t&&f<d.length-1)c=d[f+1];var h=MinDistance(c,a.x,a.y,this.editorPrefix,t?n:i)}if(IsNull(h)){return e}return h.elem}else if(c.parent!==null&&IsGrouper(c.parent)){c=c.parent;n=function(t){return t.elem!==e&&t.elem!==c&&a.y-t.y>s&&(a.y-t.y)*5>Math.abs(a.x-t.x)};i=function(t){return t.elem!==e&&t.elem!==c&&t.y-a.y>s&&(t.y-a.y)*5>Math.abs(a.x-t.x)}}h=MinDistance(c,a.x,a.y,this.editorPrefix,t?n:i);if(IsNull(h)){return e}return h.elem};Editor.prototype.FindUp=function(e){return this.FindUpOrDown(e,true)};Editor.prototype.FindDown=function(e){return this.FindUpOrDown(e,false)};Editor.prototype.FindNodeNearPoint=function(e,t){return MinDistance(this.root,e,t,this.editorPrefix,null).elem};function FindCursorFromOldCursor(e,t){var r=EnumerateTree(e);for(var n=0;n<r.length;n++){if(r[n].Equals(t)){if(r[n].id.match(/\d+/g)[1]===t.id.match(/\d+/g)[1]){return r[n]}}}throw"Cursor not found in FindCursorFromOldCursor"}function FindCursorFromClone(e,t,r){var n=EnumerateTree(e);var i=EnumerateTree(t);for(var a=0;a<n.length;a++){if(n[a].id===r.id){return i[a]}}throw"Cursor not found in FindCursorFromClone"}Editor.prototype.updateView=function(e){this.updateViewInternal(e?true:false,false)};Editor.prototype.updateViewInternal=function(e,t){var r=this;if(!t){r.startCursor=r.root.Normalize(r.startCursor);r.root.SetIds(r.editorPrefix);var n=r.root.ToHtml(false,this.root.subject)}if(!t&&n!==r.displayHtml){r.isProcessingMathJax++;r.displayCount++;r.HideInsertionPoint();r.displayHtml=n;r.displayCursor=r.displayCursor;if(r.root.Any()){if(!IsNull(r.currentFrame))r.currentFrame.html(n)}else{var i="";if(!IsNull(r.root.id)){i=' id="'+r.root.id+'"'}if(!IsNull(r.currentFrame))r.currentFrame.html("<div"+i+' class="emptyText editorLine">'+r.emptyText+"</div>")}if(typeof window!=="undefined"){window.MathJax.Hub.Queue(["Process",window.MathJax.Hub,r.currentFrame[0]]);window.MathJax.Hub.Queue([function(){if(r.currentFrame[0].innerHTML.indexOf("<merror>")!==-1){API.logNewRelic("MathJax Error",r.root.toString())}r.updateCursor();if(r.deferFocus){r.deferFocus=false;r.HideInsertionPoint()}else if(!r.isWorksheet){r.TakeFocus()}r.isProcessingMathJax--;$.publish("editorContentUpdate",[r]);r.updateViewInternal(e,true)}])}}else{if(r.Focused())r.ShowInsertionPoint();r.updateCursor()}};Editor.prototype.updateCursor=function(){if(this.state===this.states.focused&&!this.isProcessingMathJax){this.displayCursor=this.startCursor;var e=this;this.updateCursorInternal();window.setTimeout(function(){window.MathJax.Hub.Queue([function(){e.updateCursorInternal(true)}])},50)}};Editor.prototype.updateCursorInternal=function(e){if(typeof this.displayCursor.GetCursorPos==="function"&&!this.isProcessingMathJax){if(this.selectedElems.length>0)this.UnSelect();var t=this.displayCursor.GetCursorPos(this.editorPrefix);if(t===null)return;var r=this.editElem.offset();var n=t.x-r.left;var i=t.y-t.size-r.top;this.cursorElem.css("left",n).css("height",t.size+"px").css("top",i+"px");if(!e)$.publish("editorDYMUpdate",[this])}};Editor.AsciiToMathml=function(e,t){var r=new Parser(e).Parse();if(r===null){return"parse error"}var n=r.GetSolverStrings(t);return n.html};Editor.Buttons=function(e){var t=this;e=$.extend({editor:null,mode:EditorButtonsMode.main,onSubmit:null,onCapture:null,onImageUpload:null,onEdit:null,onVoice:null,onToggle:null,onClose:null},e);if(e.$editor===null){Debug.error("Editor object is null for button instance.");return}if(e.onSubmit===null){e.onSubmit=function(){if(c){$.publish("tutorPreSession/problem")}else{Actions.Do(Actions.submitProblem)}}}if(e.onCapture===null){e.onCapture=function(){e.editor.TakeFocus();if(i()){$("#tutor-camera").trigger("click")}else{if(App.isAndroidDevice)Actions.Do(Actions.openCamera,{isPreTutorSession:c});else Actions.Do(Actions.openCamera)}}}if(e.onImageUpload===null){e.onImageUpload=function(){var e=a.children(".editor-attach-file").eq(0);$.publish("editor/imageUpload",[e]);l.focus()}}if(e.onEdit===null){e.onEdit=function(){}}if(e.onVoice===null){e.onVoice=function(){Actions.Do(Actions.startSpeechToText)}}if(e.onToggle===null){e.onToggle=function(){$(this).toggleClass("flipped")}}if(e.onClose===null){e.onClose=function(){}}var r=function(e){switch(e){case EditorButtonsMode.noImages:case EditorButtonsMode.main:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:return o.closest("#editor-outer");case EditorButtonsMode.graph:return o.closest(".editor-outer");case EditorButtonsMode.geometry:return null}};var n=function(e){switch(e){case EditorButtonsMode.noImages:case EditorButtonsMode.main:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:return s.children("#editor-container");case EditorButtonsMode.graph:return s.children(".editor-container");case EditorButtonsMode.geometry:return null}};var i=function(){return App.IsApps&&!App.isAndroidDevice&&(c||Tutor!==null&&Tutor.inChatRoom())};var a=null;var o=e.editor.editElem;var s=r(e.mode);var u=n(e.mode);var l=null;var c=false;t.setMode=function(t){switch(t){case EditorButtonsMode.main:case EditorButtonsMode.graph:case EditorButtonsMode.noImages:case EditorButtonsMode.geometry:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:e.mode=t;d();break}};t.forceSubmit=function(){switch(e.mode){case EditorButtonsMode.ExpertAdd:if(e.editor.CanClear())t.buttons.submit.click();else t.buttons.imageUpload.click();break;case EditorButtonsMode.ExpertUpdate:if(e.editor.CanClear())t.buttons.edit.click();else t.buttons.imageUpload.click();break;default:t.buttons.submit.click();break}};t.contentHandle=null;t.hijackHandle=null;t.releaseHandle=null;t.buttons={submit:new Editor.Button("mw mw-paper-airplane","submit your problem","paper-airplane",e.onSubmit),capture:new Editor.Button("mw mw-camera","take a picture of your problem","take-picture",e.onCapture),imageUpload:new Editor.Button("mw mw-addimage","upload a photo of your problem","upload-image",e.onImageUpload),edit:new Editor.Button("mw mw-edit","edit your problem","edit-problem",e.onEdit),voice:new Editor.Button("mw mw-voice","describe your problem","voice",e.onVoice),selectToggle:new Editor.Button("mw mw-step","toggle drop down","editor-toggle",e.onToggle),close:new Editor.Button("mw mw-editor-remove","remove editor row","editor-close",e.onClose)};var p=function(){var e=0;for(var r in t.buttons){if(t.buttons[r].state!==EditorButtonState.hidden)e++}return e};var d=function(){var r=t.buttons.submit.element.clientWidth;switch(e.mode){case EditorButtonsMode.main:if(e.editor.CanClear()){if(App.IsApps){t.buttons.capture.hide();t.buttons.voice.hide()}else t.buttons.imageUpload.hide();t.buttons.submit.enable()}else{t.buttons.submit.hide();if(App.IsApps){t.buttons.capture.enable();if(App.voiceSupported()){t.buttons.voice.enable()}}else t.buttons.imageUpload.enable()}break;case EditorButtonsMode.ExpertAdd:if(e.editor.CanClear()){t.buttons.imageUpload.hide();t.buttons.submit.enable()}else{t.buttons.imageUpload.enable();t.buttons.submit.hide()}t.buttons.edit.hide();break;case EditorButtonsMode.ExpertUpdate:t.buttons.submit.hide();t.buttons.imageUpload.hide();t.buttons.edit.enable();break;case EditorButtonsMode.graph:if(App.IsApps){if(e.editor.CanClear()){t.buttons.capture.hide();t.buttons.close.enable()}else{t.buttons.capture.enable();t.buttons.close.hide()}}else{if(e.editor.CanClear()){t.buttons.close.enable()}else{t.buttons.close.disable()}}break;case EditorButtonsMode.noImages:if(e.editor.CanClear()){t.buttons.submit.enable()}else{t.buttons.submit.hide()}break;case EditorButtonsMode.geometry:break}var n=15;var i=p();var o=0;Object.keys(t.buttons).reverse().forEach(function(e){var i=t.buttons[e];if(i.state!==EditorButtonState.hidden){i.element.style.right=o*(r+n)+"px";o++}});var s=r*i+(i-1)*n;a.width(s);if(e.mode===EditorButtonsMode.main){u.css("width","calc(100% - "+(s+20)+"px)")}};var f=function(){a=$('<div class="editor-buttons"></div>');for(var r in t.buttons){a.append(t.buttons[r].element)}a.append('<input class="editor-attach-file" type="file" accept="image/*" capture="capture" />');l=$('<input class="editor-focus-hole" type="text" style="display: none" />');a.append(l);if(App.IsApps)a.append('<input type="file" accept="image/*" id="tutor-camera" style="display:none" />');s.append(a);contentHandle=$.subscribe("editorContentUpdate",function(t){if(e.editor!==t){return}d()});hijackHandle=$.subscribe("topics/hijack",function(){c=true});releaseHandle=$.subscribe("topics/release",function(){c=false});if(App.IsApps){var n=document.getElementById("tutor-camera");if(n!==null){n.addEventListener("change",function(e){var t=this.files[0];if($("#tutor-pre-session-container").is(":visible")){$.publish("tutorPreSession/appPhoto",[t]);Actions.Do("ChatTapped")}else{Tutor.handleCameraInput(t);$(this).attr("value","");$(this).val("")}})}}if(e.mode===EditorButtonsMode.graph){if(App.IsApps){t.buttons.capture.enable();t.buttons.close.hide()}else{t.buttons.close.disable()}}d()};f()};Editor.Buttons.prototype={Delete:function(){$.unsubscribe(this.contentHandle);$.unsubscribe(this.hijackHandle);$.unsubscribe(this.releaseHandle)},getSubmitButton:function(){return this.buttons.submit},getCloseButton:function(){return this.buttons.close}};Editor.Button=function(e,t,r,n){this.iconClassName=e;this.element=document.createElement("button");this.element.setAttribute("aria-label",t);this.element.addEventListener("click",function(e){e.preventDefault();Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:r,eventAction:"click",eventLabel:""});$(this).blur();if(typeof n==="function")n.call(this)});this.hide();var i=document.createElement("i");i.className=this.iconClassName;this.element.appendChild(i)};Editor.Button.prototype={enable:function(){if(this.state===EditorButtonState.enabled){return}this.state=EditorButtonState.enabled;var e=$(this.element);e.removeClass("hidden disabled");e.addClass("enabled")},disable:function(){if(this.state===EditorButtonState.disabled){return}this.state=EditorButtonState.disabled;var e=$(this.element);e.removeClass("hidden enabled");e.addClass("disabled")},hide:function(){if(this.state===EditorButtonState.hidden){return}this.state=EditorButtonState.hidden;var e=$(this.element);e.removeClass("disabled enabled flipped");e.addClass("hidden")},click:function(){$(this.element).trigger("click")}};var SqrtWordMatcher=FlatListMatch.SpecificWord("sqrt",true);Head.ComandMatch=FlatListMatch.Command();Head.prototype.GetSolverStrings=function(e){if(!e)e=App.CurrentSubject;var t=this.Clone();var r="";capture={};var n=Head.ComandMatch.func(t.next,capture);if(!IsNull(n)){var i=t.Between(capture["$2"].start,capture["$2"].end.prev);r=i.map(function(e){return e.value}).join("");t.Splice(t.next,n.prev)}var a,o;t.SetIds();o=t.ToHtml(true,e);a=t.ToAsciiMath();return{ascii:a,html:o,command:r}};Head.prototype.ApplyMalformedRadicalDym=function(){var e=this.next;var t=false;while(e!==this){if(e instanceof Radical){t=true;var r=e.index;var n=e.radicand;if(r.next!==r&&n.next===n){AddAfter(n,r);e.index=new Head}}e=e.next}return t};Head.prototype.GetDidYouMean=function(e){var t=this.GetDYMChunk(e);var r=t.start;var n=t.end;var i=t.root;var a=i.CloneRange(r,n);var o=ApplyDymToChunk(a,false,App.CurrentSubject);if(o){var s=a.ToHtml(true,App.CurrentSubject);var u=this.ToAsciiMath();var l=i.ToAsciiMathRange(r,n);var c=a.ToAsciiMath();var p=u.split(l).join(c);return{asciimath:p,html:s}}return null};Head.prototype.GetDYMChunk=function(e){var t=GetHead(e);var r=RunAutomaton(t.next,false,App.CurrentSubject,null,true);SqrtToMath(t.next,r);MathSpacesToMathML(r);var n=t.next;var i=t.next;var a=t;var o=true;if(r.length>0){o=r[0].inMath;for(var s=0;s<r.length;s++){if(r[s].inMath!==o){o=r[s].inMath;if(t.IsABeforeB(e,i)){a=i;break}else{n=i}}i=r[s].node}if(s>=r.length){o=!o}}return{start:n,end:a,inMath:!o,root:t}};function SqrtToMath(e,t){var r=e;for(var n=0;n<t.length;n++){if(t[n].type==="word"&&!IsNull(SqrtWordMatcher.func(r))){t[n].inMath=true}r=t[n].node}}function ApplyDymToChunk(){return false}"use strict";function NodeToMathString(e){if(IsNull(e)){return"?"}else if(e instanceof Head){return"Head"}else if(e instanceof Character){return e.value}else if(e instanceof Superscript){return"^"}else if(e instanceof Subscript){return"_"}else if(e instanceof Table){return"Table"}else if(e instanceof Fraction){return"Fraction"}else if(e instanceof Paren){return e.type.openingDelim+e.type.closingDelim}else if(e instanceof Radical){return"Rad"}else if(e instanceof Matrix){return"Matrix"}else if(e instanceof Piecewise){return"Pcws"}else if(e instanceof Limit){return"Limit"}else if(e instanceof Integral){return"Integral"}else if(e instanceof Summation){return"Sum"}else if(e instanceof PermComb){return e.type.name}else{return"unknown"}}function UpdateDebug(e){var t="";if(!IsNull(e.displayCursor)&&typeof e.displayCursor.GetCursorPos==="function"){var r=e.displayCursor.GetCursorPos(e.editorPrefix);t+="x:"+r.x.toFixed(3)+" y:"+r.y.toFixed(3)+" id:"+e.displayCursor.id+"<br/>"}else{t+="unknown position <br/>"}return t}var printTreeOutput="";function PrintTree(e,t){printTreeOutput="";PrintTreeInternal(e,"",true,t);return"<pre>"+printTreeOutput+"</pre>"}function PrintTreeInternal(e,t,r,n){var i=NodeToMathString(e),a=[];if(e===n){i='<font color="red">'+i+"</font>"}printTreeOutput=printTreeOutput+t+(r?"└── ":"├── ")+i+"\n";if(e instanceof Head){a=e.ToArray(true);a.shift()}else if(IsGrouper(e)){a=GetGrouperChildren(e)}for(var o=0;o<a.length-1;o++){PrintTreeInternal(a[o],t+(r?"    ":"│   "),false,n)}if(a.length>0){PrintTreeInternal(a[a.length-1],t+(r?"    ":"│   "),true,n)}}Editor.Buttons=function(e){var t=this;e=$.extend({editor:null,mode:EditorButtonsMode.main,onSubmit:null,onCapture:null,onImageUpload:null,onEdit:null,onVoice:null,onToggle:null,onClose:null},e);if(e.$editor===null){Debug.error("Editor object is null for button instance.");return}if(e.onSubmit===null){e.onSubmit=function(){if(c){$.publish("tutorPreSession/problem")}else{Actions.Do(Actions.submitProblem)}}}if(e.onCapture===null){e.onCapture=function(){e.editor.TakeFocus();if(i()){$("#tutor-camera").trigger("click")}else{if(App.isAndroidDevice)Actions.Do(Actions.openCamera,{isPreTutorSession:c});else Actions.Do(Actions.openCamera)}}}if(e.onImageUpload===null){e.onImageUpload=function(){var e=a.children(".editor-attach-file").eq(0);$.publish("editor/imageUpload",[e]);l.focus()}}if(e.onEdit===null){e.onEdit=function(){}}if(e.onVoice===null){e.onVoice=function(){Actions.Do(Actions.startSpeechToText)}}if(e.onToggle===null){e.onToggle=function(){$(this).toggleClass("flipped")}}if(e.onClose===null){e.onClose=function(){}}var r=function(e){switch(e){case EditorButtonsMode.noImages:case EditorButtonsMode.main:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:return o.closest("#editor-outer");case EditorButtonsMode.graph:return o.closest(".editor-outer");case EditorButtonsMode.geometry:return null}};var n=function(e){switch(e){case EditorButtonsMode.noImages:case EditorButtonsMode.main:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:return s.children("#editor-container");case EditorButtonsMode.graph:return s.children(".editor-container");case EditorButtonsMode.geometry:return null}};var i=function(){return App.IsApps&&!App.isAndroidDevice&&(c||Tutor!==null&&Tutor.inChatRoom())};var a=null;var o=e.editor.editElem;var s=r(e.mode);var u=n(e.mode);var l=null;var c=false;t.setMode=function(t){switch(t){case EditorButtonsMode.main:case EditorButtonsMode.graph:case EditorButtonsMode.noImages:case EditorButtonsMode.geometry:case EditorButtonsMode.ExpertAdd:case EditorButtonsMode.ExpertUpdate:e.mode=t;d();break}};t.forceSubmit=function(){switch(e.mode){case EditorButtonsMode.ExpertAdd:if(e.editor.CanClear())t.buttons.submit.click();else t.buttons.imageUpload.click();break;case EditorButtonsMode.ExpertUpdate:if(e.editor.CanClear())t.buttons.edit.click();else t.buttons.imageUpload.click();break;default:t.buttons.submit.click();break}};t.contentHandle=null;t.hijackHandle=null;t.releaseHandle=null;t.buttons={submit:new Editor.Button("mw mw-paper-airplane","submit your problem","paper-airplane",e.onSubmit),capture:new Editor.Button("mw mw-camera","take a picture of your problem","take-picture",e.onCapture),imageUpload:new Editor.Button("mw mw-addimage","upload a photo of your problem","upload-image",e.onImageUpload),edit:new Editor.Button("mw mw-edit","edit your problem","edit-problem",e.onEdit),voice:new Editor.Button("mw mw-voice","describe your problem","voice",e.onVoice),selectToggle:new Editor.Button("mw mw-step","toggle drop down","editor-toggle",e.onToggle),close:new Editor.Button("mw mw-editor-remove","remove editor row","editor-close",e.onClose)};var p=function(){var e=0;for(var r in t.buttons){if(t.buttons[r].state!==EditorButtonState.hidden)e++}return e};var d=function(){var r=t.buttons.submit.element.clientWidth;switch(e.mode){case EditorButtonsMode.main:if(e.editor.CanClear()){if(App.IsApps){t.buttons.capture.hide();t.buttons.voice.hide()}else t.buttons.imageUpload.hide();t.buttons.submit.enable()}else{t.buttons.submit.hide();if(App.IsApps){t.buttons.capture.enable();if(App.voiceSupported()){t.buttons.voice.enable()}}else t.buttons.imageUpload.enable()}break;case EditorButtonsMode.ExpertAdd:if(e.editor.CanClear()){t.buttons.imageUpload.hide();t.buttons.submit.enable()}else{t.buttons.imageUpload.enable();t.buttons.submit.hide()}t.buttons.edit.hide();break;case EditorButtonsMode.ExpertUpdate:t.buttons.submit.hide();t.buttons.imageUpload.hide();t.buttons.edit.enable();break;case EditorButtonsMode.graph:if(App.IsApps){if(e.editor.CanClear()){t.buttons.capture.hide();t.buttons.close.enable()}else{t.buttons.capture.enable();t.buttons.close.hide()}}else{if(e.editor.CanClear()){t.buttons.close.enable()}else{t.buttons.close.disable()}}break;case EditorButtonsMode.noImages:if(e.editor.CanClear()){t.buttons.submit.enable()}else{t.buttons.submit.hide()}break;case EditorButtonsMode.geometry:break}var n=15;var i=p();var o=0;Object.keys(t.buttons).reverse().forEach(function(e){var i=t.buttons[e];if(i.state!==EditorButtonState.hidden){i.element.style.right=o*(r+n)+"px";o++}});var s=r*i+(i-1)*n;a.width(s);if(e.mode===EditorButtonsMode.main){u.css("width","calc(100% - "+(s+20)+"px)")}};var f=function(){a=$('<div class="editor-buttons"></div>');for(var r in t.buttons){a.append(t.buttons[r].element)}a.append('<input class="editor-attach-file" type="file" accept="image/*" capture="capture" />');l=$('<input class="editor-focus-hole" type="text" style="display: none" />');a.append(l);if(App.IsApps)a.append('<input type="file" accept="image/*" id="tutor-camera" style="display:none" />');s.append(a);contentHandle=$.subscribe("editorContentUpdate",function(t){if(e.editor!==t){return}d()});hijackHandle=$.subscribe("topics/hijack",function(){c=true});releaseHandle=$.subscribe("topics/release",function(){c=false});if(App.IsApps){var n=document.getElementById("tutor-camera");if(n!==null){n.addEventListener("change",function(e){var t=this.files[0];if($("#tutor-pre-session-container").is(":visible")){$.publish("tutorPreSession/appPhoto",[t]);Actions.Do("ChatTapped")}else{Tutor.handleCameraInput(t);$(this).attr("value","");$(this).val("")}})}}if(e.mode===EditorButtonsMode.graph){if(App.IsApps){t.buttons.capture.enable();t.buttons.close.hide()}else{t.buttons.close.disable()}}d()};f()};Editor.Buttons.prototype={Delete:function(){$.unsubscribe(this.contentHandle);$.unsubscribe(this.hijackHandle);$.unsubscribe(this.releaseHandle)},getSubmitButton:function(){return this.buttons.submit},getCloseButton:function(){return this.buttons.close}};Editor.Button=function(e,t,r,n){this.iconClassName=e;this.element=document.createElement("button");this.element.setAttribute("aria-label",t);this.element.addEventListener("click",function(e){e.preventDefault();Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:r,eventAction:"click",eventLabel:""});$(this).blur();if(typeof n==="function")n.call(this)});this.hide();var i=document.createElement("i");i.className=this.iconClassName;this.element.appendChild(i)};Editor.Button.prototype={enable:function(){if(this.state===EditorButtonState.enabled){return}this.state=EditorButtonState.enabled;var e=$(this.element);e.removeClass("hidden disabled");e.addClass("enabled")},disable:function(){if(this.state===EditorButtonState.disabled){return}this.state=EditorButtonState.disabled;var e=$(this.element);e.removeClass("hidden enabled");e.addClass("disabled")},hide:function(){if(this.state===EditorButtonState.hidden){return}this.state=EditorButtonState.hidden;var e=$(this.element);e.removeClass("disabled enabled flipped");e.addClass("hidden")},click:function(){$(this.element).trigger("click")}};"use strict";{Character.prototype.toString=function(){if(this.value===NewLine){return"\\n"}return this.value};TrigLog.prototype.toString=function(){return this.value};Placeholder.prototype.toString=function(){return"?"};Head.prototype.toString=function(){var e=this.next,t=[];while(e!==this){t.push(e);e=e.next}return"["+t.join(",")+"]"};Fraction.prototype.toString=function(){return"frac["+this.numerator+","+this.denominator+"]"};Superscript.prototype.toString=Subscript.prototype.toString=function(){return(this instanceof Superscript?"[^":"[_")+this.contents+"]"};Accent.prototype.toString=function(){return this.accent+"["+this.contents+"]"};Limit.prototype.toString=function(){return"lim["+this.contents+"]"};Integral.prototype.toString=Summation.prototype.toString=function(){return(this instanceof Integral?"int[":"sum[")+this.lowerBound+","+this.upperBound+"]"};Radical.prototype.toString=function(){return"rad["+this.index+","+this.radicand+"]"};PermComb.prototype.toString=function(){return this.letter+"["+this.left+","+this.right+"]"};Table.prototype.toString=function(){var e=[],t="table[";for(var r=0;r<this.children.length;r=r+2){e.push("["+this.children[r].toString()+","+this.children[r+1].toString()+"]")}t+=e.join(",")+"]";return t};Matrix.prototype.toString=function(){var e=[],t="matrix[";for(var r=0;r<this.numRows;r++){var n=[];for(var i=0;i<this.numCols;i++){n.push(this.children[r*this.numCols+i].toString())}e.push("["+n.join(",")+"]")}t+=e.join(",")+"]";return t};Piecewise.prototype.toString=function(){var e="piecewise[",t=[];for(var r=0;r<this.children.length;r++){t.push(this.children[r].toString())}e+=t.join(",")+"]";return e};ShapeTable.prototype.toString=function(){var e="shapetable[",t=[];for(var r=0;r<this.labels.length;r++){t.push("["+this.labels[r]+","+this.children[r]+"]")}e+=t.join(",")+"]";return e}}var DocumentEditor=function(e){var t=[];var r=0;var n=function(e){t.splice(e,0,{ascii:"",html:new Head(null,[]).ToHtml(true,null,true),command:"",section:null})};n(0);this._InsertLineAbove=function(){n(r);r++};this._InsertLineBelow=function(){n(r+1)};this._GetCursor=function(){return r};this._SetCursor=function(e){if(e<0||e>=t.length)return false;r=e;return true};this._UpdateLine=function(e){t[r]=e};this._GetLine=function(e){if(e<0||e>=t.length)return null;return t[e]};this._GetAtMathwayLines=function(){list=[];t.forEach(function(e){if(e.command==="mathway"){list.push(e)}});return list};this._GetLineCount=function(){return t.length};this._DeleteCursor=function(){t.splice(r,1);if(t.length===0)n(0);if(r>=t.length)r=t.length-1};this._ToHtml=function(){var n=e;t.forEach(function(e,t){var i=e.command===""?"":"@"+e.command+" ";var a="";var o=i+e.ascii;var s=null;var u=null;if(typeof e.section!=="undefined"&&e.section!==null){if(typeof e.section.ID!=="undefined"&&e.section.ID!==null)a=' data-id="'+e.section.ID+'"';if(typeof e.section.ImageURL!=="undefined"&&e.section.ImageURL!==null)s=e.section.ImageURL;if(typeof e.section.GraphInput!=="undefined"&&e.section.GraphInput!==null)u=HtmlEntitites.encode(e.section.GraphInput)}var l=t===r?" current-block":"";var c='<span class="document-buttons"><span class="document-insert"'+a+'><span class="mw mw-expertqa-add"></span></span>'+'<span class="document-delete"'+a+'><span class="mw mw-expertqa-delete"></span></span></span>';if(e.command==="mathway"){n+='<div class="document-block'+l+'"'+a+' ascii="'+o+'" index="'+t+'">';n+=this.CleanStepsHtml(e.html);n+=c+"</div>"}else if(s){n+='<div class="visitor-block document-block'+l+'"'+a+' index="'+t+'"><div class="visitor-bubbles">';n+='<div class="example-bubble"><div class="visitor-content">';n+='<img src="'+s+'" class="visitor-image" />';n+="</div></div></div>"+c+'<div class="clear"></div></div>'}else if(u){n+='<div class="visitor-block document-block'+l+'"'+a+' index="'+t+'"><div class="visitor-bubbles"><div class="example-bubble"><div class="visitor-content">';n+='<div class="GraphWrapper" data-graph-input="'+u+'"><img src="/images/placeholder.gif" class="graph-thumbnail" alt="image of graph" /></div>';n+="</div></div></div>"+c+'<div class="clear"></div></div>'}else{n+='<div class="visitor-block document-block'+l+'"'+a+' ascii="'+o+'" index="'+t+'"><div class="visitor-bubbles">';n+='<div class="example-bubble"><div class="visitor-content">';n+=e.html;n+="</div></div></div>"+c+'<div class="clear"></div></div>'}}.bind(this));return n};this._CleanStepsHtml=function(e){var t=e.indexOf('<div class="block-grey-border"');if(t===-1)t=e.indexOf('<div class="visitor-block"');return e.substring(t)}};DocumentEditor.prototype.InsertLineAbove=function(){this._InsertLineAbove()};DocumentEditor.prototype.InsertLineBelow=function(){this._InsertLineBelow()};DocumentEditor.prototype.GetCursor=function(){return this._GetCursor()};DocumentEditor.prototype.SetCursor=function(e){return this._SetCursor(e)};DocumentEditor.prototype.UpdateLine=function(e){this._UpdateLine(e)};DocumentEditor.prototype.GetLine=function(e){return this._GetLine(e)};DocumentEditor.prototype.GetAtMathwayLines=function(){return this._GetAtMathwayLines()};DocumentEditor.prototype.GetLineCount=function(){return this._GetLineCount()};DocumentEditor.prototype.ToHtml=function(e){return this._ToHtml(e)};DocumentEditor.prototype.CleanStepsHtml=function(e){return this._CleanStepsHtml(e)};DocumentEditor.prototype.DeleteCursor=function(){this._DeleteCursor()};function Color(e){var t=this;t.r=0;t.g=0;t.b=0;switch(e){case"MWRed":t.r=187;t.g=69;t.b=69;break;case"MWBlue":t.r=74;t.g=106;t.b=173;break;case"Black":t.r=0;t.g=0;t.b=0;break;case"DarkGray":t.r=154;t.g=154;t.b=154;break;case"AsymGray":t.r=200;t.g=200;t.b=200;break;case"UnitCircleTriangleGray":t.r=200;t.g=200;t.b=200;break;case"LightGray":t.r=225;t.g=225;t.b=225;break;case"Blue":t.r=0;t.g=0;t.b=255;break;case"Red":t.r=255;t.g=0;t.b=0;break;case"Purple":t.r=128;t.g=0;t.b=128;break;case"Green":t.r=0;t.g=128;t.b=0;break;case"Orange":t.r=255;t.g=165;t.b=0;break;case"SlateGray":t.r=112;t.g=128;t.b=144;break;case"Cyan":t.r=0;t.g=255;t.b=255;break;case"Crimson":t.r=220;t.g=20;t.b=60;break;case"Lavender":t.r=204;t.g=153;t.b=204;break;case"Yellow":t.r=255;t.g=255;t.b=0;break;case"LightBlue":t.r=173;t.g=216;t.b=230;break;case"LightGreen":t.r=144;t.g=238;t.b=144;break;case"LightSalmon":t.r=255;t.g=160;t.b=122;break;case"LightCyan":t.r=224;t.g=255;t.b=255;break;case"White":t.r=255;t.g=255;t.b=255;break;case"NoFill":t.r=250;t.g=250;t.b=250;break}t.rgb=function(){return t.r+","+t.g+","+t.b;
};t.alpha=function(e){return"rgba("+t.rgb()+","+e+")"};t.css=function(){return"#"+Color.padHex(t.r)+Color.padHex(t.g)+Color.padHex(t.b)};t.colorString=function(){return e};return t}Color.padHex=function(e){return("0"+e.toString(16)).slice(-2)};Color.FromArgb=function(e,t,r){var n=new Color;n.r=e;n.g=t;n.b=r;return n};function Font(e,t,r){var n=this;n.face=e;n.size=t;n.style=r;return n}function PointF(e,t){var r=this;r.x=e;r.y=t;return r}(function(e){e.fn.MWGraph=function(t){var r;var n;var i;var a;var o;var s;var u;var l;var c;const p=128;const d=1/p;const f=1/2;const h=1/128;const m=.005;const g=.24;const v=.6;const b=true;var y=this;y.params=t;y.last_xy={};y.colors=[];y.evals=[];y.badevals=[];y.dashed=[];y.points=[];y.segments=[];y.graphs=[];y.holes=[];y.colorGroups=[];y.zoomGraphPoints=true;y.palette=[new Color("MWRed"),new Color("MWBlue"),new Color("Green"),new Color("Purple"),new Color("Orange"),new Color("SlateGray"),new Color("Cyan"),new Color("Crimson"),new Color("Lavender"),new Color("Yellow")];if(t.palette!==undefined&&t.palette!==null){y.palette=t.palette}y.colorQueue=[];y.palette.forEach(function(e){y.colorQueue.push(e)});y.palette.next=function(){var e=y.palette.shift();y.palette.push(e);return e};y.asymGrey=new Color("AsymGray");y.density=App.Screen.pixelRatio;if(!App.isMobile&&y.density<2){y.density=2}if(y.density>2){y.density=2}r=document.createElement("canvas");n=document.createElement("canvas");i=document.createElement("canvas");r.width=y.density*e(y).width();r.height=y.density*e(y).height();n.width=r.width;n.height=r.height;i.width=r.width;i.height=r.height;e(r).appendTo(e(y));r.style.width=e(y).width()+"px";r.style.height=e(y).height()+"px";if(typeof t.onClick==="function"){y.on("click",function(){t.onClick()})}var w=null;if((y.params.solverInput instanceof String||typeof y.params.solverInput==="string")&&y.params.solverInput!==""){var C=y.params.solverInput;if(C.startsWith("{")&&C.endsWith("}")){try{w=JSON.parse(C)}catch(S){w=JSON.parse(C.replace(/'/g,'"').replace(/\\/g,"\\\\"))}}else{console.log("Graph data in incorrect format")}}else if(y.params.solverInput){w=y.params.solverInput}var x=[];if(w!==null){w.asymptotes.forEach(function(e){if(e.ascii.indexOf("=")>-1&&e.ascii.split("=",2)[0]===e.ascii.split("=",2)[1])return;var t=parseToRpn(e.ascii);if(t)t=changeVariables(t);var r=null;if(t)r=new Evaluator(t);if(r&&r.rpn){y.evals.push(new Evaluator(t))}else{y.evals.push(null)}y.colors.push(y.asymGrey);y.dashed.push(true)});w.graphs.forEach(function(e,t){if(e.ascii.indexOf("=")>-1&&e.ascii.split("=",2)[0]===e.ascii.split("=",2)[1])return;var r=parseToRpn(e.ascii);if(r)r=changeVariables(r);var n=null;if(r)n=new Evaluator(r);if(n&&n.rpn){y.evals.push(new Evaluator(r))}else{y.evals.push(null)}if(!IsNull(e.color)){if(e.color>=y.colorGroups.length||typeof y.colorGroups[e.color]==="undefined"){y.colorGroups[e.color]=e.isGrey?y.asymGrey:y.palette.next()}y.colors.push(y.colorGroups[e.color])}else y.colors.push(e.isGrey?y.asymGrey:y.palette.next());(e.holes?e.holes:[]).forEach(function(e){y.holes.push({x:e.x,y:e.y,color:y.colors[y.colors.length-1]})});y.dashed.push(!!e.dashed);if(r)x=x.concat(Evaluator.pointsFromInequalities(r))});if(!w.areaBetweenCurves)w.areaBetweenCurves=w.areaUnderCurve;w.areaBetweenCurves.forEach(function(e,t){if(!e.ascii2)e.ascii2="0";var r=parseToRpn(e.ascii+"<y<"+e.ascii2+" or "+e.ascii2+"<y<"+e.ascii);if(r!==null){r=[e.lower,"x","<","x",e.upper,"<","and"].concat(r).concat(["undef","{"]);r=changeVariables(r);var n=null;if(r)n=new Evaluator(r);if(n&&n.rpn){y.evals.push(new Evaluator(r))}else{y.evals.push(null)}}else{y.evals.push(null)}y.colors.push(y.palette.next());y.dashed.push(null)});w.segments.forEach(function(e,t){if(!e.color)y.colors.push(y.palette.next());else y.colors.push(new Color(e.color));y.dashed.push(false)});y.points=w.points;y.segments=w.segments}y.grid=new Grid(i,y.evals.filter(function(e){return e}),y.density);y.grid.autozoom(y.points);if(x.length>0){y.grid.autozoom(x)}y.draw=function(e){if(typeof e==="undefined")e=true;if(e){var t=y.badevals.map(function(e){if(e.startsWith("{")&&e.endsWith("}")){return JSON.parse(e)}else{return ParseGraphInput.parse(e)}});var a=y.points,o=y.segments,s=y.colors,u=y.dashed;t.forEach(function(e,t){a=a.concat(e.points);o=o.concat(e.segments);e.segments.forEach(function(e){if(!e.color)s.push(y.colors[t]);else s.push(new Color(e.color));u.push(false)})});if(a.length!==y.points.length||y.points.some(function(e,t){e.x!==a[t].x||e.y!==a[t].y}))y.grid.autozoom(a);var l=n.getContext("2d");l.setTransform(1,0,0,1,0,0);l.clearRect(0,0,n.width,n.height);if(o.length||a.length)y.grid.numberline=false;if(y.evals.length>y.graphs.length){if(y.calcTimer){clearTimeout(y.calcTimer);y.calcTimer=null}do{var c=y.grid.zoomTo;y.graphs=y.evals.map(function(e,t){if(e===null)return null;return new Graph(n,y.grid,e,y.colors[t],y.dashed[t])});if(y.zoomGraphPoints){y.graphs.forEach(function(e){if(e!==null)e.tree.forEach(function(e){y.grid.autozoom(e.points)})})}}while(c!==y.grid.zoomTo);y.zoomGraphPoints=false}else if(y.zoomGraphPoints){y.graphs.forEach(function(e){e.tree.forEach(function(e){y.grid.autozoom(e.points)})});y.zoomGraphPoints=false}y.grid.draw();var p=performance.now()+100;while(y.graphs.some(function(e){return e&&e.tree.some(function(e){return e.queue.length})})&&performance.now()<p){y.graphs.forEach(function(e){if(performance.now()>p)return;if(e!==null){e.tree.forEach(function(e){if(e.queue.length)e.nextCell()})}})}y.graphs.forEach(function(e){if(e!==null){e.draw(y.density)}});var d=n.getContext("2d");y.grid.setTransform(d);a.forEach(function(e){y.grid.drawPoint(e.x,e.y,d)});y.holes.forEach(function(e){y.grid.drawHole(e.x,e.y,e.color,d)});o.forEach(function(e,t){y.grid.drawSegment(e.x1,e.y1,e.x2,e.y2,y.colors[y.graphs.length+t],y.dashed[y.graphs.length+t],d)});d=r.getContext("2d");d.clearRect(0,0,r.width,r.height);d.drawImage(i,0,0);d.drawImage(n,0,0);if(y.graphs.some(function(e){return e&&e.tree.some(function(e){return e.queue.length})}))y.calcTimer=setTimeout(function(){y.draw()},0);if(typeof y.params.postRender==="function")y.params.postRender.call(this)}else{l=n.getContext("2d");l.setTransform(1,0,0,1,0,0);l.clearRect(0,0,n.width,n.height);y.grid.draw()}};y.updateEquations=function(e,t){y.zoomGraphPoints=true;if(typeof t==="undefined")t=true;var r=[];if(Array.isArray(e)){y.badevals=[];y.evals=e.map(function(e){if(e.indexOf("=")>-1&&e.split("=",2)[0]===e.split("=",2)[1]){y.badevals.push(e);return null}var t=parseToRpn(e);if(t===null){y.badevals.push(e);return null}t=changeVariables(t);if(t===null){y.badevals.push(e);return null}var n=new Evaluator(t);if(n.rpn===null){y.badevals.push(e);return null}y.badevals.push("");r=r.concat(Evaluator.pointsFromInequalities(n.rpn));return n});y.dashed=e.map(function(e){return false});y.grid.changeEval(y.evals);y.grid.autozoom(r);if(t){y.graphs=[];y.draw()}}};y.resize=function(t){if(typeof t==="undefined")t=true;var a=y.density*e(y).width();var o=y.density*e(y).height();if(r.width!==a||r.height!==o){r.width=y.density*e(y).width();r.height=y.density*e(y).height();n.width=r.width;n.height=r.height;i.width=r.width;i.height=r.height;r.style.width=e(y).width()+"px";r.style.height=e(y).height()+"px";var s=y.grid.zoomTo;var u={x:y.grid.axis("x").min+y.grid.axis("x").len/2,y:y.grid.axis("y").min+y.grid.axis("y").len/2};y.grid=new Grid(i,[],y.density);y.grid.changeEval(y.evals);y.grid.zoom(s);y.grid.move(u.x,u.y);if(t){y.graphs=[];y.draw()}}};y.zoomIn=function(e,t){if(y.grid.zoomTo<p){if(typeof e==="undefined")e=2;y.grid.zoom(e);if(typeof t==="undefined")t=true;y.graphs=[];y.draw(t)}};y.zoomOut=function(e,t){if(y.grid.zoomTo>d){if(typeof e==="undefined")e=.5;y.grid.zoom(e);if(typeof t==="undefined")t=true;y.graphs=[];y.draw(t)}};e(y).mousewheel(function(e,t){if(t>0){y.zoomIn()}else{y.zoomOut()}});function A(e,t,r){var n=e.getBoundingClientRect();var i=(r.clientX-n.left)/n.width;var a=1-(r.clientY-n.top)/n.height;var o=i*t.axis("x").len+t.axis("x").min;var s=a*t.axis("y").len+t.axis("y").min;return{x:o,y:s,px_x:r.clientX,px_y:r.clientY}}y.dragOffset={x:0,y:0};e(r).css("z-index",0);var T=function(){var e=false;var a=false;var o=new Hammer(r,{domEvents:true});o.get("pinch").set({enable:true});var s=function(e){if(y.calcTimer){clearTimeout(y.calcTimer);y.calcTimer=null}y.last_xy=A(r,y.grid,e);y.dragOffset={x:0,y:0};if(typeof t.onMoveStart==="function"){t.onMoveStart()}};var u=function(e){var t=A(r,y.grid,e);y.dragOffset={x:y.dragOffset.x+y.last_xy.px_x-t.px_x,y:y.dragOffset.y+y.last_xy.px_y-t.px_y};y.grid.move(y.last_xy.x-t.x,y.last_xy.y-t.y);y.last_xy=A(r,y.grid,e);var a=r.getContext("2d");a.clearRect(0,0,r.width,r.height);y.grid.draw();a.drawImage(i,0,0);if(y.grid.numberline){a.drawImage(n,-y.dragOffset.x*r.width/r.clientWidth,0)}else{if(App.deviceName!=="ios")a.drawImage(n,-y.dragOffset.x*r.width/r.clientWidth,-y.dragOffset.y*r.height/r.clientHeight)}};var l=function(e){var t=A(r,y.grid,e);y.grid.move(y.last_xy.x-t.x,y.last_xy.y-t.y);y.dragOffset={x:0,y:0};y.graphs=[];y.draw()};var c=function(e,t,r){return(e-t)/(r-t)};var p=function(e,t,r){return t+(r-t)*e};var d=1;var b=function(e){return{clientX:e.center.x,clientY:e.center.y,deltaX:e.deltaX,deltaY:e.deltaY}};o.on("pinchstart",function(e){if(!a){s(b(e));a=true}});o.on("pinchend",function(e){if(a){l(b(e));d=1;a=false}});o.on("pinchcancel",function(e){if(a){l(b(e));d=1;a=false}});o.on("pinchin",function(e){if(a){u(b(e));var t=Math.abs(e.scale-d);if(e.scale<d&&t>m){if(t>g)t=g;var r=c(t,m,g);var n=p(r,1-h,1-f);y.zoomOut(n,false);d=e.scale}}});o.on("pinchout",function(e){if(a){u(b(e));var t=Math.abs(e.scale-d);if(e.scale>d&&t>m){if(t>v)t=v;var r=c(t,m,v);var n=p(r,1+h,1+f);y.zoomIn(n,false);d=e.scale}}});o.on("panstart",function(t){if(!e){s(b(t));e=true}});o.on("panmove",function(t){if(e){u(b(t))}});o.on("panend",function(t){if(e){l(b(t));e=false}})};y.reset=function(){y.zoomGraphPoints=true;y.grid=new Grid(i,y.evals.filter(function(e){return e}),y.density);y.grid.autozoom(y.points);var e=[];for(var t=0;t<y.evals.length;t++){e=e.concat(Evaluator.pointsFromInequalities(y.evals[t].rpn))}if(e.length>0){y.grid.autozoom(e)}y.graphs=[];y.draw()};y.dataUrl=function(){return canvasEle.toDataURL("image/png;")};if(y.params.draggable)T();return y}})(jQuery);var ParseGraphInput=function(){};ParseGraphInput.PointRegx=/^\(([^,]+)[,|;]([^,]+)\)$/;ParseGraphInput.AsymptoteRegx=/^Asymptote:([^=]*=[^=]*)$/i;ParseGraphInput.SegmentRegx=/^\(([^,]+)[,|;]([^,]+)\)-\(([^,]+)[,|;]([^,]+)\)$/;ParseGraphInput.AreaUnderCurveRegx=/^([^\{]+)\{([^<]+)<x<([^\}]+)\}$/;ParseGraphInput.UnitCircleTriangleRegx=/^UnitCircleTriangle:\(([^,]+)[,|;]([^,]+)\)-\(([^,]+)[,|;]([^,]+)\)$/;ParseGraphInput.TanNormEqRegx=/^TangentNormalEq:(.*)$/;ParseGraphInput.parse=function(e){var t=false;var r=-1;var n=e.match(ParseGraphInput.TanNormEqRegx);if(n!==null)e=n[1];var i=e.split("_");var a={graphs:[],points:[],asymptotes:[],segments:[],areaUnderCurve:[],areaBetweenCurves:[]};i.forEach(function(e){if(e==="")return;var n=e.split(/[,|;]/);var i=null;if(n.length%2===0){var o=[];while(n.length)o.push(n.shift()+","+n.shift());n=o.map(function(e){return e.match(ParseGraphInput.PointRegx)});if(n.every(function(e){return e}))i={}}if(i!==null){n=n.map(function(e){return{x:ParseGraphInput.asNum(e[1]),y:ParseGraphInput.asNum(e[2])}});if(n.every(function(e){return e.x===e.x||e.y===e.y})){a.points=a.points.concat(n);return}}i=e.match(ParseGraphInput.AsymptoteRegx);if(i!==null){a.asymptotes.push({ascii:i[1]});return}i=e.match(ParseGraphInput.SegmentRegx);if(i!==null){var s={x1:ParseGraphInput.asNum(i[1]),y1:ParseGraphInput.asNum(i[2]),x2:ParseGraphInput.asNum(i[3]),y2:ParseGraphInput.asNum(i[4])};if(s.x1===s.x1&&s.y1===s.y1&&s.x2===s.x2&&s.y2===s.y2){a.segments.push(s);return}}i=e.match(ParseGraphInput.AreaUnderCurveRegx);if(i!==null){var u={ascii:ParseGraphInput.inputToAscii(i[1]),lower:ParseGraphInput.asNum(i[2]),upper:ParseGraphInput.asNum(i[3])};if(u.lower===u.lower&&u.upper===u.upper){a.areaUnderCurve.push(u);a.areaBetweenCurves.push(u);return}}i=e.match(ParseGraphInput.UnitCircleTriangleRegx);if(i!==null){var l={x1:ParseGraphInput.asNum(i[1]),y1:ParseGraphInput.asNum(i[2]),x2:ParseGraphInput.asNum(i[3]),y2:ParseGraphInput.asNum(i[4]),color:"UnitCircleTriangleGray"};if(l.x1===l.x1&&l.y1===l.y1&&l.x2===l.x2&&l.y2===l.y2){a.segments.push(l);return}}var c=t;t=e.endsWith("<C>0<c>");if(t)e=e.slice(0,-7);if(t&&!c)r++;a.graphs.push({ascii:ParseGraphInput.inputToAscii(e),color:t||c?r:null})});return a};ParseGraphInput.asNum=function(e){var t=parseToRpn(ParseGraphInput.inputToAscii(e));if(t)return new Evaluator(t).eval(0,0).z;else return NaN};ParseGraphInput.LogBaseRegx=/log\[([^\]]+)\]/g;ParseGraphInput.PiecewiseRegx=/^f\(x\)(=|<|>|<=|>=)<W>[^,]+,[^\):]+(?::[^,]+,[^\):]+)+<w>$/;ParseGraphInput.RootRegx=/√\((\d+)\):/g;ParseGraphInput.inputToAscii=function(e){e=e.replace(/asi\(/g,"arcsin ").replace(/aco\(/g,"arccos ").replace(/ata\(/g,"arctan ").replace(/act\(/g,"arccot ").replace(/ase\(/g,"arcsec ").replace(/acs\(/g,"arccsc ");e=e.replace(ParseGraphInput.LogBaseRegx,"log_($1)");e=e.replace(ParseGraphInput.RootRegx,"\\root($1)");e=e.replace(/√/g,"\\sqrt");if(e.match(ParseGraphInput.PiecewiseRegx)){e=e.split("<W>");var t=e[0];e=e[1].split("<w>")[0].split(":");e=e.map(function(e){return e.replace(","," ")}).reduce(function(e,t){return e+(e===""?"":",")+"("+t+")"},"");e=t+"{"+e+":}"}return e};Evaluator=function(e){try{this.rpn=e.map(Evaluator.tryParseFloat);if(this.rpn.some(function(e){return e==="x"})&&this.rpn.some(function(e){return e==="y"})&&this.rpn.some(function(e){return e==="r"})){this.rpn=null}}catch(t){this.rpn=null}};Evaluator.prototype.isYEq=function(){if(this.rpn[0]!=="y"||this.rpn[this.rpn.length-1]!=="=")return false;var e={z:0,dx:1,dy:0,dxy:0,dxx:0,dyy:0,satisfied:true};var t={z:0,dx:0,dy:1,dxy:0,dxx:0,dyy:0,satisfied:true};var r=[t];for(var n=1;n<this.rpn.length-1;n++){var i=this.rpn[n];var a=Evaluator.ops[i];if(a!==undefined){var o=[];var s=null;for(var u=0;u<a.args;u++){var l=r.pop();if(r.length===0&&i==="abs")return false;if(s===null&&!l.satisfied&&i!=="{"){s=l}o.unshift(l)}if(s===null||a.anySatisfied){var c=a.func.apply(null,o);c.innerNotSatisfied=false;r.push(c)}else{s.innerNotSatisfied=true;r.push(s)}}else if(i==="x"||i==="θ"){r.push(e)}else if(i==="y"||i==="r"){return false}else{r.push(Evaluator.cons(i))}}return r[0]===t};Evaluator.pointsFromInequalities=function(e){var t=[];var r=0;var n=-1;while(r<e.length){if(e[r]==="neg"){if(r===0||typeof t[n]!=="number")return[];else{t[n]=-t[n];r++}}else{t.push(e[r]);r++;n++}}var i=[];function a(e,t,r){if(["=","<",">","≤","≥"].filter(function(e){return e===r}).length===1){var n=null,a=null;if(typeof e==="number"){a=e;if(typeof t==="string")n=t}else if(typeof t==="number"){a=t;if(typeof e==="string")n=e}if(n!==null&&a!==null){if(n==="x")i.push({x:a,y:0});else if(n==="y")i.push({x:0,y:a});return n==="x"||n==="y"}return false}}if(t.length===3)a(t[0],t[1],t[2]);if(t.length===7&&(t[6]==="and"||t[6]==="or"))a(t[0],t[1],t[2])&&a(t[3],t[4],t[5]);return i.filter(function(e){return isFinite(e.x)&&isFinite(e.y)})};Evaluator.tryParseFloat=function(e){var t=parseFloat(e);return Number.isNaN(t)?e:t};Evaluator.prototype.eval=function(e,t){var r={z:e,dx:1,dy:0,dxy:0,dxx:0,dyy:0,satisfied:true,asym:[]};var n={z:t,dx:0,dy:1,dxy:0,dxx:0,dyy:0,satisfied:true,asym:[]};var i=[];var a=[];for(var o=0;o<this.rpn.length;o++){var s=this.rpn[o];var u=Evaluator.ops[s];if(u!==undefined){var l=[];var c=null;for(var p=0;p<u.args;p++){var d=i.pop();if(c===null&&!d.satisfied&&s!=="{"){c=d}l.unshift(d)}if(c===null||u.anySatisfied){var f=u.func.apply(null,l);f.innerNotSatisfied=false;i.push(f)}else{c.innerNotSatisfied=true;i.push(c)}if(i[i.length-1].asym){}else{i[i.length-1].asym=l.reduce(function(e,t){return e.concat(t.asym)},[])}if(typeof u.pred!=="undefined"){a[o]=u.pred.apply(null,l)}}else if(s==="x"||s==="θ"){i.push(r)}else if(s==="y"||s==="r"){i.push(n)}else{i.push(Evaluator.cons(s));i[i.length-1].asym=[]}}var h=i[0];h.x=e;h.y=t;h.asymArr=h.asym;h.predArr=a;h.radius=Evaluator.getRadius(h);h.eval=this;return h};Evaluator.getRadius=function(e){var t=-e.dy*e.dy*e.dxx+2*e.dx*e.dy*e.dxy-e.dx*e.dx*e.dyy;var r=Math.sqrt(Math.pow(e.dx*e.dx+e.dy*e.dy,3));return Math.abs(r/t)};Evaluator.prototype.getOpArgs=function(e){var t=[];var r=[];for(var n=0;n<this.rpn.length;n++){token=this.rpn[n];var i=Evaluator.ops[token];if(i!==undefined){var a=[];for(var o=0;o<i.args;o++){a.unshift(t.pop())}var s=e.indexOf(token);if(s>=0){r.push({op:e[s],arg_list:a})}var u=Array.prototype.concat.apply([],a);u.push(token);t.push(u)}else{t.push([token])}}return r};Evaluator.prototype.IsInquality=function(){return[">","≥","<","≤"].indexOf(this.rpn[this.rpn.length-1])>=0};Evaluator.prototype.IsStrictInequality=function(){return[">","<"].indexOf(this.rpn[this.rpn.length-1])>=0};Evaluator.prototype.IsOnlyInX=function(){return this.rpn.some(function(e){return e==="x"})&&this.rpn.every(function(e){return e!=="y"})};Evaluator.prototype.IsNotInY=function(){return this.rpn.every(function(e){return e!=="y"})};Evaluator.IsConstantInt=function(e){return Number.isInteger(e.z)&&e.dx===0&&e.dy===0};Evaluator.div=function(e,t){var r={z:e.z/t.z,dx:e.dx/t.z-e.z*t.dx/Math.pow(t.z,2),dy:e.dy/t.z-e.z*t.dy/Math.pow(t.z,2),dxx:e.dxx/t.z-e.dx*t.dx/Math.pow(t.z,2)-(e.z*t.dxx+t.dx*e.dx)/Math.pow(t.z,2)+2*e.z*Math.pow(t.dx,2)*t.z/Math.pow(t.z,4),dyy:e.dyy/t.z-e.dy*t.dy/Math.pow(t.z,2)-(e.z*t.dyy+t.dy*e.dy)/Math.pow(t.z,2)+2*e.z*Math.pow(t.dy,2)*t.z/Math.pow(t.z,4),dxy:e.dxy/t.z-e.dx*t.dy/Math.pow(t.z,2)-(e.z*t.dxy+t.dx*e.dy)/Math.pow(t.z,2)+2*e.z*t.dx*t.dy*t.z/Math.pow(t.z,4)};if(e.dx/t.dx===e.z/t.z)r.dx=0;if(e.dy/t.dy===e.z/t.z)r.dy=0;if(Evaluator.IsConstantInt(e)&&Evaluator.IsConstantInt(t)){r.numer=e;r.denom=t}r.satisfied=true;r.asym=[t].concat(e.asym?e.asym:[]);return r};Evaluator.exp=function(e,t){if(t.z<0){return Evaluator.div(Evaluator.one,Evaluator.exp(e,Evaluator.neg(t)))}if(e.z<0&&!Number.isInteger(t.z)&&t.denom!==undefined&&Number.isInteger(t.denom.z)&&t.denom.z%2===1&&Number.isInteger(t.numer.z)){var r=Evaluator.exp(Evaluator.abs(e),t);if(t.numer.z%2===1){r.z=-r.z;r.dx=-r.dx;r.dy=-r.dy;r.dxx=-r.dxx;r.dyy=-r.dyy;r.dxy=-r.dxy}else{}r.satisfied=true;return r}var n=Math.pow(e.z,t.z);var i=true;if(Number.isNaN(n)&&e.z<=0){i=false}var a=Math.log(e.z);if(Number.isNaN(a)){a=0}var o=n;var s=t.dx*a+t.z*(1/e.z)*e.dx;var u=o*s;var l=t.dy*a+t.z*(1/e.z)*e.dy;var c=o*l;var p=o*s*s+o*(t.dxx*a+t.dx*(2/e.z)*e.dx-t.z*(1/(e.z*e.z))*e.dx*e.dx+t.z*(1/e.z)*e.dxx);var d=o*l*l+o*(t.dyy*a+t.dy*(2/e.z)*e.dy-t.z*(1/(e.z*e.z))*e.dy*e.dy+t.z*(1/e.z)*e.dyy);var f=l*s*o+o*(t.dxy*a+t.dx*(1/e.z)*e.dy+t.dy*(1/e.z)*e.dx-t.z*(1/(e.z*e.z))*e.dy*e.dx+t.z*(1/e.z)*e.dxy);return{z:n,dx:u,dy:c,dxx:p,dyy:d,dxy:f,satisfied:i}};Evaluator.add=function(e,t){return{z:e.z+t.z,dx:e.dx+t.dx,dy:e.dy+t.dy,dxy:e.dxy+t.dxy,dxx:e.dxx+t.dxx,dyy:e.dyy+t.dyy,satisfied:true}};Evaluator.sub=function(e,t){return Evaluator.add(e,Evaluator.mult(Evaluator.cons(-1),t))};Evaluator.mult=function(e,t){return{z:e.z*t.z,dx:t.z*e.dx+e.z*t.dx,dy:t.z*e.dy+e.z*t.dy,dxy:e.z*t.dxy+t.dx*e.dy+t.z*e.dxy+e.dx*t.dy,dxx:t.z*e.dxx+2*e.dx*t.dx+e.z*t.dxx,dyy:t.z*e.dyy+2*e.dy*t.dy+e.z*t.dyy,satisfied:true}};Evaluator.tan=function(e){return Evaluator.div(Evaluator.sin(e),Evaluator.cos(e))};Evaluator.cos=function(e){return Evaluator.sin(Evaluator.sub(Evaluator.piOverTwo,e))};Evaluator.sin=function(e){return{z:Math.sin(e.z),dx:Math.cos(e.z)*e.dx,dy:Math.cos(e.z)*e.dy,dxy:Math.cos(e.z)*e.dxy+e.dx*-Math.sin(e.z)*e.dy,dxx:Math.cos(e.z)*e.dxx+e.dx*-Math.sin(e.z)*e.dx,dyy:Math.cos(e.z)*e.dyy+e.dy*-Math.sin(e.z)*e.dy,satisfied:true,asym:[]}};Evaluator.sec=function(e){return Evaluator.div(Evaluator.one,Evaluator.cos(e))};Evaluator.csc=function(e){return Evaluator.div(Evaluator.one,Evaluator.sin(e))};Evaluator.cot=function(e){return Evaluator.div(Evaluator.cos(e),Evaluator.sin(e))};Evaluator.arcsin=function(e){var t=true;if(e.z>1){t=false}if(e.z<-1){t=false}return{z:Math.asin(e.z),dx:e.dx/Math.sqrt(1-e.z*e.z),dy:e.dy/Math.sqrt(1-e.z*e.z),dxx:(1-e.z*e.z)*e.dxx+e.z*e.dx*e.dx/Math.pow(1-e.z*e.z,1.5),dyy:(1-e.z*e.z)*e.dyy+e.z*e.dy*e.dy/Math.pow(1-e.z*e.z,1.5),dxy:(1-e.z*e.z)*e.dxy+e.z*e.dx*e.dy/Math.pow(1-e.z*e.z,1.5),satisfied:t}};Evaluator.arccos=function(e){return Evaluator.sub(Evaluator.piOverTwo,Evaluator.arcsin(e))};Evaluator.arctan=function(e){return{z:Math.atan(e.z),dx:e.dx/(1+e.z*e.z),dy:e.dy/(1+e.z*e.z),dxx:(e.dxx*(1+e.z*e.z)-2*e.dx*e.dx*e.z)/Math.pow(1+e.z*e.z,2),dyy:(e.dyy*(1+e.z*e.z)-2*e.dy*e.dy*e.z)/Math.pow(1+e.z*e.z,2),dxy:(e.dxy*(1+e.z*e.z)-2*e.dx*e.dy*e.z)/Math.pow(1+e.z*e.z,2),satisfied:true}};Evaluator.arcsec=function(e){return Evaluator.arccos(Evaluator.div(Evaluator.one,e))};Evaluator.arccsc=function(e){return Evaluator.arcsin(Evaluator.div(Evaluator.one,e))};Evaluator.arccot=function(e){return Evaluator.sub(Evaluator.piOverTwo,Evaluator.arctan(e))};Evaluator.abs=function(e){return Evaluator.piecewise(Evaluator.less(e,Evaluator.cons(0)),Evaluator.mult(Evaluator.cons(-1),e),e)};Evaluator.root=function(e,t){return Evaluator.exp(t,Evaluator.div(Evaluator.one,e))};Evaluator.sqrt=function(e){return Evaluator.root(Evaluator.two,e)};Evaluator.ln=function(e){var t=true;if(e.z<=0){t=false}return{z:Math.log(e.z),dx:1/e.z*e.dx,dy:1/e.z*e.dy,dxx:1/e.z*e.dxx+e.dx*(-1/(e.z*e.z))*e.dx,dyy:1/e.z*e.dyy+e.dy*(-1/(e.z*e.z))*e.dy,dxy:1/e.z*e.dxy+e.dx*(-1/(e.z*e.z))*e.dy,asym:[e],satisfied:t}};Evaluator.log=function(e,t){return Evaluator.div(Evaluator.ln(t),Evaluator.ln(e))};Evaluator.neg=function(e){var t=Evaluator.sub(Evaluator.zero,e);if(e.numer)t.numer=Evaluator.neg(e.numer);if(e.denom)t.denom=e.denom;return t};Evaluator.equ=function(e,t){var r=Evaluator.sub(e,t);r.satisfied=e.z===t.z;return r};Evaluator.notEqu=function(e,t){var r=Evaluator.sub(e,t);r.satisfied=e.z!==t.z;return r};Evaluator.greater=function(e,t){if(e.rightSide!==undefined){e=e.rightSide}var r=Evaluator.sub(e,Evaluator.add(t,Evaluator.epsilon));r.satisfied=e.z>t.z;r.rightSide=t;r.strict=true;return r};Evaluator.greaterEqu=function(e,t){if(e.rightSide!==undefined){e=e.rightSide}var r=Evaluator.sub(e,t);r.satisfied=e.z>=t.z;r.rightSide=t;r.strict=false;return r};Evaluator.less=function(e,t){if(e.rightSide!==undefined){e=e.rightSide}var r=Evaluator.sub(t,Evaluator.add(e,Evaluator.epsilon));r.satisfied=e.z<t.z;r.rightSide=t;r.strict=true;return r};Evaluator.lessEqu=function(e,t){if(e.rightSide!==undefined){e=e.rightSide}var r=Evaluator.sub(t,e);r.satisfied=e.z<=t.z;r.rightSide=t;r.strict=false;return r};Evaluator.and=function(e,t){if(e.z!==e.z)return e;else if(t.z!==t.z)return t;else if(e.z<t.z)return e;else return t};Evaluator.or=function(e,t){if(e.z!==e.z)return t;else if(t.z!==t.z)return e;else if(e.z<t.z)return t;else return e};Evaluator.piecewise=function(e,t,r){if(e.satisfied){return t}return r};Evaluator.cons=function(e){return{z:e,dx:0,dy:0,dxy:0,dxx:0,dyy:0,satisfied:true}};Evaluator.undef=function(){return{z:NaN,dx:NaN,dy:NaN,dxy:NaN,dxx:NaN,dyy:NaN,satisfied:true}};Evaluator.zero=Evaluator.cons(0);Evaluator.one=Evaluator.cons(1);Evaluator.two=Evaluator.cons(2);Evaluator.epsilon=Evaluator.cons(1e-12);Evaluator.pi=Evaluator.cons(Math.PI);Evaluator.piOverTwo=Evaluator.cons(Math.PI/2);Evaluator.ops={"+":{args:2,func:Evaluator.add},"-":{args:2,func:Evaluator.sub},"*":{args:2,func:Evaluator.mult},"^":{args:2,func:Evaluator.exp},"/":{args:2,func:Evaluator.div},tan:{args:1,func:Evaluator.tan},sin:{args:1,func:Evaluator.sin},cos:{args:1,func:Evaluator.cos},sec:{args:1,func:Evaluator.sec},csc:{args:1,func:Evaluator.csc},cot:{args:1,func:Evaluator.cot},arcsin:{args:1,func:Evaluator.arcsin},arccos:{args:1,func:Evaluator.arccos},arctan:{args:1,func:Evaluator.arctan},arcsec:{args:1,func:Evaluator.arcsec},arccsc:{args:1,func:Evaluator.arccsc},arccot:{args:1,func:Evaluator.arccot},abs:{args:1,func:Evaluator.abs},sqrt:{args:1,func:Evaluator.sqrt},root:{args:2,func:Evaluator.root},ln:{args:1,func:Evaluator.ln},log:{args:2,func:Evaluator.log},e:{args:0,func:function(){return Evaluator.cons(Math.E)}},"π":{args:0,func:function(){return Evaluator.cons(Math.PI)}},"=":{args:2,func:Evaluator.equ},"≠":{args:2,func:Evaluator.notEqu},">":{args:2,func:Evaluator.greater},"≥":{args:2,func:Evaluator.greaterEqu},"<":{args:2,func:Evaluator.less},"≤":{args:2,func:Evaluator.lessEqu},and:{args:2,func:Evaluator.and},or:{args:2,func:Evaluator.or,anySatisfied:true},"{":{args:3,func:Evaluator.piecewise,pred:function(e,t,r){return e}},undef:{args:0,func:Evaluator.undef},neg:{args:1,func:Evaluator.neg}};var Cell=function(e,t,r,n,i){if(!i)i=0;this.l=e;this.t=t;this.r=r;this.b=n;this.isleaf=true;this.enqueued=true;this.lvl=i;this.children=[];this.ll=e.startPoint();this.ul=e.endPoint();this.ur=r.endPoint();this.lr=r.startPoint();e.cells[1]=this;t.cells[0]=this;r.cells[0]=this;n.cells[1]=this};Cell.prototype.width=function(){return this.lr.x-this.ll.x};Cell.prototype.height=function(){return this.ul.y-this.ll.y};Cell.prototype.willDivide=function(e){if(!this.isleaf)return false;if(this.width()>Tree.axis("x",e).min_res||this.height()>Tree.axis("y",e).min_res)return true;if(e.numberline)if(this.width()>Tree.axis("x",e).min_res/4||this.height()>Tree.axis("y",e).min_res/4)return true;if(this.width()<Tree.axis("x",e).max_res&&this.height()<Tree.axis("y",e).max_res)return false;var t=[this.ll,this.ul,this.ur,this.lr];t=t.map(function(e){return e.z!=e.z});var r=t.reduce(function(e,t){return e&&t});var n=t.some(function(e){return e});if(n&&!r)return true;var i=this.getPoints();if(e.numberline){var a=[];while(i.length){var o=i.pop();if(!a.some(function(e){return e.x==o.x}))a.push(o)}i=a}if(i.length==0)return false;if(i.length==2&&Cell.isLinear(i))return false;return true};Cell.prototype.divide=function(eval,EPSILON_X,EPSILON_Y){this.isleaf=false;if(this.l.isleaf)this.l.divide(eval,EPSILON_Y);if(this.t.isleaf)this.t.divide(eval,EPSILON_X);if(this.r.isleaf)this.r.divide(eval,EPSILON_Y);if(this.b.isleaf)this.b.divide(eval,EPSILON_X);var horiz=new Edge(Edge.midpoint(this.ll,this.ul,eval),Edge.midpoint(this.lr,this.ur,eval),eval,EPSILON_X);horiz.divide(eval,EPSILON_X);var vert=new Edge(Edge.midpoint(this.ll,this.lr,eval),Edge.midpoint(this.ul,this.ur,eval),eval,EPSILON_Y);vert.divide(eval,EPSILON_Y);this.children=[new Cell(this.l.start,horiz.start,vert.start,this.b.start,this.lvl+1),new Cell(this.l.end,this.t.start,vert.end,horiz.start,this.lvl+1),new Cell(vert.end,this.t.end,this.r.end,horiz.end,this.lvl+1),new Cell(vert.start,horiz.end,this.r.start,this.b.end,this.lvl+1)]};Cell.prototype.getPoints=function(){var e=[this.l,this.t,this.r,this.b];while(e.some(function(e){return!e.isleaf}))e=e.map(function(e){return e.isleaf?[e]:[e.start,e.end]}).reduce(function(e,t){return e.concat(t)});e=e.map(function(e){return e.points}).reduce(function(e,t){return e.concat(t)});var t=[];e.forEach(function(e){if(!t.some(function(t){return e.x==t.x&&e.y==t.y}))t.push(e)});while(t.length>2&&Cell.isLinear([t[0],t[1]])&&Cell.isLinear([t[1],t[2]])){var r=[t[0],t[1],t[2]];var n=r.reduce(function(e,t){return e.x==t.x?e.y<t.y?e:t:e.x<t.x?e:t});var i=r.reduce(function(e,t){return e.x==t.x?e.y>t.y?e:t:e.x>t.x?e:t});t=[n,i]}return t};Cell.isLinear=function(e){if(e.length!=2)return false;var t=e[0],r=e[1];if((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y)<4e-4)return true;var n=function(e){return e>Math.PI/2?e-Math.PI:e<=-Math.PI/2?e+Math.PI:e};var i=function(e){return e<=0?e+Math.PI:e};var a=[Math.atan2(-e[0].dx,e[0].dy),Math.atan2(-e[1].dx,e[1].dy),Math.atan2(e[0].y-e[1].y,e[0].x-e[1].x)];if(Math.abs(n(a[0])-n(a[1]))>.2&&Math.abs(i(a[0])-i(a[1]))>.2)return false;if(Math.abs(n(a[0])-n(a[2]))>.2&&Math.abs(i(a[0])-i(a[2]))>.2)return false;if(a.some(function(e){return e!=e}))return false;return true};Cell.prototype.neighbor=function(e){switch(e){case 0:return this.l.cells[0];case 1:return this.t.cells[1];case 2:return this.r.cells[1];case 3:return this.b.cells[0]}};var Edge=function(start,end,eval,EPSILON,points,ignore){if(typeof points==="undefined")points=null;this.start=start;this.end=end;if(points)this.points=points.filter(function(e){return start.x<=e.x&&e.x<=end.x&&start.y<=e.y&&e.y<=end.y});if(ignore)this.points=[];else if(!points||!this.points.length){this.points=Edge.findPoints(start,end,eval,EPSILON)}this.cells=[null,null];this.isleaf=true};Edge.prototype.startPoint=function(){if(this.isleaf)return this.start;return this.start.startPoint()};Edge.prototype.endPoint=function(){if(this.isleaf)return this.end;return this.end.endPoint()};Edge.prototype.divide=function(eval,EPSILON){var mid=Edge.midpoint(this.start,this.end,eval);this.start=new Edge(this.start,mid,eval,EPSILON,this.points);this.end=new Edge(mid,this.end,eval,EPSILON,this.points);this.start.cells=[].concat(this.cells);this.end.cells=[].concat(this.cells);this.isleaf=false};Edge.expectPoints=function(e,t){if(e.z!=e.z&&t.z!=t.z)return false;if(!isFinite(e.z)||!isFinite(t.z))return true;if(e.z==0||t.z==0)return true;if(e.z>0!=t.z>0){return true}return Edge.quadratic(e,t,e).length!=0||Edge.quadratic(e,t,t).length!=0};Edge.quadratic=function(e,t,r){if(e.x==t.x){if(r.dy*r.dy>=2*r.z*r.dyy){var n=[r.y-r.dy/r.dyy-Math.sqrt(r.dy*r.dy-2*r.z*r.dyy)/r.dyy,r.y-r.dy/r.dyy+Math.sqrt(r.dy*r.dy-2*r.z*r.dyy)/r.dyy];var i=n.filter(function(r){return e.y<=r&&r<=t.y});return i}else return[]}else{if(r.dx*r.dx>=2*r.z*r.dxx){var n=[r.x-r.dx/r.dxx-Math.sqrt(r.dx*r.dx-2*r.z*r.dxx)/r.dxx,r.x-r.dx/r.dxx+Math.sqrt(r.dx*r.dx-2*r.z*r.dxx)/r.dxx];var i=n.filter(function(r){return e.x<=r&&r<=t.x});return i}else return[]}};Edge.findPoints=function(start,end,eval,EPSILON,depth){if(typeof depth==="undefined")depth=0;if(!Edge.expectPoints(start,end))return[];if(depth>10||end.x-start.x<EPSILON&&end.y-start.y<EPSILON){var endpointMatches=[start,end].filter(function(e){return e.z==0});if(endpointMatches.length)return endpointMatches;if(!isNaN(start.z)&&!isNaN(end.z)&&start.z>0!=end.z>0&&isFinite(Math.abs(start.z-end.z))){var mid=Edge.midpoint(start,end,eval);if(!(start.z<=mid.z&&mid.z<=end.z||end.z<=mid.z&&mid.z<=start.z))return[];return[start]}else return[]}var mid=Edge.midpoint(start,end,eval);var res=Edge.findPoints(start,mid,eval,EPSILON,depth+1);if(res.length)return res;else return Edge.findPoints(mid,end,eval,EPSILON,depth+1)};Edge.midpoint=function(e,t,r){return r.eval((e.x+t.x)/2,(e.y+t.y)/2)};var Axis=function(){};Axis.prototype.givenLabels=function(e,t,r,n,i,a){this.density=a;this.name=e;this.min=t;this.max=t+r;this.len=r;this.res=r/n;this.scale=n/r;var o=Grid.findGoodStepSize(Grid.MinPxBetweenMajor*this.res*this.density,i);this.major=o.step;this.minor=o.step/o.minorCount;this.msd=o.msd;this.labelType=i;this.min_res=this.minor/2;this.max_res=this.res/2;return this};Axis.prototype.givenScale=function(e,t,r,n,i){this.density=i;this.name=e;this.res=1/t;this.scale=t;this.len=r*this.res;this.min=-this.len/2;this.max=this.min+this.len;var a=Grid.findGoodStepSize(Grid.MinPxBetweenMajor*this.res*this.density,n);this.major=a.step;this.minor=a.step/a.minorCount;this.msd=a.msd;this.labelType=n;this.min_res=this.minor/2;this.max_res=this.res/2;return this};Axis.prototype.updateType=function(e){var t=Grid.findGoodStepSize(Grid.MinPxBetweenMajor*this.res*this.density,e);this.major=t.step;this.minor=t.step/t.minorCount;this.msd=t.msd;this.labelType=e};Axis.prototype.computeLines=function(){var e=this;var t=Math.ceil(e.min/e.major);e.major_lines=[t*e.major];while(t*e.major<=e.max){t++;e.major_lines.push(t*e.major)}e.major_lines.pop();t=Math.ceil(e.min/e.minor);e.minor_lines=[t*e.minor];while(t*e.minor<=e.max){t++;e.minor_lines.push(t*e.minor)}e.minor_lines.pop();e.all_lines=e.minor_lines;e.minor_lines=e.minor_lines.filter(function(t){return!e.major_lines.some(function(e){return t===e})});e.all_lines.push(e.all_lines[e.all_lines.length-1]+e.minor);e.all_lines.unshift(e.all_lines[0]-e.minor)};Axis.prototype.zoom=function(e){this.len=this.len/e;var t=(this.max+this.min-this.len)/2;this.max=this.max+this.min-t;this.min=t;this.res=this.res/e;
this.scale=this.scale*e;var r=Grid.findGoodStepSize(Grid.MinPxBetweenMajor*this.res*this.density,this.labelType);this.major=r.step;this.minor=r.step/r.minorCount;this.msd=r.msd;this.min_res=this.minor/2;this.max_res=this.res/2};var Grid=function(e,t,r){if(isNaN(r)){r=1}this.density=r;this.fudge=3*r;this.canvas=e;this.ctx=this.canvas.getContext("2d");this.polar=t.some(function(e){return e.rpn.some(function(e){return e==="r"||e===Grid.THETA})});this.numberline=t.length>0&&t.every(function(e){return e.rpn.some(function(e){return["<",">","≤","≥"].some(function(t){return e===t})})&&e.rpn.every(function(e){return e!=="y"&&e!=="r"&&e!==Grid.THETA})});this.axes=[(new Axis).givenLabels("x",-10,20,e.width,t.some(function(e){return e.rpn.some(function(e){return Grid.TRIG.some(function(t){return e===t})})})?1:0,this.density)];this.axes.push((new Axis).givenScale("y",this.axis("x").scale,e.height,t.some(function(e){return e.rpn.some(function(e){return Grid.ARCTRIG.some(function(t){return e===t})})})?1:0,this.density));this.axes.push((new Axis).givenLabels(Grid.THETA,0,2*Math.PI,Math.PI*Math.max(e.width,e.height),2,this.density));var n=Math.max(Math.abs(this.axis("x").max),Math.abs(this.axis("x").min));var i=Math.max(Math.abs(this.axis("y").max),Math.abs(this.axis("y").min));var a=this.pointToCanvX(n)-this.pointToCanvX(0);var o=this.pointToCanvX(i)-this.pointToCanvX(0);this.axes.push((new Axis).givenLabels("r",0,Math.sqrt(Math.pow(n,2)+Math.pow(i,2)),Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),0,this.density));this.axes.forEach(function(e){return e.computeLines()});this.zoomTo=1};Grid.prototype.changeEval=function(e){e=e.filter(function(e){return e instanceof Evaluator});this.polar=e.some(function(e){return e.rpn.some(function(e){return e==="r"||e===Grid.THETA})});this.numberline=e.length>0&&e.every(function(e){return e.rpn.some(function(e){return["<",">","≤","≥"].some(function(t){return e===t})})&&e.rpn.every(function(e){return e!=="y"&&e!=="r"&&e!==Grid.THETA})});this.axis("x").updateType(e.some(function(e){return e.rpn.some(function(e){return Grid.TRIG.some(function(t){return e===t})})})?1:0);this.axis("y").updateType(e.some(function(e){return e.rpn.some(function(e){return Grid.ARCTRIG.some(function(t){return e===t})})})?1:0);if(this.numberline){this.axis("y").max=this.axis("y").len/2;this.axis("y").min=-this.axis("y").max}this.axes.forEach(function(e){e.computeLines()})};Grid.prototype.zoom=function(e){if(this.zoomTo*e>1e3||this.zoomTo*e<.01)return false;this.axis("x").zoom(e);this.axis("y").zoom(e);var t=this.axis("r");t.zoom(e);var r=this.calcR();t.min=r.min;t.max=r.max;t.len=t.max-t.min;this.zoomTo=this.zoomTo*e;this.axes.forEach(function(e){e.computeLines()});return true};Grid.prototype.autozoom=function(e){var t=this.axis("x"),r=this.axis("y");var n=.8;e.forEach(function(e){var i=t.min,a=t.max,o=r.min,s=r.max;var u=a-i,l=s-o;var c=(1-n)/2;i+=c*u;a-=c*u;o+=c*l;s-=c*l;while(e.x<i||e.x>a||e.y<o||e.y>s){if(!this.zoom(.5))return;i=t.min;a=t.max;o=r.min;s=r.max;u=a-i;l=s-o;c=(1-n)/2;i+=c*u;a-=c*u;o+=c*l;s-=c*l}}.bind(this))};Grid.prototype.move=function(e,t){var r=this.axis("x");var n=this.axis("y");r.min+=e;r.max+=e;if(!this.numberline){n.min+=t;n.max+=t}var i=this.axis("r");var a=this.calcR();i.min=a.min;i.max=a.max;i.len=i.max-i.min;this.axes.forEach(function(e){e.computeLines()})};Grid.prototype.calcR=function(){var e=this.axis("x");var t=this.axis("y");var r=[[e.min,t.min],[e.min,t.max],[e.max,t.max],[e.max,t.min]];if(e.min<0&&0<e.max){if(t.min<0&&0<t.max)r.push([0,0]);r.push([0,t.min]);r.push([0,t.max])}else if(t.min<0&&0<t.max){r.push([e.min,0]);r.push([e.max,0])}r=r.map(function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])});var n=r.reduce(function(e,t){return Math.max(e,t)});var i=r.reduce(function(e,t){return Math.min(e,t)});return{min:i,max:n}};Grid.PI="π";Grid.THETA="θ";Grid.font_size=14;Grid.TRIG=["sin","cos","tan","csc","sec","cot"];Grid.ARCTRIG=Grid.TRIG.map(function(e){return"arc"+e});Grid.MinPxBetweenMajor=65;Grid.GoodStepFactors=[[[2,4],[5,5],[10,5]],[[2,4],[3,3],[6,4]]];Grid.findGoodStepSize=function(e,t){if(t===2){return{step:Math.PI/6,minorCount:2,msd:1/6}}var r=Math.pow(10,Math.floor(Math.log(e)/Math.log(10)));if(t===1)r=Math.pow(6,Math.floor(Math.log(e/Math.PI)/Math.log(6)))*Math.PI;for(var n=0;n<Grid.GoodStepFactors[t].length;n++){var i=Grid.GoodStepFactors[t][n][0]*r;if(i>=e){return{step:i,minorCount:Grid.GoodStepFactors[t][n][1],msd:t===1?r/Math.PI:r}}}throw"Good step not found:"+e};Grid.prototype.axis=function(e){var t=this.axes.filter(function(t){return t.name===e});if(t.length)return t[0];else throw"No axis "+e};Grid.prototype.setTransform=function(e){if(!e)e=this.ctx;e.setTransform(1,0,0,1,0,0)};Grid.prototype.drawLine=function(e,t,r,n,i,a){this.ctx.beginPath();this.ctx.moveTo(this.pointToCanvX(e),this.pointToCanvY(t));this.ctx.strokeStyle=r;this.ctx.lineWidth=a*this.density;this.ctx.lineTo(this.pointToCanvX(n),this.pointToCanvY(i));this.ctx.stroke()};Grid.prototype.drawCirc=function(e,t,r){var n=this.pointToCanvX(0),i=this.pointToCanvY(0);e=this.pointToCanvX(e)-n;this.ctx.beginPath();this.ctx.moveTo(e+n,i);this.ctx.strokeStyle=t;this.ctx.lineWidth=r*this.density;this.ctx.arc(n,i,e,0,2*Math.PI);this.ctx.stroke()};Grid.prototype.drawLbl=function(e,t,r,n,i,a){var o=Grid.font_size*this.density;this.ctx.font=o+"px Arial";this.ctx.textAlign=i;this.ctx.textBaseline=a;this.ctx.strokeStyle="white";this.ctx.lineWidth=3*this.density;this.ctx.strokeText(e,t,r);this.ctx.fillStyle=n;this.ctx.fillText(e,t,r)};Grid.prototype.pointToCanvX=function(e){return(e-this.axis("x").min)*(this.canvas.width*1/this.axis("x").len)};Grid.prototype.pointToCanvY=function(e){return(this.axis("y").max-e)*(this.canvas.height*1/this.axis("y").len)};Grid.prototype.pointToCanv=function(e,t){if(t==="x")return this.pointToCanvX(e);else return this.pointToCanvY(e)};Grid.getText=function(e,t,r){var n="";if(t===1){e=e/Math.PI;n=Grid.PI;if(r<1&&r>=1/36){var i=Math.round(e/r);var a=Math.round(1/r);while(i%3===0&&a%3===0){i=i/3;a=a/3}while(i%2===0&&a%2===0){i=i/2;a=a/2}if(i===1)i="";if(i===-1)i="-";if(a===1)a="";else a="/"+a;return i+Grid.PI+a}else if(r>=1)return Math.round(e)+Grid.PI;else return(e*Math.PI).toExponential(2)}var o=Number.parseFloat(e).toFixed(10);if(o.indexOf("e")===-1){o=o.replace(/\.?0+$/,"")}return o};Grid.prototype.drawCartLines=function(){var e=this;this.ctx.setLineDash([]);this.axis("x").minor_lines.forEach(function(t){e.drawLine(t,e.numberline?-e.axis("y").minor/4:e.axis("y").min,"LightGrey",t,e.numberline?e.axis("y").minor/4:e.axis("y").max,1/2)});if(!this.numberline)this.axis("y").minor_lines.forEach(function(t){e.drawLine(e.axis("x").min,t,"LightGrey",e.axis("x").max,t,1/2)});this.axis("x").major_lines.filter(function(e){return e}).forEach(function(t){e.drawLine(t,e.numberline?-e.axis("y").minor/3:e.axis("y").min,"grey",t,e.numberline?e.axis("y").minor/3:e.axis("y").max,1/2)});this.axis("x").major_lines.filter(function(e){return!e}).forEach(function(t){e.drawLine(t,e.numberline?-e.axis("y").minor/3:e.axis("y").min,"black",t,e.numberline?e.axis("y").minor/3:e.axis("y").max,1)});if(!this.numberline){this.axis("y").major_lines.filter(function(e){return e}).forEach(function(t){e.drawLine(e.axis("x").min,t,"grey",e.axis("x").max,t,1/2)});this.axis("y").major_lines.filter(function(e){return!e}).forEach(function(t){e.drawLine(e.axis("x").min,t,"black",e.axis("x").max,t,1)})}if(this.numberline){[0].forEach(function(t){e.drawLine(e.axis("x").min,t,"black",e.axis("x").max,t,1/2)});e.drawAxisArrow(true);e.drawAxisArrow(false)}};Grid.prototype.drawAxisArrow=function(e,t,r){r=r?r:1;this.ctx.lineWidth=r*this.density/2;this.ctx.strokeStyle=t?t:"black";this.ctx.beginPath();if(e){this.ctx.moveTo(this.pointToCanvX(this.axis("x").min+this.axis("x").minor/2),this.pointToCanvY(-this.axis("y").minor/2));this.ctx.lineTo(this.pointToCanvX(this.axis("x").min),this.pointToCanvY(0));this.ctx.lineTo(this.pointToCanvX(this.axis("x").min+this.axis("x").minor/2),this.pointToCanvY(this.axis("y").minor/2))}else{this.ctx.moveTo(this.pointToCanvX(this.axis("x").max-this.axis("x").minor/2),this.pointToCanvY(-this.axis("y").minor/2));this.ctx.lineTo(this.pointToCanvX(this.axis("x").max),this.pointToCanvY(0));this.ctx.lineTo(this.pointToCanvX(this.axis("x").max-this.axis("x").minor/2),this.pointToCanvY(this.axis("y").minor/2))}this.ctx.stroke()};Grid.prototype.drawLabels=function(){this.ctx.save();this.ctx.setTransform(1,0,0,1,0,0);var e=this;var t=e.axis("x");var r=e.axis("y");var n=[1];if(e.polar){t=e.axis("r");r=t;n=[1,-1]}t.major_lines.filter(function(e){return e}).map(function(e){return n.map(function(t){return{val:e,pos:e*t}})}).reduce(function(e,t){return e.concat(t)},[]).forEach(function(r){var n=Grid.getText(r.val,t.labelType,t.msd);var i=e.ctx.measureText(n).width;r.pos=e.pointToCanvX(r.pos);if(i/2+e.fudge>r.pos)r.pos=i/2+e.fudge;if(r.pos>e.canvas.width-i/2-e.fudge)r.pos=e.canvas.width-i/2-e.fudge;var a=e.findTextPos(Grid.font_size*e.density,"y",-e.fudge);e.drawLbl(n,r.pos,a.pos,"black","center","top")});if(!e.numberline){r.major_lines.filter(function(e){return e}).map(function(e){return n.map(function(t){return{val:e,pos:e*t}})}).reduce(function(e,t){return e.concat(t)},[]).forEach(function(t){var n=Grid.getText(t.val,r.labelType,r.msd);var i=e.findTextPos(e.ctx.measureText(n).width,"x");var a=Grid.font_size*e.density;t.pos=e.pointToCanvY(t.pos);if(a/2+e.fudge>t.pos)t.pos=a/2+e.fudge;if(t.pos>e.canvas.height-a/2-e.fudge)t.pos=e.canvas.height-a/2-e.fudge;e.drawLbl(n,i.pos,t.pos,"black","right","middle")})}if(!e.polar&&t.major_lines.some(function(e){return e===0})&&r.major_lines.some(function(e){return e===0})){var i="0";var a=e.findTextPos(e.ctx.measureText(i).width,"x");var o=e.findTextPos(Grid.font_size*e.density,"y",-e.fudge);e.drawLbl(i,a.pos,o.pos,"black","right","top")}if(e.polar){e.axis(Grid.THETA).major_lines.filter(function(e){return![0,.5,1,1.5,2].some(function(t){return t*Math.PI===e})}).forEach(function(t){var r=Grid.getText(t,1,e.axis(Grid.THETA).msd);var n=e.axis("r").max*Math.cos(t);var i=e.axis("r").max*Math.sin(t);if(n>e.axis("x").max){var a=e.axis("x").max/n;n=e.axis("x").max;i*=a}else if(n<e.axis("x").min){a=e.axis("x").min/n;n=e.axis("x").min;i*=a}if(i>e.axis("y").max){a=e.axis("y").max/i;i=e.axis("y").max;n*=a}else if(i<e.axis("y").min){a=e.axis("y").min/i;i=e.axis("y").min;n*=a}var o=Math.max(e.ctx.measureText(r).width,Grid.font_size*e.density);n=e.pointToCanvX(n)-(e.fudge+o)*Math.cos(t);i=e.pointToCanvY(i)+(e.fudge+o)*Math.sin(t);e.drawLbl(r,n,i,"#a7a7a7","center","middle")})}this.ctx.restore()};Grid.prototype.findTextPos=function(e,t,r){if(isNaN(r)){r=this.fudge}var n=this.pointToCanv(0,t)-r;var i=t==="x"?this.canvas.width:this.canvas.height;if(n-e<0)return{pos:e};else if(n>i)return{pos:i};else return{pos:n}};Grid.prototype.drawPolarLines=function(){var e=this;this.ctx.setLineDash([]);var t=e.axis("r").max;var r=e.axis(Grid.THETA).major_lines.slice(0,e.axis(Grid.THETA).major_lines.length-1);r.forEach(function(r){var n="grey";if([0,.5,1,1.5].some(function(e){return e*Math.PI===r}))n="black";e.drawLine(0,0,n,t*Math.cos(r),t*Math.sin(r),1)});e.axis(Grid.THETA).minor_lines.forEach(function(r){e.drawLine(0,0,"LightGrey",t*Math.cos(r),t*Math.sin(r),1)});e.axis("r").minor_lines.forEach(function(t){e.drawCirc(t,"LightGrey",1)});e.axis("r").major_lines.forEach(function(t){e.drawCirc(t,"grey",1)})};Grid.prototype.clearGrid=function(){this.ctx.setTransform(1,0,0,1,0,0);this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};Grid.prototype.draw=function(){this.clearGrid();this.setTransform();if(this.polar)this.drawPolarLines();else this.drawCartLines();this.drawLabels()};Grid.prototype.drawPoint=function(e,t,r){if(!r)r=this.ctx;var n=this.pointToCanvX(e),i=this.pointToCanvY(t);var a=this.axis("x").res*7;a=this.pointToCanvX(e+a)-n;r.beginPath();r.fillStyle="black";r.arc(n,i,a,0,2*Math.PI);r.fill()};Grid.prototype.drawHole=function(e,t,r,n){if(!n)n=this.ctx;var i=this.pointToCanvX(this.axis("x").minor/6)-this.pointToCanvX(0);n.fillStyle=r.css();n.beginPath();n.arc(this.pointToCanvX(e),this.pointToCanvY(t),i,0,2*Math.PI);n.fill();n.fillStyle="white";n.beginPath();n.arc(this.pointToCanvX(e),this.pointToCanvY(t),i/2,0,2*Math.PI);n.fill()};Grid.prototype.drawSegment=function(e,t,r,n,i,a,o){if(!o)o=this.ctx;var s=this.pointToCanvX(this.axis("x").res*7)-this.pointToCanvX(0);o.beginPath();o.fillStyle=i.css();o.arc(this.pointToCanvX(e),this.pointToCanvY(t),s,0,2*Math.PI);o.arc(this.pointToCanvX(r),this.pointToCanvY(n),s,0,2*Math.PI);o.fill();o.strokeStyle=i.css();o.setLineDash(a?[this.axis("x").res*5]:[]);o.lineWidth=1*3;o.beginPath();o.moveTo(this.pointToCanvX(e),this.pointToCanvY(t));o.lineTo(this.pointToCanvX(r),this.pointToCanvY(n));o.stroke()};var Tree=function(e,t){this.grid=e;if(t.isYEq()){var r=Tree.buildYeq(e,t);this.cells=r.cells;this.points=r.points;this.queue=[]}else if((t.rpn.length===3||t.rpn.length===4&&t.rpn[2]==="neg")&&t.rpn[0]==="x"&&t.rpn[t.rpn.length-1]==="="&&$.isNumeric(t.rpn[1])){var n=-t.eval(0,0).z;var i=e.axis("x"),a=e.axis("y");var o=[[i.min,a.min],[i.min,a.max],[i.max,a.max],[i.max,a.min]];o=o.map(function(e){return t.eval(e[0],e[1])});var s=[[0,1],[1,2],[3,2],[0,3]];s=s.map(function(e){return new Edge(o[e[0]],o[e[1]],t,Number.POSITIVE_INFINITY,[],true)});var u=[[0,1,2,3]];u=u.map(function(e){return new Cell(s[e[0]],s[e[1]],s[e[2]],s[e[3]])});if(i.min<=n&&n<=i.max){u[0].b.points=[t.eval(n,a.min)];u[0].t.points=[t.eval(n,a.max)]}this.cells=u;this.points=[];this.queue=[]}else{this.cells=Tree.buildCart(e,t);this.cells=this.cells.reduce(function(e,t){return e.concat(t)},[]);this.points=[];this.queue=this.cells.map(function(e){return{cell:e,reprocess:false}})}this.eval=t;this.lvl=0};Tree.axis=function(e,t){if(e==="x")return t.polar?t.axis(Grid.THETA):t.axis(e);if(e==="y")return t.polar?t.axis("r"):t.axis(e);throw"Invalid axis name: "+e};Tree.buildCart=function(e,t){var r=Tree.axis("x",e);var n=Tree.axis("y",e);var i=[];if(e.polar){var a=r.min_res-1e-10;var o=n.min_res-1e-10;var s=Math.ceil(r.len*6/r.min_res)+1;var u=Math.ceil(n.len/n.min_res)+1;for(var l=0;l<s;l++){i.push([]);for(var c=0;c<u;c++){i[l].push(t.eval(r.min+l*a,n.min+c*o))}}}else{var p=r.all_lines;var d=n.all_lines;if(e.numberline){d=[-e.axis("y").minor/2,e.axis("y").minor/2]}for(l=0;l<p.length;l++){i.push([]);for(c=0;c<d.length;c++){i[l].push(t.eval(p[l],d[c]))}}}var f=new Edge(i[0][0],i[0][1],t,n.max_res);var h=new Edge(i[0][1],i[1][1],t,r.max_res);var m=new Edge(i[1][0],i[1][1],t,n.max_res);var g=new Edge(i[0][0],i[1][0],t,r.max_res);var v=[[new Cell(f,h,m,g)]];for(c=2;c<i[0].length;c++){f=new Edge(i[0][c-1],i[0][c],t,n.max_res);h=new Edge(i[0][c],i[1][c],t,r.max_res);m=new Edge(i[1][c-1],i[1][c],t,n.max_res);g=v[0][c-2].t;v[0].push(new Cell(f,h,m,g))}for(l=2;l<i.length;l++){f=v[l-2][0].r;h=new Edge(i[l-1][1],i[l][1],t,r.max_res);m=new Edge(i[l][0],i[l][1],t,n.max_res);g=new Edge(i[l-1][0],i[l][0],t,r.max_res);v.push([new Cell(f,h,m,g)]);for(c=2;c<i[l].length;c++){f=v[l-2][c-1].r;h=new Edge(i[l-1][c],i[l][c],t,r.max_res);m=new Edge(i[l][c-1],i[l][c],t,n.max_res);g=v[l-1][c-2].t;v[l-1].push(new Cell(f,h,m,g))}}return v};Tree.buildYeq=function(e,t){var r=function(t,r){if(t.asymArr.some(function(e,t){return e&&r.asymArr[t]&&Math.sign(e.z)!==Math.sign(r.asymArr[t].z)}))return true;if(Math.sign(-t.dx/t.dy)===Math.sign(-r.dx/r.dy)&&Math.sign(-r.dx/r.dy)!==Math.sign((r.y-t.y)/(r.x-t.x))){return Math.abs(r.y-t.y)>e.axis("y").minor/2}return false};var n=e.axis("x");var i=[];var a=[];var o=[new Edge({x:n.min,y:Number.NEGATIVE_INFINITY},{x:n.min,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true)];var s=t.eval(o[0].start.x,0);s=t.eval(s.x,-s.z);o[0].points[0]=s;var u=0;while(o[o.length-1].start.x<n.max){var l=o.length;var c=n.min+(l-u)*n.res;if(l>0&&n.all_lines.some(function(e){return o[o.length-1].start.x<e&&e<c})){c=n.all_lines.find(function(e){return o[o.length-1].start.x<e&&e<c});u++;o.push(new Edge({x:c,y:Number.NEGATIVE_INFINITY},{x:c,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true))}else o.push(new Edge({x:c,y:Number.NEGATIVE_INFINITY},{x:c,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true));s=t.eval(o[l].start.x,0);if(s.asymArr.some(function(e){return e&&e.z===0})){c+=1e-12;o[l].start.x=c;o[l].end.x=c;s=t.eval(o[l].start.x,0)}s=t.eval(s.x,-s.z);o[l].points[0]=s;var p=o[l-1];var d=o[l];var f=new Edge({x:p.start.x,y:Number.POSITIVE_INFINITY},{x:d.start.x,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);f.points=[];var h=new Edge({x:p.start.x,y:Number.NEGATIVE_INFINITY},{x:d.start.x,y:Number.NEGATIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);h.points=[];s=p.points[0],q=d.points[0];if(s.predArr.some(function(e,t){return e&&q.predArr[t]&&Math.sign(e.z)!==Math.sign(q.predArr[t].z)})){var m=(p.start.x+d.start.x)/2;var g=new Edge({x:m,y:Number.NEGATIVE_INFINITY},{x:m,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);g.points=[];var v=new Edge({x:p.start.x,y:Number.POSITIVE_INFINITY},{x:g.start.x,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);var b=new Edge({x:p.start.x,y:Number.NEGATIVE_INFINITY},{x:g.start.x,y:Number.NEGATIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);var y=new Edge({x:g.start.x,y:Number.POSITIVE_INFINITY},{x:d.start.x,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);var w=new Edge({x:g.start.x,y:Number.NEGATIVE_INFINITY},{x:d.start.x,y:Number.NEGATIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);v.points=y.points=b.points=w.points=[];i.push(new Cell(p,v,g,b));i.push(new Cell(g,y,d,w));if(s.predArr.some(function(e){return e&&e.satisfied&&e.strict}))a=a.concat([s,q]);else a=a.concat([q,s])}else if(r(s,q)){m=(p.start.x+d.start.x)/2;g=new Edge({x:m,y:Number.NEGATIVE_INFINITY},{x:m,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[{x:m,y:0}]);g.points=[];v=new Edge({x:p.start.x,y:Number.POSITIVE_INFINITY},{x:g.start.x,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);b=new Edge({x:p.start.x,y:Number.NEGATIVE_INFINITY},{x:g.start.x,y:Number.NEGATIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);y=new Edge({x:g.start.x,y:Number.POSITIVE_INFINITY},{x:d.start.x,y:Number.POSITIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);w=new Edge({x:g.start.x,y:Number.NEGATIVE_INFINITY},{x:d.start.x,y:Number.NEGATIVE_INFINITY},t,Number.POSITIVE_INFINITY,[],true);v.points=y.points=b.points=w.points=[];i.push(new Cell(p,v,g,b));i.push(new Cell(g,y,d,w));if(Math.abs(s.y-q.y)<n.res*2){}else{if(Math.sign(-s.dx/s.dy)>0)s.y=Number.MAX_SAFE_INTEGER;else if(Math.sign(-s.dx/s.dy)<0)s.y=Number.MIN_SAFE_INTEGER;if(Math.sign(-q.dx/q.dy)<0)q.y=Number.MAX_SAFE_INTEGER;else if(Math.sign(-q.dx/q.dy)>0)q.y=Number.MIN_SAFE_INTEGER}}else{var C=new Cell(p,f,d,h);i.push(C)}}return{cells:i,points:a}};Tree.prototype.nextCell=function(){var e=this;if(!e.queue.length)return;var t=e.queue.shift();var r=t.cell;r.enqueued=false;if(r.lvl>e.lvl)e.lvl=r.lvl;var n=[r.ll,r.ul,r.ur,r.lr].some(function(e){return e.asymArr.some(function(e){return e&&e.z<0})})&&[r.ll,r.ul,r.ur,r.lr].some(function(e){return e.asymArr.some(function(e){return e&&e.z>0})});n=r.getPoints().length===1&&r.getPoints()[0].z!==0&&([r.ll,r.ul,r.ur,r.lr].some(function(e){return e.asymArr.some(function(e){return e&&e.z===0})})||n);if(n){var i=r.getPoints()[0];var a;if(i.y===r.ll.y)a=e.eval.eval(i.x,r.ul.y);else if(i.y===r.ul.y)a=e.eval.eval(i.x,r.ll.y);else if(i.x===r.ll.x)a=e.eval.eval(r.lr.x,i.y);else if(i.x===r.lr.x)a=e.eval.eval(r.ll.x,i.y);var o=function(e,t){if(e.isleaf)e.points.push(t);else{var r=e.startPoint();var n=e.start.endPoint();var i=e.endPoint();if(r.x===i.x&&t.y<n.y)o(e.start,t);else if(r.x===i.x)o(e.end,t);else if(r.y===i.y&&t.x<n.x)o(e.start,t);else o(e.end,t)}};if(Cell.isLinear([i,a])){var s;if(a.y===r.ll.y){o(r.b,a);s=r.neighbor(3)}else if(a.y===r.ul.y){o(r.t,a);s=r.neighbor(1)}else if(a.x===r.ll.x){o(r.l,a);s=r.neighbor(0)}else{o(r.r,a);s=r.neighbor(2)}if(s&&!s.enqueued){e.queue.push({cell:s,reprocess:true});s.enqueued=true}}a.asymAdd=true}if(!r.willDivide(e.grid))return;var u=[r.l,r.r,r.t,r.b];while(u.some(function(e){return!e.isleaf}))u=u.map(function(e){return e.isleaf?[e]:[e.start,e.end]}).reduce(function(e,t){return e.concat(t)});u.forEach(function(e){e.points=e.points.filter(function(e){return!e.asymAdd})});var l=[[0,r.l],[1,r.t],[2,r.r],[3,r.b]].filter(function(e){return e[1].isleaf});r.divide(e.eval,Tree.axis("x",e.grid).max_res,Tree.axis("y",e.grid).max_res);l.forEach(function(t){var n=r.neighbor(t[0]);if(n&&!n.enqueued&&t[1].start.points.length+t[1].end.points.length>0)e.queue.push({cell:n,reprocess:true})});e.queue=e.queue.concat(r.children.map(function(e){return{cell:e,reprocess:false}}));e.cells=e.cells.concat(r.children)};var Graph=function(e,t,r,n,i){this.grid=t;this.ctx=e.getContext("2d");this.tree=[new Tree(t,r)];if(t.polar){var a=new Grid(t.canvas,[r]);a.zoom(t.zoomTo);var o=a.axis("r");o.min=-t.axis("r").max;o.max=-t.axis("r").min;this.tree.push(new Tree(a,r))}if(!(n instanceof Color)){n=new Color("MWRed")}this.color=n;this.dashed=i;if((App.isSafari||App.IsApps&&!App.isAndroidDevice)&&r.rpn.length>3&&i==true)this.dashed=false;this.lastComputeTime=0};Graph.prototype.zoom=function(e){this.tree.forEach(function(t){var r=t.grid;r.zoom(e);if(e>1){var n=function(e,t){var r=e.ll.x<t.ll.x&&t.ll.x<e.lr.x;var n=e.ll.y<t.ul.y&&t.ul.y<e.ul.y;var i=e.ll.x<t.lr.x&&t.lr.x<e.lr.x;var a=e.ll.y<t.ll.y&&t.ll.y<e.ul.y;return r&&a||r&&n||i&&n||i&&a};var i=function(e,t,r,n){return{ll:{x:e,y:t},ul:{x:e,y:n},ur:{x:r,y:n},lr:{x:r,y:t}}};i=i(r.axis("x").min,r.axis("y").min,r.axis("x").max,r.axis("y").max);t.queue=t.cells.filter(function(e){return e.isleaf&&n(e,i)}).map(function(e){return{cell:e,reprocess:false}})}});var t=performance.now();this.compute();this.lastComputeTime=performance.now()-t};Graph.compute=function(e,t,r,n,i){var a=performance.now();var o=new Graph(e,t,r,n,i);o.tree.forEach(function(e){while(e.queue.length)e.nextCell()});o.lastComputeTime=performance.now()-a;return o};Graph.prototype.iterate=function(e){var t=performance.now();this.tree.forEach(function(t){if(t.queue.length&&t.lvl<t.queue[0].cell.lvl)t.lvl=t.queue[0].cell.lvl;while(t.queue.length&&t.lvl>=t.queue[0].cell.lvl){if(e&&performance.now()>e)break;t.nextCell()}});this.lastComputeTime=performance.now()-t+this.lastComputeTime};Graph.polarToCart=function(e,t){return{x:t*Math.cos(e),y:t*Math.sin(e)}};Graph.prototype.draw=function(e){if(!e)e=1;var t=performance.now();var r=this;var n=r.grid;var i=this.ctx;n.setTransform(i);i.setLineDash([]);i.strokeStyle=this.color.css();if(r.grid.numberline)i.fillStyle=this.color.css();else i.fillStyle=this.color.alpha(.25);r.tree.forEach(function(t){if(t.eval.rpn.some(function(e){return e==="="})){var a=1;if(t.grid.axis("r").min<0)a=-1;var o=t.cells.filter(function(e){if(!e.isleaf)return false;var t=e.getPoints();if(t.length<2)return false;return true});var s=o.map(function(e){return e.getPoints().sort(function(e,t){return e.x!==t.x?e.x-t.x:e.y-t.y})});i.strokeStyle=r.color.css();if(r.dashed){i.setLineDash([1*5*e]);while(s.length>1&&s[0][0].y===s[1][1].y&&s[0][0].x<s[1][1].x&&s[0][1].x===s[1][0].x&&s[0][1].y===s[1][0].y){var u=s.shift(),l=s.shift();s.unshift([u[0],l[1]])}while(s.length>1&&s[0][0].x===s[1][1].x&&s[0][0].y<s[1][1].y&&s[0][1].x===s[1][0].x&&s[0][1].y===s[1][0].y){u=s.shift(),l=s.shift();s.unshift([u[0],l[1]])}}else{i.setLineDash([])}i.lineWidth=1*2*e;i.beginPath();lastPos=null;s.forEach(function(e){if(isNaN(e[1].x)||isNaN(e[1].y)){lastPos=null;i.stroke();i.beginPath();return}if(lastPos===null&&(isNaN(e[0].x)||isNaN(e[0].y)))return;if(t.grid.polar)e=e.map(function(e){return{x:e.y*Math.cos(e.x),y:e.y*Math.sin(e.x),dx:-(e.dy*Math.sin(e.x)+e.y*Math.cos(e.x)),dy:e.dy*Math.cos(e.x)-e.y*Math.sin(e.x)}});var r=-e[0].dx/e[0].dy,a=-e[1].dx/e[1].dy;var o=(e[0].y-e[1].y+a*e[1].x-r*e[0].x)/(a-r);var s=r*(o-e[0].x)+e[0].y;if(!isFinite(r)||!isFinite(a)){r=-e[0].dy/e[0].dx,a=-e[1].dy/e[1].dx;s=(e[0].x-e[1].x+a*e[1].y-r*e[0].y)/(a-r);o=r*(s-e[0].y)+e[0].x}var u=Math.pow(2,23)-1,l=-Math.pow(2,23)+1;var c=function(e){return e>u?u:e<l?l:e};var p=c(e[0].x),d=c(e[0].y),f=c(e[1].x),h=c(e[1].y);var m=function(e,t,r){return e<r&&r<t||e>r&&r>t};if(isFinite(p)&&isFinite(d)&&isFinite(f)&&isFinite(h)){if(!lastPos||lastPos[0]!==p||lastPos[1]!==d)i.moveTo(n.pointToCanvX(p),n.pointToCanvY(d));if(m(p,f,o)&&m(d,h,s))i.quadraticCurveTo(n.pointToCanvX(o),n.pointToCanvY(s),n.pointToCanvX(f),n.pointToCanvY(h));else i.lineTo(n.pointToCanvX(f),n.pointToCanvY(h))}lastPos=[f,h]});i.stroke()}else{if(n.polar)return;if(t.eval.rpn.some(function(e){return e==="<"||e===">"})&&!n.numberline||r.dashed)i.setLineDash([1*5*e]);if(r.dashed===null)i.setLineDash([0,1e10]);o=t.cells.filter(function(e){return e.isleaf});s=o.filter(function(e){return e.getPoints().length>1});i.lineWidth=1*2*e;if(n.numberline){o=o.filter(function(e){return e.ll.z>=0||e.lr.z>=0}).map(function(e){return[Math.min(e.ll.x,e.lr.x),Math.max(e.ll.x,e.lr.x)]});i.lineWidth=n.axis("y").minor/n.axis("y").res/16*e;i.beginPath();o.forEach(function(e){i.moveTo(n.pointToCanvX(e[0]),n.pointToCanvY(0));i.lineTo(n.pointToCanvX(e[1]),n.pointToCanvY(0))});var c=false,p=false;for(var d=0;d<t.eval.rpn.length;d++){if(t.eval.rpn[d]===Number.POSITIVE_INFINITY){if(d+1<t.eval.rpn.length&&t.eval.rpn[d+1]==="neg")p=true;else c=true}}i.stroke();if(c)n.drawAxisArrow(false,r.color.css(),2);if(p)n.drawAxisArrow(true,r.color.css(),2);s=s.filter(function(e){return e.height()===.2?true:e.ll.y===0}).map(function(e){return e.getPoints()[0]});s.forEach(function(e){var t=n.pointToCanvX(n.axis("y").minor/6)-n.pointToCanvX(0);i.beginPath();i.arc(n.pointToCanvX(e.x),n.pointToCanvY(0),t,0,2*Math.PI);i.fill();if(e.strict){i.fillStyle="white";i.beginPath();i.arc(n.pointToCanvX(e.x),n.pointToCanvY(0),t/2,0,2*Math.PI);i.fill();i.fillStyle=r.color.css()}})}else{o=o.filter(function(e){return e.getPoints().length<2&&e.ll.z>0});i.beginPath();s.map(function(e){return e.getPoints()}).forEach(function(e){if(t.grid.polar)e=e.map(function(e){return{x:e.y*Math.cos(e.x),y:e.y*Math.sin(e.x),dx:e.dy*Math.cos(e.x)-e.y*Math.sin(e.x)*e.dx,dy:e.dy*Math.sin(e.x)+e.y*Math.cos(e.x)*e.dx}});var r=-e[0].dx/e[0].dy,a=-e[1].dx/e[1].dy;var o=(e[0].y-e[1].y+a*e[1].x-r*e[0].x)/(a-r);var s=r*(o-e[0].x)+e[0].y;if(!isFinite(r)||!isFinite(a)){r=-e[0].dy/e[0].dx,a=-e[1].dy/e[1].dx;s=(e[0].x-e[1].x+a*e[1].y-r*e[0].y)/(a-r);o=r*(s-e[0].y)+e[0].x}i.moveTo(n.pointToCanvX(e[0].x),n.pointToCanvY(e[0].y));var u=function(e,t,r){return e<r&&r<t||e>r&&r>t};if(u(e[0].x,e[1].x,o)&&u(e[0].y,e[1].y,s))i.quadraticCurveTo(n.pointToCanvX(o),n.pointToCanvY(s),n.pointToCanvX(e[1].x),n.pointToCanvY(e[1].y));else i.lineTo(n.pointToCanvX(e[1].x),n.pointToCanvY(e[1].y))});i.stroke();i.beginPath();o.forEach(function(e){i.rect(Math.floor(n.pointToCanvX(e.ll.x)),Math.floor(n.pointToCanvY(e.ll.y)),Math.floor(n.pointToCanvX(e.ur.x))-Math.floor(n.pointToCanvX(e.ll.x)),Math.floor(n.pointToCanvY(e.ur.y))-Math.floor(n.pointToCanvY(e.ll.y)))});s.forEach(function(e){var r=e.getPoints();var a=1e-12;var o=function(e,r,n){if(isFinite(e.z))return e;else return t.eval.eval(e.x+r*a,e.y+n*a)};var s=[o(e.ll,1,1),o(e.ul,1,-1),o(e.ur,-1,-1),o(e.lr,-1,1)].filter(function(e){return e.z>0});s=s.concat([r[0],r[1]]).map(function(e){return{x:e.x,y:e.y,z:e.z}});var u=s.reduce(function(e,t){return{x:e.x+t.x,y:e.y+t.y}});u={x:u.x/s.length,y:u.y/s.length};s=s.map(function(e){return{x:e.x-u.x,y:e.y-u.y}});s.sort(function(e,t){return Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x)});i.moveTo(Math.floor(n.pointToCanvX(s[0].x+u.x)),Math.floor(n.pointToCanvY(s[0].y+u.y)));for(var l=1;l<s.length;l++)i.lineTo(Math.floor(n.pointToCanvX(s[l].x+u.x)),Math.floor(n.pointToCanvY(s[l].y+u.y)))});i.fill()}}i.fillStyle=r.color.css();t.points.forEach(function(e){if(!isFinite(e.x)||!isFinite(e.y))return;var t=n.pointToCanvX(n.axis("x").minor/6)-n.pointToCanvX(0);i.beginPath();i.arc(n.pointToCanvX(e.x),n.pointToCanvY(e.y),t,0,2*Math.PI);i.fill();if(e.predArr.some(function(e){return e&&e.satisfied&&e.strict})){i.fillStyle="white";i.beginPath();i.arc(n.pointToCanvX(e.x),n.pointToCanvY(e.y),t/2,0,2*Math.PI);i.fill();i.fillStyle=r.color.css()}})});r.lastCurveTime=performance.now()-t};Graph.prototype.mkCurve=function(){var e=this.tree.map(function(e){return e.cells}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){if(!e.isleaf)return false;var t=e.getPoints();if(t.length<2)return false;return true});var t=e.map(function(e){return e.getPoints().sort(function(e,t){return e.x!==t.x?e.x-t.x:e.y-t.y})});return t.map(function(e){if(this.grid.polar)e=e.map(function(e){return{x:e.y*Math.cos(e.x),y:e.y*Math.sin(e.x),dx:e.dy*Math.cos(e.x)-e.y*Math.sin(e.x)*e.dx,dy:e.dy*Math.sin(e.x)+e.y*Math.cos(e.x)*e.dx}});var t=-e[0].dx/e[0].dy,r=-e[1].dx/e[1].dy;var n=(e[0].y-e[1].y+r*e[1].x-t*e[0].x)/(r-t);var i=t*(n-e[0].x)+e[0].y;if(!isFinite(t)||!isFinite(r)){t=-e[0].dy/e[0].dx,r=-e[1].dy/e[1].dx;i=(e[0].x-e[1].x+r*e[1].y-t*e[0].y)/(r-t);n=t*(i-e[0].y)+e[0].x}var a=Math.pow(2,23)-1,o=-Math.pow(2,23)+1;var s=function(e){return e>a?a:e<o?o:e};var u=s(e[0].x),l=s(e[0].y),c=s(e[1].x),p=s(e[1].y);return[{x:u,y:l},{x:c,y:p}]}.bind(this)).filter(function(e){var t=e[0].x===e[0].x&&e[0].y===e[0].y&&e[1].x===e[1].x&&e[1].y===e[1].y;var r=this.grid.axis("x");var n=this.grid.axis("y");var i=function(e,t,r){return e<=t&&t<=r};var a=i(r.min,e[0].x,r.max)&&i(n.min,e[0].y,n.max)&&i(r.min,e[1].x,r.max)&&i(n.min,e[1].y,n.max);return t&&a}.bind(this))};var Chat={};Chat.Genre={};Chat.Callout={};Chat.CreateBubble=function(e){e=Util.Extend({action:null,anonUserId:null,callout:null,avatarUrl:null,content:null,extraClass:null,genre:"mathway",solutionId:"",typeset:false,userId:null,testContext:BubbleContext.Generic},e||{});if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")e.userId=Auth.userstate.userId;e.anonUserId=WebStorage.anonUserId.get();return e};Chat.ConvertIntoTutorGenres=function(e){for(var t=0,r=e.length;t<r;t++){switch(e[t].genre){case"local":e[t].genre="localTutor";break;case"remote":e[t].genre="remoteTutor";break;case"mathway":e[t].genre="mathwayTutor";break}}return e};Chat.ContextToDisplay=function(e){switch(e){default:case BubbleContext.Generic:return"generic";case BubbleContext.Problem:return"problem";case BubbleContext.Topic:return"topic";case BubbleContext.SolutionSteps:return"solutionsteps";case BubbleContext.SolutionNoSteps:return"solutionnosteps";case BubbleContext.Graph:return"graph";case BubbleContext.Rating:return"rating";case BubbleContext.Advert:return"advert";case BubbleContext.TutorBubble:return"tutorbubble";case BubbleContext.AppStore:return"appstore";case BubbleContext.Survey:return"survey";case BubbleContext.AutoResolve:return"autoresolve";case BubbleContext.ErrorBubble:return"errorbubble";case BubbleContext.Loading:return"loading"}};var ChatBridge=function(){var e={};e.affiliateMode=false;e.InsertIntoEditor=function(e){e=Util.Extend({asciiMath:"",moreTopics:"n",isTutor:false},e||{});var t=e.asciiMath;if(Tutor!==null&&Tutor.inChatRoom()&&Tutor.getRoleInRoom()===ChatUserType.Tutor&&!e.isTutor){t="@mwsolve "+e.asciiMath}$.publish("chat/problem",[{ascii:t}]);if(e.moreTopics=="y"){$.publish("chat/getMoreTopics")}};e.OpenGraphDialog=function(e){e=Util.Extend({graphInput:null,toggle:false,sequence:null},e||{});if(e.toggle){$.publish("ChatLibrary/Toggle",[e.sequence])}else{Actions.Do(Actions.openGraph,e)}};e.OpenViewSteps=function(e){e=Util.Extend({solutionId:"",asciiMath:"",mathML:"",topicId:null,topicText:"",presetProblem:false,freeTrialToken:null,showProblemLink:true},e||{});if($(".popup-view-steps").length>0)return;Actions.Do(Actions.openSteps,e)};e.AdViewSteps=function(t){t.adSteps=true;e.OpenViewSteps(t)};e.InviteTutor=function(e){var t=Util.Extend({},e||{});App.OriginalTutorBubbleSequence=t.origBubbleSequence;if(Auth.hasRole(UserRoles.TutoringAccess)){if(Auth.hasRole(UserRoles.Student)){t.InviteSource=TutorInviteSource.StudentBubble}else{t.InviteSource=TutorInviteSource.Bubble;
}}else{t.InviteSource=e.InviteSource!==TutorInviteSource.CreditsBubble?TutorInviteSource.TrialBubble:e.InviteSource}t.DeviceString=App.deviceString();if(t.Ascii==undefined)t=DtoHelper.InviteRequest({UserId:Auth.userstate.userId,Topic:{Id:e.topicId,Text:e.topicText},Type:ChatUserType.Student,DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),Subject:e.subject,Ascii:e.asciiMath,MathML:e.mathML,SolutionId:e.solutionId,Reason:InviteReason.UnableToSolve,Source:t.InviteSource});Actions.Do(Actions.studentRequestsTutor,t)};e.CancelTutor=function(e){e=Util.Extend({},e||{});Actions.Do(Actions.studentCancelsRequest,e)};e.RateSolution=function(e){e=Util.Extend({ascii:""},e||{});Actions.Do(Actions.rateSolution,e)};e.Upgrade=function(e){Actions.Do(Actions.showUpgrade,e)};e.UpgradeTutor=function(t){if(Auth.hasRole(UserRoles.TutoringAccess)){e.InviteTutor(t);return}if(Auth.hasRole(UserRoles.Student)){Popup.showError(Strings.Errors.IncompatibleUpgradeStudent);return}Popup.spinner();API.validateCredits(CreditType.Tutoring,function(r){Popup.hideSpinner();if(r.status!==1){return false}if(r.count>0){t.InviteSource=TutorInviteSource.CreditsBubble;e.InviteTutor(t)}else{t.InviteSource=TutorInviteSource.CreditsBubble;t.tutorSessionAfterPurchase=true;t.Subject=App.CurrentSubject.str;Actions.Do(Actions.showUpgrade,t)}})};e.FreeTrialTutor=function(t){e.InviteTutor(t)};e.FreeTrialTutorUpgrade=function(e){e=Util.Extend({},e||{});Actions.Do(Actions.showUpgrade,e)};e.AskOurExperts=function(e){e=Util.Extend({fromBubble:true},e||{});Actions.Do(Actions.askOurExperts,e)};e.OpenExamples=function(e){e=Util.Extend({},e||{});Actions.Do(Actions.openExamples)};e.GoToUrl=function(e){e=Util.Extend({url:App.getHomeLink()},e||{});var t=e.url.substring(0,4)!=="http"?App.baseUrl+App.urlPrefix+e.url:e.url;window.open(t)};e.StartTutorial=function(e){e=Util.Extend({},e||{});Actions.Do(Actions.startTutorial,[true])};e.AppStore=function(){Actions.Do(Actions.appStore,[true])};e.UpdateApp=function(){Actions.Do(Actions.appStore,[true])};e.LoadWhiteboard=function(e){Actions.Do(Actions.loadWhiteboard,[e.imageUrl])};e.ToggleImage=function(e){Actions.Do(Actions.toggleImage,[e])};e.AppShareBubble=function(e){Actions.Do(Actions.appShare,[e])};e.FreeTrialExpert=function(t){if(App.IsApps||Auth.hasExpertSubscription()){e.FreeTrialTutor(t);return}t=Util.Extend({fromBubble:true,freeTrial:true},t||{});Actions.Do(Actions.askOurExperts,t)};e.UpgradeExpert=function(t){if(App.IsApps){e.UpgradeTutor(t);return}if(Auth.hasTutoringSubscription()){$.publish("chat/removeUpgrade");return}Actions.Do(Actions.showUpgrade,{source:UpgradeSource.bubble})};e.AskAnExpert=function(t){if(App.IsApps){e.InviteTutor(t);return}t=Util.Extend({fromBubble:true},t||{});Actions.Do(Actions.askOurExperts,t)};return e}();Chat.Bubble=function(e,t,r){e=Util.Extend({anonUserId:null,content:"",extraClass:null,id:null,separator:false,separatorText:null,sequence:null,sessionId:null,solutionId:"",subject:null,timestamp:0,typeset:false,userId:null,avatarUrl:null,roomId:null,canBeEditted:false,transactionId:null,appstoreString:"",fromLoggedInUser:false,testContext:BubbleContext.Generic},e||{});this.anonUserId=e.anonUserId;this.content=e.content;this.extraClass=e.extraClass;this.id=e.id;this.separator=e.separator;this.separatorText=e.separatorText;this.sequence=e.sequence;this.sessionId=e.sessionId;this.solutionId=e.solutionId;this.subject=e.subject;this.timestamp=e.timestamp;this.typeset=e.typeset;this.userId=e.userId;this.avatarUrl=e.avatarUrl;this.roomId=e.roomId;this.canBeEditted=e.canBeEditted?true:false;this.transactionId=e.transactionId;this.deleteAction=null;this.postRender=null;this.actionString=null;this.appstoreString=e.appstoreString;this.fromLoggedInUser=e.fromLoggedInUser?true:false;this.testContext=e.testContext;var n=this;if(typeof t==="string"){this.actionString=t;t=t.length>0?JSON.parse(t):null}else if(t!=null){this.actionString=JSON.stringify(t)}this.action=null;if(t!=null){var i=t.method||null;var a=t.params||null;if(i!==null){this.method=i;var o=[i];this.action=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}if(e.target&&e.target.className!=="GlossaryTerm"){if(i==="OpenGraphDialog"){a["toggle"]=e.target.className!=="graph-thumbnail"?true:false;a["sequence"]=n.sequence}if(i==="OpenViewSteps"){a["showProblemLink"]=n.fromLoggedInUser}if(a!==null){a.origBubbleSequence=n.sequence;o.push(a)}$.publish("ChatLibrary/Bridge",o)}}}}this.genre=r||null;this.element=null;this.position="single";this.rendered=false;if(this.canBeEditted&&this.transactionId>0){this.deleteAction=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}Actions.Do(Actions.removeMessage,n.transactionId)}}};Chat.Bubble.prototype.create=function(){this.element=document.createElement("div");Util.AddClass("ch-bubble",this.element);if(this.extraClass!==null)Util.AddClass(this.extraClass,this.element);this.element.setAttribute("data-sequence",this.sequence);if(this.genre===null)throw new Error("genre not set for chat bubble");if(this.separator===true)this.createSeparator();if(this.avatarUrl!=null){this.genre.create(this.element,this.content,this.avatarUrl)}else if(this.appstoreString!==""){this.genre.create(this.element,this.content,this.appstoreString)}else{this.genre.create(this.element,this.content)}this.createAction();this.element.setAttribute("genre",this.genre.type);if(this.method)this.element.setAttribute("method",this.method);this.element.setAttribute("data-context",Chat.ContextToDisplay(this.testContext));this.setPosition(this.position);this.element.appendChild(Util.CreateElement({className:"clear"}));return this.element};Chat.Bubble.prototype.createAction=function(){if(this.action!==null){$(this.genre.element).addClass("clickable");if(this.actionString.indexOf("InsertIntoEditor")!==-1){$(this.genre.element).addClass("ch-problem")}this.genre.element.addEventListener("click",this.action)}};Chat.Bubble.prototype.createDeleteAction=function(){if(this.genre.element!==null){$(this.genre.element).addClass("clickable");this.genre.element.addEventListener("click",this.deleteAction)}};Chat.Bubble.prototype.hasSeparator=function(){if(!this.element)return false;var e=this.element.firstChild;if(e==null)return false;return e.className==="ch-separator"?true:false};Chat.Bubble.prototype.createSeparator=function(){if(this.hasSeparator())return;var e=Util.CreateElement({className:"ch-separator"});var t=this.separatorText?this.separatorText:this.formatDate();e.appendChild(Util.CreateElement({className:"ch-separator-inner",content:t}));this.element.insertBefore(e,this.element.firstChild)};Chat.Bubble.prototype.removeSeparator=function(){if(!this.hasSeparator())return;this.element.removeChild(this.element.firstChild)};Chat.Bubble.prototype.formatDate=function(){var e=this.timestamp;if(this.genre.type!=="greeting")e+=App.TimeOffset;return Util.formatDateWithTime(e)};Chat.Bubble.prototype.update=function(){if(this.separator===true){this.createSeparator()}else{this.removeSeparator()}};Chat.Bubble.prototype.destroy=function(){this.destroyAction();this.destroyDeleteAction();if(typeof this.genre.destroy==="function"){this.genre.destroy()}if(this.element!==null){if(this.element.parentNode!==null)this.element.parentNode.removeChild(this.element);this.element=null}};Chat.Bubble.prototype.destroyAction=function(){if(this.action!==null){$(this.genre.element).removeClass("clickable").removeClass("ch-problem");this.genre.element.removeEventListener("click",this.action)}};Chat.Bubble.prototype.destroyDeleteAction=function(){if(this.genre.element!==null){$(this.genre.element).removeClass("clickable");this.genre.element.removeEventListener("click",this.deleteAction)}};Chat.Bubble.prototype.setPosition=function(e){if(typeof e==="undefined")e="single";switch(e){case"single":case"top":if(this.genre.icon!==null){this.genre.icon.style.display=""}break;case"middle":case"bottom":if(this.genre.icon!==null){this.genre.icon.style.display="none"}break;default:e="single";if(this.genre.icon!==null){this.genre.icon.style.display=""}break}if(e!=="single"&&this.separator===true)this.createSeparator();this.position=e;if(this.element!==null){this.element.setAttribute("data-position",this.position)}};Chat.Bubble.prototype.onRender=function(){$(this.element).removeClass("is-solution-bubble");if(typeof this.genre.onRender==="function"){this.genre.onRender.call(this)}this.rendered=true};Chat.Bubble.prototype.startEditMode=function(){if(this.canBeEditted&&this.transactionId){var e=Util.RandomInt(10,75);var t=Util.RandomInt(22,35);$(this.genre.outer).addClass("ch-edit-mode");$(this.genre.outer).attr("style","animation-delay: -0."+e+"s; animation-duration: ."+t+"s;");this.destroyAction();this.createDeleteAction()}};Chat.Bubble.prototype.endEditMode=function(){if(this.canBeEditted&&this.transactionId){$(this.genre.outer).removeClass("ch-edit-mode");$(this.genre.outer).removeAttr("style");this.destroyDeleteAction();this.createAction()}};Chat.Bubble.prototype.disableEditMode=function(){this.endEditMode();this.canBeEditted=false};Chat.Bubble.prototype.toggle=function(){if(typeof this.genre.toggle==="function"){this.genre.toggle()}};Chat.Callout.ViewSteps=function(){this.type="ViewSteps"};Chat.Callout.ViewSteps.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-viewsteps"}));e.appendChild(document.createTextNode(Strings.Chat.ActionUpgrade));return e};Chat.Callout.AdViewSteps=function(){this.type="AdViewSteps"};Chat.Callout.AdViewSteps.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-bubble-trial"});var t=Util.CreateElement({className:"ch-bubble-action-inner"});var r=Util.CreateElement({tagName:"img",className:"green-icon"});r.setAttribute("src","/images/green-icon.svg");t.appendChild(r);t.appendChild(document.createTextNode(Strings.Chat.ActionTrial));t.appendChild(Util.CreateElement({className:"clear"}));e.appendChild(t);return e};Chat.Callout.ViewTrialSteps=function(){this.type="ViewSteps"};Chat.Callout.ViewTrialSteps.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-viewtrialsteps"}));e.appendChild(document.createTextNode(Strings.Chat.ActionTrial));return e};Chat.Callout.OpenGraph=function(){this.type="OpenGraph"};Chat.Callout.OpenGraph.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-opengraph"}));e.appendChild(document.createTextNode(Strings.Chat.ActionGraph));return e};Chat.Callout.TapToRate=function(){this.type="TapToRate";this.element=null};Chat.Callout.TapToRate.prototype.create=function(){this.element=Util.CreateElement({className:"ch-bubble-action"});this.element.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-taptorate"}));this.element.appendChild(document.createTextNode(Strings.Chat.ActionRating));return this.element};Chat.Callout.TapToRate.prototype.destroy=function(){};Chat.Callout.TapForExamples=function(){this.type="TapForExamples"};Chat.Callout.TapForExamples.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-tapexamples"}));e.appendChild(document.createTextNode(Strings.Chat.ActionExamples));return e};Chat.Callout.AutoMoreTopics=function(){this.type="AutoMoreTopics"};Chat.Callout.AutoMoreTopics.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-automoretopics"}));e.appendChild(document.createTextNode(Strings.Chat.MoreOptions));return e};Chat.Callout.TapToInsert=function(){this.type="TapToInsert"};Chat.Callout.TapToInsert.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-taptoinsert"}));e.appendChild(document.createTextNode(Strings.Chat.ActionInsertExample));return e};Chat.Callout.StartTutorial=function(){this.type="StartTutorial"};Chat.Callout.StartTutorial.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw  mw-callout-startutorial"}));e.appendChild(document.createTextNode(Strings.Chat.ActionTutorial));return e};Chat.Callout.TapToGo=function(e,t){this.type="TapToGo";this.actionText=e;this.actionIcon=t};Chat.Callout.TapToGo.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw "+(this.actionIcon?this.actionIcon+" ":"")+"mw-callout-taptogo"}));e.appendChild(document.createTextNode(this.actionText?this.actionText:Strings.Chat.ActionGoToUrl));return e};Chat.Callout.TapToShare=function(){this.type="TapToGo"};Chat.Callout.TapToShare.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-problem-link"}));e.appendChild(document.createTextNode(Strings.Chat.ActionAppShare));return e};Chat.Callout.AppStore=function(){this.type="AppStore"};Chat.Callout.AppStore.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-appstore"}));e.appendChild(document.createTextNode("Upgrade App"));return e};Chat.Callout.TutorRequest=function(){this.type="TutorRequest"};Chat.Callout.TutorRequest.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));e.appendChild(document.createTextNode(Strings.Chat.ActionTutorRequest));return e};Chat.Callout.ExpertRequest=function(){this.type="ExpertRequest"};Chat.Callout.ExpertRequest.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));e.appendChild(document.createTextNode(Strings.Chat.ActionExpertRequest));return e};Chat.Callout.FreeTrialTutor=function(){this.type="TutorRequest"};Chat.Callout.FreeTrialTutor.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));e.appendChild(document.createTextNode(Strings.Chat.ActionFreeTrialTutor));return e};Chat.Callout.FreeTrialExpert=function(){if(Auth.hasExpertSubscription())this.type="TutorRequest";else this.type="ExpertRequest"};Chat.Callout.FreeTrialExpert.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));if(Auth.hasExpertSubscription())e.appendChild(document.createTextNode(Strings.Chat.ActionFreeTrialLiveExpert));else e.appendChild(document.createTextNode(Strings.Chat.ActionFreeTrialExpert));return e};Chat.Callout.FreeTrialTutorUpgrade=function(){this.type="TutorUpgradeRequest"};Chat.Callout.FreeTrialTutorUpgrade.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));e.appendChild(document.createTextNode(Strings.Chat.ActionFreeTrialTutorUpgrade));return e};Chat.Callout.FreeTrialExpertUpgrade=function(){this.type="ExpertUpgradeRequest"};Chat.Callout.FreeTrialExpertUpgrade.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-tutor-request ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-cap"}));e.appendChild(document.createTextNode(Strings.Chat.ActionFreeTrialExpertUpgrade));return e};Chat.Callout.CancelTutor=function(){this.type="CancelTutor"};Chat.Callout.CancelTutor.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-canceltutor"}));e.appendChild(document.createTextNode(Strings.Chat.CancelTutor));return e};Chat.Callout.LoadWhiteboard=function(){this.type="LoadWhiteboard"};Chat.Callout.LoadWhiteboard.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-loadwhiteboard"}));e.appendChild(document.createTextNode(Strings.Chat.LoadWhiteboard));return e};Chat.Callout.ToggleImage=function(){this.type="ToggleImage"};Chat.Callout.ToggleImage.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-toggle"}));e.appendChild(document.createTextNode(Strings.Tutor.HideImage));return e};Chat.Callout.ToggleGraph=function(e){this.type="ToggleGraph";this.showGraph=e?true:false};Chat.Callout.ToggleGraph.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-toggle"}));e.innerHTML=this.showGraph?'<span class="mw mw-callout-toggle"></span>'+Strings.Chat.HideGraph:'<span class="mw mw-callout-toggle"></span>'+Strings.Chat.ShowGraph;return e};Chat.Callout.UpdateApp=function(){this.type="UpdateApp"};Chat.Callout.UpdateApp.prototype.create=function(){var e=Util.CreateElement({className:"ch-bubble-action ch-bubble-trial"});e.appendChild(Util.CreateElement({tagName:"span",className:"mw mw-callout-updateapp"}));e.appendChild(document.createTextNode(Strings.Chat.UpdateApp));return e};Chat.Collection=function(e){this.items=[];this.options=Util.Extend({limit:50,startingSequence:1e3},e||{})};Chat.Collection.prototype.count=function(){return this.items.length};Chat.Collection.prototype.prepend=function(e){if(e.length===0)return;for(var t=0,r=e.length;t<r;t++){e[t].sequence=this.items.length>0?this.items[this.items.length-1].sequence+1:this.options.startingSequence;this.items.push(e[t])}};Chat.Collection.prototype.append=function(e){if(e.length===0)return;for(var t=0,r=e.length;t<r;t++){e[t].sequence=this.items.length>0?this.items[0].sequence-1:this.options.startingSequence;this.items.unshift(e[t])}};Chat.Collection.prototype.cull=function(e){var t=this.rendered();var r=t.length;if(r<this.options.limit)return;t.splice(e?0:r-this.options.limit,this.options.limit);for(var n=0,i=t.length;n<i;n++){this.removeBySequence(t[n])}if(t.length>0){$.publish(e?"ChatLibrary/CulledNewer":"ChatLibrary/CulledOlder")}};Chat.Collection.prototype.getBySequence=function(e){for(var t=0,r=this.items.length;t<r;t++){if(this.items[t].sequence===e){return this.items[t]}}return null};Chat.Collection.prototype.removeBySequence=function(e){for(var t=0,r=this.items.length;t<r;t++){if(this.items[t].sequence===e){this.items[t].destroy();this.items.splice(t,1);return true}}return false};Chat.Collection.prototype.removeAllOfGenre=function(e,t){var r=[];if(t&&e){for(var n=0,i=this.items.length;n<i;n++){if(this.items[n].genre.type===e){var a=this.items[n].genre;if(a.callout&&typeof a.callout.type!=="undefined"&&a.callout.type===t){r.push(this.items[n].sequence)}}}}else if(e){for(var n=0,i=this.items.length;n<i;n++){if(this.items[n].genre.type===e){r.push(this.items[n].sequence)}}}for(var n=0,i=r.length;n<i;n++){this.removeBySequence(r[n])}};Chat.Collection.prototype.removeAllWithAction=function(e){var t=[];for(var r=0,n=this.items.length;r<n;r++){if(this.items[r].method!=null&&this.items[r].method===e){t.push(this.items[r].sequence)}}for(var r=0,n=t.length;r<n;r++){this.removeBySequence(t[r])}};Chat.Collection.prototype.forEach=function(e){for(var t=0,r=this.items.length;t<r;t++){e.call(this,this.items[t],t>0?this.items[t-1]:null)}};Chat.Collection.prototype.rendered=function(){var e=[];for(var t=0,r=this.items.length;t<r;t++){if(this.items[t].rendered===true)e.push(this.items[t].sequence)}return e};Chat.Collection.prototype.empty=function(){for(var e=0,t=this.items.length;e<t;e++){this.items[e].destroy()}this.items.length=0};Chat.Collection.prototype.removeNewerThan=function(e){var t=[];for(var r=0,n=this.items.length;r<n;r++){if(this.items[r].sequence>e){t.push(this.items[r].sequence)}}for(var r=0,n=t.length;r<n;r++){this.removeBySequence(t[r])}};Chat.Collection.prototype.startEditMode=function(){for(var e=0,t=this.items.length;e<t;e++){this.items[e].startEditMode()}};Chat.Collection.prototype.endEditMode=function(){for(var e=0,t=this.items.length;e<t;e++){this.items[e].endEditMode()}};Chat.Collection.prototype.disableEditMode=function(){for(var e=0,t=this.items.length;e<t;e++){this.items[e].disableEditMode()}};Chat.Collection.prototype.getByTransactionId=function(e){e=parseInt(e);for(var t=0,r=this.items.length;t<r;t++){if(this.items[t].transactionId===e){return this.items[t].element}}return null};Chat.Collection.prototype.removeByTransactionId=function(e){var t=[];e=parseInt(e);for(var r=0,n=this.items.length;r<n;r++){if(this.items[r].transactionId===e){t.push(this.items[r].sequence)}}for(var r=0,n=t.length;r<n;r++){this.removeBySequence(t[r])}};Chat.Collection.prototype.getSurveyById=function(e){e=parseInt(e);for(var t=0,r=this.items.length;t<r;t++){if(this.items[t].genre&&this.items[t].genre.type&&this.items[t].genre.type==="survey"){if(this.items[t].genre.surveyId===e){return this.items[t].genre}}}return null};Chat.Collection.prototype.adjustStepsCallout=function(){for(var e=0,t=this.items.length;e<t;e++){if(this.items[e].method!=null&&(this.items[e].method==="OpenViewSteps"||this.items[e].method==="AdViewSteps")){if(this.items[e].genre&&this.items[e].genre.type&&this.items[e].genre.type==="mathway"){this.items[e].genre.setNewCallout("ViewSteps")}}}};Chat.Genre.Mathway=function(e,t){if(typeof t==="undefined")t=false;this.type="mathway";this.element=null;this.outer=null;this.icon=null;this.callout=e||null;this.inner=null;this.placeholder=null;this.graphWrapper=null;this.showGraph=t;this.graphRendered=false;this.calloutEle=null};Chat.Genre.Mathway.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-mathway-icon"});e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.inner=Util.CreateElement({className:"ch-bubble-content",content:t});this.graphWrapper=this.inner.querySelector(".GraphWrapper");if(this.graphWrapper!==null){this.callout=new Chat.Callout.ToggleGraph(this.showGraph);this.placeholder=Util.CreateElement({className:"ch-bubble-content bubble-image-caption",content:'<div class="image-caption"><span class="mw mw-graph"></span></div>'});if(this.showGraph){this.inner.style.display="block";this.placeholder.style.display="none";$(this.element).addClass("co-toggle-open");if(!this.graphRendered)this.renderGraph()}else{this.inner.style.display="none";this.placeholder.style.display="block"}this.element.appendChild(this.placeholder)}this.element.appendChild(this.inner);if(this.callout!==null){this.calloutEle=this.callout.create();this.element.appendChild(this.calloutEle)}this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Mathway.prototype.toggle=function(){if(this.inner.style.display==="block"){this.inner.style.display="none";this.placeholder.style.display="block";$(this.element).removeClass("co-toggle-open");this.calloutEle.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Chat.ShowGraph}else{this.inner.style.display="block";this.placeholder.style.display="none";$(this.element).addClass("co-toggle-open");this.calloutEle.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Chat.HideGraph;if(!this.graphRendered)this.renderGraph()}};Chat.Genre.Mathway.prototype.renderGraph=function(){GraphBuilder.addGraphWrapper(this.graphWrapper);this.graphRendered=true};Chat.Genre.Mathway.prototype.setNewCallout=function(newCallout){var newFunc=eval("Chat.Callout."+newCallout);if(typeof newFunc!=="function"){return}if(typeof this.callout.destroy==="function")this.callout.destroy.call(this);this.calloutEle.parentNode.removeChild(this.calloutEle);this.calloutEle=null;this.callout=new newFunc;this.calloutEle=this.callout.create();this.element.appendChild(this.calloutEle)};Chat.Genre.Remote=function(e){this.type="remote";this.element=null;this.icon=null;this.iconPath=e;this.outer=null};Chat.Genre.Remote.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-remote-icon"});e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.element.appendChild(Util.CreateElement({className:"ch-bubble-content",content:t}));this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Local=function(){this.type="local";this.element=null;this.icon=null;this.outer=null};Chat.Genre.Local.prototype.create=function(e,t){this.outer=Util.CreateElement({className:"ch-bubble-local"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.element.appendChild(Util.CreateElement({className:"ch-bubble-content",content:t}));this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.LocalTutor=function(e,t){this.type="localTutor";this.element=null;this.icon=null;this.canBeEditted=e?true:false;this.outer=null;this.transactionId=t;this.removeControls=null;this.removeAction=null;if(this.canBeEditted&&this.transactionId>0){var r=this;this.removeAction=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}Actions.Do(Actions.removeMessage,r.transactionId)}}};Chat.Genre.LocalTutor.prototype.create=function(e,t){this.outer=Util.CreateElement({className:"ch-bubble-local"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.element.appendChild(Util.CreateElement({className:"ch-bubble-content",content:t}));this.outer.appendChild(this.element);e.appendChild(this.outer);if(this.removeAction){this.removeControls=Util.CreateElement({className:"ch-edit-controls",content:'<span class="mw mw-trash"></span>'});this.removeControls.addEventListener("click",this.removeAction);this.outer.appendChild(this.removeControls)}};Chat.Genre.LocalTutor.prototype.destroy=function(){if(this.removeControls)this.removeControls.removeEventListener("click",this.removeAction)};Chat.Genre.LocalImage=function(e,t,r,n){this.type="localImage";this.element=null;this.icon=null;this.callout=e||null;this.hideImage=t||false;this.canBeEditted=r?true:false;this.outer=null;this.transactionId=n;this.removeControls=null;this.removeAction=null;if(this.canBeEditted&&this.transactionId>0){var i=this;this.removeAction=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}Actions.Do(Actions.removeMessage,i.transactionId)}}};Chat.Genre.LocalImage.prototype.create=function(e,t){this.outer=Util.CreateElement({className:"ch-bubble-local"});var r=this;this.element=Util.CreateElement({className:"ch-bubble-border"});var n=Util.CreateElement({className:"ch-bubble-content bubble-image-caption",content:'<div class="image-caption"><span class="mw mw-callout-uploaded"></span></div>'});this.element.appendChild(n);this.element.appendChild(Util.CreateElement({tagName:"img",attributes:[{key:"src",value:t}]}));var i=this.element.lastChild;this.element.onload=function(){$.publish("ChatLibrary/ScrollBottom")};if(this.callout!==null){var a=this.callout.create();this.element.appendChild(a)}var o=function(){$(r.element).addClass("co-toggle-open");a.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Tutor.HideImage;n.style.display="none";i.style.display="block"};var s=function(){$(r.element).removeClass("co-toggle-open");a.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Tutor.ShowImage;n.style.display="block";i.style.display="none"};this.element.onclick=function(){if(i.style.display==="none"){o()}else{s()}};$(r.element).addClass("co-toggle-open");if(this.hideImage)s();this.outer.appendChild(this.element);e.appendChild(this.outer);if(this.removeAction){this.removeControls=Util.CreateElement({className:"ch-edit-controls",content:'<span class="mw mw-trash"></span>'});this.removeControls.addEventListener("click",this.removeAction);this.outer.appendChild(this.removeControls)}};Chat.Genre.LocalImage.prototype.destroy=function(){if(this.removeControls)this.removeControls.removeEventListener("click",this.removeAction)};Chat.Genre.RemoteImage=function(e,t){this.type="remoteImage";this.element=null;this.icon=null;this.callout=e;this.hideImage=t||false;this.outer=null};Chat.Genre.RemoteImage.prototype.create=function(e,t,r){this.icon=Util.CreateElement({className:"ch-remote-icon"});r=r?r:App.DefaultAvatarUrl;this.icon.appendChild(Util.CreateElement({tagName:"img",attributes:[{key:"src",value:r}]}));e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});var n=this;this.element=Util.CreateElement({className:"ch-bubble-border"});var i=Util.CreateElement({className:"ch-bubble-content bubble-image-caption",content:'<div class="image-caption"><span class="mw mw-callout-uploaded"></span></div>'});this.element.appendChild(i);this.element.appendChild(Util.CreateElement({tagName:"img",attributes:[{key:"src",value:t}]}));var a=this.element.lastChild;this.element.onload=function(){$.publish("ChatLibrary/ScrollBottom")};if(this.callout!==null){var o=this.callout.create();this.element.appendChild(o)}var s=function(){$(n.element).addClass("co-toggle-open");o.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Tutor.HideImage;i.style.display="none";a.style.display="block"};var u=function(){$(n.element).removeClass("co-toggle-open");o.innerHTML='<span class="mw mw-callout-toggle"></span>'+Strings.Tutor.ShowImage;i.style.display="block";a.style.display="none"};this.element.onclick=function(){if(a.style.display==="none"){s()}else{u()}};$(n.element).addClass("co-toggle-open");if(this.hideImage)u();this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.RemoteTutor=function(e){this.type="remoteTutor";this.element=null;this.icon=null;this.iconPath=e;this.outer=null};Chat.Genre.RemoteTutor.prototype.create=function(e,t,r){this.icon=Util.CreateElement({className:"ch-remote-icon"});r=r?r:App.DefaultAvatarUrl;this.icon.appendChild(Util.CreateElement({tagName:"img",attributes:[{key:"src",value:r}]}));e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.element.appendChild(Util.CreateElement({className:"ch-bubble-content",content:t}));this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Advert=function(){this.type="advert";this.element=null;this.icon=null;this.inner=null;this.adSlot=null;this.outer=null};Chat.Genre.Advert.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-ad-icon"});e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});var r=Util.CreateElement({className:"ch-bubble-content"});var n=Chat.Genre.Advert.AdToggle?"D_C1":"D_C2";r.appendChild(Util.CreateElement({id:n,className:"ch-ad-slot"}));this.element.appendChild(r);this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Advert.AdToggle=true;Chat.Genre.Advert.CurrentSize="";Chat.Genre.Advert.prototype.onRender=function(){if(!window.location.href.ToLower().contains("www.mathway.com"))return;var e=this.genre;Chat.Genre.Advert.AdRefresh(false)};Chat.Genre.Advert.GetSize=function(){if(App.Screen.width<550)return"small";if(App.Screen.width<1200)return"medium";return"large"};Chat.Genre.Advert.AdRefresh=function(e){if(e){var t=$("#D_C1"),r=$("#D_C2");
var n=$("<div></div>").addClass("ch-ad-slot");var i=null;if(t.length===1){i=t.parent();n.attr("id","D_C2")}else{i=r.parent();n.attr("id","D_C1")}i.empty();i.append(n)}else{Chat.Genre.Advert.CurrentSize=Chat.Genre.Advert.GetSize()}var a=Chat.Genre.Advert.AdToggle?1:2;var o=Chat.Genre.Advert.CurrentSize+"-C"+a;sbmCmd.push(function(e){e.reload({layout:o,union:true});Chat.Genre.Advert.AdToggle=!Chat.Genre.Advert.AdToggle})};$.subscribe("window/resize",function(){var e=$("#D_C1"),t=$("#D_C2");if(e.length===0&&t.length===0)return;if(App.Screen.width<550&&Chat.Genre.Advert.CurrentSize!=="small"){Chat.Genre.Advert.CurrentSize="small";Chat.Genre.Advert.AdRefresh(true)}else if(App.Screen.width>=550&&App.Screen.width<1200&&Chat.Genre.Advert.CurrentSize!=="medium"){Chat.Genre.Advert.CurrentSize="medium";Chat.Genre.Advert.AdRefresh(true)}else if(App.Screen.width>=1200&&Chat.Genre.Advert.CurrentSize!=="large"){Chat.Genre.Advert.CurrentSize="large";Chat.Genre.Advert.AdRefresh(true)}});Chat.Genre.Rating=function(e,t){this.type="rating";this.element=null;this.callout=e;this.action=t};Chat.Genre.Rating.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-mathway-icon"});e.appendChild(this.icon);this.element=e;var r=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border clickable"});var n=Util.CreateElement({className:"ch-bubble-content",content:t});var i=this.callout.create();var a=Util.CreateElement({className:"rating-container"});var o=this;new Component.Rating({elem:a,onRating:function(e){Actions.Do(Actions.dispatchRating,{asciiMath:o.action.params.asciiMath,mathML:o.action.params.mathMl,subject:o.action.params.subject,topicId:o.action.params.topicId,topicText:o.action.params.topicText,customData:o.action.params.customData,rating:e});if(e===Component.Rating.MaxRating){Actions.Do(Actions.showInAppRating)}setTimeout(function(){i.parentNode.removeChild(i);n.innerHTML=Strings.Chat.RateSolutionFeedback;Util.RemoveClass("clickable",o.element)},800)}});n.appendChild(a);this.element.appendChild(n);if(this.callout!==null)this.element.appendChild(i);r.appendChild(this.element);e.appendChild(r)};Chat.Genre.NativeAd=function(){this.type="advert";this.element=null;this.icon=null;this.inner=null;this.adSlot=null;this.outer=null};Chat.Genre.NativeAd.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-ad-icon"});e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});this.element.appendChild(Util.CreateElement({className:"ch-bubble-content",content:t}));this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Survey=function(e,t,r){if(typeof showGraph==="undefined")showGraph=false;this.type="survey";this.surveyId=r;this.element=null;this.inner=null;this.action=t;this.callout=e;this.icon=null;this.optionSelected=false};Chat.Genre.Survey.prototype.create=function(e,t){this.icon=Util.CreateElement({className:"ch-mathway-icon"});e.appendChild(this.icon);var r=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border clickable"});this.inner=Util.CreateElement({className:"ch-bubble-content clickable"});var n=Util.CreateElement({className:"survey-question clickable",content:t});this.element.appendChild(this.inner);var i=Util.CreateElement({className:"survey-options clickable"});for(var a=0;a<this.action.params.surveyOptions.length;a++){var o=Util.CreateElement({tagName:"label",className:"survey-option clickable"});var s=Util.CreateElement({tagName:"input",className:"survey-radio clickable",attributes:[{key:"type",value:"radio"},{key:"name",value:"surveyOpt"}]});o.appendChild(s);o.appendChild(document.createTextNode(this.action.params.surveyOptions[a]));var u=this.action.params.surveyOptionGetDetail[a]?this.action.params.surveyOptionMessage[a]:null;o.onclick=this.SendFunc(this.action.params.surveyID,this.action.params.surveyOptionID[a],u);i.appendChild(o)}this.inner.appendChild(n);this.inner.appendChild(i);if(this.callout!==null){this.calloutEle=this.callout.create();this.element.appendChild(this.calloutEle)}r.appendChild(this.element);e.appendChild(r)};Chat.Genre.Survey.prototype.postAnswer=function(){var e=this;setTimeout(function(){e.inner.innerHTML=Strings.Chat.ThanksForFeedback},800)};Chat.Genre.Survey.prototype.cancelDetail=function(){this.optionSelected=false;var e=this.inner.querySelector(".survey-radio:checked");if(e){e.checked=false}};Chat.Genre.Survey.prototype.SendFunc=function(e,t,r){var n=this;return function(){if(!n.optionSelected){n.optionSelected=true;if(r){Actions.Do(Actions.surveyOpenDialog,{surveyId:e,responseId:t,surveyText:r})}else{Actions.Do(Actions.surveySubmit,{surveyId:e,responseId:t})}}}};Chat.Genre.Appstore=function(e,t,r){if(typeof showGraph==="undefined")showGraph=false;this.type="appstore";this.element=null;this.action=t;this.callout=e;this.icon=null;this.appstoreComponent=r};Chat.Genre.Appstore.prototype.create=function(e,t,r){this.icon=Util.CreateElement({className:"ch-mathway-icon"});e.appendChild(this.icon);var n=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});var i=Util.CreateElement({className:"ch-bubble-content",content:t});this.element.appendChild(i);var a=Util.CreateElement({className:"ch-bubble-action ch-bubble-appstore"});a.innerHTML=r;this.element.appendChild(a);if(this.callout!==null){this.calloutEle=this.callout.create();this.element.appendChild(this.calloutEle)}n.appendChild(this.element);e.appendChild(n)};Chat.Genre.Loading=function(e){this.type="loading";this.element=null;this.icon=null;this.callout=e||null;this.outer=null};Chat.Genre.Loading.prototype.create=function(e,t,r){if(t===null)t="";if(!r)r="";if(r===""){this.icon=Util.CreateElement({className:"ch-mathway-icon"})}else{this.icon=Util.CreateElement({className:"ch-remote-icon"});this.icon.style.backgroundImage="url('"+r+"')"}e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});var n=Util.CreateElement({className:"ch-bubble-content",content:t});var i=Util.CreateElement({className:"spinner"});i.appendChild(Util.CreateElement({className:"bounce1"}));i.appendChild(Util.CreateElement({className:"bounce2"}));i.appendChild(Util.CreateElement({className:"bounce3"}));i.appendChild(Util.CreateElement({className:"clear"}));n.appendChild(i);this.element.appendChild(n);if(this.callout!==null)this.element.appendChild(this.callout.create());this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.Loading.prototype.onRender=function(){if(this.element!==null)this.element.querySelector(".spinner").style.display="block"};Chat.Genre.LoadingTutor=function(e){this.type="loading-tutor";this.element=null;this.icon=null;this.callout=e||null;this.outer=null};Chat.Genre.LoadingTutor.prototype.create=function(e,t,r){if(t===null)t="";if(!r)r="";if(r===""){this.icon=Util.CreateElement({className:"ch-mathway-icon"})}else{this.icon=Util.CreateElement({className:"ch-remote-icon"});this.icon.style.backgroundImage="url('"+r+"')"}e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});var n=Util.CreateElement({className:"ch-bubble-content",content:t});var i=Util.CreateElement({tagName:"span",className:"ch-bubble-content-place"});n.appendChild(i);var a=Util.CreateElement({className:"spinner"});a.appendChild(Util.CreateElement({className:"bounce1"}));a.appendChild(Util.CreateElement({className:"bounce2"}));a.appendChild(Util.CreateElement({className:"bounce3"}));a.appendChild(Util.CreateElement({className:"clear"}));n.appendChild(a);this.element.appendChild(n);if(this.callout!==null)this.element.appendChild(this.callout.create());this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.LoadingTutor.prototype.onRender=function(){if(this.element!==null)this.element.querySelector(".spinner").style.display="block"};Chat.Genre.RemoteTyping=function(){this.type="remoteTyping";this.element=null;this.icon=null;this.outer=null};Chat.Genre.RemoteTyping.prototype.create=function(e,t,r){this.icon=Util.CreateElement({className:"ch-remote-icon"});r=r?r:App.DefaultAvatarUrl;this.icon.appendChild(Util.CreateElement({tagName:"img",attributes:[{key:"src",value:r}]}));e.appendChild(this.icon);this.outer=Util.CreateElement({className:"ch-bubble-remote"});this.element=Util.CreateElement({className:"ch-bubble-border"});var n=Util.CreateElement({className:"ch-bubble-content",content:t});var i=Util.CreateElement({className:"spinner"});i.appendChild(Util.CreateElement({className:"bounce1"}));i.appendChild(Util.CreateElement({className:"bounce2"}));i.appendChild(Util.CreateElement({className:"bounce3"}));i.appendChild(Util.CreateElement({className:"clear"}));n.appendChild(i);this.element.appendChild(n);this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.RemoteTyping.prototype.onRender=function(){if(this.element!==null)this.element.querySelector(".spinner").style.display="block"};Chat.Genre.LocalTyping=function(){this.type="localTyping";this.element=null;this.icon=null;this.outer=null};Chat.Genre.LocalTyping.prototype.create=function(e,t){this.outer=Util.CreateElement({className:"ch-bubble-local"});this.element=Util.CreateElement({className:"ch-bubble-border"});var r=Util.CreateElement({className:"ch-bubble-content",content:t});var n=Util.CreateElement({className:"spinner"});n.appendChild(Util.CreateElement({className:"bounce1"}));n.appendChild(Util.CreateElement({className:"bounce2"}));n.appendChild(Util.CreateElement({className:"bounce3"}));n.appendChild(Util.CreateElement({className:"clear"}));r.appendChild(n);this.element.appendChild(r);this.outer.appendChild(this.element);e.appendChild(this.outer)};Chat.Genre.LocalTyping.prototype.onRender=function(){if(this.element!==null)this.element.querySelector(".spinner").style.display="block"};Chat.Manager=function(e,t,r,n){this.element=e;this.queue=t;this.bubbles=r;this.strings=n;this.separatorTime=9e5};Chat.Manager.prototype.parseInput=function(e,t){var r=this;t=Util.Extend({subject:true,insertNewer:true,hideImages:false,canBeEditted:false,fromLoggedInUser:false,adFreeStepsAllowed:false},t||{});var n=[];for(var i=0,a=e.bubbles.length;i<a;i++){var o=e.bubbles[i].id!=null?e.bubbles[i].id:null;var s=e.bubbles[i].userId!=null?e.bubbles[i].userId:null;var u=e.bubbles[i].anonUserId!=null?e.bubbles[i].anonUserId:null;var l=e.bubbles[i].extraClass!=null?e.bubbles[i].extraClass:null;var c=e.bubbles[i].showGraph!=null?e.bubbles[i].showGraph:false;var p=e.bubbles[i].testContext!=null?e.bubbles[i].testContext:BubbleContext.Generic;var d=null;var f=null;var h=false;var m=null;var g=null;var v=null;var b=null;var y="";switch(e.bubbles[i].callout){case"ViewTrialSteps":v=new Chat.Callout.ViewTrialSteps;break;case"ViewSteps":v=new Chat.Callout.ViewSteps;break;case"AdViewSteps":if(t.adFreeStepsAllowed){v=new Chat.Callout.AdViewSteps}else{e.bubbles[i].action=e.bubbles[i].action.replace("AdViewSteps","OpenViewSteps");e.bubbles[i].action=e.bubbles[i].action.replace("freeTrialToken","invalidatedData");v=new Chat.Callout.ViewSteps}break;case"OpenGraph":v=new Chat.Callout.OpenGraph;break;case"TapToRate":v=new Chat.Callout.TapToRate;break;case"TapForExamples":v=new Chat.Callout.TapForExamples;break;case"AutoMoreTopics":v=new Chat.Callout.AutoMoreTopics;break;case"TapToInsert":v=new Chat.Callout.TapToInsert;break;case"TapToGo":var w="";var C="";if(typeof e.bubbles[i].action==="string"){e.bubbles[i].action=JSON.parse(e.bubbles[i].action)}if(typeof e.bubbles[i].action==="object"){var g=e.bubbles[i].action;w=typeof g.actionText==="string"?g.actionText:"";C=typeof g.actionIcon==="string"?g.actionIcon:""}v=new Chat.Callout.TapToGo(w,C);break;case"TapToShare":v=new Chat.Callout.TapToShare;break;case"AppStore":v=new Chat.Callout.AppStore;break;case"StartTutorial":v=new Chat.Callout.StartTutorial;break;case"ExpertRequest":var S=false;if(typeof e.bubbles[i].action==="object"){S=e.bubbles[i].action.method==="FreeTrialExpert"}v=S?new Chat.Callout.FreeTrialExpert:new Chat.Callout.ExpertRequest;break;case"ExpertUpgradeRequest":v=new Chat.Callout.FreeTrialExpertUpgrade;break;case"TutorRequest":var x=false;if(typeof e.bubbles[i].action==="object"){x=e.bubbles[i].action.method==="FreeTrialTutor"||e.bubbles[i].action.method==="FreeTrialExpert"}v=x?new Chat.Callout.FreeTrialTutor:new Chat.Callout.TutorRequest;break;case"TutorUpgradeRequest":v=new Chat.Callout.FreeTrialTutorUpgrade;break;case"CancelTutor":v=new Chat.Callout.CancelTutor;break;case"ToggleImage":v=new Chat.Callout.ToggleImage;break;case"UpdateApp":v=new Chat.Callout.UpdateApp;break}switch(e.bubbles[i].genre){case"local":m=new Chat.Genre.Local;u=e.bubbles[i].anonUserId;s=e.bubbles[i].userId;break;case"remote":m=new Chat.Genre.Remote(null);u=e.bubbles[i].anonUserId;s=e.bubbles[i].userId;break;case"localTutor":f=e.bubbles[i].transactionId!=null?e.bubbles[i].transactionId:null;m=new Chat.Genre.LocalTutor(t.canBeEditted,f);u=e.bubbles[i].anonUserId;s=e.bubbles[i].userId;b=e.bubbles[i].avatarUrl;h=t.canBeEditted;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;break;case"localImage":f=e.bubbles[i].transactionId!=null?e.bubbles[i].transactionId:null;m=new Chat.Genre.LocalImage(v,t.hideImages,t.canBeEditted,f);u=e.bubbles[i].anonUserId;s=e.bubbles[i].userId;b=e.bubbles[i].avatarUrl;h=t.canBeEditted;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;break;case"localTyping":m=new Chat.Genre.LocalTyping;u=e.bubbles[i].anonUserId;s=e.bubbles[i].userId;b=e.bubbles[i].avatarUrl;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;break;case"remoteTutor":m=new Chat.Genre.RemoteTutor;b=e.bubbles[i].avatarUrl;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;f=e.bubbles[i].transactionId!=null?e.bubbles[i].transactionId:null;break;case"remoteImage":m=new Chat.Genre.RemoteImage(v,t.hideImages);b=e.bubbles[i].avatarUrl;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;f=e.bubbles[i].transactionId!=null?e.bubbles[i].transactionId:null;break;case"remoteTyping":m=new Chat.Genre.RemoteTyping;b=e.bubbles[i].avatarUrl;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;break;case"mathwayTutor":f=e.bubbles[i].transactionId!=null?e.bubbles[i].transactionId:null;m=new Chat.Genre.Mathway(v,c);h=t.canBeEditted;d=e.bubbles[i].roomId!=null?e.bubbles[i].roomId:null;break;case"advert":m=new Chat.Genre.Advert;break;case"nativead":m=new Chat.Genre.NativeAd;break;case"loading":m=new Chat.Genre.Loading(v);b=e.bubbles[i].avatarUrl;break;case"loading-tutor":m=new Chat.Genre.LoadingTutor(v);b=e.bubbles[i].avatarUrl;break;case"rating":m=new Chat.Genre.Rating(v,e.bubbles[i].action);break;case"greeting":case"freetrial":case"notice":case"error":m=new Chat.Genre.Mathway(v);m.type=e.bubbles[i].genre;break;case"autoresolve":m=new Chat.Genre.Mathway(v,c);m.type="autoresolve";d=e.bubbles[i].roomId!==null?e.bubbles[i].roomId:null;break;case"message":m=new Chat.Genre.Mathway(v,c);m.type="message";d=e.bubbles[i].roomId!==null?e.bubbles[i].roomId:null;break;case"mathway":d=e.bubbles[i].roomId!==null?e.bubbles[i].roomId:null;m=new Chat.Genre.Mathway(v,c);break;case"survey":m=new Chat.Genre.Survey(v,e.bubbles[i].action,e.bubbles[i].action.params.surveyID);break;case"appstore":m=new Chat.Genre.Appstore(v,e.bubbles[i].action,e.bubbles[i].action.params.appstoreString);y=e.bubbles[i].action.params.appstoreString;break;default:m=new Chat.Genre.Mathway(v);break}if(e.bubbles[i].id!=null){o=e.bubbles[i].id}n.push(new Chat.Bubble({anonUserId:u,content:e.bubbles[i].content,extraClass:l,id:o,sessionId:e.bubbles[i].sessionId,solutionId:e.bubbles[i].solutionId,subject:t.subject,timestamp:e.bubbles[i].timestamp,typeset:e.bubbles[i].typeset,userId:s,avatarUrl:b,roomId:d,transactionId:f,canBeEditted:h,appstoreString:y,fromLoggedInUser:t.fromLoggedInUser,testContext:p},e.bubbles[i].action,m))}if(t.insertNewer)this.bubbles.prepend(n);else this.bubbles.append(n)};Chat.Manager.prototype.render=function(e){var t=this;e=Util.Extend({cullNewer:true,immediate:false,postRender:null},e||{});var r=[];var n=[];var i=typeof e.postRender==="function"?true:false;this.bubbles.forEach(function(i,a){if(i.sessionId!==null&&a!==null&&a.timestamp+t.separatorTime<i.timestamp)i.separator=true;if(i.genre.type==="greeting"&&a!==null){i.timestamp=App.StartTime+10;i.separator=true}if(a!==null){var o=false;if(i.separator===false&&i.genre.type===a.genre.type){var s=t.isRemoteBubble(i.genre.type);if(s&&i.userId===a.userId)o=true;if(!s)o=true}if(o){if(a.position==="single"){a.setPosition("top");i.setPosition("bottom")}else if(a.position==="bottom"){a.setPosition("middle");i.setPosition("bottom")}}i.roomId=i.roomId==0?null:i.roomId;a.roomId=a.roomId==0?null:a.roomId;i.timestamp=i.timestamp==null?Date.parse(new Date):i.timestamp;if(i.roomId!==null&&(a.roomId===null||i.roomId!==a.roomId)){var u=t.separatorDate(i.timestamp);if(u){i.separator=true;i.separatorText="Live Expert Session Started ("+Util.formatDateWithTime(u)+")"}}else if(i.roomId===null&&a.roomId!==null){var l=t.separatorDate(i.timestamp);if(l){i.separator=true;i.separatorText="Live Expert Session Ended ("+Util.formatDateWithTime(l)+")"}}}if(i.element===null){t.insertInPlace(i.create(),i.sequence);if(i.separator===true&&a!==null){if(a.position==="top"){a.setPosition("single");if(i.position==="bottom")i.setPosition("single");else i.setPosition("top")}else if(a.position==="middle"){a.setPosition("bottom");if(i.position==="bottom")i.setPosition("single");else i.setPosition("top")}}if(i.typeset===true){r.push(i.element)}else{Util.AddClass("rendered",i.element)}if(e.immediate){n.push(i)}else{if(typeof e.postRender==="function"){i.postRender=e.postRender}t.queue.push(i)}}i.update()});var a=function(){for(var r=0,i=n.length;r<i;r++){t.queue.render(n[r])}if(typeof e.postRender==="function"){e.postRender.apply(this)}};this.bubbles.cull(e.cullNewer);if(r.length>0){MathJax.Hub.Queue(["Typeset",MathJax.Hub,r,function(){for(var t=0,n=r.length;t<n;t++){Util.AddClass("rendered",r[t])}if(e.immediate)a()}])}else{if(e.immediate)a()}};Chat.Manager.prototype.evaluatePositions=function(){var e=this;this.bubbles.forEach(function(t,r){if(!r){t.separator=false;t.setPosition("single");t.update();return}t.separator=false;r.separator=false;if(t.sessionId!==null&&r.timestamp+e.separatorTime<t.timestamp)t.separator=true;if(t.genre.type==="greeting"){t.separator=true}t.roomId=t.roomId==0?null:t.roomId;r.roomId=r.roomId==0?null:r.roomId;t.timestamp=t.timestamp==null?Date.parse(new Date):t.timestamp;if(t.roomId!==null&&(r.roomId===null||t.roomId!==r.roomId)){var n=e.separatorDate(t.timestamp);if(n){t.separator=true;t.separatorText="Tutor Session Started ("+Util.formatDateWithTime(n)+")"}}else if(t.roomId===null&&r.roomId!==null){var i=e.separatorDate(t.timestamp);if(i){t.separator=true;t.separatorText="Tutor Session Ended ("+Util.formatDateWithTime(i)+")"}}if(t.genre.type===r.genre.type&&t.roomId===r.roomId){if(r.position==="single"){r.setPosition("top");t.setPosition("bottom")}else if(r.position==="bottom"){r.setPosition("middle");t.setPosition("bottom")}}else{t.setPosition("single")}t.update()})};Chat.Manager.prototype.insertInPlace=function(e,t){var r=false;for(var n=0,i=this.element.children.length;n<i;n++){var a=this.element.children[n];var o=parseInt(a.getAttribute("data-sequence"));if(t<o){this.element.insertBefore(e,a);r=true;break}}if(!r){this.element.appendChild(e)}};Chat.Manager.prototype.getOldestWithSessionId=function(){for(var e=0,t=this.bubbles.items.length;e<t;e++){if(this.bubbles.items[e].sessionId!==null)return this.bubbles.items[e]}return null};Chat.Manager.prototype.getNewestWithSessionId=function(){for(var e=0,t=this.bubbles.items.length-1;e<t;t--){if(this.bubbles.items[t].sessionId!==null)return this.bubbles.items[t]}return null};Chat.Manager.prototype.getBubbleBySessionId=function(e){for(var t=0,r=this.bubbles.items.length;t<r;t++){if(this.bubbles.items[t].sessionId===e)return this.bubbles.items[t]}return null};Chat.Manager.prototype.removeNewerThanSessionId=function(e){this.bubbles.removeNewerThan(e)};Chat.Manager.prototype.isTutoringBubble=function(e){switch(e){case"localTutor":case"localImage":case"localTyping":case"remoteTutor":case"remoteImage":case"remoteTyping":case"mathwayTutor":return true;default:return false}};Chat.Manager.prototype.isRemoteBubble=function(e){switch(e){case"remote":case"remoteTutor":case"remoteImage":case"remoteTyping":case"mathwayTutor":return true;default:return false}};Chat.Manager.prototype.separatorDate=function(e){var t=parseInt(e);if(Util.IsNumber(t)){var r=new Date(parseInt(t));if(r.getFullYear()!==1970){return r}}return null};Chat.Queue=function(e,t){this.element=e||null;this.options=Util.Extend({duration:300},t||{});this.bubbles=[];this.timerHandler=null};Chat.Queue.prototype.push=function(e){this.bubbles.push(e);if(this.timerHandler===null){this.iterate()}};Chat.Queue.prototype.render=function(e){if(e.element!=null){e.element.style.display="";e.element.style.opacity=1}e.onRender();$.publish("layout/chat")};Chat.Queue.prototype.iterate=function(){var e=this;this.animate(this.bubbles[0]);this.bubbles.splice(0,1);e.timerHandler=setInterval(function(){if(e.bubbles.length>0){e.animate(e.bubbles[0]);e.bubbles.splice(0,1)}else{clearInterval(e.timerHandler);e.timerHandler=null;setTimeout(function(){$.publish("ChatLibrary/QueueComplete")},50)}},e.options.duration)};Chat.Queue.prototype.animate=function(e){if(e.element===null)return;if(typeof e.postRender==="function"){e.postRender.call(this)}$.publish("layout/chat");if(App.isAndroidDevice){e.element.style["transform"]="scaleX(1) scaleY(1)";e.element.style["opacity"]="1";e.onRender();$.publish("layout/chat");if(e.element!==null){Chat.Queue.FixBubble(e)}return}if(false){e.element.style.transform="scaleX(0) scaleY(0)"}else{$.Velocity(e.element,{scaleX:0,scaleY:0},{duration:0})}$.Velocity(e.element,{opacity:1,scaleX:1,scaleY:1},{duration:this.options.duration,progress:function(){$.publish("layout/chat")},complete:function(){e.onRender();setTimeout(function(){if(e.element!==null){Chat.Queue.FixBubble(e)}},50)},easing:[0,.5,.75,1.25]})};Chat.Queue.FixBubble=function(e){e.element.style["-webkit-backface-visibility"]="hidden";e.element.style["-webkit-transform"]="translateZ(0) scale(1.0, 1.0)";for(var t=0,r=e.element.children.length;t<r;t++){e.element.children[t].style["-webkit-backface-visibility"]="hidden";e.element.children[t].style["-webkit-transform"]="translateZ(0) scale(1.0, 1.0)"}};var Tutor=function(e){var t=false;var r=false;var n=false;var i=false;var a={};a.monitor=null;a.Connect=function(){Tutor.Hub.connect();t=true};a.Disconnect=function(){Tutor.Hub.disconnect();t=false};a.isConnected=function(){return t};var o=function(t,i){WebStorage.tutorRoomId.set(t.RoomId);Tutor.Typing.ListenForTyping();WebStorage.tutorRoleInRoom.set(i);WebStorage.tutorRatingPending.set(false);r=true;n=false;Tutor.Requester.stop();Tutor.RoomTimer.Restart();a.monitor=new Tutor.ConnectionMonitor;a.monitor.Start();e.publish("Tutor/StartRoom");if(a.IsFromFreeTrial()){e.publish("Tutor/RemoveFreeTrial")}};var s=function(){var t={};if(Auth.getChatUserType()===ChatUserType.Tutor){t.isTutor=true;t.showCamera=true}else{t.tutorName=WebStorage.tutorName.get()}e.publish("Tutor/StartRoom");e.publish("Tutor/InviteAccepted",[t]);Tutor.Requester.stop();Tutor.Typing.ListenForTyping();r=true;n=false;Tutor.RoomTimer.Restart()};var u=function(){WebStorage.tutorRoomId.remove();WebStorage.tutorRatingPending.remove();Tutor.Typing.StopListening();WebStorage.tutorRoleInRoom.remove();r=false;Tutor.RoomTimer.Stop();e.publish("tutor/leaveRoom");Tutor.Requester.start()};a.getRoomId=function(){return WebStorage.tutorRoomId.get()};a.getRoleInRoom=function(){var e=WebStorage.tutorRoleInRoom.get();if(typeof e==="undefined"||e===null)return null;return parseInt(WebStorage.tutorRoleInRoom.get())};a.inChatRoom=function(){return r};a.invitePending=function(){return n};a.setPendingInvite=function(){n=true};a.endInvite=function(){n=false};a.RequestTutorInvite=function(t){Tutor.Notifier.notify();t.isInvite=false;WebStorage.tutorInvite.set(t);t.isInvite=true;if(e(".popup-container").length>0){setTimeout(function(){Popup.showTutorInvite(t,true)},Popup.transitionTimeout)}else Popup.showTutorInvite(t,true)};a.PlaceInLineResponse=function(t){var r=e(".ch-bubble[genre=loading-tutor]");if(r.length===0){return}var n=r.find(".ch-bubble-content-place");if(t<=1){n.hide();return}var i="th";if(t%10===1&&t!==11)i="st";else if(t%10===2&&t!==12)i="nd";else if(t%10===3&&t!==13)i="rd";n.text(" (you are "+t+i+" in line)").show()};a.TutorRequestCreated=function(e){WebStorage.tutorRequestId.set(e)};a.CancelTutorInvite=function(t){e.publish("Tutor/InviteCancelled");e.publish("ChatLibrary/ClearTutorLoading");WebStorage.tutorRoomSubject.remove();var r=Strings.Tutor.InvitationNotAvailable;switch(t.type){case 1:r=t.name+" "+Strings.Tutor.InvitationOtherTutor;break;case 2:r=Strings.Tutor.InvitationCancelled;break;case 3:r=Strings.Tutor.InvitationTimedOut;break}e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:r,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.CancelStudentRequest=function(){a.endInvite();WebStorage.tutorRequestPending.remove();WebStorage.tutorRequestId.remove();e.publish("ChatLibrary/ClearTutorLoading");e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.NoTutorsAvailable,genre:"mathway",typeset:false,testContent:BubbleContext.TutorBubble})]}])};a.CancelRequestUserFraud=function(){a.endInvite();WebStorage.tutorRequestPending.remove();WebStorage.tutorRequestId.remove();e.publish("ChatLibrary/ClearTutorLoading");e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.TooManyRequests,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.CancelRequestAlreadyInRoom=function(){a.endInvite();WebStorage.tutorRequestPending.remove();WebStorage.tutorRequestId.remove();e.publish("ChatLibrary/ClearTutorLoading");e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.AlreadyInRoom,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.CancelRequestMissedRoom=function(){var t=WebStorage.tutorRequestPending.get();if(t!==null&&t!==undefined&&t==="true"){a.endInvite();WebStorage.tutorRequestPending.remove();WebStorage.tutorRequestId.remove();e.publish("ChatLibrary/ClearTutorLoading");e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.MissedRoom,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])}};a.TutorRoomError=function(){e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:"There was a problem connecting you to the student.  The request has been terminated.",genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.WaitingForStudent=function(){e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.WaitingForStudent,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.Messages=function(t){Tutor.Typing.ClearTypingBubble();var r={canBeEditted:Auth.getChatUserType()===ChatUserType.Tutor?true:false};if(Auth.userstate.userId!==t.userId){if(Auth.hasRole(UserRoles.Tutor)){Tutor.Notifier.newMessage()}if(Component.TutorNotifier.NewMessages()){r["postRender"]=null}}e.publish("ChatLibrary/Insert",[{bubbles:t.messages},r])};a.TutorAcceptedInvite=function(t){var r=t.chatState;o(r,ChatUserType.Student);WebStorage.tutorName.set(r.FirstName);WebStorage.displayedFinal.remove();WebStorage.tutorRequestPending.remove();WebStorage.tutorRequestId.remove();e.publish("Tutor/InviteAccepted",[{tutorName:r.FirstName}]);e.publish("ChatLibrary/ClearTutorLoading",[{removeOrigBubble:true}])};a.TutorStartRoom=function(t){var r=t.currentSubject.toLowerCase().replace("-","");Popup.hide();Tutor.Notifier.reset();var n=WebStorage.tutorRoomSubject.get();if(n!==null&&r!==n){WebStorage.tutorRoomId.set(t.RoomId);WebStorage.tutorRoleInRoom.set(ChatUserType.Tutor);e.publish("Tutor/ChangeSubject",[n])}e.publish("Tutor/InviteAccepted",[{isTutor:true,showCamera:true}]);o(t,ChatUserType.Tutor);e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.ConnectedMessageForTutor,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])};a.TutorResumeRoom=function(e){var t=e.toLowerCase().replace("-","");var r=WebStorage.tutorRoomSubject.get();if(r!==null&&t!==r){Util.Redirect(App.urlPrefix+r);return}else{s()}};a.ShowRateTutor=function(e){WebStorage.tutorRatingPending.set(true);Popup.showRateTutor(e)};a.RoomFinishedTutor=function(t){t=Util.Extend({isStudent:false,creditAcknowledgement:false,studentId:0,roomId:0},t);if(a.monitor!==null){a.monitor.Stop();a.monitor=null}if(document.getElementById("tutor-invite-container")!==null){Popup.hideAll(true)}if(t.isStudent){e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.StudentLeavesRoom,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])}else{e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:Strings.Tutor.TutorEndsSession,genre:"mathway",typeset:false,testContext:BubbleContext.TutorBubble})]}])}if(t.creditAcknowledgement){API.consumeCredit(t.studentId,t.roomId,CreditTransactionType.Consumed);Popup.showCreditConsume(function(e){if(e!==undefined)API.consumeCredit(t.studentId,t.roomId,e);Tutor.Hub.tutorAnswersCreditDialog(ChatRoomLeaveReason.Manual);Tutor.Hub.tutorAvailable();u()})}else{u();Tutor.Hub.tutorAvailable()}};a.RoomFinishedStudent=function(){u();if(a.getRoleInRoom()!==ChatUserType.Tutor)Tutor.Disconnect();l()};a.UserStartedTyping=function(e){Tutor.Typing.AddTypingBubble(e);Tutor.RoomTimer.Restart()};a.ContinueTimer=function(t){e.publish("dialog/close",["confirmDialog"]);Tutor.RoomTimer.Restart()};a.UserStoppedTyping=function(e){if(!e.Local)Component.TutorNotifier.UserStoppedTyping();Tutor.Typing.ClearTypingBubble()};a.UserDisconnected=function(){var t={};var r=Chat.CreateBubble({content:Strings.Tutor.StudentDisconnect,genre:"mathway",typset:false,roomId:parseInt(Tutor.getRoomId()),testContext:BubbleContext.TutorBubble});if(Component.TutorNotifier.NewMessages()){t["postRender"]=null}e.publish("tutor/disconnected")};a.StudentReconnected=function(){if(Tutor.waitingForReconnect){var t={};var r=Chat.CreateBubble({content:Strings.Tutor.StudentReconnect,genre:"mathway",typset:false,roomId:parseInt(Tutor.getRoomId()),testContext:BubbleContext.TutorBubble});if(Component.TutorNotifier.NewMessages()){t["postRender"]=null}}e.publish("tutor/reconnected")};a.MessageWasRemoved=function(t,r){e.publish("ChatLibrary/RemoveByTransactionId",[t,r])};a.getTutorCommand=function(e){var t=ChatSolveType.Regular;switch(e){case"mathway":t=ChatSolveType.AtMathway;break;case"mwsolve":t=ChatSolveType.LocalSolve;break}return t};a.handleCameraInput=function(t){var r;var n;EXIF.getData(t,function(){n=this.exifdata;r=this.exifdata.Orientation});var i=new FileReader;i.onloadend=function(t){var o=new Image;o.src=i.result;o.onload=function(){var i=500;var s=500;var u=o.width;var l=o.height;if(r!=6){if(u>i){l*=i/u;u=i}}else{if(l>s){u*=s/l;l=s}}var c=document.createElement("canvas");c.width=u;c.height=l;var p=c.getContext("2d");p.save();var d=c.width;var f=c.style.width;var h=c.height;var m=c.style.height;if(r>1){if(r>4){c.width=h;c.style.width=m;c.height=d;c.style.height=f}switch(r){case 2:p.translate(d,0);p.scale(-1,1);break;case 3:p.translate(d,h);p.rotate(Math.PI);break;case 4:p.translate(0,h);p.scale(1,-1);break;case 5:p.rotate(.5*Math.PI);p.scale(1,-1);break;case 6:p.rotate(.5*Math.PI);p.translate(0,-h);break;case 7:p.rotate(.5*Math.PI);p.translate(d,-h);p.scale(-1,1);break;case 8:p.rotate(-.5*Math.PI);
p.translate(-d,0);break}}p.drawImage(this,0,0,u,l);p.restore();var g="t"+(new Date).getTime()+".jpg";if(e("body.apps-ios").length>0){Popup.showImageCrop(t.target.result,n,function(e){e.toBlob(function(e){API.uploadBlobImage(g,e,ImageType.Whiteboard,false,function(e){var t=e.status===1?e.value:"";a.onCapture(t)})})})}else{c.toBlob(function(e){API.uploadBlobImage(g,e,ImageType.Whiteboard,false,function(e){var t=e.status===1?e.value:"";a.onCapture(t)})})}}};i.readAsDataURL(t)};a.onCapture=function(e){var t=Chat.CreateBubble({content:e,callout:"ToggleImage",genre:"localImage",avatarUrl:Auth.userstate.avatarUrl,typeset:false,testContext:BubbleContext.TutorBubble,action:{method:"ToggleImage"}});Tutor.Hub.userSendsMessage(t)};a.IsFromFreeTrial=function(){return Auth.hasRole(UserRoles.TutoringAccess)?false:true};a.dispatchSolution=function(e,t,r){e=Chat.ConvertIntoTutorGenres(e);Actions.Do(Actions.userSendsSolution,{messages:e,solutionId:t,sendToRemote:r?true:false})};var l=function(){var t=STM.Tests.CreditPackPurchase.enabled();var r=WebStorage.displayedFinal.get();if(r)return;WebStorage.displayedFinal.set(true);var n=WebStorage.tutorCredits.get();if(n!==null)n=parseInt(n);var i=a.IsFromFreeTrial()&&(n===0||n===null);if(i)e.publish("Tutor/RemoveFreeTrial");API.chatBotTutorFinished(i,t,WebStorage.lastSubject.get(),function(t){var r=t.messages;if(t.messages&&t.messages.length>0){e.publish("ChatLibrary/Insert",[{bubbles:Util.FixupBubbleTimestamps(r)}])}})};return a}(jQuery);Tutor.Hub=function(e){var t={};const r=18e5;const n=1e4;const i=3e4;var a=null;var o=null;var s=null;var u=null;var l=false;var c="Algebra";var p;t.init=function(t){a=e.hubConnection();o=a.createHubProxy("TutorHub");c=t;a.url=App.Services.BroadcastHub+"/sockets";a.logging=false;a.disconnected(function(){l=false;w();if(v()||Auth.hasRole(UserRoles.Tutor)){setTimeout(function(){d()},5e3)}});a.connectionSlow(function(){API.logConnectionSlow()});a.error(function(e){Tutor.Disconnect()});o.on("RequestTutorInvite",function(e){Actions.Do(Actions.requestTutorInvite,DtoHelper.InviteRequest(e))});o.on("PlaceInLineResponse",function(e){Actions.Do(Actions.placeInLineResponse,e)});o.on("CancelTutorInvite",function(e){Actions.Do(Actions.cancelTutorInvite,e)});o.on("CancelStudentRequest",function(){Actions.Do(Actions.cancelStudentRequest)});o.on("TutorRoomError",function(){Actions.Do(Actions.tutorRoomError)});o.on("CancelStudentRequestUserFraud",function(){Actions.Do(Actions.cancelRequestUserFraud)});o.on("CancelRequestAlreadyInRoom",function(){Actions.Do(Actions.cancelRequestAlreadyInRoom)});o.on("CanceRequestMissedRoom",function(){Actions.Do(Actions.cancelRequestMissedRoom)});o.on("TutorRequestCreated",function(e){Actions.Do(Actions.tutorRequestCreated,e)});o.on("TutorAcceptedInvite",function(e,t,r){clearTimeout(s);s=null;Actions.Do(Actions.tutorAcceptedInvite,{chatState:e,welcome:t,forceRefresh:r})});o.on("TutorStartRoom",function(e){Actions.Do(Actions.tutorStartRoom,{currentSubject:c,RoomId:e})});o.on("WaitingForStudent",function(){Actions.Do(Actions.waitingForStudent)});o.on("Messages",function(e,t){Actions.Do(Actions.messages,{messages:e,userId:t})});o.on("ShowRateTutor",function(e){Actions.Do(Actions.showRateTutor,e)});o.on("RoomFinishedTutor",function(e){Actions.Do(Actions.roomFinishedTutor,JSON.parse(e))});o.on("RoomFinishedStudent",function(e){Actions.Do(Actions.roomFinishedStudent,e)});o.on("UserStartedTyping",function(e){var t=DtoHelper.StartTyping(e);Actions.Do(Actions.userStartedTyping,t)});o.on("UserStoppedTyping",function(e){var t=DtoHelper.StopTyping(e);Actions.Do(Actions.userStoppedTyping,t)});o.on("ContinueTimer",function(){Actions.Do(Actions.continueTimer)});o.on("UserDisconnected",function(e){Actions.Do(Actions.userDisconnected)});o.on("ResumeRoom",function(e){Actions.Do(Actions.tutorResumeRoom,c);var t=WebStorage.tutorRatingPending.get();if(t==="true"){Tutor.RoomFinishedStudent()}});o.on("StudentReconnected",function(){Actions.Do(Actions.studentReconnected)});o.on("MessageWasRemoved",function(e){Actions.Do(Actions.messageWasRemoved,e)});o.on("RoomPing",function(){var e=WebStorage.tutorRoomId.get();o.invoke("PingReply",e)});o.on("PingReceived",function(){if(Tutor.monitor!==null)Tutor.monitor.PingReceived()});e.subscribe("TutorHub/Connected",function(){e.publish("apps/loadTutorHistory")});if(Auth.getChatUserType()===ChatUserType.Tutor){d()}else if(v()){d()}};var d=function(e){if(!a)return;if(e!==true)if(l){g();return}a.qs={userId:Auth.userstate.userId,anonUserId:WebStorage.anonUserId.get(),deviceString:App.deviceString(),isTutor:Auth.hasRole(UserRoles.Tutor)};if(App.Services.BroadcastHub.indexOf("mathway")>=0){a.start().done(function(){f()})}else{a.start().done(function(){Debug.log("Connected, transport = "+a.transport.name);f()})}};var f=function(){l=true;y();e.publish("TutorHub/Connected");g();if(App.isMobile){window.removeEventListener("focus",h);window.addEventListener("focus",h);e.subscribe("apps/phoneWake",function(){Tutor.Disconnect()},true)}};function h(t){if(t.type==="focus"){if(Tutor.inChatRoom()){e.publish("chat/clear");e.publish("apps/loadTutorHistory")}d(true)}}var m=function(){if(!a)return;if(!l)return;a.stop();l=false;e.publish("TutorHub/Disconnected")};var g=function(){if(v()){var e=WebStorage.tutorRoomId.get();o.invoke("UserTriesResumingRoom",e,Auth.userstate.userId)}else if(b()){o.invoke("UserChecksRequestStatus",WebStorage.tutorRequestId.get())}};var v=function(){var e=WebStorage.tutorRoomId.get();return e!==null&&e!==undefined};var b=function(){var e=WebStorage.tutorRequestPending.get();return e!==null&&e!==undefined&&e==="true"};var y=function(){Tutor.Hub.connectionPing();p=setInterval(function(){Tutor.Hub.connectionPing()},i)};var w=function(){clearInterval(p)};t.connect=function(e){d(e)};t.disconnect=function(){m()};t.connectionPing=function(){o.invoke("ConnectionPing")};t.tutorAvailable=function(){o.invoke("TutorAvailable")};t.studentRequestsTutor=function(t){var i=e(".apps-android #viewsteps-container").length>0;if(i){JavascriptInterface.StudentRequestsTutor(JSON.stringify(t));return}if(Auth.isAnonymousSubscriber()&&(e(".apps-android").length>0||e(".apps-ios").length>0)){Actions.Do(Actions.showUpgrade);return}t.AnonUserId=WebStorage.anonUserId.get();if(Tutor.inChatRoom()||Tutor.invitePending())return;var a=function(t){Tutor.setPendingInvite();Popup.hide();s=setTimeout(function(){Actions.Do(Actions.studentRequestTimesOut)},r);u=setInterval(function(){Tutor.Hub.studentRequestsPlaceInLine()},n);var i=Chat.CreateBubble({content:Strings.Tutor.FindingTutor,genre:"loading-tutor",typeset:false,testContext:BubbleContext.Loading});i.callout="CancelTutor";i.action={method:"CancelTutor",params:false};e.publish("ChatLibrary/Insert",[{bubbles:[i]},{immediate:false,fromUser:false}]);e.publish("ChatLibrary/ScrollBottom");WebStorage.tutorRequestPending.set("true");o.invoke("StudentRequestsTutor",t)};if(App.IsApps)Actions.Do(Actions.chatTapped);else{Actions.Do(Actions.hideKeyboard)}Popup.showTutorPreSession(false,t,function(t){Tutor.Disconnect();var r=e.subscribe("TutorHub/Connected",function(){a(t);e.unsubscribe(r)});Actions.Do(Actions.tutorConnect)})};t.studentRequestsPlaceInLine=function(){Tutor.Hub.connect(true);o.invoke("StudentRequestsPlaceInLine",Auth.userstate.userId)};t.studentCancelsRequest=function(e){Tutor.endInvite();clearTimeout(s);s=null;if(!l)return;o.invoke("StudentCancelsRequest",e)};t.studentRequestTimesOut=function(e){if(!l)return;Tutor.endInvite();clearTimeout(s);s=null;o.invoke("StudentRequestTimesOut",e)};t.tutorDeclineInvite=function(e){if(!l)return;o.invoke("TutorDeclineInvite",e)};t.tutorAcceptsInvite=function(e){if(!l)return;o.invoke("TutorAcceptsInvite",e)};t.tutorWelcomesStudent=function(e){if(!l)return;o.invoke("TutorWelcomesStudent",e)};t.leaveRoom=function(e){if(!l)return;var t=Tutor.getRoleInRoom();var r=DtoHelper.ChatRoomUserConnection({UserId:Auth.userstate.userId,Type:t,RoomId:Tutor.getRoomId(),AnonUserId:WebStorage.anonUserId.get()});o.invoke("UserLeavesRoom",r,e)};t.tutorAnswersCreditDialog=function(e){if(!l)return;var t=Tutor.getRoleInRoom();var r=DtoHelper.ChatRoomUserConnection({UserId:Auth.userstate.userId,Type:t,RoomId:Tutor.getRoomId(),AnonUserId:WebStorage.anonUserId.get()});o.invoke("TutorAnswersCreditDialog",r,e)};t.userSendsMessage=function(t){if(!l)return;e.publish("Tutor/PreSendingMessages");o.invoke("UserSendsMessage",DtoHelper.ChatUserConnection({UserId:Auth.userstate.userId,Type:Tutor.getRoleInRoom(),DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),RoomId:Tutor.getRoomId(),Subject:c}),t).done(function(){e.publish("Tutor/PostSendingMessages")})};t.userSendsSolution=function(t){if(!l)return;e.publish("Tutor/PreSendingMessages");o.invoke("UserSendsSolution",DtoHelper.ChatUserConnection({UserId:Auth.userstate.userId,Type:Tutor.getRoleInRoom(),DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),RoomId:Tutor.getRoomId(),Subject:c}),t.messages,t.sendToRemote).done(function(){e.publish("Tutor/PostSendingMessages")})};t.userStartsTyping=function(){if(!l)return;o.invoke("UserStartsTyping",DtoHelper.ChatRoomUserConnection({UserId:Auth.userstate.userId,Type:Auth.getChatUserType(),RoomId:Tutor.getRoomId(),AnonUserId:WebStorage.anonUserId.get(),AvatarURL:Auth.userstate.avatarUrl}))};t.userStopsTyping=function(){if(!l)return;o.invoke("UserStopsTyping",DtoHelper.ChatRoomUserConnection({UserId:Auth.userstate.userId,Type:Auth.getChatUserType(),RoomId:Tutor.getRoomId(),AnonUserId:WebStorage.anonUserId.get()}))};e.subscribe("subject/set",function(e){c=e});e.subscribe("ChatLibrary/ClearTutorLoading",function(){clearInterval(u)});t.continueMyTutorConnections=function(){if(!l)return;o.invoke("ContinueMyTutorConnections",DtoHelper.ChatRoomUserConnection({UserId:Auth.userstate.userId,Type:Auth.getChatUserType(),RoomId:Tutor.getRoomId(),AnonUserId:WebStorage.anonUserId.get()}))};t.removeMessage=function(e){o.invoke("RemoveMessage",DtoHelper.RemoveMessage({TransactionId:e,RoomId:Tutor.getRoomId(),UserId:Auth.userstate.userId}))};t.pingRoom=function(){o.invoke("RoomPing",Tutor.getRoomId())};t.pingReply=function(){o.invoke("PingReply",Tutor.getRoomId())};t.flagRoom=function(){o.invoke("TutorFlagsRoom",Tutor.getRoomId())};t.hubConnection=function(){return a};var C=function(){var t=document.getElementsByClassName("ch-solution-top");if(t.length>0){e.publish("ChatLibrary/Scroll",[t[t.length-1],true])}};return t}(jQuery);Tutor.ConnectionMonitor=function(){this.interval=3e3;this.pingInterval=null;this.alive=true;this.connected=true;this.Start=function(){var e=this;if(Tutor.getRoleInRoom()==ChatUserType.Tutor){e.pingInterval=setInterval(function(){if(!e.alive&&e.connected){Actions.Do(Actions.userDisconnected);e.connected=false}e.alive=false;Tutor.Hub.pingRoom()},e.interval)}};this.Stop=function(){var e=this;clearTimeout(e.pingInterval);e.pingInterval=null};this.PingReceived=function(){var e=this;e.alive=true;if(!e.connected){Actions.Do(Actions.studentReconnected);e.connected=true}}};Tutor.Notifier=function(e){var t=function(e){this.id=e;this.buffer=null;this.loaded=false};var r=window.AudioContext||window.webkitAudioContext||false;const n="audio/";const i=["slow-spring-board","new-message"];const a="mp3";var o={};var s=document.title;var u="Tutor Session Available";var l="New Messages";var c=s;var p=1e3;var d;var f=false;var h=r?new r:null;var m=true;function g(e){document.title=e}function v(e){c=c==s?e:s}var b=function(e){return"/"+n+e+"."+a};var y=function(){if(!h)return;i.forEach(function(e){o[e]=new t(e);var r=new XMLHttpRequest;r.open("GET",b(e),true);r.responseType="arraybuffer";r.onload=function(){h.decodeAudioData(r.response,function(t){o[e].buffer=t;o[e].loaded=true})};r.send()})};var w=function(e){document.getElementById("notification-sound").innerHTML='<audio autoplay="autoplay"><source src="'+e+'" type="audio/mpeg" /></audio>'};var C=function(e){if(!h){w(b(e));return}var t=o[e];if(!t.loaded||t.buffer===null)return;var r=h.createBufferSource();r.buffer=t.buffer;var n=h.createGain();n.gain.value=1;n.connect(h.destination);r.connect(n);r.start(0)};e.subscribe("window/focus",function(){m=true;Tutor.Notifier.reset()});e.subscribe("window/blur",function(){m=false});return{init:function(){y()},notify:function(){if(f===true)return;f=true;clearInterval(d);C("slow-spring-board");g(u);d=setInterval(function(){v(u);g(c)},p)},reset:function(){clearInterval(d);g(s);f=false},newMessage:function(){if(m===true){return}if(f===true)return;f=true;clearInterval(d);C("new-message");g(l);d=setInterval(function(){v(l);g(c)},p)}}}(jQuery);Tutor.RoomTimer=function(e){var t={};var r={interval:3e5,dialogInterval:3e4,timeout:null,dialogTimeout:null};t.Restart=function(){if(Tutor.getRoleInRoom()==ChatUserType.Tutor){if(r.timeout!==null)t.Stop();r.timeout=setTimeout(function(){t.Stop();n()},r.interval)}};t.Stop=function(){clearTimeout(r.timeout);r.timeout=null};var n=function(){r.dialogTimeout=setTimeout(function(){i();t.Stop();Popup.hide();Actions.Do(Actions.leaveRoom,ChatRoomLeaveReason.Timeout)},r.dialogInterval);Popup.showYesNo(Strings.Tutor.ContinueMessage,function(){i();t.Restart();Tutor.Hub.continueMyTutorConnections()},function(){i();t.Stop();Actions.Do(Actions.leaveRoom,ChatRoomLeaveReason.Manual)})};var i=function(){clearTimeout(r.dialogTimeout);r.dialogTimeout=null};return t}(jQuery);Tutor.Requester=function(e){var t={};var r=null;var n=12e4;var i=function(){if(Auth.getChatUserType()==ChatUserType.Tutor&&Auth.userstate.isAvailable){Tutor.Hub.tutorAvailable()}};t.start=function(){if(r)t.stop();i();r=setInterval(function(){i()},n)};t.stop=function(){if(r){clearInterval(r);r=null}};return t}();Tutor.Typing=function(e){var t={};var r={interval:5e3,lastMessage:0,editorHandle:null,startTimer:null,stopTimer:null,inFlight:false,preHandle:null,postHandle:null};var n={handle:null,timeout:1e4,active:false};t.ListenForTyping=function(){r.editorHandle=e.subscribe("editorContentUpdate",function(){o();i()});e.subscribe("Tutor/PreSendingMessages",function(){r.inFlight=true});e.subscribe("Tutor/PostSendingMessages",function(){r.inFlight=false;a();u()})};t.StopListening=function(){e.unsubscribe(r.editorHandle);r.editorHandle=null;a();o()};t.AddTypingBubble=function(t){if(n.active)return;var r={};if(!t.Local&&Component.TutorNotifier.UserIsTyping()){r["postRender"]=null}e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({genre:t.Local?"localTyping":"remoteTyping",avatarUrl:t.AvatarURL,roomId:t.RoomId,testContext:BubbleContext.TutorBubble})]},r]);l();n.active=true};t.ClearTypingBubble=function(){c();e.publish("Tutor/ClearTyping");n.active=false};var i=function(){if(r.inFlight)return;if(r.startTimer!==null)return;var e=Util.TimeStamp()-r.lastMessage;if(e>=r.interval){s()}else{r.startTimer=setTimeout(function(){s();a()},e)}};var a=function(){if(r.startTimer!==null){clearTimeout(r.startTimer);r.startTimer=null}Tutor.RoomTimer.Restart()};var o=function(){if(r.stopTimer!==null){clearTimeout(r.stopTimer);r.stopTimer=null}Tutor.RoomTimer.Restart()};var s=function(){o();Actions.Do(Actions.userStartsTyping);r.lastMessage=Util.TimeStamp();r.stopTimer=setTimeout(function(){u()},r.interval)};var u=function(){Actions.Do(Actions.userStopsTyping);o()};var l=function(){c();n.handle=setTimeout(function(){t.ClearTypingBubble()},n.timeout)};var c=function(){if(n.handle!==null){clearTimeout(n.handle);n.handle=null}};return t}(jQuery);Component.ChatWeb=function(e){e=Util.Extend({subject:"Algebra",affiliate:false,sayHello:false,deferHistory:false,adDebug:false,rateDebug:false,preset:false,splice:false,suppressGreeting:false,shouldCloseDrawer:function(){return true},ignoreSubjectChange:false,enableAdTest:false},e||{});var t=document.querySelector("#chat-area");var r=document.querySelector("#chat-area .cell");var n=document.getElementById("chat-inner");var i=$.query("#chat-loader-upper");var a=$.query("#chat-loader-lower");var o=2e3;var s=1e3;var u=App.isAndroidDevice?12:18;var l=App.isAndroidDevice?30:50;var c=0;var p=new Chat.Manager(n,new Chat.Queue(r),new Chat.Collection({limit:l,startingSequence:s}));var d=false;var f=false;if(e.suppressGreeting)f=true;var h=false;GraphBuilder.widthFn=function(){var e=$(n).width()-80;if(e>450)e=450;return e};$.subscribe("ChatLibrary/Insert",function(t,r){if(typeof t.bubbles==="undefined"||t.bubbles.length===0)throw Error("Invalid data passed into chat library");if(t.bubbles.length>1){if(b(t.bubbles)){p.bubbles.removeAllOfGenre("advert");p.bubbles.removeAllOfGenre("nativead");p.evaluatePositions()}if(y(t.bubbles)){p.bubbles.removeAllWithAction("FreeTrialExpert");p.evaluatePositions()}}r=Util.Extend({commitMessages:false,insertNewer:true,solutionId:null,isHistory:false,isPreset:false,immediate:false,logInputs:false,canBeEditted:false,postRender:function(){M()}},r||{});if(r.logInputs){Debug.log(t,r)}if(S.atBottom===false&&r.isHistory===false){if(Tutor.inChatRoom())return;S.isLoading=true;S.atTop=false;S.atBottom=true;e.preset=true;e.deferHistory=true;d=false;p.bubbles.empty();$.publish("ChatLibrary/StateCheck",[true])}if(App.IsApps&&r.isHistory===false)t.bubbles=v(t.bubbles);for(var n=0;n<t.bubbles.length;n++){if(["TapToRate","AutoMoreTopics","ExpertRequest","TutorRequest","ViewSteps","ViewTrialSteps","AdViewSteps"].indexOf(t.bubbles[n].callout)===-1){var i=null;if(typeof t.bubbles[n].action==="string"&&t.bubbles[n].action!==""){i=JSON.parse(t.bubbles[n].action)}else if(t.bubbles[n].action&&typeof t.bubbles[n].action!=="string"){i=t.bubbles[n].action}if(i&&i.params&&i.params.asciiMath){t.bubbles[n].content=Editor.AsciiToMathml(i.params.asciiMath)}}}p.parseInput(t,{subject:e.subject,insertNewer:r.insertNewer,hideImages:r.isHistory,canBeEditted:r.canBeEditted,fromLoggedInUser:Auth.isLoggedIn(),adFreeStepsAllowed:App.IsApps&&App.isAndroidDevice?true:false});if(r.solutionId!==null){p.bubbles.removeAllOfGenre("loading")}p.render({cullNewer:r.insertNewer?false:true,immediate:r.immediate,postRender:r.postRender});GraphBuilder.process();if(p.bubbles.count()>=l){S.hasReachedLimit=true}if(e.preset===true&&r.solutionId!==null){var a=$.subscribe("ChatLibrary/QueueComplete",function(){if(e.deferHistory===true){f=true;w(e.subject,false);e.deferHistory=false;e.preset=false}$.unsubscribe(a)})}});$.subscribe("ChatLibrary/Bridge",function(e,t){if(e!=null&&ChatBridge.hasOwnProperty(e)){if(t!=null){ChatBridge[e].call(this,t)}else{ChatBridge[e].call(this)}}});$.subscribe("ChatLibrary/CreateAutoReSolve",function(){p.bubbles.removeAllOfGenre("autoresolve");p.evaluatePositions()});$.subscribe("ChatLibrary/ClearLoading",function(){p.bubbles.removeAllOfGenre("loading");p.evaluatePositions()});$.subscribe("ChatLibrary/ClearTutorLoading",function(e){if(typeof e==="undefined"){e={removeOrigBubble:false}}if(e.removeOrigBubble===true){p.bubbles.removeAllWithAction("FreeTrialExpert")}p.bubbles.removeAllOfGenre("loading-tutor");p.evaluatePositions()});$.subscribe("ChatLibrary/StartEditMode",function(){p.bubbles.startEditMode()});$.subscribe("ChatLibrary/EndEditMode",function(){p.bubbles.endEditMode()});$.subscribe("ChatLibrary/DisableEditMode",function(){p.bubbles.disableEditMode()});$.subscribe("ChatLibrary/RemoveByTransactionId",function(e,t){if(t){var r=p.bubbles.getByTransactionId(e);if(r){$.Velocity(r,{scaleX:0,scaleY:0},{duration:250,easing:"easeInExpo",complete:function(){g(e)}})}else{g(e)}}else{g(e)}});var m=function(){p.bubbles.adjustStepsCallout()};var g=function(e){p.bubbles.removeByTransactionId(e);p.evaluatePositions()};$.subscribe("ChatLibrary/Toggle",function(e){var t=p.bubbles.getBySequence(e);if(t)t.toggle()});var v=function(e){return e.filter(function(e){return e.genre!=="advert"})};var b=function(e){for(var t=0,r=e.length;t<r;t++){if(e[t].genre=="advert"||e[t].genre=="nativead")return true}return false};var y=function(e){for(var t=0,r=e.length;t<r;t++){if(typeof e[t].action!=="undefined"&&e[t].action!==null)if(typeof e[t].action.method==="string")if(e[t].action.method==="FreeTrialExpert")return true}return false};var w=function(e,t){if(!Auth.isLoggedIn())return;if(d===true)return;d=true;var r=null;if(t){r=function(){M();B(true,function(){M();G()})}}else{r=function(){k(document.querySelector(".ch-solution-top"),true);B(true);G()}}O(true);if(!App.isApps){S.isLoading=true;O(true,function(){x(r,false)})}else{O(true,function(){x(r,true)})}};var C=function(){$.publish("solution/request")};var S={lastCheck:0,isLoading:false,atTop:true,atBottom:true};var x=function(t,r){API.getMessagesMostRecent(e.subject,u,function(r){if(r.status===1&&r.messages!=null&&r.messages.length>0){var n=e.splice?H(r.messages):r.messages;if(n.length>0){$.publish("ChatLibrary/Insert",[{bubbles:n},{isHistory:true,insertNewer:false,immediate:true,postRender:t}])}else B(true);S.atTop=false;S.atBottom=true}else{B(true)}$.publish("layout/drawer");S.isLoading=false;if(h){$.publish("Scheduler/Next");h=false}})};var A=function(e){if(S.atTop)return;var t=p.getOldestWithSessionId();if(t==null)return;if(App.isAndroidDevice&&t.sequence-u<0){S.atTop=true;S.atBottom=false;return}S.isLoading=true;S.lastCheck=e+o;O(true,function(){E(t)})};var T=function(e){if(S.atBottom)return;S.atBottom=true;var t=p.getNewestWithSessionId();if(t==null)return;S.isLoading=true;S.lastCheck=e+o;O(false,function(){I(t)})};var I=function(t){API.getMessagesNewer(t.sessionId,e.subject,u,function(e){if(e.status===1&&e.messages!=null){if(e.messages.length>0){$.publish("ChatLibrary/Insert",[{bubbles:e.messages},{isHistory:true,immediate:true,postRender:function(){k(t.element,false);B(false)}}]);S.atTop=false;S.atBottom=false}else{S.atTop=false;S.atBottom=true;B(false)}}S.lastCheck=Util.TimeStamp()+o;S.isLoading=false})};var E=function(t){API.getMessagesOlder(t.sessionId,e.subject,u,function(e){if(e.status===1&&e.messages!=null){if(e.messages.length>0){$.publish("ChatLibrary/Insert",[{bubbles:e.messages},{isHistory:true,insertNewer:false,immediate:true,postRender:function(){k(t.element,true);B(true)}}]);S.atTop=false;S.atBottom=false}else{S.atTop=true;S.atBottom=false;B(true)}}S.lastCheck=Util.TimeStamp()+o;S.isLoading=false})};var P=function(){if(S.isLoading===true)return;var e=Date.now();var t=e+o;if(S.lastCheck>t)return;var i=$(n).height();var a=$(r).height();var s=$(r).scrollTop();if(S.atTop===false&&s<=c){A(e)}else if(S.atBottom===false&&s+a>=i-c){T(e)}};$.subscribe("ChatLibrary/Scroll",function(e,t){k(e,t)});var k=function(e,t){if(t){r.scrollTop=e.offsetTop-8}else{r.scrollTop=e.offsetTop+e.offsetHeight-r.offsetHeight+8}};var M=function(){if(r===null)return;r.scrollTop=App.MaxScrollableValue};$.subscribe("ChatLibrary/ScrollBottom",function(){M()});var D=function(){if(f===true)return;f=true;if(!(e.subject=="Graphing")){API.chatBotGreeting(L(),e.subject,function(e){var t=Util.FixupBubbleTimestamps(e.messages);if(e.messages&&e.messages.length>0){$.publish("ChatLibrary/Insert",[{bubbles:t},{separator:true}])}})}if(Auth.isLoggedIn()){API.refreshUserState(function(e){if(e.status==1){Auth.setUserState(e.userState);$.publish("auth/refreshedUserState")}})}};var L=function(){if(App.isBot===true)return false;if(App.isAffiliateWidget()==true)return false;var e=WebStorage.dismissedTutorial.get();if(e!==null&&e!=="false")return false;return true};var R=function(){var e=$(n);var t=$(r);if(e.height()<t.height())return false;if(t.scrollTop()+t.height()>=e.height()-25)return true;return false};var N=function(){if(e.sayHello===true)D();if(!App.IsApps&&e.enableAdTest===true){StaticAdManager.evaluate()}if(Auth.isLoggedIn()&&e.deferHistory===false){setTimeout(function(){w(e.subject,true)},600)}else{if(h)$.publish("Scheduler/Next")}};$.subscribe("auth/loggedin",function(){w(e.subject,true)});$.subscribe("ChatLibrary/AdRendered",function(e){var t=document.getElementsByClassName("ch-solution-top");if(t.length>0){k(t[t.length-1],true)}});var U=function(){if(Auth.hasRole(UserRoles.TutoringAccess))return Strings.Chat.SubscribedTutoring;if(Auth.hasRole(UserRoles.ExpertQA))return Strings.Chat.SubscribedExpertQA;return Strings.Chat.Subscribed};$.subscribe("app/subscribed",function(){var e=U();$.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:e,genre:"notice",testContext:BubbleContext.Generic},{commitMessages:true})]}]);WebStorage.afterOfferUpgrade.set("")});var F=WebStorage.afterOfferUpgrade.get();if(F!=null&&F=="true"){$.publish("app/subscribed")}$.subscribe("chat/clear",function(){$(n).empty();d=false;f=false;p.bubbles.empty()});$.subscribe("subject/set",function(t){e.subject=t;if(e.ignoreSubjectChange)return;$.publish("chat/clear");$.publish("ChatLibrary/StateCheck");N()});$.subscribe("ChatLibrary/Redirect",function(e){if(!Auth.hasSubscription()){var t="/SignUp.aspx";var r=App.getQueryParam("affiliateid");if(r!==false&&!Auth.isLoggedIn()){t=Util.addQueryParam(t,"pr",r)}var n=App.getAffiliateSubject();t=Util.addQueryParam(t,"subject",n)}else{var t="/Offer.aspx";var r=App.getQueryParam("affiliateid");if(r!==false&&!Auth.isLoggedIn()){t=Util.addQueryParam(t,"promo",r)}var n=App.getAffiliateSubject();t=Util.addQueryParam(t,"subject",n)}WebStorage.attemptResolve.set("true");window.top.location.href=t});var O=function(e,t){var r=e?i:a;r.velocity("stop").show().velocity({opacity:1},{duration:150,complete:function(){if(Util.IsEmpty(r)){r.append($("<div></div>").addClass("loader"))}if(typeof t==="function")t.apply(this)}})};var B=function(e,t){var r=e?i:a;r.velocity("stop").velocity({opacity:0,display:"none"},{duration:250,complete:function(){r.hide().empty();if(typeof t==="function")t.apply(this)}})};var H=function(t){e.splice=false;if(t.length===0)return[];if(t[0].genre==="mathway")t.shift();if(t[0].genre==="local")t.shift();if(t[0].genre==="local")t.shift();return t};var q=false;var G=function(){if(q)return;$(r).on("scrollend",150,function(){P()});q=true};$.subscribe("chat/ratetoggle",function(){e.rateDebug=e.rateDebug?false:true});$.subscribe("chat/adtoggle",function(){e.adDebug=e.adDebug?false:true});$.subscribe("rating/success",function(){p.bubbles.removeAllOfGenre("rating");p.evaluatePositions()});$.subscribe("ChatLibrary/StateCheck",function(t){if(typeof t!=="undefined")e.splice=t;D();w(e.subject,true)});$.subscribe("apps/loadTutorHistory",function(){if(Tutor.inChatRoom()){$.publish("chat/clear");w(e.subject,true)}});$.subscribe("ChatLibrary/CulledNewer",function(){S.atBottom=false});$.subscribe("ChatLibrary/CulledOlder",function(){S.atTop=false});$.subscribe("dym/state",function(e){if(R())M()});$.subscribe("window/resize",function(){Util.Debounce(GraphBuilder.resize(),100)});$.subscribe("Tutor/ClearTyping",function(){p.bubbles.removeAllOfGenre("remoteTyping");p.bubbles.removeAllOfGenre("localTyping");p.evaluatePositions()});$.subscribe("upgrade/success",function(){if(Auth.hasRole(UserRoles.TutoringAccess)){p.bubbles.removeAllOfGenre("mathway","TutorUpgradeRequest");p.evaluatePositions()}p.bubbles.adjustStepsCallout()});$.subscribe("apps/viewDidAppear",function(){if(Auth.hasRole(UserRoles.TutoringAccess)){p.bubbles.removeAllOfGenre("mathway","TutorUpgradeRequest");p.evaluatePositions()}});$.subscribe("ChatLibrary/GoToBottom",function(){if(S.atBottom===false){S.isLoading=true;S.atTop=false;S.atBottom=true;d=false;p.bubbles.empty();$.publish("ChatLibrary/StateCheck",[true])}else{M()}});$.subscribe("chat/dispatchRating",function(e){if(typeof e==="string")e=JSON.parse(e);e=Util.Extend({asciiMath:"",mathML:"",subject:"Algebra",topicId:0,topicText:"",customData:null,rating:1,comments:"",callback:function(){}},e||{});API.chatBotRating(e.asciiMath,e.mathML,e.subject,e.topicId,e.topicText,e.customData,e.rating,e.comments,function(t){e.callback.apply(this,[t])})});$.subscribe("Tutor/RemoveFreeTrial",function(){p.bubbles.removeAllWithAction("FreeTrialTutor");p.evaluatePositions()});$.subscribe("expertQA/RemoveFreeTrial",function(){p.bubbles.removeAllWithAction("FreeTrialExpert");p.evaluatePositions()});$.subscribe("chat/removeUpgrade",function(){p.bubbles.removeAllWithAction("UpgradeExpert");p.bubbles.removeAllWithAction("UpgradeTutor");p.evaluatePositions()});$.subscribe("upgrade/success",function(){p.bubbles.removeAllWithAction("FreeTrialTutor");p.bubbles.removeAllWithAction("FreeTrialExpert");p.bubbles.removeAllWithAction("UpgradeExpert");p.bubbles.removeAllWithAction("UpgradeTutor");p.evaluatePositions()});$.subscribe("surveyText/surveySubmit",function(e){e=Util.Extend({surveyId:0,responseId:0,surveyDetails:null},e||{});API.chatBotSurvey(e.surveyId,e.responseId,e.surveyDetails,function(){$.publish("surveyText/postAnswer",[{surveyId:e.surveyId,responseId:e.responseId}])})});$.subscribe("surveyText/surveyCancel",function(e){e=Util.Extend({surveyId:0,responseId:0},e||{});API.chatBotSurvey(e.surveyId,e.responseId,null,function(){$.publish("surveyText/postAnswer",[{surveyId:e.surveyId,responseId:e.responseId}])})});$.subscribe("surveyText/postAnswer",function(e){e=Util.Extend({surveyId:0,responseId:0},e||{});var t=p.bubbles.getSurveyById(e.surveyId);if(t&&typeof t.postAnswer==="function"){t.postAnswer()}});$.subscribe("surveyText/cancelDetail",function(e){e=Util.Extend({surveyId:0,responseId:0},e||{});var t=p.bubbles.getSurveyById(e.surveyId);if(t&&typeof t.cancelDetail==="function"){t.cancelDetail()}});$.subscribe("testing/ad",function(){$.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({genre:"advert",testContext:BubbleContext.Advert})]},{immediate:false}])});Scheduler.Add({label:"Initialize Chat",priority:10,evalFn:function(){return true},execFn:function(){h=true;N();$.publish("Scheduler/Next")}});if(!App.IsApps){Component.Drawer({contentContainer:t,shouldClose:function(t){if(!e.shouldCloseDrawer())return false;return(t.type==="mouseup"||t.type==="touchend")&&!Util.HasClassInDom("clickable",t.target)&&!Util.HasClassInDom("ch-problem",t.target)&&!Util.HasIdInDom("topics-container",t.target)&&!Util.HasClassInDom("popup-container",t.target)},onOpenProgress:function(e){$.publish("layout/chat");if(R())M()},onCloseProgress:function(){$.publish("layout/chat")},onOpened:function(){$.publish("layout/drawer")},onStart:function(){Scheduler.Add({label:"Open and Lock Drawer",priority:5,evalFn:function(){return true},execFn:function(){$.publish("Scheduler/Next")}});Scheduler.Add({label:"Unlock Drawer",priority:100,evalFn:function(){return true},execFn:function(){$.publish("drawer/unlock");$.publish("Scheduler/Next")}});if(e.enableAdTest){var t=WebStorage.showUpgradeAfterReload.get();WebStorage.showUpgradeAfterReload.remove();if(t==="true"){Scheduler.Add({label:"ShowUpgrade",priority:150,evalFn:function(){return true},execFn:function(){$.publish("app/subscribed");if(App.upgradeAllowed()){Actions.Do(Actions.showUpgrade,{startAtPayment:false,selectedPlan:undefined,source:UpgradeSource.upgradeAfter})}$.publish("Scheduler/Next")}})}}}})}};Page.Examples=function(e){var t={};var r=$.query(".example-node");var n=$.query("#ex-input");var i=$.query("#ex-results");var a=$.query("example-graph");var o=function(e,r,n){for(var i=0,a=e.length;i<a;i++){switch(e[i].category){case"subject":if(e[i].children.length>0){o(e[i].children,e[i].text)}break;case"chapter":if(e[i].children.length>0){o(e[i].children,r,e[i].text)}break;case"topic":t[e[i].value]={subject:r,chapter:n,topic:e[i].text,link:e[i].link,id:e[i].value};break}}};var s=function(e){var r=new Sifter(t,{diacritics:true});var n=r.search(e,{fields:["topic","chapter","subject"],conjunction:"and"});return n};var u=function(e,r){i.empty();var n=$("<div></div>");for(var a=0,o=e.length;a<o;a++){var s=t[e[a].id];n.append($("<a></a>").attr("href",s.link).addClass("result-single").append($("<div></div>").addClass("result-subject").appendText(s.subject)).append($("<div></div>").addClass("result-topic").appendText(s.chapter+" - "+s.topic)))}i.append(n);for(var a=0,o=r.length;a<o;a++){findAndReplaceDOMText(document.getElementById("ex-results"),{find:r[a].regex,wrap:"span"})}i.show()};n.keyup(function(){var e=$(this).val();if(e.length>0){var t=s(e);u(t.items,t.tokens)}else{i.empty();i.hide()}});r.click(function(e){if(this.getAttribute("data-category")==="topic")return;
e.preventDefault();var t=this.nextElementSibling;var r=this.previousElementSibling;if(t!==null&&$(t).hasClass("example-children")){var n=window.getComputedStyle(t,null);if(n.display==="none"){l(t,r)}else{c(t,r)}}});var l=function(e,t){$(t).addClass("main-open");$.Velocity(e,"stop");$.Velocity(e,"slideDown",{display:"block",duration:150,easing:"easeOutQuad"})};var c=function(e,t){$(t).removeClass("main-open");$.Velocity(e,"stop");$.Velocity(e,"slideUp",{display:"none",duration:100,easing:"easeInQuad"})};o(e.examples)};Page.ExampleChapter=function(){};Page.ExampleTopic=function(){_topicInner();$.query("#come-on-you-know-you-wanna").on("click",function(){Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"Examples",eventAction:"click",eventLabel:"Enter YOUR Problem"})})};Page.PopularProblem=function(){_topicInner();$.query("#come-on-you-know-you-wanna").on("click",function(){Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"Popular Problems",eventAction:"click",eventLabel:"Enter YOUR Problem"})});$("#top-menu .left-side, #top-menu .member-icon, #top-menu .show-more").on("click",function(e){e.preventDefault();Util.Redirect(App.getHomeLink())})};var _topicInner=function(){var e=$.query(".Graph");var t=$.query(".visitor-toggle-button");var r=$.query(".example-graph");GraphBuilder.widthFn=function(){return r.width()};t.click(function(){n(this)});var n=function(e){var t=e.parentNode.nextElementSibling;var r=t.nextElementSibling;var n=$(t).css("display");var i=e.querySelector("span");if(n==="none"){$.Velocity(t,"stop");$.Velocity(t,"slideDown",{display:"inline-block",duration:250,easing:"easeOutQuint",begin:function(){r.style.display="none"}});$(e).addClass("visitor-steps-open");if(i!==null)i.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(t,"stop");$.Velocity(t,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){r.style.display=""}});$(e).removeClass("visitor-steps-open");if(i!==null)i.innerHTML=Strings.Chat.ActionShowSteps}};if(e.length){var i=e[0];var a=e.data("input");var o=Util.CreateElement({tagName:"img",className:"graph-thumbnail",attributes:[{key:"src",value:"/images/placeholder.gif"}]});i.appendChild(o);GraphBuilder.add(i,a,o);GraphBuilder.process()}$.subscribe("document/ready",function(){$("#example-problem").addClass("example-problem-button")});$("#example-problem").on("click",function(){var e=$("#come-on-you-know-you-wanna").attr("href");e=e+"?problem="+$("#come-on-you-know-you-wanna").attr("problem");top.location.href=e})};Page.PopularProblems=function(){$.query("#pp-subjects").change(function(){Util.Redirect($(this).val())});MathJax.Hub.Queue(["Typeset",MathJax.Hub,document.getElementById("pp-problem-list")])};Page.PopularProblemAlt=function(e,t){var r=$.query("#helppage-area");var n=$.query("#drawer");var i=$.query("#editor");var a=$.query("#did-you-mean");var o=$.query("#keyboard");var s=$.query(".Graph");var u=$.query(".visitor-toggle-button");var l=$.query(".example-graph");GraphBuilder.widthFn=function(){var e=l.width();if(e==null||isNaN(e)){e=450}return e};u.click(function(){c(this)});var c=function(e){var t=e.parentNode.nextElementSibling;var r=t.nextElementSibling;var n=$(t).css("display");var i=e.querySelector("span");if(n==="none"){$.Velocity(t,"stop");$.Velocity(t,"slideDown",{display:"inline-block",duration:250,easing:"easeOutQuint",begin:function(){r.style.display="none"}});$(e).addClass("visitor-steps-open");if(i!==null)i.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(t,"stop");$.Velocity(t,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){r.style.display=""}});$(e).removeClass("visitor-steps-open");if(i!==null)i.innerHTML=Strings.Chat.ActionShowSteps}};var p=function(){if(s.length){var e=s[0];var r=s.data("input");var n=Util.CreateElement({tagName:"img",className:"graph-thumbnail",attributes:[{key:"src",value:"/images/placeholder.gif"}]});e.appendChild(n);GraphBuilder.add(e,r,n);GraphBuilder.process()}Component.Drawer({contentContainer:document.getElementById("chat-area"),shouldClose:function(e){return(e.type==="mouseup"||e.type==="touchend")&&!Util.HasClassInDom("clickable",e.target)&&!Util.HasClassInDom("popup-container",e.target)},onOpenProgress:function(){$.publish("layout/chat")},onCloseProgress:function(){$.publish("layout/chat")}});App.CurrentEditor.Paste(t)};var d=function(){var e=0;e+=i.height();e+=a.height();e+=o.height();e+=2;n.css("height",e+"px");n.css("bottom",0);r.css("bottom",e+"px")};$.subscribe("editorContentUpdate",function(e){d()});$("#top-menu .left-side, #top-menu .member-icon, #top-menu .show-more").on("click",function(e){e.preventDefault();Util.Redirect(App.getHomeLink())});$.subscribe("dym/state",function(){d()});$.subscribe("window/resize",function(){d()});$.subscribe("document/ready",function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,document.getElementById("example-problem")]);MathJax.Hub.Queue(["Typeset",MathJax.Hub,document.getElementById("example-area")]);$(".Explanation .GraphWrapper").each(function(){GraphBuilder.addGraphWrapper(this)})});Scheduler.Add({label:"Open and Lock Drawer",priority:5,evalFn:function(){return true},execFn:function(){$.publish("Scheduler/Next")}});Scheduler.Add({label:"Popular Problem Initialization",priority:45,evalFn:function(){return true},execFn:function(){p();$.publish("Scheduler/Next")}});Scheduler.Add({label:"Unlock Drawer",priority:100,evalFn:function(){return true},execFn:function(){$.publish("drawer/unlock");$.publish("Scheduler/Next")}})};Page.ExpertAnswerDetail=function(e,t){var r=$("#my-question");var n=$("#my-answer");var i=$("#answer-rating");var a=function(e){return Strings.Tutor.PreSessionAnswers[e-1]};var o=function(e){var t=$(e);var r=e.parentNode.nextElementSibling;var n=$(r);var i=r.nextElementSibling;var a=n.css("display");var o=e.querySelector("span");var s=function(){if(a==="none"){$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"block",duration:250,easing:"easeOutQuint",begin:function(){i.style.display="none"},complete:function(){n.css({height:"inherit"})}});t.addClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){i.style.display=""}});t.removeClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionShowSteps}};var u=n.children(":not(.visitor-child-rows)").toArray();if(!n.hasClass("rendered")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,u,function(){n.addClass("rendered");s()}])}else{s()}};var s=function(t){if(t.AnswerState===ExpertAnswerState.Answered){API.updateExpertAnswer(e,t.ID,ExpertAnswerState.Viewed,function(){$.publish("expertQA/viewUpdate")})}if(t.AnswerState!==ExpertAnswerState.Rated){$("#answer-rating-title").show();new Component.Rating({elem:i[0],onRating:function(t){setTimeout(function(){API.rateExpertAnswer(t,e);$("#answer-rating-title").hide();i.html(Strings.Chat.ThanksForFeedback)},800)}})}};var u=function(e){var t=null;if(!Util.IsNullOrEmpty(e.TutorFirstName)){t=e.TutorFirstName}if(!Util.IsNullOrEmpty(e.TutorLastName)){t=t?t+" "+e.TutorLastName:e.TutorLastName}return t};var l=function(e){var t='<table cellpadding="0" cellspacing="0" border="0" class="eqa-details">';t+="<tr><td>"+Strings.ExpertQA.DetailsSubject+"</td><td>"+e.Subject+"</td></tr>";if(e.IsProblem)t+="<tr><td>"+Strings.ExpertQA.DetailsTopic+"</td><td>"+e.TopicText+"</td></tr>";t+="<tr><td>"+Strings.ExpertQA.DetailsRequest+'</td><td style="white-space:normal">'+a(e.AnswerType)+"</td></tr>";t+="</table>";return t};var c=function(){var e=0;$(".GraphWrapper").each(function(t,r){e++;var n=Util.CreateElement({tagName:"img",className:"graph-thumbnail",attributes:[{key:"src",value:"/images/placeholder.gif"},{key:"alt",value:"image of graph"}]});r.appendChild(n);GraphBuilder.add(r,r.getAttribute("data-graph-input"),n)});if(e>0){GraphBuilder.process()}};var p=function(){GraphBuilder.widthFn=function(){return n.width()};API.getExpertAnswerDetail(e,function(e){if(e.status===ResponseStatuses.Success){if(e.Answer===undefined)Util.Redirect("/");var i=e.Answer;var a="";if(!Util.IsNullOrEmpty(i.ImageURL)){a='<div id="visitor-problem"><div id="example-problem"><img src="'+i.ImageURL+'" alt="'+Strings.ExpertQA.Title+'" /></div></div>'}else{a='<div id="visitor-problem"><div id="example-problem">'+Editor.AsciiToMathml(i.AsciiMath)+"</div></div>"}a+=l(i);r.html(a);MathJax.Hub.Queue(["Typeset",MathJax.Hub,r[0],function(){}]);e.Sections.forEach(function(e){var t="eqa-section";switch(e.DisplayStyle){case ExpertSectionStyle.GreyBorder:t+=" eqa-grey-border";break}var r=$('<div class="'+t+'" />');if(!Util.IsNullOrEmpty(e.ImageURL)){r.append('<img src="'+e.ImageURL+'" alt="'+Strings.ExpertQA.Title+'" />')}else if(!Util.IsNullOrEmpty(e.GraphInput)){var i=Util.CreateElement({className:t}).appendChild(Util.CreateElement({className:"GraphWrapper",attributes:[{key:"data-graph-input",value:e.GraphInput}]}));r[0].appendChild(i)}else{r.html(e.HTML)}n.append(r)});c();MathJax.Hub.Queue(["Typeset",MathJax.Hub,n[0],function(){$(".visitor-toggle-button").on("click",function(){o(this);return false});$(".GraphWrapper").on("click",function(){var e=HtmlEntitites.encode(this.getAttribute("data-graph-input"));Actions.Do(Actions.openGraph,{graphInput:e})});Actions.Do(Actions.hideSpinner)}]);if(t)s(e.Answer)}else{Util.Redirect("/")}})};Actions.Do(Actions.showSpinner);Scheduler.Add({label:"ExpertQA Page Initialization",priority:50,evalFn:function(){return true},execFn:function(){p();$.publish("Scheduler/Next")}})};Page.ExpertAnswers=function(){var e=$("#eqa-question-set");var t=$(".td-answer-pagination");var r=8;var n="/Ask-an-Expert?page=";var i=false;var a=function(e){e=$.extend({text:"",page:null,"class":null,url:n},e||{});var t=$("<span />");if(e.class)t.addClass(e.class);if(e.page){var r=e.url+e.page;t.append($("<a />").attr("href",r).on("click",function(t){t.preventDefault();Actions.Do(Actions.showSpinner);p(e.page);window.history.pushState({},null,r)}).text(e.text))}else{t.text(e.text)}return t};var o=function(e,r){t.empty();t.append(e>1?a({text:Pagination.LeftArrow,page:e-1}):a({text:Pagination.LeftArrow}));var n=Pagination.Ranged(e,r);for(var i=0,o=n.length;i<o;i++){var s={text:n[i]?n[i]:Pagination.Ellipses};if(n[i]===e)s["class"]="bold";else if(n[i]!==null)s["page"]=n[i];t.append(a(s))}t.append(e<r?a({text:Pagination.RightArrow,page:e+1}):a({text:Pagination.RightArrow}))};var s=function(e){var t=true;var r=e>0?false:true;if(Auth.isLoggedIn()){if(Auth.hasRole(UserRoles.TutoringAccess))t=false;if(Auth.hasRole(UserRoles.ExpertQA))t=false}if(t){$("#eqa-dashboard-callout").show()}else{$("#eqa-dashboard-callout").hide()}if(!t&&r){$("#eqa-dashboard-empty").show()}else{$("#eqa-dashboard-empty").hide()}};var u=function(e){return e.AnswerState===ExpertAnswerState.Answered||e.AnswerState===ExpertAnswerState.Viewed||e.AnswerState===ExpertAnswerState.Rated};var l=function(t){e.empty();var r=[];t=t.filter(function(e){if(r.indexOf(e.ID)!==-1)return false;r.push(e.ID);return true});t.forEach(function(t){var r=$("<div />").addClass("eqa-single");var n=$("<div />").addClass("eqa-question").append($("<div />").addClass("eqa-mobile-title").text("Question")).append($("<div />").addClass("eqa-content").append(function(){var e=$("<div />").addClass("eqa-content");if(typeof t.AltAscii==="undefined"&&t.ImageURL!==""){e.append($("<div />").addClass("eqa-expand").attr("data-eqa-id",t.ID).text(Strings.ExpertQA.ShowImage).on("click",function(e){e.preventDefault();var t=this;var r=parseInt(t.getAttribute("data-eqa-id"));if(Util.IsNumber(r)){if(i)return;i=true;var n=$('.eqa-image[data-eqa-id="'+r+'"]');var a=$('.eqa-image[data-eqa-id="'+r+'"] img');if(n.css("display")==="block"){a.velocity("stop").velocity({opacity:0},{duration:150,easing:"easeInQuad",display:"none",complete:function(){$(t).text(Strings.ExpertQA.ShowImage);n.css("display","none");i=false}})}else{n.css("display","block");a.velocity("stop").velocity({opacity:1},{duration:250,easing:"easeOutQuad",display:"block",complete:function(){$(t).text(Strings.ExpertQA.HideImage);i=false}})}}}));e.append($("<div />").addClass("eqa-image").attr("data-eqa-id",t.ID).append($("<img />").attr("src",t.ImageURL).attr("alt",Strings.ExpertQA.Title)))}else{e.html(Editor.AsciiToMathml(t.AltAscii))}return e}));r.append(n);var a=$("<div />").addClass("eqa-asked-on").append($("<div />").addClass("eqa-mobile-title").text("Asked On")).append($("<div />").addClass("eqa-content").text(function(){var e=new Date(parseInt(t.Timestamp.substring(6)));return Util.formatDateWithTime(e)}));if(u(t)){a.append($("<span />").text("Returned On"));a.append($("<div />").addClass("eqa-content").text(function(){var e=new Date(parseInt(t.AnsweredAt.substring(6)));return Util.formatDateWithTime(e)}))}r.append(a);var o=$("<div />").addClass("eqa-status").append($("<div />").addClass("eqa-mobile-title").text("Status")).append($("<div />").addClass("eqa-content").html(function(){if(t.AnswerState===ExpertAnswerState.Answered)return Strings.ExpertQA.StatusAnswered+'<div class="eqa-unread">'+Strings.ExpertQA.Unread+"</div>";else if(u(t))return Strings.ExpertQA.StatusAnswered;return Strings.ExpertQA.StatusWaiting}));r.append(o);var s=$("<div />").addClass("eqa-controls");if(u(t)){var l=$("<button />").addClass("btn-primary").addClass("small").text("View").attr("href","/Ask-an-Expert/Answers/"+t.AnswerID);l.on("click",function(e){e.preventDefault();document.location.href=$(this).attr("href")});s.append(l)}r.append(s);r.append($("<div />").addClass("clear"));e.append(r)})};var c=function(e){return e>0?Math.ceil(e/r):1};var p=function(t){if(t<1){p(1);window.history.pushState({},null,n+1);return}API.getExpertQuestionDtosByUserId(t,r,function(r){if(r.status===ResponseStatuses.Success){ExpertQA.SetState(r.State);var i=c(r.Count);if(t>i){p(i);window.history.pushState({},null,n+i);return}if(r.Questions.length>0){o(t,i);l(r.Questions);MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0],function(){Actions.Do(Actions.hideSpinner);$("#eqa-dashboard-questions").show()}])}else{Actions.Do(Actions.hideSpinner)}s(r.Count)}else{Actions.Do(Actions.hideSpinner);s(0)}})};var d=parseInt(App.getQueryParam("page"));if(!Util.IsInteger(d)||d<1)d=1;Actions.Do(Actions.showSpinner);$("#eqa-upgrade").on("click",function(e){e.preventDefault();Actions.Do(Actions.showUpgrade,{source:UpgradeSource.expertQA})});$.subscribe("expertQA/update",function(){p(d)});$.subscribe("auth/loggedin",function(){p(d)});$.subscribe("auth/loggedout",function(){s(0)});$.subscribe("upgrade/success",function(){p(d)});Scheduler.Add({label:"ExpertQA Page Initialization",priority:65,evalFn:function(){return true},execFn:function(){if(!Auth.isLoggedIn()){s(0);Actions.Do(Actions.hideSpinner);Popup.showLogin({closeOnOverlay:false,closeOnX:false,onAuthReload:true,onX:function(){Util.Redirect(App.getHomeLink())}})}else{p(d)}$.publish("Scheduler/Next")}})};Page.ExpertAnswerCompose=function(e){e=$.extend({subject:"Algebra",answerId:0,questionId:0,asciiMath:null,imageURL:null,answerType:1,isProblem:true,topicText:"",userEmail:null},e||{});var t=$("body");var r=$("#chat-inner");var n=$("#eqa-submit");var i=$("#eqa-abandon");var a=null;if(e.asciiMath!==""){e.asciiMath=Base64.decode(e.asciiMath).replace(/(?:\r\n|\r|\n)/g,"<br>")}if(e.isProblem==="True")e.isProblem=true;if(e.isProblem==="False")e.isProblem=false;var o=function(){return Strings.Tutor.PreSessionAnswers[e.answerType-1]};n.on("click",function(t){t.preventDefault();t.stopPropagation();Popup.showYesNo("Submit Answer?",function(){API.submitExpertAnswer(e.answerId,function(e){if(e.status===1){Util.Redirect("/TutorDashboard?tab=questions")}else{Popup.showError("There was a problem with your request.")}})})});i.on("click",function(t){t.preventDefault();t.stopPropagation();Popup.showYesNo("Abandon Answer?",function(){API.updateExpertAnswer(e.answerId,e.questionId,ExpertAnswerState.Abandoned,function(e){if(e.status===1){Util.Redirect("/TutorDashboard?tab=questions")}else{Popup.showError("There was a problem with your request.")}})})});var s=function(t){r.html(App.CurrentDocumentEditor.ToHtml(e.subject));window.MathJax.Hub.Queue(["Process",window.MathJax.Hub,r[0],function(){$(".document-block").click(u);$(".visitor-toggle-button").on("click",function(){y(this);return false});$(".document-insert").on("click",function(){c();return false});$(".document-delete").on("click",function(){p();return false});$(".block-grey-border").on("click",function(e){e.stopPropagation();l(this.parentElement);return false});if(!e.imageURL){$("#example-problem").on("click",function(){var e=this.getAttribute("data-ascii");if(!Util.IsNullOrEmpty(e)){e=e.replace(/<br ?\/?>/g,"\n");App.CurrentEditor.Replace("@mathway "+e)}})}$(".GraphWrapper").on("click",function(){var e=HtmlEntitites.encode(this.getAttribute("data-graph-input"));Actions.Do(Actions.openGraph,{graphInput:e})});h();if(typeof t==="function")t()}])};var u=function(e){if(Util.HasClass("GlossaryTerm",e.target))return;var t=parseInt(this.getAttribute("index"));m(t);d(true)};var l=function(e){var t=e.getAttribute("ascii");var r=parseInt(e.getAttribute("index"));if(typeof t==="string"&&t.startsWith("@mathway ")){var n=document.querySelector(".document-block[index='"+(r+1)+"']");var i=parseInt(n.getAttribute("data-id"));if(Util.IsInteger(i)){App.CurrentDocumentEditor.InsertLineBelow()}m(r+1);s(function(){App.CurrentEditor.Replace(t);App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertAdd);var e=document.querySelector(".document-block[index='"+App.CurrentDocumentEditor.GetCursor()+"']");if(e)$.publish("ChatLibrary/Scroll",[e,true])})}};var c=function(){App.CurrentDocumentEditor.InsertLineBelow();App.CurrentEditor.Clear();App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertAdd);m(App.CurrentDocumentEditor.GetCursor()+1);s(function(){d(true)})};var p=function(){var t=App.CurrentDocumentEditor.GetLine(App.CurrentDocumentEditor.GetCursor());if(!f(t.section)){App.CurrentDocumentEditor.DeleteCursor();m(App.CurrentDocumentEditor.GetCursor());s(function(){d(true)})}else{API.deleteExpertAnswerSection(t.section.ID,e.answerId,function(e){if(e.status===ResponseStatuses.Success){App.CurrentDocumentEditor.DeleteCursor();m(App.CurrentDocumentEditor.GetCursor());s(function(){d()})}})}};var d=function(e){Debug.trace();var t=App.CurrentDocumentEditor.GetLine(App.CurrentDocumentEditor.GetCursor());if(f(t.section)){if(!Util.IsNullOrEmpty(t.section.ImageURL)){App.CurrentEditor.Clear();App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertUpdate)}else if(!Util.IsNullOrEmpty(t.section.GraphInput)){App.CurrentEditor.Clear();App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertUpdate)}else{var r="";if(typeof t.command==="string"&&t.command.length>0)r="@"+t.command+" ";App.CurrentEditor.Replace(r+t.ascii);App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertUpdate)}}else{App.CurrentEditor.Clear();App.CurrentEditor.Buttons.setMode(EditorButtonsMode.ExpertAdd)}if(e){var n=document.querySelector(".document-block[index='"+App.CurrentDocumentEditor.GetCursor()+"']");if(n)$.publish("ChatLibrary/Scroll",[n,true])}};var f=function(e){if(typeof e==="undefined")return false;if(e===null)return false;return Util.IsInteger(e.ID)};var h=function(){var e=[];$(".GraphWrapper").each(function(){var t={};t["parent"]=this;t["input"]=this.getAttribute("data-graph-input");t["loader"]=this.querySelector("img");e.push(t)});if(e.length>0){for(var t=0,r=e.length;t<r;t++){GraphBuilder.add(e[t].parent,e[t].input,e[t].loader)}GraphBuilder.process()}};$.subscribe("documentEditor/addLine",function(){var t=App.CurrentEditor.root.GetSolverStrings();if(t.command==="mathway"){$.publish("chat/getMoreTopics")}else{v([{answerId:e.answerId,asciiMath:t.ascii,html:t.html,command:t.command}],App.CurrentDocumentEditor.GetCursor(),false);n.removeAttr("disabled")}});$.subscribe("documentEditor/updateLine",function(){var t=App.CurrentEditor.root.GetSolverStrings();var r=App.CurrentDocumentEditor.GetLine(App.CurrentDocumentEditor.GetCursor());if(t.command==="mathway"){$.publish("chat/getMoreTopics")}else if(f(r.section)){b({sectionId:r.section.ID,answerId:e.answerId,asciiMath:t.ascii,html:t.html,command:t.command,setToSelection:false})}});var m=function(e){App.CurrentDocumentEditor.SetCursor(e);$(".document-block").removeClass("current-block");$(".document-block[index='"+e+"']").addClass("current-block")};var g=function(e){e=Util.Extend({answerId:0,asciiMath:null,finalAnswerAsciiMath:null,customData:null,topicID:0,html:null,imageURL:null,command:null,graphInput:null,displayStyle:ExpertSectionStyle.None},e||{});return{AnswerID:e.answerId,AsciiMath:e.asciiMath,FinalAnswerAsciiMath:e.finalAnswerAsciiMath,CustomData:e.customData,TopicID:e.topicID,HTML:e.html,GraphInput:e.graphInput,ImageURL:e.imageURL,Command:e.command,DisplayStyle:e.displayStyle,Deleted:false}};var v=function(e,t,r){if(!Array.isArray(e))return;var n=[];for(var i=0,a=e.length;i<a;i++){n.push(g(e[i]))}API.addExpertAnswerSections(n,t,function(e){if(e.status===ResponseStatuses.Success){for(var t=0,n=e.Sections.length;t<n;t++){w(e.Sections[t])}s(function(){if(r){var e=App.CurrentDocumentEditor.GetCursor();m(e)}d(true)})}})};var b=function(e){e=Util.Extend({sectionId:0,answerId:0,asciiMath:null,finalAnswerAsciiMath:null,customData:null,topicID:0,html:null,imageURL:null,command:null,graphInput:null,displayStyle:ExpertSectionStyle.None,resetCursor:false,setToSelection:true},e||{});var t=App.CurrentDocumentEditor.GetCursor();API.updateExpertAnswerSection(e.sectionId,e.answerId,e.asciiMath,e.html,e.command,e.imageURL,null,e.displayStyle,e.finalAnswerAsciiMath,e.customData,e.topicID,function(r){w(r.Section);s(function(){if(e.resetCursor)m(t);if(e.setToSelection){d(true)}else{m(App.CurrentDocumentEditor.GetLineCount()-1);d(false)}})})};$.subscribe("expertQA/insertImage",function(t){var r=App.CurrentDocumentEditor.GetCursor();var n=App.CurrentDocumentEditor.GetLine(r);if(f(n.section)){b({sectionId:n.section.ID,answerId:e.answerId,imageURL:t})}else{v([{answerId:e.answerId,imageURL:t}],r,false)}});$.subscribe("solving/dispatch",function(t){t=Util.Extend({subject:"",topicId:0,topicText:"",customData:null,asciiMath:"",mathML:""},t||{});API.chatBotViewSteps(null,t.topicId,t.topicText,t.customData,t.subject,t.asciiMath,t.mathML,null,function(r){var i=App.CurrentDocumentEditor.GetCursor();var a=App.CurrentDocumentEditor.CleanStepsHtml(r.solutionhtml);var o=App.CurrentDocumentEditor.GetLine(i);a='<div class="block-grey-border" data-ascii="'+t.asciiMath+'">'+t.mathML+"</div>"+a;if(f(o.section)){b({sectionId:o.section.ID,answerId:e.answerId,asciiMath:t.asciiMath,html:a,command:"mathway",finalAnswerAsciiMath:r.finalAnswerAsciiMath,customData:r.customData,topicID:r.topicID})}else{v([{answerId:e.answerId,asciiMath:t.asciiMath,html:a,command:"mathway",finalAnswerAsciiMath:r.finalAnswerAsciiMath,customData:r.customData,topicID:r.topicID}],i,false)}n.removeAttr("disabled")})});var y=function(e){var t=$(e);var r=e.parentNode.nextElementSibling;var n=$(r);var i=r.nextElementSibling;var a=n.css("display");var o=e.querySelector("span");var s=function(){if(a==="none"){$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"block",duration:250,easing:"easeOutQuint",begin:function(){i.style.display="none"},complete:function(){n.css({height:"inherit"})}});t.addClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){i.style.display=""}});t.removeClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionShowSteps}};var u=n.children(":not(.visitor-child-rows)").toArray();if(!n.hasClass("rendered")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,u,function(){n.addClass("rendered");s()}])}else{s()}};var w=function(e){var t={ascii:HtmlEntitites.decode(e.AsciiMath),finalAnswerAsciiMath:HtmlEntitites.decode(e.FinalAnswerAsciiMath),customData:e.CustomData,topicID:e.TopicID,html:e.HTML,section:e};if(typeof e.Command==="string")t["command"]=e.Command;App.CurrentDocumentEditor.UpdateLine(t);if(App.CurrentDocumentEditor.GetCursor()+1===App.CurrentDocumentEditor.GetLineCount()){App.CurrentDocumentEditor.InsertLineBelow()}App.CurrentDocumentEditor.SetCursor(App.CurrentDocumentEditor.GetCursor()+1)};var C=function(){var t='<table cellpadding="0" cellspacing="0" border="0" class="eqa-details">';t+="<tr><td>"+Strings.ExpertQA.DetailsSubject+"</td><td>"+e.subject+"</td></tr>";if(e.isProblem)t+="<tr><td>"+Strings.ExpertQA.DetailsTopic+"</td><td>"+e.topicText+"</td></tr>";t+="<tr><td>"+Strings.ExpertQA.DetailsRequest+"</td><td>"+o()+"</td></tr>";if(e.userEmail)t+="<tr><td>"+Strings.ExpertQA.DetailsFrom+"</td><td>"+e.userEmail+"</td></tr>";t+="</table>";return t};var S=function(e){return e.replace(/<br\s*[\/]?>/gi,"\n")};var x=function(){API.getExpertAnswerSections(e.answerId,function(t){if(t.status===1){var r="";if(!Util.IsNullOrEmpty(e.imageURL)){r='<div id="visitor-problem"><div id="example-problem"><a href="'+e.imageURL+'" target="_blank"><img src="'+e.imageURL+'" alt="" /></a></div></div>'}else if(e.isProblem){r='<div id="visitor-problem"><div id="example-problem" class="clickable" data-ascii="'+e.asciiMath+'">'+Editor.AsciiToMathml(S(e.asciiMath))+"</div></div>"}else{r='<div id="visitor-problem"><div id="example-problem" class="clickable" data-ascii="'+e.asciiMath+'">'+Editor.AsciiToMathml(S(e.asciiMath))+"</div></div>"}r+=C();Debug.log("build that boi");App.CurrentDocumentEditor=new DocumentEditor(r);for(var a=0,o=t.Sections.length;a<o;a++){w(t.Sections[a])}s(function(){d(true);i.removeAttr("disabled");if(t.Sections.length>0)n.removeAttr("disabled")})}$.publish("expertQA/composeAnswer")})};t.addClass("eqa-compose");Scheduler.Add({label:"ExpertQA Compose",priority:20,evalFn:function(){return true},execFn:function(){GraphBuilder.widthFn=function(){return $(".visitor-content").width()};x()}})};Page.Formulas=function(){};Page.GiftCards=function(){var e=null;var t;var r="mathway-gift-card";var n;var i=$.query("#gift-card-phase1");var a=$.query("#gc-gifter-name");var o=$.query("#gc-gifter-email");var s=$.query("#gc-first-name");var u=$.query("#gc-last-name");var l=$.query("#gc-recipient-email");var c=$.query("#gc-custom-message");var p=$.query("#gc-step1");var d=$.query("#gift-card-phase2");var f=$.query("#gc-cc-first-name");var h=$.query("#gc-cc-last-name");var m=$.query("#gc-cc-number");var g=$.query("#gc-cc-cvv");var v=$.query("#gc-cc-exp-month");var b=$.query("#gc-cc-exp-year");var y=$.query("#gc-cc-zipcode");var w=$.query("#gc-cc-country-codes");var C=$.query("#gc-step2");var S=$.query("#gc-goback");var x=$.query("#cc-type-visa");var A=$.query("#cc-type-mc");var T=$.query("#cc-type-amex");var I=$.query("#cc-type-disc");var E=$.query(".cc-type");var P=$.query(".form-cc-icon");var k=$.query(".upgrade-form-cc");var M=$.query("#invoke-cvv");var D=$.query("#cvv-help");var L=[f,h,m,g];var R=[a,s,u,l];M.mouseenter(function(){U()});M.mouseleave(function(){F()});var N=function(){if(!Auth.isLoggedIn()){$.publish("dialog/open",["login",false,"signin",true]);$.publish("dialog/modal",["login"]);return}var e=new Date;for(var t=e.getFullYear(),r=t+10;t<=r;t++){b.append($("<option></option>").attr("value",t).appendText(t))}Recurly.init()};var U=function(){if(n)return;D.velocity("stop").velocity({opacity:1},{duration:150,easing:"easeOutQuad",display:"block"});n=true};var F=function(){if(!n)return;D.velocity("stop").velocity({opacity:0},{duration:100,easing:"easeInQuad",display:"none"});n=false};var O=function(){var e=true;t=$("input[name='gift-card-value']:checked").val();R.forEach(function(t,r){if(t.val()===""){e=false;t.addClass("invalid")}else{t.removeClass("invalid")}});if(!Util.isRFC2822Email(l.val())){e=false;l.addClass("invalid")}return e};var B=function(e){var t=true;L.forEach(function(e,r){if(e.val()===""){t=false;e.addClass("invalid")}else{e.removeClass("invalid")}});if(q()){m.removeClass("invalid")}else{m.addClass("invalid");t=false}var r=v.val();var n=b.val();var i=new Date(n,r,0,23,59,59);if(i.getTime()<=Date.now()){t=false;v.addClass("invalid");b.addClass("invalid")}else{v.removeClass("invalid");b.removeClass("invalid")}if(w.val()=="US"){if(y.val()==""){y.addClass("invalid");t=false}var a=/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(y.val());if(a==false){y.addClass("invalid");t=false}}return t};var H=function(){if(App.fromUnitedStates()){$(".form-cc-zipcode").show()}else{y.val("");$(".form-cc-zipcode").hide()}};var q=function(){var e=m.validateCreditCard({accept:["visa","mastercard","amex","discover"]});E.hide();if(e.card_type!==null){switch(e.card_type.name){case"visa":x.show();P.show();break;case"mastercard":A.show();P.show();break;case"amex":T.show();P.show();break;case"discover":I.show();P.show();break}}return e.luhn_valid};var G=function(){C.prop("disabled",true);var e={first_name:f.val(),last_name:h.val(),number:m.val(),cvv:g.val(),month:v.val(),year:b.val(),postal_code:y.val(),country:w.val()};if(!B(e)){C.prop("disabled",false);return}_();Recurly.updateBilling(e,function(e,t){W(e,t)})};var _=function(){UI.spinner.show();k.find(".field-error").remove();isLocked=true};var W=function(e,n){if(e){z();j(e)}else{Recurly.giftcard({tokenid:n.id,userid:Auth.userstate.userId,giftername:a.val(),gifteremail:Auth.userstate.email,recipientfirstname:s.val(),recipientlastname:u.val(),personalmessage:c.val(),recipientemail:l.val(),productcode:r,cardvalue:t},function(e){if(e.status<0)V(e.messageId);else{z(e)}})}};var z=function(e){Actions.Do(Actions.gaEvent,{eventCategory:"gift card",eventAction:"User purchased a Gift Card",eventLabel:WebStorage.anonUserId.get()});Util.Redirect("/Thanks/GiftCard")};var j=function(e){C.prop("disabled",false);switch(e.code){case"validation":if(typeof e.fields!=="undefined")if(e.fields.length>0){e.fields.forEach(function(e,t){if(e==="number")fieldAlert(m,Strings.Upgrade.ErrorInvalid);else if(e==="cvv")fieldAlert(g,Strings.Upgrade.ErrorInvalid)})}break;case"declined":GenericDialog.open(Strings.Upgrade.ErrorBillingDeclined);break;case"paypal-canceled":GenericDialog.open(Strings.Upgrade.ErrorBillingPaypalCanceled);break;case"paypal-error":GenericDialog.open(Strings.Upgrade.ErrorBillingPaypalError+" "+e.message);break;default:GenericDialog.open(e.message);break}};var V=function(e){UI.spinner.hide();UI.spinner.moveBack();isLocked=false;C.prop("disabled",false);GenericDialog.open(API.serverError(e))};m.on("keyup",function(e){q()});w.on("change",function(e){H()});p.on("click",function(){if(O()){i.hide();d.show();S.css("display","block")}});S.on("click",function(){i.show();d.hide();S.css("display","none")});C.on("click",function(){G()});d.on("submit",function(e){e.preventDefault()});N()};Page.Glossary=function(e){var t=$.query("#filter-select");var r=$.query("#filter-select select");var n=$.query("#filter-button");var i=$.query("#filter-spinner");var a=$.query("#glossary-terms");var o=function(){var e=document.querySelector(".glossary-term");MathJax.Hub.Queue(["Typeset",MathJax.Hub,e])};var s=function(){i.append(UI.buildSpinnerDOM());u()};var u=function(){i.remove();r.selectize({persist:true,valueField:"Id",labelField:"Term",searchField:"Term",sortField:"Term",options:e,render:{item:function(e,t){return"<div class='filter-item'>"+t(e.Term)+"</div>"},option:function(e,t){return"<div class='filter-option'>"+t(e.Term)+"</div>"}}});t.show();n.show()};n.click(function(){var t=r.val();var n=Util.friendlyUrl(e[t].Term);if(n.length===0)n="definition";Util.Redirect(App.urlPrefix+"glossary/definition/"+t+"/"+n)});o();s();Component.GlossaryTerm()};Page.Graph=function(){var e=null;var t=document.getElementById("gpc-container");var r=document.getElementById("gpc-outer");var n=document.getElementById("did-you-mean");var i=null;var a=$.query("#gpc-sidebar");var o=$.query("#graph-zoom-in");var s=$.query("#graph-zoom-out");var u=$.query("#graph-center");var l=$.query("#editor-group");var c=false;var p=Util.TimeStamp();
var d=function(e){var t=Util.TimeStamp();Debug.log(e,t-p);p=t};var f={colors:[],inDraw:false,input:"",lastRedraw:0,resize:false,updateHandle:null,updateInterval:250};var h=function(){var t=r.offsetWidth;var n=r.offsetHeight;f.colors=[new Color("MWRed"),new Color("MWBlue"),new Color("Green"),new Color("Purple"),new Color("Orange"),new Color("SlateGray"),new Color("Cyan"),new Color("Crimson"),new Color("Lavender"),new Color("Yellow")];f.inDraw=true;e=$('<div class="Graph" style="width:'+t+"px; height:"+n+'px;"></div>');e.MWGraph({height:n,width:t,showErrors:false,mousewheel:true,draggable:true,background:"#fff",fromSubjectsPage:false,onMoveStart:function(){Actions.Do(Actions.hideKeyboard);$.publish("graphSlider/close")},onClick:function(){if(App.IsApps||$(window).width()<600){Actions.Do(Actions.hideKeyboard);$.publish("graphSlider/close")}}});e.colors=f.colors;e.show();e.draw();$(r).append($("<div></div>").addClass("GraphWrapper").append(e));e.removeAttr("style");Page.Graph.Control();f.inDraw=false;f.lastRedraw=Util.TimeStamp();App.postAffiliateMessage("Graph");if(App.IsApps){Actions.Do(Actions.showKeyboard)}};var m=function(){if(f.updateHandle!==null)return;if(f.inDraw===true){f.updateHandle=setTimeout(function(){clearTimeout(f.updateHandle);f.updateHandle=null;m()},f.updateInterval);return}var e=Util.TimeStamp()-f.lastRedraw;if(e>=f.updateInterval){g()}else{f.updateHandle=setTimeout(function(){g();clearTimeout(f.updateHandle);f.updateHandle=null},e)}};var g=function(){f.inDraw=true;if(f.resize){e.resize(false);f.resize=false}e.colors=f.colors;e.updateEquations(f.input,false);e.graphs=[];e.draw();f.lastRedraw=Util.TimeStamp();f.inDraw=false};var v=function(){f.resize=true;m()};var b=function(e,t){f.input=e;f.colors=t;m()};var y=function(e){f.colors=e;m()};$.subscribe("document/ready",function(){h();$.publish("graphSlider/open")});if(App.IsApps){$.subscribe("apps/solveExample",function(e){var t=atob(e.asciiText);if(App.CurrentEditor!==null){App.CurrentEditor.Clear();App.CurrentEditor.Paste(t);Actions.Do(Actions.showKeyboard);$.publish("graphSlider/open")}})}$.subscribe("graph/colors",function(e){if(c)Debug.log("graph/colors");y(e)});$.subscribe("graph/update",function(e,t){if(c)Debug.log("graph/update");b(e,t)});$.subscribe("graph/resize",function(){if(c)Debug.log("graph/resize");v()});$.subscribe("drawer/opened",function(){if(!App.IsApps){if(c)Debug.log("drawer/opened");v()}});$.subscribe("graphSlider/opened",function(){Util.AddClass("sidebar-open",r);if(c)Debug.log("graphSlider/opened");v()});$.subscribe("graphSlider/closed",function(){Util.RemoveClass("sidebar-open",r);if(c)Debug.log("graphSlider/closed");v()});$.subscribe("drawer/closed",function(){if(App.CurrentEditor!==null)App.CurrentEditor.RemoveFocus();if(c)Debug.log("drawer/closed");v()});$.subscribe("dym/state",function(){if(c)Debug.log("dym/state");v()});$.subscribe("mobile/rotated",function(){if(c)Debug.log("mobile/rotated");v()});if(App.IsApps){l.on("click",function(){Actions.Do(Actions.showKeyboard)})}o.on("click",function(){if(e!==null)Util.Debounce(e.zoomIn(),100)});s.on("click",function(){if(e!==null)Util.Debounce(e.zoomOut(),100)});u.on("click",function(){if(e!==null)Util.Debounce(e.reset(),100)});if(!App.IsApps){Component.Drawer({contentContainer:t,shouldClose:function(e){return e.type==="mouseup"&&!Util.HasIdInDom("gpc-sidebar",e.target)&&!Popup.active()}})}};Page.Graph.Control=function(e){var t=$.query("#gpc-sidebar");var r=$.query("#gpc-toggle");var n=$.query("#gpc-toggle .mw");var i=false;var a=false;var o=function(){if(i)return;n.removeClass("mw-arrow-closed").addClass("mw-arrow-opened");t.velocity("stop").velocity({left:0},{duration:250,easing:"easeOutQuint",complete:function(){i=true;$.publish("graphSlider/opened")}});Actions.Do(Actions.showKeyboard)};var s=function(){if(!i)return;var e=parseInt(t.width());n.removeClass("mw-arrow-opened").addClass("mw-arrow-closed");t.velocity("stop").velocity({left:"-"+e+"px"},{duration:150,easing:"easeOutQuint",complete:function(){i=false;$.publish("graphSlider/closed")}});Actions.Do(Actions.hideKeyboard)};var u=function(){if(!i){o();if(App.CurrentEditor!==null)App.CurrentEditor.TakeFocus();Actions.Do(Actions.showKeyboard)}else{s();if(App.CurrentEditor!==null)App.CurrentEditor.RemoveFocus();Actions.Do(Actions.hideKeyboard)}};var l=function(){if(App.IsApps){return 0}return $(header).height()-Math.abs(parseInt($(header).css("top")))};r.click(function(){u()});$.subscribe("graphSlider/open",function(){o()});$.subscribe("graphSlider/close",function(){s()})};Page.Calculator=function(e,t){var r=$.query("#helppage-area");var n=$.query("#drawer");var i=$.query("#editor");var a=$.query("#did-you-mean");var o=$.query("#keyboard");var s=function(){Component.Drawer({contentContainer:document.getElementById("chat-area"),shouldClose:function(e){return(e.type==="mouseup"||e.type==="touchend")&&!Util.HasClassInDom("clickable",e.target)&&!Util.HasClassInDom("popup-container",e.target)},onOpenProgress:function(){$.publish("layout/chat")},onCloseProgress:function(){$.publish("layout/chat")}});App.CurrentEditor.Paste(t)};var u=function(){var e=0;e+=i.height();e+=a.height();e+=o.height();e+=2;n.css("height",e+"px");n.css("bottom",0);r.css("bottom",e+"px")};$.subscribe("editorContentUpdate",function(e){u()});$.subscribe("dym/state",function(e){u()});$.subscribe("window/resize",function(){u()});Scheduler.Add({label:"Open and Lock Drawer",priority:5,evalFn:function(){return true},execFn:function(){$.publish("Scheduler/Next")}});Scheduler.Add({label:"Calculator Page Initialization",priority:45,evalFn:function(){return true},execFn:function(){s();$.publish("Scheduler/Next")}});Scheduler.Add({label:"Unlock Drawer",priority:100,evalFn:function(){return true},execFn:function(){$.publish("drawer/unlock");$.publish("Scheduler/Next")}})};Page.RedeemGiftCard=function(){var e=1999;var t=7999;var r=null;var n=null;var i=true;var a=$.query("#redeem-gift-card");var o=$("#gc-redemption-code");var s=$("#redeem-gc");var u=$("#redeem-invalid-subscription");s.on("click",function(){UI.spinner.show();var e=true;if(o.val()==""){UI.spinner.hide();e=false;o.addClass("invalid")}else{o.removeClass("invalid")}if(Auth.userstate.isSubscribed&&Auth.userstate.MWSubscriptionSource!=1)e=false;if(e)Recurly.redeemGiftCard({userid:Auth.userstate.userId,redemptionCode:o.val()},function(e){if(e.status<0){GenericDialog.open(e.message)}else{if(i)l(e);else p()}})});var l=function(i){Recurly.init();Recurly.getPrices(function(a,o){r=a;if(i.giftCard!=="undefined"){switch(i.giftCard.UnitAmountInCents){case e:n=r.monthly.code;break;case t:n=r.annual.code;break}c()}})};var c=function(){Recurly.subscribe({purchasetype:"gift-card",tokenid:"",plancode:n,couponcode:""},function(e){if(e.status<0)GenericDialog.open(API.serverError(e.messageId));else{p(e)}})};var p=function(e){GoogleAnalytics.send({eventCategory:"gift card",eventAction:"User redeemed a Gift Card",eventLabel:WebStorage.anonUserId.get()});UI.spinner.hide();if(i)Util.Redirect("/Thanks/RedeemUpgrade");else Util.Redirect("/Thanks/RedeemCredit")};a.on("submit",function(e){e.preventDefault()});if(!Auth.isLoggedIn()){$.publish("dialog/open",["login",false,"signin",true]);$.publish("dialog/modal",["login"]);return}else{if(Auth.userstate.isSubscribed&&Auth.userstate.MWSubscriptionSource!=1){s.attr("disabled","disabled");u.show()}else{if(Auth.userstate.isSubscribed&&Auth.userstate.MWSubscriptionSource==1)i=false}}$.subscribe("overlay/hide",function(){UI.spinner.hide()})};Page.Upgrade=function(){var e=function(){Util.Redirect(App.getHomeLink())};if(!Auth.isLoggedIn()){e();return}if(Auth.hasSubscription()){e();return}UpgradeCore.onOpen($("#upgrade-page-container"),true);$.subscribe("dialog/option",function(t){if(t==="upgrade"){e();return}})};Page.Worksheet=function(e){const t="Algebra";const r=84;const n=47;var i=$("#drawer");var a=$("#did-you-mean");var o=$("#editor");var s=$.query("#keyboard");var u=$.query("#worksheet-area");var l=$.query("#worksheet-area > .cell");var c=$.query("#worksheet-subject");var p=$.query("#worksheet-topic");var d=$.query("#worksheet-subject-select select");var f=$.query("#worksheet-topic-select select");var h=$.query("#worksheet-clear");var m=$.query("#worksheet-create-button");var g=$.query("h4");var v=$.query("h5");var b=$.query("#worksheet-preview");var y=$.query("#worksheet-problems");var w=$.query("#worksheet-numproblems");var C=$.query("#worksheet-columns");var S=$.query("#worksheet-spacing");var x=$.query("#worksheet-shownamedate");var A=$.query(".name-date");var T=$.query("#worksheet-options");var I=$.query("#worksheet-settings");var E=I.children(".mw-settings");var P=$.query(".settings-menu");var k=$.query("#worksheet-print");var M=null;var D=false;var L=[];var R=[];var N="";var U="";var F=0;var O="";const B={ID:0,Header:Strings.Worksheet.Header,Subheader:Strings.Worksheet.Subheader,Cols:3,ProblemSpacing:6,NumProblems:6,Problems:[]};var H=B;var q=function(e,t,r){e.forEach(function(e,n){if(e.category==="subject"){t=e.translated;L.push({value:e.value,text:e.translated})}if(e.category==="chapter")r=e.translated;if(e.category==="topic"){R.push({id:e.value,subject:t,chapter:r,topic:e.translated})}q(e.children,t,r)})};var G=function(e){var t;L.forEach(function(r,n){if(r.value===e){t=r;return false}});return t};var _=function(e){var t;R.forEach(function(r,n){if(r.topic===e){t=r;return false}});return t};var W=function(e){var t=[];R.forEach(function(r,n){if(r.subject===e){t.push(r)}});return t};var z=function(e){H=B;g.html(Strings.Worksheet.Header);g.attr("data-asciitext","");v.html(Strings.Worksheet.Subheader);v.attr("data-asciitext","");j(e)};var j=function(e){if(typeof e!=="undefined")e.preventDefault();Actions.Do(Actions.showSpinner);var t={id:H.ID,userId:Auth.isLoggedIn()?Auth.userstate.userId:0,subject:N,chapter:U,topicId:F,topicText:O,qty:w.val(),cols:C.val(),problemSpacing:S.val(),header:g.html(),subheader:v.html(),showNameDate:x.is(":checked")};API.saveWorksheet(t,function(e){if(e.status!==1){Popup.show(Strings.Errors.Generic);Actions.Do(Actions.hideSpinner);return}H=e.worksheet;X();$.query("#drawer").show();$.publish("window/resize");Actions.Do(Actions.hideSpinner)})};var V=function(e){j()};var Q=function(e,t,r){var n=$("<td></td>").addClass("problem");var i=$("<div></div>").addClass("problem-wrap");if(typeof r!=="undefined")i.attr("data-id",r);i.attr("data-asciitext",e);var a=$("<span></span>").addClass("editorLine editable");a.html(t);a.on("click",te);a.appendTo(i);if(t===Strings.Worksheet.ClickToEdit)n.addClass("empty");i.appendTo(n);return n};var Y=function(){var e=$("<tr></tr>");H.Problems.forEach(function(t,r){if(r%H.Cols===0){if(e.children().length>0)e.appendTo(y);e=$("<tr></tr>")}var n=Q(t.ProblemText,t.MathML,t.ID);n.appendTo(e)});if(e.children().length>0)e.appendTo(y)};var X=function(){y.html("");var e=$("<tr></tr>");if(H.Problems.length===0){for(var t=0;t<H.Quantity;t++){if(t%H.Cols===0){if(e.children().length>0)e.appendTo(y);e=$("<tr></tr>")}var r=Q(Strings.Worksheet.ClickToEdit,Strings.Worksheet.ClickToEdit);r.appendTo(e)}if(e.children().length>0)e.appendTo(y);y.removeClass().addClass("cols-"+H.Cols).addClass("spacing-"+H.ProblemSpacing);b.show();T.addClass("on")}else{Y();y.removeClass().addClass("cols-"+H.Cols).addClass("spacing-"+H.ProblemSpacing);MathJax.Hub.Queue(["Typeset",MathJax.Hub,y[0],function(){if(H.Problems.length<H.Quantity){var e=H.Quantity-H.Problems.length;var t=y.find("tr:last");if(t.children().length===H.Cols)t=$("<tr></tr>");for(var r=0;r<e;r++){if(t.children().length===H.Cols){t.appendTo(y);t=$("<tr></tr>")}var n=Q(Strings.Worksheet.ClickToEdit,Strings.Worksheet.ClickToEdit);n.appendTo(t)}if(t.children().length>0&&t.closest("table").length===0)t.appendTo(y)}b.show();T.addClass("on")}])}};var K=function(){var e=App.CurrentEditor.GetSolverStrings();var t=e.ascii;var r=e.html;if(!re())return;Z(M,t,r);$(".editable").removeClass("on");M.removeClass("on");M=null;App.CurrentEditor.Clear()};var J=function(e){e.addClass("on");M=e;var t=M.attr("data-asciitext");var r=false;var n=t==null||t===""||t=="undefined";if(e.hasClass("problem-wrap")){if(!n&&t!==Strings.Worksheet.ClickToEdit)r=true}else if(e[0].localName==="h4"){if(!n&&t!==Strings.Worksheet.Header)r=true}else if(e[0].localName==="h5"){if(!n&&t!==Strings.Worksheet.Subheader)r=true}if(r){App.CurrentEditor.Clear();App.CurrentEditor.Paste(t)}App.CurrentEditor.TakeFocus();$.publish("drawer/open");me()};var Z=function(e,t,r){var n=e.attr("data-asciitext");var i=n!==t&&t!==""&&t!==Strings.Worksheet.ClickToEdit;if(i){e.attr("data-asciitext",t);if(e.hasClass("problem-wrap")){ee(e,r)}else{j()}}};var ee=function(e,t){var r=e.attr("data-id");if(typeof r==="undefined"||r===null)r=0;API.saveWorksheetProblem({id:r,worksheetId:H.ID,asciiText:e.attr("data-asciitext"),mathML:t},function(t){if(t.status===1&&t.worksheetProblem!=null){e.attr("data-id",t.worksheetProblem.ID);j()}})};var te=function(e){e.preventDefault();K();var t=$(this);if(t.parent().hasClass("problem-wrap"))t=t.parent();J(t)};var re=function(){if(typeof M==="undefined")return false;if(M===null)return false;if(M.length===0)return false;return true};var ne=function(e){if(e===""){d[0].selectize.setValue(t);e=t}var r=G(e);if(r.text!==N&&F>0){H=B;b.hide();T.removeClass("on");i.hide()}N=r.text;$.publish("keyboard/change",[e.replace(/\s+|-/g,"")]);oe()};var ie=function(){d.selectize({valueField:"value",labelField:"text",options:L,items:[t],searchField:["text"],create:false,render:{option:function(e,t){return'<div class="filter-option"><div class="result-subject">'+e.text+"</div></div>"}},onChange:ne});ne(t);c.show()};var ae=function(e){if(e!==""){h.show();var t=_(e);if(t.value!==O){H=B;g.html(Strings.Worksheet.Header);g.attr("data-asciitext",Strings.Worksheet.Header);v.html(Strings.Worksheet.Subheader);v.attr("data-asciitext",Strings.Worksheet.Subheader);b.hide();T.removeClass("on")}U=t.chapter;F=t.id;O=e}else{h.hide();U="";F=0;O=""}};var oe=function(){var e=typeof f[0].selectize==="undefined";if(e){f.selectize({valueField:"topic",labelField:"topic",options:W(N),searchField:["topic","chapter"],render:{option:function(e,t){return'<div class="filter-option"><div class="result-chapter">'+e.chapter+'</div><div class="result-topic">'+e.topic+"</div></div>"}},onChange:ae})}else{f[0].selectize.clearOptions();f[0].selectize.load(function(e){e(W(N))})}p.show()};var se=function(){var e=l.scrollTop()+M.offset().top-80;l.scrollTop(e)};var ue=function(){return s.outerHeight(true)};var le=function(){return o.outerHeight(true)};var ce=function(){return a.css("display")==="block"?a.outerHeight(true):0};var pe=function(){return ue()+ce()+le()};var de=function(){i.height(pe())};var fe=function(){de();return i.hasClass("opened")?pe():le()};var he=function(){de();return i.hasClass("opened")?0:-(ue()+ce())};var me=function(e){i.css({bottom:he()});u.css({bottom:fe()});if(typeof e==="function")e()};$.subscribe("editorContentUpdate",function(e){var t=e.GetSolverStrings();var r=t.ascii;var n=t.html;if(!re())return;var i=r===""||r===null||r==="undefined";if(i)M.attr("data-asciitext","");if(M.hasClass("problem-wrap")){var a=i?Strings.Worksheet.ClickToEdit:r;M.html(n);var o=M.children(".editorLine");o.addClass("editable on");o.on("click",te);if(i){o.text(a);o.closest("td").addClass("empty")}else{MathJax.Hub.Queue(["Typeset",MathJax.Hub,o[0]]);o.closest("td").removeClass("empty")}}else if(M[0].localName==="h4"){var a=i?Strings.Worksheet.Header:n;M.html(a);if(a===Strings.Worksheet.Header)M.addClass("default");else M.removeClass("default");MathJax.Hub.Queue(["Typeset",MathJax.Hub,M[0]])}else if(M[0].localName==="h5"){var a=i?Strings.Worksheet.Subheader:n;M.html(a);if(a===Strings.Worksheet.Subheader)M.addClass("default");else M.removeClass("default");MathJax.Hub.Queue(["Typeset",MathJax.Hub,M[0]])}me()});$.subscribe("dym/state",function(e){me()});$.subscribe("drawer/opened",function(){if(re()){me(function(){se()})}else{var e=y.find(".problem-wrap").first();if(e.length===0)return;J(e)}});$.subscribe("drawer/closed",function(){if(re()){K()}me()});$.subscribe("document/mouseup",function(e){if(P.is(e.target)||P.has(e.target).length>0)return;if($(e.target).hasClass("mw-settings")){I.toggleClass("on");return}I.stop().removeClass("on")});Component.Drawer({contentContainer:u[0],shouldClose:function(e){return e.type==="mouseup"&&!Util.HasClassInDom("editable",e.target)},onStart:function(){i.hide()}});m.on("click",z);P.on("click",function(e){e.stopPropagation()});x.on("click",function(e){A.toggle()});k.on("click",function(e){window.print()});b.on("click",".editable",te);h.on("click",function(e){e.preventDefault();f[0].selectize.setValue("")});w.on("change",V);C.on("change",V);S.on("change",V);x.on("change",V);if(typeof e==="undefined"){Actions.Do(Actions.showSpinner);API.getAllExamples("",function(e){if(e.status!==1&&e.nodes!=null){Popup.show(Strings.Errors.Generic);Actions.Do(Actions.hideSpinner);return}q(e.nodes);ie();Actions.Do(Actions.hideSpinner)})}};Page.WorksheetList=function(e){var t={};var r=$.query(".example-node");var n=$.query("#ex-input");var i=$.query("#ex-results");var a=$.query("example-graph");$.query("#wl-subjects").change(function(){Util.Redirect($(this).val())});var o=function(e,r,n){for(var i=0,a=e.length;i<a;i++){switch(e[i].category){case"subject":if(e[i].children.length>0){o(e[i].children,e[i].text)}break;case"chapter":if(e[i].children.length>0){o(e[i].children,r,e[i].text)}break;case"topic":t[e[i].value]={subject:r,chapter:n,topic:e[i].text,link:e[i].link,id:e[i].value};break}}};var s=function(e){var r=new Sifter(t,{diacritics:true});var n=r.search(e,{fields:["topic","subject"],conjunction:"and"});return n};var u=function(e,r){i.empty();var n=$("<div></div>");for(var a=0,o=e.length;a<o;a++){var s=t[e[a].id];n.append($("<a></a>").attr("href",s.link).addClass("result-single").append($("<div></div>").addClass("result-subject").appendText(s.subject)).append($("<div></div>").addClass("result-topic").appendText(s.topic)))}i.append(n);for(var a=0,o=r.length;a<o;a++){findAndReplaceDOMText(document.getElementById("ex-results"),{find:r[a].regex,wrap:"span"})}i.show()};n.keyup(function(){var e=$(this).val();if(e.length>0){var t=s(e);u(t.items,t.tokens)}else{i.empty();i.hide()}});r.click(function(e){if(this.getAttribute("data-category")==="topic")return;e.preventDefault();var t=this.nextElementSibling;var r=this.previousElementSibling;if(t!==null&&$(t).hasClass("example-children")){var n=window.getComputedStyle(t,null);if(n.display==="none"){l(t,r)}else{c(t,r)}}});var l=function(e,t){$(t).addClass("main-open");$.Velocity(e,"stop");$.Velocity(e,"slideDown",{display:"block",duration:150,easing:"easeOutQuad"})};var c=function(e,t){$(t).removeClass("main-open");$.Velocity(e,"stop");$.Velocity(e,"slideUp",{display:"none",duration:100,easing:"easeInQuad"})};o(e.examples)};Pages.Web=function(){var e={};var t=function(){Component.Header();Component.CultureHint();Component.Mobile();Component.Subjects();Component.Member();Component.ShowMore();Component.UserMenu();Component.Login();Component.ForgotPassword();Component.GDPR();Component.AskOurExperts();$.publish("auth/loadFacebook")};var r=function(e){Component.Tutoring(e);Component.RateTutor();Component.TutorInvite();Component.TutorToggle();Component.TutorToolbar();Component.TutorNotifier.init();Component.TutorMacros();Component.TutorFormulas();Component.CameraDialog()};e.Subject=function(e){var t=App.getQueryParam("signIn");var n=App.getQueryParam("signUp");if(n===false){n=App.getQueryParam("pr")}if(App.isAndroidDevice){$("body, html").addClass("kill-swipe")}var i=JSON.parse(WebStorage.PresetProblem.get());if(i===null){function a(e){var t=App.getQueryParam(e);if(t)return t;else return null}i={asciiMath:a("asciimath"),topic:{Id:a("topicId"),Text:a("topicText"),CustomData:a("customData")}}}var o=!!(i&&i.asciiMath);var s=n!==false||t!==false;if(o)s=true;Component.Tutorials({defer:s});Component.Header();Component.CultureHint();Component.Mobile();Component.Subjects(e);Component.Member();Component.ShowMore();Component.UserMenu();Component.SetPasswordDialog();var u=n!==false?"signup":"";if(u==="")u=t!==false?"signin":"";Component.Login({startOpen:u});Component.StickyBottom();Component.Editor({subject:e,deferFocus:s||WebStorage.dismissedTutorial.get()===null});Component.TopicsDialog(e);if(o){Scheduler.Add({label:"Solve Preset Problem",priority:9,evalFn:function(){return true},execFn:function(){WebStorage.PresetProblem.remove();var e=Editor.AsciiToMathml(i.asciiMath);App.CurrentEditor.Replace(i.asciiMath);$.publish("solving/dispatch",[{topicId:i.topic.Id,topicText:i.topic.Text,asciiMath:i.asciiMath,mathML:e,customData:i.topic.CustomData,isOCR:false,asciiEdited:false,historyClick:false,isSpeech:false,fromExamples:false,fromPreset:true}]);$.publish("Scheduler/Next")}})}var l=false;if(o&&Auth.isLoggedIn())l=true;var c=o||n!==false&&!Auth.isLoggedIn()?false:true;var p=WebStorage.fromHelpPage.get();var d=false;if(typeof p!=="undefined"&&p!==null&&p!==""){c=false;d=true}Component.Solving(e);Component.ChatWeb({subject:e,sayHello:c,affiliate:false,deferHistory:!c,preset:o,splice:l,suppressGreeting:d,enableAdTest:true});if(n!==false&&!Auth.isLoggedIn())$.publish("check/resolve");Component.AutoComplete({subject:e,onlyFromCurrent:false});Component.Examples(e);Component.GlossaryTerm();Component.ProblemLink();Component.Matrix();Component.Trigonometry();Component.PeriodicTable();Component.Keyboard({subject:e});Component.ForgotPassword();Component.GDPR();Component.AskOurExperts();Component.GraphDialog();Component.ViewSteps(e);Component.TutorPreSession();r(e);Component.ImageUpload();Component.ImageCropDialog();Component.SurveyText();Auth.migrateUserObject();Component.WebWorker.init();$.publish("auth/loadFacebook")};e.DocumentEditor=function(e,t){Component.Header();Component.Subjects(e);Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.StickyBottom();Component.DocumentEditor();Component.Editor({subject:e,onSubmit:function(){$.publish("documentEditor/updateLine")},deferFocus:false});Component.TopicsDialog(e,false);Component.ChatWeb({subject:e,sayHello:function(){},affiliate:false,deferHistory:true,preset:false,splice:false,suppressGreeting:true,shouldCloseDrawer:function(){return false},ignoreSubjectChange:true});Component.AutoComplete({subject:e,onlyFromCurrent:false});Component.Matrix();Component.Trigonometry();Component.PeriodicTable();Component.Keyboard({subject:e});Component.GraphDialog();Component.ViewSteps(e);Component.SurveyText();Component.WebWorker.init()};e.Affiliate=function(e,t,r){if(typeof r!=="undefined"&&r!=="")t=Base64.decode(r);if(typeof t==="undefined"||t==="")t=null;var n=App.getQueryParam("affiliateid");if(n!==false)App.affiliateId=n;var i=e==="Graph"||e==="Graphing";if(i){return Pages.Web.Graph()}Component.Header(true);Component.Subjects(e);Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.StickyBottom();Component.Solving(e);Component.ChatWeb({subject:e,sayHello:true,affiliate:true,adDebug:false});Component.AutoComplete({subject:e,onlyFromCurrent:false});Component.Examples(e);Component.GlossaryTerm();Component.ProblemLink();Component.Editor({subject:e,affiliate:true,legacyDYM:false,problem:t});Component.TopicsDialog(e);Component.Matrix();Component.Trigonometry();Component.PeriodicTable();Component.Keyboard({subject:e});Component.ForgotPassword();Component.GraphDialog();Component.ViewSteps(e);Component.SurveyText();ChatBridge.affiliateMode=true;App.postAffiliateMessage(e);$.subscribe("subject/set",function(e){App.postAffiliateMessage(e)})};e.Graph=function(){Component.Header();Component.CultureHint({graphPage:true});Component.Mobile({graphPage:true});Component.Subjects("Graph");Component.Member();Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.SetPasswordDialog();Component.Login();Component.StickyBottom({chat:false,graph:true});var e=false;Component.EditorGraph({affiliate:false,legacyDYM:e});if(e===false){Component.AutoComplete({subject:"Algebra",graph:true,onlyFromCurrent:true})}Component.GlossaryTerm();Component.Examples("Graphing");Component.Keyboard({subject:"Graph"});Component.ForgotPassword();Component.GDPR();Component.Trigonometry();$.publish("auth/loadFacebook");Page.Graph({apps:false})};e.Worksheet=function(e){Component.Header();Component.CultureHint();Component.Mobile();Component.Member();Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.SetPasswordDialog();Component.Login();Component.Editor({subject:"Algebra",deferFocus:true,isWorksheet:true,affiliate:false});Component.AutoComplete({subject:"Algebra"});Component.Keyboard({subject:"Algebra"});Component.ForgotPassword();Component.GDPR();Component.Matrix();Component.Trigonometry();Component.PeriodicTable();$.publish("auth/loadFacebook");Page.Worksheet(e)};e.StepsPopout=function(e,t,r,n,i,a,o,s,u,l){$("body").addClass("apps-"+e);if(typeof JavascriptInterface==="undefined")JavascriptInterface=PlatformInterface.Testing;App.Interface=PlatformInterface({platform:"web"});$(function(){Actions.Do("PageLoaded")});Component.GlossaryTerm();Component.Apps.ViewSteps(t,r,n,i,a,o,s,u,l)};e.WorksheetList=function(e){e=e||{examples:{}};t();Page.WorksheetList(e)};e.Settings=function(){t();Component.Settings();Component.Billing();Component.CancelConfirm();Component.PauseAsk();Component.SetPasswordDialog()};e.SettingsVM=function(){t();Component.SettingsVM(function(){Component.CancelConfirm();Component.PauseAsk();Component.SetPasswordDialog()})};e.ResetPassword=function(){t();Component.ResetPassword()};e.Examples=function(e){e=e||{examples:{}};t();Page.Examples(e)};e.ExamplesChapter=function(){t();Page.ExamplesChapter()};e.ExamplesTopic=function(){t();Component.GlossaryTerm();Component.GraphDialog();Page.ExampleTopic()};e.PopularProblems=function(e){t();Page.PopularProblems()};e.PopularProblem=function(){Component.GlossaryTerm();Component.GraphDialog();Page.PopularProblem()};e.PopularProblemAlt=function(e,t){Component.Editor({subject:e,affiliate:false,isPopularProblem:true,onSubmit:function(){Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"Popular Problems ALT Keyboard/Editor",eventAction:"click",eventLabel:"Enter YOUR Problem ALT"});e=e==="PreAlgebra"||e==="FiniteMath"?"Algebra":e;var t=App.CurrentEditor.GetAsciiMath();WebStorage.fromHelpPage.set({subject:e,asciiMath:t});var r=App.baseUrl+App.urlPrefix+e;window.location=r}});$("#editor-submit").addClass("click-events");Component.AutoComplete({subject:e});Component.Keyboard({subject:e});Component.StickyBottom();Component.GDPR();Component.Matrix();Component.Trigonometry();Component.PeriodicTable();Component.GlossaryTerm();Component.GraphDialog();Page.PopularProblemAlt(e,t);Component.WebWorker.init()};e.Glossary=function(e){t();Page.Glossary(e)};e.About=function(){t()};e.Terms=function(){t()};e.Privacy=function(){t()};e.Editor=function(){t();Component.EditorTest()};e.AffiliateDashboard=function(){if(!Auth.isLoggedIn())Util.Redirect(App.getHomeLink());t();Component.AffiliateDashboard()};e.TutorDashboard=function(e,r){if(!Auth.isLoggedIn()||!Auth.hasRole(UserRoles.Tutor))Util.Redirect(App.getHomeLink());t();Component.TutorDashboard(e,r)};e.Offers=function(){t();Component.Offers()};e.Careers=function(){t()};e.TutorLanding=function(){t();Component.TutorLanding()};e.TutorSignUp=function(){t();Component.TutorSignUp()};e.AffiliatePage=function(){t()};e.Press=function(){t()};e.PageNotFound=function(){t()};e.ServerError=function(){t()};e.Upgrade=function(){t();Page.Upgrade()};e.GiftCards=function(){t();Page.GiftCards()};e.RedeemGiftCard=function(){t();Page.RedeemGiftCard()};e.AprilFools=function(){t()};e.Calculators=function(){t()};e.Calculator=function(e,t){Component.Header();Component.CultureHint();Component.Mobile();Component.Member();Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.Login();Component.Editor({subject:e,affiliate:false,isCalculator:true,onSubmit:function(){var t=App.CurrentEditor.GetAsciiMath();WebStorage.fromHelpPage.set({subject:e,asciiMath:t});var r=App.baseUrl+App.urlPrefix+e;window.location=r}});Component.AutoComplete({subject:e});Component.Keyboard({subject:e});Component.ForgotPassword();Component.GDPR();Component.Matrix();Component.Trigonometry();Component.PeriodicTable();$.publish("auth/loadFacebook");Page.Calculator(e,t);Component.WebWorker.init()};e.Formulas=function(){t();Page.Formulas()};e.ExpertAnswerCompose=function(e,t,r,n,i,a,o,s,u){Component.Header();Component.Member();Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.ExpertSubject();Component.StickyBottom();Page.ExpertAnswerCompose({subject:e,answerId:t,imageURL:r,answerType:n,questionId:i,asciiMath:a,isProblem:o,topicText:s,userEmail:u});Component.Editor({subject:e,onSubmit:function(){$.publish("documentEditor/addLine")},onEdit:function(){$.publish("documentEditor/updateLine")},isExpertQA:true,deferFocus:false});Component.TopicsDialog(e,false);Component.GlossaryTerm();Component.ChatWeb({subject:e,sayHello:function(){},affiliate:false,deferHistory:true,preset:false,splice:false,suppressGreeting:true,shouldCloseDrawer:function(){return false},ignoreSubjectChange:true});Component.AutoComplete({subject:e,onlyFromCurrent:false});Component.Matrix();Component.Trigonometry();Component.PeriodicTable();Component.Keyboard({subject:e});Component.ImageUpload();Component.ImageCropDialog();Component.GraphDialog();Component.ViewSteps(e);Component.SurveyText();Component.WebWorker.init()};e.ExpertAnswerDashboard=function(){ExpertQA.DeferPolling=true;Component.Header();Component.Member();Component.ShowMore();Component.UserMenu();Component.AskOurExperts();Component.Login();Page.ExpertAnswers();Component.WebWorker.init()};e.ExpertAnswerDetail=function(e){Component.Header();Component.Member();Component.ShowMore();Component.UserMenu();Component.GlossaryTerm();Component.GraphDialog();Component.AskOurExperts();Component.WebWorker.init();Page.ExpertAnswerDetail(e,true)};e.ExpertHistoricQuestion=function(e){Component.Header();Component.Member();Component.ShowMore();Component.UserMenu();Component.GlossaryTerm();Component.GraphDialog();Component.AskOurExperts();Component.WebWorker.init();Page.ExpertAnswerDetail(e,false)};e.Security=function(){t()};return e}();Component.AddStudent=function(){var e={email:null,firstName:null,lastName:null,"class":null,submitButton:null,submitMoreButton:null};var t;$.subscribe("addStudent/beforeShow",function(n){t=n;e.email=document.getElementById("sf-email");e.firstName=document.getElementById("sf-firstname");e.lastName=document.getElementById("sf-lastname");e.class=document.getElementById("sf-class");e.submitButton=document.getElementById("sf-submit");e.submitMoreButton=document.getElementById("sf-submit-more");e.firstName.focus();var i=$(e.class);$("#classes").children().each(function(e,t){var r=$(t),n=r.attr("data-classid"),a=r.find(".tab-title span:first").text();var o=$('<option value="'+n+'">'+a+"</option>");if(n==="0"){o.addClass("unassigned")}i.append(o)});$(e.submitButton).on("click",function(e){e.preventDefault();r(false)});$(e.submitMoreButton).on("click",function(e){e.preventDefault();r(true)})});var r=function(t){$(".sf-message").hide();var r={email:e.email.value,firstName:e.firstName.value,lastName:e.lastName.value,classId:$(e.class).val(),addMore:t};var i=Component.AddStudent.Validate(r);if(i.length===0){n(r)}else{for(var a=0,o=i.length;a<o;a++){$(".sf-message[data-msg-id='"+i[a]+"']").show()}}};var n=function(r){r=Util.Extend({email:null,firstName:null,lastName:null,classId:null,addMore:null},r||{});e.submitButton.setAttribute("disabled","disabled");e.submitMoreButton.setAttribute("disabled","disabled");API.createStudent(r.email,r.classId,r.firstName,r.lastName,function(n){if(n.status===ResponseStatuses.Success){n.student.classId=r.classId;t(n.student);if(!r.addMore)Popup.hide();else i()}else{var a="";switch(n.messageId){case ErrorCode.EmailInvalid:a=r.email+" is an invalid email.";
break;case ErrorCode.EmailTooLong:a=r.email+" is too long.  It must be 50 characters or less.";break;case ErrorCode.StudentAlreadyExists:a=r.firstName+" "+r.lastName+" already exists in one of your classes or in the unassigned group.";break;case ErrorCode.StudentHasSubscription:a=r.email+" is unavailable. Please add this student using a different email address.";break;default:a="There was a problem creating this student.  Please try again.";break}Popup.showError(a)}e.submitButton.removeAttribute("disabled");e.submitMoreButton.removeAttribute("disabled")})};var i=function(){e.email.value="";e.firstName.value="";e.lastName.value=""}};Component.AddStudent.Validate=function(e){e=Util.Extend({email:null,firstName:null,lastName:null,classId:null},e||{});var t=[];if(e.email!==null){if(typeof e.email!=="string"){t.push("emailinvalid")}else if(e.email.length===0){t.push("noemail")}else if(!Util.isRFC2822Email(e.email)){t.push("emailinvalid")}}else{t.push("noemail")}if(e.firstName!==null){if(typeof e.firstName!=="string"){t.push("firstnameinvalid")}else if(e.firstName.length===0){t.push("nofirstname")}}else{t.push("nofirstname")}if(e.lastName!==null){if(typeof e.lastName!=="string"){t.push("lastnameinvalid")}else if(e.lastName.length===0){t.push("nolastname")}}else{t.push("nolastname")}return t};Component.AffiliateDashboard=function(){var e=36;var t;var r=[];var n=function(){var e=this;this.tabs=[new c("earnings",new a),new c("affiliatecode",new o),new c("resources",new s),new c("settings",new u),new c("account",new l)];this.current=null;$.subscribe("affiliate/update",function(){e.setHeights()});$.subscribe("window/resize",function(){e.setHeights()})};n.prototype={initBindings:function(){var e=this;$.query(".accordian-title").click(function(){e.setCurrent(e.tabByName(this.getAttribute("data-name")))});$.query(".settings-button").click(function(){e.submit(e.tabByName(this.getAttribute("data-name")),this.getAttribute("data-action"))})},setCurrent:function(t){var r={duration:250,easing:"easeInQuint"};if(this.current!==null){this.current.toggle(false);$.Velocity(this.current.ele,{height:e+"px"},r)}if(this.current===t){this.current=null;return}this.current=t;$(this.current.ele).addClass("active");$.Velocity(this.current.ele,{height:this.current.height()},r)},submit:function(e,t){var r=e.action.validate(e.name);if(r)e.action.process(t);this.setHeights()},setHeights:function(){for(var t=0,r=this.tabs.length;t<r;t++){var n=this.tabs[t];$(n.ele).height(n.isActive()?n.height():e+"px")}},tabByName:function(e){for(var t=0,r=this.tabs.length;t<r;t++){if(this.tabs[t].name===e)return this.tabs[t]}return null}};var i=function(){};i.prototype={validate:function(e){return true},process:function(e){},message:function(e,t){$.query("#tab-"+e+" .validation-message[data-error-type="+t+"]").show()},reset:function(e){$.query("#tab-"+e+" .validation-message").hide()}};var a=function(){p()};a.prototype=new i;{$("#commission-results-area").hide()}a.prototype.constructor=a;a.prototype.process=function(e){Actions.Do(Actions.showSpinner);API.getTotalOrdersForAffiliate(Auth.userstate.MWaffiliateCode,$("#aff-date-start").val(),$("#aff-date-end").val(),function(e){if(e.status==1){$("#commission-results-area").show();if(e.orders!=null){$("#Commision").text("$"+e.orders.TotalRevenue);$("#Conversion").text(e.orders.TotalQuantity);$("#Signups").text(e.orders.TotalSignups);if(e.orders.TotalSignups>0){$("#ConversionRate").text(parseFloat(100*e.orders.TotalQuantity/e.orders.TotalSignups).toFixed(3)+"%")}else{$("#ConversionRate").text("N/A")}}$.publish("affiliate/update");Actions.Do(Actions.hideSpinner)}else{Actions.Do(Actions.hideSpinner)}})};a.prototype.validate=function(e){this.reset(e);var t=new Date($("#aff-date-start").val());var r=new Date($("#aff-date-end").val());var n=new Date;n.setHours(0,0,0,0);if(t==null||r==null){this.message(e,"check-date-range");return false}if(r<t){this.message(e,"check-date-range");return false}var i=r;i.setDate(r.getDate()-32);if(i>t){this.message(e,"dates-too-far");return false}return true};var o=function(){};o.prototype=new i;o.prototype.constructor=o;o.prototype.process=function(e){$("#widget").show();g({data:"",url:"",topic:""},Auth.userstate.MWaffiliateCode);$.publish("affiliate/update")};var s=function(){};s.prototype=new i;s.prototype.constructor=s;var u=function(){};u.prototype=new i;u.prototype.constructor=u;u.prototype.validate=function(e){this.reset(e);if(!Util.isRFC2822Email($("#aff-paypal-email").val())){this.message(e,"invalid-email");return false}return true};u.prototype.process=function(e){API.savePromo(Auth.userstate.MWaffiliateCode,t.MWdays,t.MWMonths,t.MWrate,t.MWavailable,$("#aff-paypal-email").val(),t.W9Status,t.LandingPageHTML,function(e){if(e.status==1){Popup.show("Your email has been updated.")}})};var l=function(){};l.prototype=new i;l.prototype.constructor=l;var c=function(e,t){this.name=e;this.id="tab-"+e;this.ele=document.getElementById(this.id);this.content=document.querySelector("#"+this.id+" .accordian-content");this.action=t};var p=function(){if(!Auth.hasRole(UserRoles.Affiliate)||Auth.userstate.MWaffiliateCode===null||Auth.userstate.MWaffiliateCode===""){Util.Redirect("/");return}d()};var d=function(){API.getPromo(Auth.userstate.MWaffiliateCode,function(e){if(e.status===ResponseStatuses.Success){t=e.promo;if(t.W9Status){$("#aff-w9-status").html("Form W-9 received")}else{$("#aff-w9-status").html("Form W-9 required")}$("#aff-paypal-email").val(t.PayPalEmail);var r=new Date;var n=new Date;n.setDate(r.getDate()-1);var i=new Date;i.setMonth(n.getMonth());i.setDate(1);i.setFullYear(n.getFullYear());TinyDatePicker(document.querySelector("#aff-date-start"));TinyDatePicker(document.querySelector("#aff-date-end"));$("#aff-date-start").val(i.toLocaleDateString());$("#aff-date-end").val(n.toLocaleDateString());$("#widget").hide();$.publish("affiliate/update")}})};var f=function(){return btoa(JSON.stringify(r))};var h=function(e,t){var n=window.document.location.protocol+"//"+document.location.host+"/ProblemWidget.aspx?affiliateid="+t;if(typeof e.url!=="undefined"&&e.url!==""){n+="&subject="+encodeURIComponent(e.url)}if(typeof e.eIdx!=="undefined"){r[e.eIdx]=e.data;n+="&problem="+f()}else if(typeof e.data!=="undefined"&&e.data!=="undefined"&&e.data!==""){n+="&problem64="+btoa(e.data)}return n};var m=function(e,t){$("#txtEmbed").val("<iframe src ='"+h(e,t)+"' frameborder='0' scrolling='no' style='width:100%;max-width:600px; height:565px; border:1px solid #E1E1E1;'></iframe>")};var g=function(e,t){$("#widget").attr("src",h(e,t))};var v=function(){var e=$("#widget")[0];if(e){e.contentWindow.focus()}};c.prototype={height:function(){return e+this.content.offsetHeight+"px"},isActive:function(){return $(this.ele).hasClass("active")},toggle:function(e){if(e){$(this.ele).addClass("active")}else{$(this.ele).removeClass("active")}}};(new n).initBindings();var b=window.addEventListener?"addEventListener":"attachEvent";var y=window[b];var w=b=="attachEvent"?"onmessage":"message";y(w,function(e){if(e.data.contains("mathwayMessage")){var t=e.data.replace(/\\/g,"\\\\");var r;try{r=JSON.parse(t)}catch(n){return}m(r,Auth.userstate.MWaffiliateCode)}},false);App.postAffiliateMessage(App.getQueryParam("subject"))};Component.AskOurExperts=function(){var e=null;$.subscribe("askExperts/beforeShow",function(n){e=Util.Extend({},n||{subject:"Algebra",topicId:0,topicText:"",asciiMath:"",mathML:"",solutionId:"",fromBubble:false,freeTrial:false});$("#aoe-question").on("click",function(e){e.preventDefault();t()});$("#aoe-tutor").on("click",function(e){e.preventDefault();r()});if(e.freeTrial){$(".eqa-trial-expert-live").show()}});$.subscribe("askExperts/beforeHide",function(){$("#aoe-question").off("click");$("#aoe-tutor").off("click");e=null;$(".eqa-trial-expert-live").hide()});var t=function(){Popup.hideAll(true);Actions.Do(Actions.createExpertQuestion,DtoHelper.CreateExpertQuestion({UserId:Auth.userstate.userId,AnonUserId:WebStorage.anonUserId.get(),DeviceString:App.deviceString(),Topic:{Id:e.topicId,Text:e.topicText},Subject:e.subject,Ascii:e.asciiMath,MathML:e.mathML,SolutionId:e.solutionId,Source:ExpertQA.GetSource(false,e.freeTrial,e.fromBubble,false)}))};var r=function(){Popup.hideAll(true);API.validateCredits(CreditType.Tutoring,function(t){if(t.status===1&&t.count>0||e.freeTrial){Actions.Do(Actions.studentRequestsTutor,DtoHelper.InviteRequest({UserId:Auth.userstate.userId,Topic:{Id:e.topicId,Text:e.topicText},Type:ChatUserType.Student,DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),Subject:e.subject,Ascii:e.asciiMath,MathML:e.mathML,SolutionId:e.solutionId,Reason:InviteReason.StepByStep,Source:ExpertQA.GetSource(true,e.freeTrial,e.fromBubble,!e.freeTrial)}))}else if(t.status===1&&t.count<=0){Actions.Do(Actions.showUpgrade,{startAtPayment:false,selectedPlan:undefined,source:UpgradeSource.viewSteps,InviteSource:ExpertQA.GetSource(true,e.freeTrial,e.fromBubble,true),tutorSessionAfterPurchase:true,UserId:Auth.userstate.userId,Topic:{Id:e.topicId,Text:e.topicText},Type:ChatUserType.Student,DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),Subject:e.subject,Ascii:e.asciiMath,MathML:e.mathML,SolutionId:e.solutionId,Reason:InviteReason.StepByStep})}else{}})}};Component.AutoComplete=function(e){e=$.extend({subject:"Algebra",graph:false,onlyFromCurrent:false},e||{});var t=$.query("#did-you-mean");var r=$.query("#dym-cellbody");var n=$.hubConnection();var i=n.createHubProxy("AutoCompleteHub");var a=App.Services.Sockets+"/sockets";var o=null;var s=null;var u=0;var l=1e3*60;var c=true;var p=true;var d=function(e,t,r){if(t.length>0)h(e,t,r);else m(e)};var f=function(e){return e.replace("	","\\t").replace("\n","\\n")};var h=function(n,i,a){t.removeClass("disabled");r.empty();var o=[];var s=[];for(var u=0,l=i.length;u<l;u++){try{var p=$("<td></td>").addClass("dym-suggestion").addClass("clickable").attr("keystrokes",i[u].FullKeystrokes).html(n.CreateMathMLFromKeystrokes(i[u].DisplayKeystrokes));s.push(f(i[u].DisplayKeystrokes));o.push(p)}catch(d){if(App.debug)Debug.warn(d)}}if(o.length>0){var h=$("<tr></tr>");for(u=0,l=o.length;u<l;u++){o[u].on("click",function(){if(!c)return;var t=this.getAttribute("keystrokes");if(typeof Tutor!=="undefined"){if(Tutor.inChatRoom()){if(a.indexOf("@mathway")>=0)t="@mathway "+t;else t="@mwsolve "+t}}$.publish("AutoSuggest/Log",[e.subject,a,s,$(this).index(),t]);n.ReplaceKeystrokes(t,true);n.TakeFocus()});r.append(o[u])}MathJax.Hub.Queue(["Typeset",MathJax.Hub,"dym-container",function(){var e=0;$(".dym-suggestion").each(function(t){var r=false;var n=this.children[0];if(n!==null){r=n.children.length>0?true:false}if(r){e++}else{$(this).remove()}});if(e>0){$.publish("layout/drawer");$.publish("dym/state",["on"])}else{m()}}])}else{m()}};var m=function(){r.empty().append($("<td></td>").addClass("dym-suggestion").append($("<div></div>").addClass("dym-placeholder")));$.publish("layout/drawer");$.publish("dym/state",["off"])};var g=function(){c=false;setTimeout(function(){c=true},150)};var v=function(r){n.url=a;n.logging=false;var c=false;if(typeof Tutor!=="undefined"){if(Tutor.inChatRoom()){p=false;t.addClass("disabled")}}n.error(function(e){b()});var f=function(){n.start().done(function(){c=true;y(App.CurrentEditor)})};var b=function(){n.stop();c=false};n.disconnected(function(){c=false});n.connectionSlow(function(){b()});var y=function(t){if(e.onlyFromCurrent&&t!==App.CurrentEditor)return;if(t===null)return;if(c===false){f();return}if(App.CurrentDocumentEditor!==null){var r=App.CurrentDocumentEditor.GetAtMathwayLines().map(function(e){return e.finalAnswerAsciiMath});r=r.filter(function(e){return e&&e!=="I am unable to solve this problem."});r=r.slice(Math.max(r.length-3,0));var n=[];for(var a=r.length-1;a>=0;a--){try{lineSplit=t.GetKeystrokes(true).split("\\|");var g=new Parser(r[a]).Parse().ToKeystrokeFormat();var v={DisplayKeystrokes:g,FullKeystrokes:lineSplit[0]+g+"\\|"+lineSplit[1],Index:-1};n.push(v)}catch(b){if(App.debug)Debug.warn(b)}}d(t,n,"")}else{var w=(new Date).getTime();if(u>0&&w<u+l)return;var C=t.GetKeystrokes(true);var S=typeof Tutor!=="undefined"?Tutor.inChatRoom():false;if(!p&&(C.startsWith("@mathway ")||C.startsWith("@mwsolve "))){p=true;h(t,[],t.GetKeystrokes(true))}else if(!p){return}else if(p&&S&&C==="\\|"){p=false;m();return}if(o===C&&s===e.subject)return;u=w;o=C;s=e.subject;C=C.replace("@mathway ","");C=C.replace("@mwsolve ","");i.invoke("GetAutoComplete",C,e.subject,WebStorage.anonUserId.get()).done(function(r){u=0;var n=t.GetKeystrokes(true);if(o===n&&s===e.subject){var i=[];for(var a=0;a<r.length;a++){i.push(r[a])}d(t,i,n)}else{y(t)}}).fail(function(e){u=0;m(t);if(App.debug)Debug.warn(e)})}};var w=function(e,t,r,n,a){var o=0;var s=WebStorage.anonUserId.get();if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")o=Auth.userstate.userId;if(c===false)f();i.invoke("LogAutoComplete",o,s,e,t,r.join("	"),n,a,App.deviceName).fail(function(e){if(App.debug)Debug.warn(e)})};if(!r){$.subscribe("editorContentUpdate",function(e){y(e)});$.subscribe("editorDYMUpdate",function(e){y(e)});$.subscribe("keyboard/change",function(t){e.subject=t;y(App.CurrentEditor)});$.subscribe("keyboard/prehide",function(){t.hide();$.publish(e.graph?"layout/drawer":"layout/chat")});$.subscribe("keyboard/hide",function(){t.hide();$.publish(e.graph?"layout/drawer":"layout/chat")});$.subscribe("keyboard/show",function(){t.show();g();$.publish(e.graph?"layout/drawer":"layout/chat")});$.subscribe("subject/set",function(t){e.subject=t;y(App.CurrentEditor)});$.subscribe("AutoSuggest/Log",function(e,t,r,n,i){w(e,t,r,n,i)});$.subscribe("autoComplete/init",function(){v(true)});$.subscribe("editor/focused",function(){y(App.CurrentEditor)});$.subscribe("Tutor/InviteAccepted",function(){p=false;t.addClass("disabled")});$.subscribe("tutor/leaveRoom",function(){p=true;t.removeClass("disabled")})}f()};Scheduler.Add({label:"Initialize AutoSuggest",priority:9,evalFn:function(){return true},execFn:function(){v();$.publish("Scheduler/Next")}})};Component.AvatarDialog=function(){const e=545;const t=600;const r=100;const n="avatar";const i="/images/userAvatarDefault.png";var a=$("body"),o,s,u,l,c,p,d,f,h,m,g;var v,b,y,w;var C;var S;var x;var A;var T;var I;var E;var P;var k;var M;var D;var L;var R;var N;var U;var F;var O;var B=false;var H;var q;$.subscribe("avatar/beforeShow",function(e){u=$(".avatar-inner");l=$("#avatar-upload");c=$("#avatar-scale");p=$("#avatar-camera");d=$("#avatar-swap");f=$("#avatar-take");h=$("#avatar-select");m=$("#avatar-update");g=$("#avatar-delete");v=null;b=[];y=e;w=false;h.on("click",function(e){l.trigger("click")});p.on("click",function(e){if(w)Q();else V()});f.on("click",function(e){Component.Camera.capture({captureType:Component.Camera.CaptureTypes.url,captureCallback:function(e){_(e);Q()}})});m.on("click",function(e){W()});l.on("change",function(e){Actions.Do(Actions.showSpinner);var t=$(this)[0].files[0];if(t!=null){var r=new FileReader;r.onload=function(e){url=e.target.result;_(url)};r.readAsDataURL(t)}});g.on("click",function(e){var t=Auth.userstate.userId+".png";API.uploadBlobImage(t,null,ImageType.ProfileImage,true,function(e){if(e.status===1){y=App.DefaultAvatarUrl;Auth.userstate.avatarUrl=App.DefaultAvatarUrl;Auth.setUserState(Auth.userstate);$.publish("AvatarRemoved");G()}})});c.on("input change",function(){k=$(this)[0].value;if(I*k<r*2){k=r*2/I;c.val(k)}if(E*k<r*2){k=r*2/E;c.val(k)}z()});q=$.subscribe("window/resize",function(){j()});j();G()});$.subscribe("avatar/afterHide",function(){$.unsubscribe(q);Q()});var G=function(){K();Devices.videoInput(Devices.ALL,function(e){b=e;if(y!==App.DefaultAvatarUrl){J();Y();g.show();_(y)}else{X();J();h.show();if(e.length>0)p.show();else p.hide();_(y)}})};var _=function(e){A=u.width();T=1e3;var t=e===App.DefaultAvatarUrl;x=new Image;x.crossOrigin="Anonymous";x.onload=function(){I=Math.min(x.width,A);E=Math.min(x.height,T);P=Math.min(I/x.width,E/x.height);I=Math.min(x.width*P,A);E=Math.min(x.height*P,T);M=I;D=E;k=1;N=0;U=0;F=0;O=0;L=I/2;R=E/2;K();S=document.createElement("canvas");S.setAttribute("id","avatar-canvas");S.setAttribute("width",M);S.setAttribute("height",D);S.style.left=(u.width()-M)/2+"px";S.style.top=(u.height()-D)/2+"px";u.append(S);u.off().on("mousedown touchstart",function(e){if(t)return;B=true;if(e.type==="touchstart"){N=F+e.originalEvent.changedTouches[0].clientX;U=O+e.originalEvent.changedTouches[0].clientY}else{N=F+e.offsetX;U=O+e.offsetY}}).on("mousemove touchmove",function(e){if(!B||t)return;if(e.type==="touchmove"){F=N-e.originalEvent.changedTouches[0].clientX;O=U-e.originalEvent.changedTouches[0].clientY}else{F=N-e.offsetX;O=U-e.offsetY}S.style.transform="translate("+F*-1+"px, "+O*-1+"px)"});H=$.subscribe("document/mouseup",function(e){if(B)B=false});if(t)m.hide();else m.show();Y();c.val(k);z();Actions.Do(Actions.hideSpinner)};x.src=e};var W=function(){Actions.Do(Actions.showSpinner);var e=document.createElement("canvas");var t=$(e);t.attr("width",M);t.attr("height",D);var n=e.getContext("2d");n.imageSmoothingEnabled=true;n.imageSmoothingQuality="high";n.fillStyle="white";n.fillRect(0,0,M,D);n.translate(M/2,D/2);n.translate(-M/2,-D/2);n.translate(-F,-O);n.drawImage(x,0,0,M*k,D*k);var i=n.getImageData(L-r,R-r,r*2,r*2);t.attr("width",r*2);t.attr("height",r*2);n.putImageData(i,0,0);e.toBlob(function(e){var t=Auth.userstate.userId+".png";API.uploadBlobImage(t,e,ImageType.ProfileImage,false,function(e){if(e.status===ResponseStatuses.Success){$.publish("AvatarUploaded",[e.value])}})},"image/jpeg",.7)};var z=function(){var e=M*k;var t=D*k;S.setAttribute("width",e);S.setAttribute("height",t);var r=S.getContext("2d");r.clearRect(0,0,e,e);r.imageSmoothingEnabled=true;r.imageSmoothingQuality="high";r.drawImage(x,0,0,e,t)};var j=function(){setTimeout(function(){L=u.width()/2;R=u.height()/2;var e=document.getElementById("avatar-overlay");if(e!==null)e.remove();C=document.createElement("canvas");C.setAttribute("id","avatar-overlay");C.setAttribute("width",u.width());C.setAttribute("height",u.height());u.append(C);var t=C.getContext("2d");t.save();t.beginPath();t.rect(0,0,u.width(),u.height());t.fillStyle="rgba(255,255,255,.8)";t.fill();t.globalCompositeOperation="destination-out";t.beginPath();t.arc(L,R,r,0,Math.PI*2,false);t.fillStyle="#fff";t.fill();t.restore();t.strokeStyle="#000";t.lineWidth=3;t.beginPath();t.arc(L,R,r,0,Math.PI*2);t.stroke()},500)};var V=function(){K();w=true;Component.Camera.open(u[0],{cameraType:Devices.BACK});p.val(p.attr("data-close"));J();p.show();if(b.length>1)d.show();f.show();$.subscribe("AvatarCaptured",function(e){_(e);Q()})};var Q=function(){w=false;Component.Camera.close();p.val(p.attr("data-open"));J();p.show();h.show()};var Y=function(){c.css("display","block")};var X=function(){c.hide()};var K=function(){var e=document.getElementById("avatar-canvas");if(e!==null){e.remove();$.unsubscribe(H)}};var J=function(){p.hide();f.hide();h.hide();m.hide();g.hide()}}();Component.Billing=function(){return;if(!Auth.isLoggedIn()){return}var e=null;var t=null;var r=$("#upgrade-plan-monthly");var n=$("#upgrade-plan-monthly-tutoring");var i=$("#upgrade-plan-quarterly");var a=$("#upgrade-plan-quarterly-tutoring");var o=$("#upgrade-plan-annual");var s=$("#upgrade-plan-annual-tutoring");var u=$(".upgrade-existing-current span");var l=$(".upgrade-existing-new span");var c=$(".billing-amount");var p=$(".billing-credit");var d=$(".live-tutor-info");var f=$("#pause-until");var h=$("#endofaccess");var m=$(".billing-pause-pending");var g=function(){API.getUpgradePlans(function(r){if(r.status!==ResponseStatuses.Success){$("#billing-upgrade").hide();return}e=r;var l=Strings.Settings.StepByStep;switch(Auth.userstate.MWSubscriptionType){case SubType.MonthlyExpertQA:case SubType.QuarterlyExpertQA:case SubType.YearlyExpertQA:l+=" + "+Strings.Settings.ExpertQA;break;case SubType.MonthlyTutoring:case SubType.QuarterlyTutoring:case SubType.YearlyTutoring:l+=" + "+Strings.Settings.LiveTutoring;break}var c="monthly";switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:case SubType.MonthlyExpertQA:case SubType.MonthlyTutoring:c=Strings.Upgrade.PerMonth;break;case SubType.Quarterly:case SubType.QuarterlyExpertQA:case SubType.QuarterlyTutoring:c=Strings.Upgrade.Quarter;break;case SubType.Yearly:case SubType.YearlyExpertQA:case SubType.YearlyTutoring:c=Strings.Upgrade.PerYear;break}u.text(l+" ("+Currency.FormatCurrency(v(r.currentPrice))+c+")");var p=false;if(typeof r.monthlyTutoring!=="undefined"&&App.Culture.isEnglish()&&App.upgradeAllowed()){n.val(r.monthlyTutoring.code);n.attr("data-price",r.monthlyTutoring.price);n.next().find("span").text(Currency.FormatCurrency(v(r.monthlyTutoring.price)));p=true}else{n.addClass("hidden");n.parent().hide()}var d=STM.Tests.Quarterly.enabled()||Auth.userstate.MWSubscriptionType===SubType.Quarterly;if(typeof r.quarterly!=="undefined"&&d){i.val(r.quarterly.code);i.attr("data-price",r.quarterly.price);i.next().find("span").text(Currency.FormatCurrency(v(r.quarterly.price)));p=true}else{i.addClass("hidden");i.parent().hide()}if(typeof r.quarterlyTutoring!=="undefined"&&d&&App.Culture.isEnglish()){a.val(r.quarterlyTutoring.code);a.attr("data-price",r.quarterlyTutoring.price);a.next().find("span").text(Currency.FormatCurrency(v(r.quarterlyTutoring.price)));p=true}else{a.addClass("hidden");a.parent().hide()}if(typeof r.annual!=="undefined"&&(Auth.userstate.MWSubscriptionType===SubType.Monthly||Auth.userstate.MWSubscriptionType===SubType.Quarterly)){o.val(r.annual.code);o.attr("data-price",r.annual.price);o.next().find("span").text(Currency.FormatCurrency(v(r.annual.price)));p=true}else{o.addClass("hidden");o.parent().hide()}if(typeof r.annualTutoring!=="undefined"&&App.Culture.isEnglish()&&(App.upgradeAllowed()||Auth.userstate.MWSubscriptionType===SubType.MonthlyTutoring||Auth.userstate.MWSubscriptionType===SubType.QuarterlyTutoring)){s.val(r.annualTutoring.code);s.attr("data-price",r.annualTutoring.price);s.next().find("span").text(Currency.FormatCurrency(v(r.annualTutoring.price)));p=true}else{s.addClass("hidden");s.parent().hide()}if(p){$("#billing-upgrade").show();t=$(".billing-upgrade-options input[type=radio]:not(.hidden)");t.on("click",function(e){$(".settings-billing-button[data-name=upgrade]")[0].removeAttribute("disabled")})}})};var v=function(e,t){if(typeof t!=="undefined"){e-=t;if(e<0)e=0}var r=parseFloat(Number(e).toFixed(2));return r*100%100===0?r.toFixed(0):r.toFixed(2)};$.subscribe("splitTest/update",function(){if(STM.Tests.CreditPackPurchase.enabled()){if(Auth.userstate.MWSubscriptionType===SubType.Monthly||Auth.userstate.MWSubscriptionType===SubType.Quarterly){n.parent().hide();s.parent().hide()}else{$("#billing-upgrade").hide()}}});var b=false;var y=function(){var e=this;this.modules=[new S("active",new A),new S("pause",new I),new S("upgrade",new T),new S("reactivate",new L),new S("resume",new ActionResume),new S("info",new U),new S("cancel",new R),new S("itunes",new k),new S("google",new M),new S("amazon",new D)];$.subscribe("billing/changed",function(t){b=false;e.clear();if(t!==null){$.query("#billing-success-message").html(t).show();var r=setTimeout(function(){$.query("#billing-success-message").hide();clearTimeout(r)},4e3)}e.init()});$.subscribe("upgrade/success",function(){e.init()})};$.subscribe("billing/updated",function(){w()});var w=function(){$(".billing-module").removeClass("no-border");var e=$("div.billing-module:visible");if(typeof e!=="undefined"&&e.length>0){var t=e[e.length-1];$(t).addClass("no-border")}};y.prototype={init:function(){var e=this;var t;$.query(".settings-billing-button").off().click(function(){B();e.submit(e.moduleByName(this.getAttribute("data-name")),this.getAttribute("data-action"))});d.off().on("click",function(e){e.preventDefault();Popup.showTutorLearnMore()});var r=e.moduleByName("active");r.hide();$.query("#stepbystep-off").hide();$.query("#stepbystep-on").hide();$.query("#stepbystep-upgrade").hide();$.query(".status-enddate").hide();$.query(".billing-cancelled-active").hide();$.query(".billing-cancelled-inactive").hide();m.hide();h.hide();e.moduleByName("info").hide();e.moduleByName("active").hide();e.moduleByName("pause").hide();e.moduleByName("upgrade").hide();e.moduleByName("resume").hide();e.moduleByName("cancel").hide();if(!Auth.hasSubscription()){$.query("#stepbystep-off").show();$.query("#stepbystep-upgrade").show();if(Auth.userstate.MWSubscriptionSource!==SubSource.Recurly||Auth.userstate.SubscriptionStatus===SubStatus.Expired){$.query("#tab-billing").hide();$("[data-recurly=card]").remove()}}else{$.query("#stepbystep-on").show();if((Auth.userstate.MWSubscriptionType===SubType.Monthly||Auth.userstate.MWSubscriptionType===SubType.Quarterly||Auth.userstate.MWSubscriptionType===SubType.Yearly)&&App.upgradeAllowed()){$.query("#stepbystep-upgrade").show()}if(Auth.userstate.MWSubscriptionSource===SubSource.NotSet){$.query("#tab-billing").hide();$("[data-recurly=card]").remove()}if(Auth.userstate.MWSubscriptionSource===SubSource.Recurly){g()}}$("#settings-tab-container").css("visibility","visible");Actions.Do(Actions.hideSpinner);switch(Auth.userstate.MWSubscriptionSource){case SubSource.NotSet:$.query("#billing-date-label").html(Strings.Settings.BillingCompedText);r.action.init(Auth.userstate.subEndDate);if(Auth.hasSubscription()&&!Auth.hasRole(UserRoles.Student)&&!Auth.hasRole(UserRoles.Teacher)&&!Auth.hasRole(UserRoles.OrgAdmin)&&!Auth.hasRole(UserRoles.OrgOwner))$.query(".status-enddate").show();break;case SubSource.Recurly:var n=e.moduleByName("info");n.show();n.action.init();switch(Auth.userstate.SubscriptionStatus){default:case SubStatus.Expired:$("#tab-billing").hide();return;case SubStatus.Paused:r.action.init(Auth.userstate.nextBillingDate);e.moduleByName("resume").show();e.moduleByName("cancel").show();break;case SubStatus.PausePending:m.show();h.find(".date").text(Util.formatDateShort(new Date(parseInt(Auth.userstate.subEndDate.substr(6)))));h.show();$(".settings-billing-cancel-pause-button").show();case SubStatus.Active:r.action.init(Auth.userstate.nextBillingDate);$.query("#stepbystep-off").removeClass("on");$.query("#stepbystep-on").addClass("on");e.moduleByName("active").show();switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:case SubType.MonthlyExpertQA:case SubType.MonthlyTutoring:if(Auth.userstate.SubscriptionStatus!==SubStatus.PausePending){e.moduleByName("pause").show()}break}e.moduleByName("cancel").show();break;case SubStatus.Cancelled:r.action.init(Auth.userstate.subEndDate);$.query("#billing-date-label").html(Strings.Settings.BillingEndsOn);e.moduleByName("reactivate").show();e.moduleByName("cancel").hide();if(Auth.hasSubscription()){$.query("#stepbystep-on").show();$.query(".billing-cancelled-active").show();$.query(".status-enddate").show()}else{$.query("#stepbystep-off").show();$.query(".billing-cancelled-inactive").show();$.query("#stepbystep-upgrade").show()}break}$.publish("billing/updated");break;case SubSource.GooglePlay:e.moduleByName("google").show();Actions.Do(Actions.hideSpinner);break;case SubSource.iTunes:e.moduleByName("itunes").show();Actions.Do(Actions.hideSpinner);break;case SubSource.Amazon:e.moduleByName("amazon").show();Actions.Do(Actions.hideSpinner);break}w()},submit:function(e,t){var r=e.action.validate();if(r)e.action.process(t)},clear:function(){var e=this;$.query("#billing-success-message").hide();$.query(".settings-billing-button").unbind("click");for(var t=0,r=e.modules.length;t<r;t++){e.modules[t].hide()}},moduleByName:function(e){for(var t=0,r=this.modules.length;t<r;t++){if(this.modules[t].name===e)return this.modules[t]}return null}};var C=function(){var e=this;(new y).init()};var S=function(e,t){this.name=e;this.id="billing-"+e;this.ele=document.getElementById(this.id);this.visible=true;this.action=t};S.prototype={show:function(){var e=this;e.ele.style.display="block"},hide:function(){var e=this;e.ele.style.display="none"}};var x=function(){};x.prototype={validate:function(){return true},process:function(e){}};var A=function(){};A.prototype=new x;A.prototype.init=function(e){var t=new Date(parseInt(e.substr(6)));var r=new Date(parseInt(Auth.userstate.nextBillingDate.substr(6)));$.query("#next-billing-date").html(Util.formatDate(t));$.query("#stepbystep-enddate").html(Util.formatDateShort(t));var n=Auth.userstate.SubscriptionStatus===SubStatus.Paused?Util.formatDateShort(r):Util.formatDateShort(t);$.query(".billing-date").html(n)};var T=function(){};T.prototype=new x;T.prototype.init=function(){};T.prototype.validate=function(){var e=Auth.userstate.subEndDate;API.refreshUserState(function(t){if(t.status!==1)return false;if(Auth.userstate.subEndDate!==e){Popup.showConfirm(Strings.Settings.SessionExpired,function(){location.reload()});return false}});return true};T.prototype.process=function(){if(b)return;var r="";var u="";var l=t.filter(":checked");var c=l.val();var p;if(c.includes("monthly-premium-tutoring")){p="("+n.next().find("span").text()+Strings.Upgrade.PerMonth+")";r=Strings.Settings.ConfirmUpgradeMonthlyTutoring.replace("{PRICE}",p)}else if(c.includes("quarterly-premium-tutoring")){p="($"+a.next().find("span").text()+Strings.Upgrade.Quarter+")";r=Strings.Settings.ConfirmUpgradeQuarterlyTutoring.replace("{PRICE}",p)}else if(c.includes("annual-premium-tutoring")){p="($"+s.next().find("span").text()+"/year)";r=Strings.Settings.ConfirmUpgradeAnnualTutoring.replace("{PRICE}",p)}else if(c.includes("quarterly-premium")){p="($"+i.next().find("span").text()+Strings.Upgrade.Quarter+")";r=Strings.Settings.ConfirmUpgradeQuarterly.replace("{PRICE}",p)}else if(c.includes("annual-premium")){p="("+o.next().find("span").text()+Strings.Upgrade.PerYear+")";r=Strings.Settings.ConfirmUpgradeAnnual.replace("{PRICE}",p)}r+="  "+Strings.Settings.UpgradeRefundNote.replace("{REFUND}",Currency.FormatCurrency(e.refundAmount));Popup.showYesNo(r,function(){b=true;Actions.Do(Actions.showSpinner);API.upgradeSubscription(c,e.refundTimestamp,function(e){Actions.Do(Actions.hideSpinner);b=false;if(e.status===1){API.logTestEvent("settings-upgrade",-1,c);switch(Auth.userstate.MWSubscriptionType){case SubType.Quarterly:u=Strings.Settings.UpgradeSuccessQuarterly;break;case SubType.Yearly:u=Strings.Settings.UpgradeSuccessAnnual;break;case SubType.MonthlyTutoring:u=Strings.Settings.UpgradeSuccessMonthlyTutoring;break;case SubType.QuarterlyTutoring:u=Strings.Settings.UpgradeSuccessQuarterlyTutoring;break;case SubType.YearlyTutoring:u=Strings.Settings.UpgradeSuccessAnnualTutoring;break}Popup.show(u,{},{onOk:function(){Popup.hide()},afterHide:function(){Util.reload()}})}else{switch(e.messageId){case 71:Popup.show(Strings.Errors.NoPaymentMethod);break;default:Popup.show(Strings.Settings.UpgradeError);break}}})})};var I=function(){E();f.on("change",function(e){if(f.val()===""){$(".settings-billing-pause-button")[0].setAttribute("disabled","disabled")}else{$(".settings-billing-pause-button")[0].removeAttribute("disabled")}});var e=$(".settings-billing-cancel-pause-button");e.on("click",function(e){Popup.showConfirm(Strings.Settings.CancelPauseConfirm,function(){Actions.Do(Actions.showSpinner);API.pauseSubscription(0,true,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){f[0].selectedIndex=0;$.publish("billing/changed",[Strings.Settings.CancelPauseSuccess])}else{Popup.show(Strings.Settings.PauseError)}})})});$.subscribe("billing/changed",function(){if(Auth.userstate.SubscriptionStatus===SubStatus.PausePending){e.show()}else{e.hide()}})};I.prototype=new x;I.prototype.process=function(){if(b)return;var e=parseInt(f.val());var t=new Date(parseInt(Auth.userstate.subEndDate.substr(6)));var r=t;var n=DateHelper.addMonths(t,r,e);var i=DateHelper.format(n,"mm/dd/yyyy");var a=Strings.Settings.PauseConfirm.replace("{DATE}",i);Popup.showConfirm(a,function(){b=true;Actions.Do(Actions.showSpinner);API.pauseSubscription(e,false,function(e){Actions.Do(Actions.hideSpinner);b=false;if(e.status===ResponseStatuses.Success){$.publish("billing/changed",[Strings.Settings.PauseSuccess]);
}else{Popup.show(Strings.Settings.PauseError)}})})};var E=function(){f.html("");$('<option value="">'+Strings.Settings.PauseDefaultOption+"</option>").appendTo(f);var e=new Date(parseInt(Auth.userstate.subEndDate.substr(6)));var t=e;for(var r=1;r<=6;r++){t=DateHelper.addMonths(e,t,1);$('<option value="'+r+'">'+Util.formatDateShort(t)+"</option>").appendTo(f)}$(".settings-billing-pause-button")[0].setAttribute("disabled","disabled")};var P=function(){};P.prototype=new x;P.prototype.process=function(){App.upgrade()};var k=function(){};k.prototype=new x;k.prototype.process=function(){Util.Redirect("https://support.apple.com/en-us/HT202039",true)};var M=function(){};M.prototype=new x;M.prototype.process=function(){Util.Redirect("https://support.google.com/googleplay/answer/2476088?hl=en",true)};var D=function(){};D.prototype=new x;D.prototype.process=function(){Util.Redirect("http://www.amazon.com/gp/help/customer/display.html?nodeId=201357590",true)};var L=function(){};L.prototype=new x;L.prototype.process=function(){if(b)return;b=true;Actions.Do(Actions.showSpinner);API.reactivateSubscription(Auth.userstate.userId,Auth.userstate.subscriptionId,function(e){Actions.Do(Actions.hideSpinner);b=false;if(e.status===ResponseStatuses.Success){$.publish("billing/changed",[Strings.Settings.ReactivateSuccess])}else{Popup.show(Strings.Settings.ReactivateError)}})};var R=function(){};R.prototype=new x;R.prototype.process=function(){Popup.showCancelConfirm(function(){Actions.Do(Actions.showSpinner);if(b)return;b=true;API.cancelSubscription(Auth.userstate.userId,Auth.userstate.subscriptionId,function(e){Actions.Do(Actions.hideSpinner);b=false;if(e.status===ResponseStatuses.Success){Popup.showCancellationSurvey();$.publish("billing/changed",[Strings.Settings.CancelSuccess]);$.query("#billing-active").hide();$.query(".status-enddate").show()}else{Popup.show(Strings.Settings.CancelError)}})})};var N=false;$.subscribe("billing/loadBillingTab",function(){if(N)return;Actions.Do(Actions.showSpinner);Recurly.configure();API.getRecurlyBilling(Auth.userstate.userId,function(e){N=true;Actions.Do(Actions.hideSpinner);if(e.billingInfo===null){$("#billing-info").hide();return}if(e.billingInfo!==null){$("#b-first-name").val(e.billingInfo.FirstName);$("#b-last-name").val(e.billingInfo.LastName);$("#b-cc-number").attr("placeholder","************"+e.billingInfo.LastFour);$("#b-select-exp-month").val(e.billingInfo.ExpirationMonth);$("#b-select-exp-year").val(e.billingInfo.ExpirationYear);$("#b-cc-country-codes").val(e.billingInfo.Country);$("#b-cc-zipcode").val(e.billingInfo.PostalCode)}if($("#b-cc-country-codes").val()===null||$("#b-cc-country-codes").val()===""){$("#b-cc-country-codes").val("US")}if($("#b-cc-country-codes").val()==="US"){$(".billing-postal-code").css("display","block")}else{$(".billing-postal-code").css("display","none")}})});$("#b-cc-country-codes").change(function(){if($("#b-cc-country-codes").val()==="US"){$(".billing-postal-code").css("display","block")}else{$(".billing-postal-code").css("display","none");$("#b-cc-zipcode").val("")}});var U=function(){};U.prototype=new x;U.prototype.init=function(){};U.prototype.validate=function(){return F()};U.prototype.process=function(){if(b)return;b=true;Actions.Do(Actions.showSpinner);var e=$("#billing-form");Recurly.updateBilling(e[0],O)};var F=function(e){var t=true;if($("#b-first-name").val()===""||$("#b-first-name").val()===undefined){H("no-first-name");t=false}if($("#b-last-name").val()===""||$("#b-last-name").val()===undefined){H("no-last-name");t=false}if($("#b-cc-country-codes").val()!=="US"){$("#b-cc-zipcode").val("")}else{var r=/(^\d{5}$)|(^\d{5}-\d{4}$)/.test($("#b-cc-zipcode").val());if(r===false){t=false;H("zipcode-invalid")}}if(!t)$.publish("billing/updated");return t};var O=function(e,t){if(e){Debug.log(e);Actions.Do(Actions.hideSpinner);b=false;if(e.code==="validation"&&e.fields.length>0){e.fields.forEach(function(e,t){switch(e){case"number":H("bi-recurly-cc-invalid");break;case"month":case"year":H("bi-recurly-ccexp-invalid");break}})}else{H("bi-recurly-generic-error")}}else{API.updateRecurlyBilling(Auth.userstate.userId,t.id,function(e){Actions.Do(Actions.hideSpinner);b=false;switch(e.status){case 1:$.publish("billing/changed",[Strings.Settings.UpdateInfoSuccess]);return;case-1:switch(e.messageId){case 71:H("bi-recurly-cc-invalid");break;default:H("bi-recurly-generic-error");break}return;default:H("bi-recurly-generic-error");return}})}};var B=function(){$.query(".validation-message").hide()};var H=function(e){$.query(".validation-message[data-error-type="+e+"]").show()};$.subscribe("auth/refreshedUserState",function(){C()});$.subscribe("upgrade/success",function(){g()})};Component.Camera=function(){const e={url:"url",blob:"blob"};var t;var r=[];var n;var i;var a;var o=function(e){a=Util.Extend({cameraType:Devices.ALL},e||{});n=0;Devices.videoInput(a.cameraType,function(e){r=e;var o=null;r.forEach(function(e,t){if(e.label.indexOf(a.cameraType)>-1){o=e;n=t}});if(o===null)o=r[0];Devices.videoStream(o.deviceId,null,function(e){t=document.createElement("video");t.setAttribute("id","video-stream");t.setAttribute("width",i.clientWidth);t.setAttribute("height",i.clientHeight);t.setAttribute("playsinline",true);t.srcObject=e;t.play();i.appendChild(t)})})};var s=function(){if(r.length<2)return;p();n=n+1===r.length?0:n+1;o(a)};var u=function(t){captureOptions=Util.Extend({captureType:e.url,captureCallback:function(){}},t||{});if(captureOptions.captureType===e.url){captureOptions.captureCallback(l())}else{c(function(e){captureOptions.captureCallback(e)})}};var l=function(){var e=document.createElement("canvas");e.setAttribute("width",t.videoWidth);e.setAttribute("height",t.videoHeight);e.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight);p();return e.toDataURL("image/png")};var c=function(e){var r=document.createElement("canvas");r.setAttribute("width",t.videoWidth);r.setAttribute("height",t.videoHeight);r.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight);var n="t"+(new Date).getTime()+".png";r.toBlob(function(t){API.uploadBlobImage(n,t,ImageType.Whiteboard,false,function(t){var r=t.status===1?t.value:"";e(r)})})};var p=function(){if(t===undefined||t===null)return;t.srcObject.getTracks().forEach(function(e){e.stop()});t.srcObject=null;t.remove();t=null};return{open:function(e,t){i=e;o(t)},capture:function(e){return u(e)},swap:function(){s()},close:function(){p()},CaptureTypes:e}}();Component.CameraDialog=function(){var e=$("body");var t,r,n,i;var a=Component.Camera,o,s,u,l;$.subscribe("camera/beforeShow",function(e){t=$(".camera-inner");r=$(".camera-button-container");n=$("#camera-swap");i=$("#camera-take");s=false;l=Util.Extend({cameraType:Devices.ALL,captureType:a.CaptureTypes.url,captureCallback:function(){}},e||{});i.on("click",function(e){i.prop("disabled",true);a.capture({captureType:l.captureType,captureCallback:function(e){l.captureCallback(e);p();Popup.hide()}})});n.on("click",function(e){a.swap()});Devices.videoInput(l.cameraType,function(e){o=e;c()})});$.subscribe("camera/afterHide",function(){p()});var c=function(){s=true;a.open(t[0],{cameraType:l.cameraType});d();if(o.length>1)n.show();i.show()};var p=function(){s=false;a.close();d()};var d=function(){i.hide();n.hide()}};Component.CancelConfirm=function(){var e,t;var r;$.subscribe("cancelconfirm/beforeShow",function(n){e=$("#cancel-confirm-1-continue");t=$("#cancel-confirm-2-continue");r=n;e.on("click",function(e){e.preventDefault();Popup.flip()});t.on("click",function(e){e.preventDefault();Popup.hide();if(typeof r==="function")r()});if(Auth.hasRole(UserRoles.TutoringAccess)){$(".upgrade-feature-list li:last-child").show()}})};Component.CancellationSurvey=function(){const e="7";const t="9";var r,n,i,a,o,s,u;var l,c,p,d,f,h;$.subscribe("cancellationSurvey/beforeShow",function(){r=document.querySelector(".cancellation");n=$("#cancellation-survey-form");i=n.find(".rating-container");a=$(".cancellation .survey");o=document.getElementById("cancellation-survey-comment");s=document.getElementById("cancellation-survey-submit");u=$("#cancel-error-opts");l=0;c=-1;p=false;d=[];f=[];h=0;n.on("submit",function(e){e.preventDefault();if(p)return;if(c===-1){y();return}p=true;Actions.Do(Actions.showSpinner);API.cancellationFeedback(c,l,o.value.trim()+" ",function(e){b(e)})});d=Strings.Settings.CancellationSurveyOpts;var e=d.splice(d.length-1,1)[0];d.forEach(function(e){var t=typeof e.subOpts!=="undefined";if(t)m(e.subOpts)});m(d);d.push(e);g(a,d,"top");new Component.Rating({elem:i[0],onRating:function(e){l=e}})});var m=function(e){var t,r,n;for(n=e.length;n;n-=1){t=Math.floor(Math.random()*n);r=e[n-1];e[n-1]=e[t];e[t]=r}};var g=function(e,t,r){var n=$("<ul></ul>");t.forEach(function(e,t){var i=typeof e.subOpts!=="undefined";var a="opt-"+e.id;var o=e.id;var s=$("<li></li>");var u=$('<input id="'+a+'" value="'+o+'" name="level-'+r+'" type="radio" />');var l=$('<label for="'+a+'">'+e.text+"</label>");var c;u.appendTo(s);l.appendTo(s);if(i)c=g(s,e.subOpts,t);s.appendTo(n);l.on("click",function(e){v($(this).parent())})});n.appendTo(e);return n};var v=function(e){var t=e.children("label");var r=e.children("input");var n=e.children("ul");var i=n.length>0;c=r.val();e.addClass("on").siblings().removeClass("on open");if(i){e.addClass("open");n.find("label").first().trigger("click")}};var b=function(r){p=false;u.hide();Actions.Do(Actions.hideSpinner);if(r.status===ResponseStatuses.Success){if(Auth.hasMonthly()&&(c===e||c===t)){Popup.showPauseAsk()}else{Util.reload()}}else{Actions.Do(Actions.hideSpinner);y()}};var y=function(){u.show()};var w=function(){Popup.hide()}}();Component.ClassroomLanding=function(){var e=$("#ClassroomLandingForm");var t=$.query("#cr-name");var r=$.query("#cr-email");var n=$.query("#cr-phone");var i=$.query("#cr-organization");var a=$.query("#cr-num-students");var o=$.query("#classroomLandingSubmit");var s=[];o.on("click",function(e){e.preventDefault();s=[];if(!u())return;o.prop("disabled",true);Actions.Do(Actions.showSpinner);var l={name:t.val(),email:r.val(),phone:n.val(),org:i.val(),students:a.val(),subjects:s};API.submitClassroomForm(l,function(e){o.prop("disabled",false);Actions.Do(Actions.hideSpinner);if(e.status===1){$(".classroom-form").hide();$(".classroom-thanks").show()}else{alert("There was an error processing your request. Please try again.")}})});var u=function(){$(".validation-message").hide();var e=[];if(t.val()==="")e.push("no-name");if(r.val()==="")e.push("no-email");else if(!Util.isRFC2822Email(r.val()))e.push("invalid-email");if(i.val()==="")e.push("no-org");if(a.val()==="")e.push("no-num-students");$('[name="cr-subjects"]:checked').each(function(){s.push(this.value)});if(s.length===0)e.push("no-subjects");if(e.length===0)return true;for(var n=0;n<e.length;n++)l(e[n]);return false};var l=function(e){$.query(".validation-message[data-error-type="+e+"]").show()}};Component.CultureHint=function(e){e=$.extend({graphPage:false},e||{});var t=false;var r=WebStorage.languageNag.get();if(Tutor.isConnected()){t=false}else if((r===null||r==="false")&&App.isBot===false){t=App.Culture.mismatch}var n=$.query("#mobile-notify .mobile-dismiss");var i=$.query("#mobile-notify .culture-go");var a=$.query("#header");var o=document.querySelector("#top-menu .cell");var s=$.query(".main-window");var u=$.query("#about-content");var l=$.query("#culture-hint");var c=$.query("#dropdowns");var p=null;var d=50;var f=App.Culture.header==="en-US"?App.baseUrl:App.baseUrl+"/"+App.Culture.header.substring(0,2);var h=false;var m=e.graphPage?"graph/resize":"layout/chat";l.html(App.Culture.hint).show();i.html(App.Culture.action);var g=function(){return o.offsetHeight+1};var v=function(){settings={duration:250,easing:"easeInQuint"};var t=g()+d+"px";if(s.length>0)s.velocity({top:t},settings);if(u.length>0)u.velocity({top:t},settings);if(c.length>0)c.velocity({top:t},settings);if(!e.graphPage)settings.progress=function(){$.publish("layout/chat")};settings.complete=function(){$.publish(m)};a.velocity({top:0},settings);$.publish("topbar/open",[t]);h=true};var b=function(){settings={duration:100,easing:"easeOutQuint"};var t=g()+"px";if(s.length>0)s.velocity({top:t},settings);if(u.length>0)u.velocity({top:t},settings);if(c.length>0)c.velocity({top:t},settings);if(!e.graphPage)settings.progress=function(){$.publish("layout/chat")};settings.complete=function(){$.publish(m)};a.velocity({top:"-"+d+"px"},settings);$.publish("topbar/close");h=false;$.publish("header/mobile")};n.click(function(e){if(h){e.preventDefault();if(p!==null)clearTimeout(p);WebStorage.languageNag.set("true");b();$.publish("Scheduler/Next")}});Scheduler.Add({label:"Culture Hint Banner",priority:105,evalFn:function(){return t?true:false},execFn:function(){p=setTimeout(function(){v();$.publish("layout/scrollBottom")},2500);i.click(function(e){e.preventDefault();Util.Redirect(f)})}})};Component.DidYouMean=function(){var e=App.Config.Platform!==App.Platform.Web;var t=$.query("#did-you-mean");var r=e?t:$.query("#did-you-mean .cell");var n=function(e,t){if(t!=null)i(t);else a();$.publish("layout/drawer")};var i=function(e){var n=$("<div></div>").attr("id","dym-container").append($("<div></div>").addClass("dym-label").appendText(Strings.Editor.DidYouMean)).append($("<div></div>").addClass("dym-suggestion").attr("id","dym-suggestion").attr("asciimath",e.asciimath).html(e.html));r.empty().append(n);$("#dym-suggestion").on("click",function(){$.publish("dymReplace",[e])});MathJax.Hub.Queue(["Typeset",MathJax.Hub,"dym-container",function(){$(".dym-suggestion").css("display","inline-block");t.show();$.publish("layout/drawer");$.publish("dym/state",["on"])}])};var a=function(){t.hide();r.empty();$.publish("layout/drawer");$.publish("dym/state",["off"])};$.subscribe("editorDYMUpdate",n)};Component.DocumentEditor=function(){var e=$("#chat-inner");var t=new DocumentEditor('<div id="visitor-problem"><div id="example-problem"><script type="math/mml"><math><mstyle displaystyle="true">'+"<mi>x</mi><mi>ln</mi><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mstyle></math></script></div></div>");var r=function(){e.html(t.ToHtml(App.CurrentSubject));window.MathJax.Hub.Queue(["Process",window.MathJax.Hub]);$(".document-block").click(n);$(".visitor-toggle-button").on("click",function(){s(this);return false});$(".document-insert").on("click",function(){i();return false});$(".document-delete").on("click",function(){a();return false})};r();var n=function(){var e=parseInt(this.getAttribute("index"));t.SetCursor(e);r();o()};var i=function(){t.InsertLineAbove();t.SetCursor(t.GetCursor()-1);r();App.CurrentEditor.Clear()};var a=function(){t.DeleteCursor();r();o()};var o=function(){var e=t.GetLine(t.GetCursor());var r=e.command===""?"":"@"+e.command+" ";App.CurrentEditor.Replace(r+e.ascii)};$.subscribe("documentEditor/updateLine",function(){var e=App.CurrentEditor.root.GetSolverStrings();if(e.command==="mathway"){$.publish("chat/getMoreTopics")}else{t.UpdateLine(e);if(t.GetCursor()+1===t.GetLineCount())t.InsertLineBelow();t.SetCursor(t.GetCursor()+1);o();r()}});$.subscribe("solving/dispatch",function(e){e=Util.Extend({subject:"",topicId:0,topicText:"",customData:null,asciiMath:"",mathML:""},e||{});API.chatBotViewSteps(e.topicId,e.topicText,e.customData,e.subject,e.asciiMath,e.mathML,null,function(n){var i={ascii:e.asciiMath,html:n.solutionhtml,command:"mathway"};t.UpdateLine(i);if(t.GetCursor()+1===t.GetLineCount())t.InsertLineBelow();t.SetCursor(t.GetCursor()+1);o();r()})});var s=function(e){var t=$(e);var r=e.parentNode.nextElementSibling;var n=$(r);var i=r.nextElementSibling;var a=n.css("display");var o=e.querySelector("span");var s=function(){if(a==="none"){$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"block",duration:250,easing:"easeOutQuint",begin:function(){i.style.display="none"},complete:function(){n.css({height:"inherit"})}});t.addClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){i.style.display=""}});t.removeClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionShowSteps}};var u=n.children(":not(.visitor-child-rows)").toArray();if(!n.hasClass("rendered")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,u,function(){n.addClass("rendered");s()}])}else s()}};Component.Drawer=function(e){e=$.extend({contentContainer:undefined,shouldOpen:undefined,shouldClose:undefined,onOpenProgress:undefined,onCloseProgress:undefined,onOpened:undefined,onClosed:undefined,onStart:undefined},e||{});if(e.contentContainer===undefined){Debug.log("Drawer is lacking the content container and cannot init.");return}var t=false;var r=[];var n=$("body");var i=$("#drawer");var a=$.query(e.contentContainer);var o=document.getElementById("keyboard");var s=document.getElementById("editor");var u=document.getElementById("did-you-mean");var l=250;var c=150;var p=false;var d=["mobile-dismiss","mobile-browse","mw-close","hamburger-toggle","ch-bubble-remote","ch-bubble-local","survey-radio","survey-options","survey-option","survey-textbox"];var f=function(){if(t)Debug.trace();if(p)return;if(m===false){m=true;App.DrawerOpen=true;var r=App.CurrentEditor==null?false:App.CurrentEditor.Focused();var n=i.height();i.velocity({bottom:0},{duration:l,easing:"easeOutQuad"});a.velocity({bottom:n},{duration:l,easing:"easeOutQuad",progress:function(){if(typeof e.onOpenProgress==="function"){e.onOpenProgress()}},complete:function(){i.addClass("opened");$.publish("drawer/opened");if(r)App.CurrentEditor.TakeFocus();if(typeof e.onOpened==="function"){e.onOpened()}}})}};var h=function(){if(t)Debug.trace();if(p)return;if(m===true){m=false;App.DrawerOpen=false;var r=o.offsetHeight+u.offsetHeight;var n=s===null?0:s.offsetHeight;var l=1;i.velocity({bottom:"-"+r+"px"},{duration:c,easing:"easeInQuad"});a.velocity({bottom:n+"px"},{duration:c,easing:"easeInQuad",progress:function(){if(typeof e.onCloseProgress==="function"){e.onCloseProgress()}},complete:function(){i.removeClass("opened");$.publish("drawer/closed");if(typeof e.onClosed==="function"){e.onClosed()}}})}};var m=false;var g=function(r){if(p===true){if(t)Debug.info("resolveVisbility - drawer locked, returning");return}var n=$(r.target);for(var a=0,o=d.length;a<o;a++){if(n.hasClass(d[a])){if(t)Debug.info("resolveVisbility - ignore list ("+d[a]+"), returning");return}}if(i.is(r.target)||i.has(r.target).length>0){f();if(t)Debug.info("resolveVisbility - should open drawer, returning");return}if(m&&typeof e.shouldClose==="function"){if(e.shouldClose(r))h()}};r.push($.subscribe("document/mouseup",function(e){g(e)}));r.push($.subscribe("document/keyup",function(e){g(e)}));r.push($.subscribe("dialog/opening",function(){p=true}));r.push($.subscribe("dialog/closing",function(){p=false}));r.push($.subscribe("tutorial/run",function(){f();p=true}));r.push($.subscribe("tutorial/finished",function(){p=false}));r.push($.subscribe("auth/loggedin",function(){f()}));r.push($.subscribe("qa/drawer/close",function(){h()}));r.push($.subscribe("example/problem",function(){f()}));r.push($.subscribe("chat/problem",function(){f()}));r.push($.subscribe("auth/fromDialog",function(){f()}));r.push($.subscribe("drawer/open",function(e){if(typeof e==="undefined")e=false;if(e)p=true;f()}));r.push($.subscribe("drawer/unlock",function(){p=false}));r.push($.subscribe("drawer/close",function(){h()}));r.push($.subscribe("drawer/debugToggle",function(){t=!t}));r.push($.subscribe("drawer/destroy",function(){r.forEach(function(e){$.unsubscribe(e)})}));if(typeof e.onStart==="function"){e.onStart()}};Component.EditorTest=function(){if(typeof Editor==="undefined")throw"Editor undefined";var e;var t;var r=$("#editor-tester");$.subscribe("document/ready",function(){e=new Editor(r);r.focus();var n="algebra";t=new Component.Keyboard(n);$("#subjectSelect").val(n);$("#subjectSelect").change(function(){$.query("#keyboard .cell").off();var e="";$("#subjectSelect option:selected").each(function(){e=$(this).text()});t=new Component.Keyboard(e)})});$(document).mousemove(function(e){$.publish("mouseMove",[e])});$.subscribe("editorContentUpdate",function(e){$("#debug").html(UpdateDebug(e))});$.subscribe("editorContentUpdate",function(e){$("#treeOutput").html(PrintTree(e.root,e.startCursor))});$.subscribe("mouseMove",function(e){var t="x:"+e.clientX.toFixed(3)+" y:"+e.clientY.toFixed(3);$("#mousePos").html(t)});Component.Editor.Common(true)};Component.Editor=function(e){if(typeof Editor==="undefined")return;e=$.extend({subject:"Algebra",affiliate:false,deferFocus:false,isWorksheet:false,isPopularProblem:false,isCalculator:false,isExpertQA:false,problem:null,onSubmit:null},e||{});var t=null;var r=$("#editor-tester");var n=$("#drawer");var i=$("#overlay");var a=function(){t=new Editor(r,Strings.Editor,{isApps:App.IsApps,deferFocus:e.deferFocus,isWorksheet:e.isWorksheet,onFocus:function(){$.publish("editor/focused");if(App.IsApps){$.publish("apps/editor/focused")}$.publish("drawer/open")}});App.CurrentEditor=t;o();if(e.affiliate===true){r.on("click",function(){r.focus()});r.focus(function(){t.TakeFocus()});r.blur(function(){t.RemoveFocus()});if(e.problem!=null){$.publish("example/problem",[e.problem,{focus:false}])}}var n=EditorButtonsMode.main;if(e.isExpertQA){n=EditorButtonsMode.ExpertAdd}else if(e.isWorksheet||e.isCalculator||e.isPopularProblem||e.affiliate){n=EditorButtonsMode.noImages}t.Buttons=new Editor.Buttons({editor:t,mode:n,onSubmit:e.onSubmit,onEdit:e.onEdit})};var o=function(){var e=App.getQueryParam("problem");if(e===false){return}try{$.publish("chat/problem",[{ascii:Base64.decode(e)}])}catch(t){return}};if(e.affiliate===true){$.subscribe("editorDYMUpdate",function(e,t){var r=e.GetAsciiMath();if(r.length>0&&App.getQueryParam("subject")!=false){App.postAffiliateMessage(App.getQueryParam("subject"),null,r)}})}$.subscribe("drawer/opened",function(){if(t===null)return;if(Popup.active()){t.RemoveFocus();return}if(i.css("display")!=="block")t.TakeFocus()});$.subscribe("drawer/closed",function(){if(t===null)return;var e=i.css("display")!=="block";t.RemoveFocus(e)});$.subscribe("editor/erase",function(){if(t===null)return;t.Clear()});$.subscribe("dialog/open",function(){if(t===null)return;t.RemoveFocus()});$.subscribe("overlay/show",function(){if(t===null)return;t.RemoveFocus()});$.subscribe("dialog/close",function(){if(t===null)return;if(n.hasClass("opened"))t.TakeFocus();else t.MakeFree()});$.subscribe("overlay/hide",function(){if(t===null)return;if(n.hasClass("opened"))t.TakeFocus();else t.MakeFree()});$.subscribe("editor/blur",function(){if(t===null)return;t.RemoveFocus()});$.subscribe("editor/focus",function(){if(t===null)return;if(!App.IsApps)t.TakeFocus()});$.subscribe("tutorial/start",function(){if(t===null)return;t.RemoveFocus()});$.subscribe("tutorial/finished",function(){if(t===null)return;t.TakeFocus()});$.subscribe("popup/open",function(){if(t===null)return;t.RemoveFocus()});$.subscribe("popup/done",function(){if(t===null)return;t.MakeFree()});$.subscribe("Tutor/InviteAccepted",function(){$("#editor .emptyText").text(Strings.Editor.EmptyMessage)});$.subscribe("tutor/leaveRoom",function(){$("#editor .emptyText").text(Strings.Editor.Empty)});$.subscribe("editorContentUpdate",function(e){$.publish("layout/drawer")});Component.Editor.Common(true);Scheduler.Add({label:"Editor Initialization",priority:8,evalFn:function(){return true},execFn:function(){a();var r=WebStorage.fromHelpPage.get();if(typeof r!=="undefined"&&r!==null&&r!==""){WebStorage.fromHelpPage.remove();if(r.subject===e.subject){t.Paste(r.asciiMath);var n=t.GetSolverStrings();$.publish("topics/parse",[{asciiMath:n.ascii,mathML:n.html}])}}$.publish("Scheduler/Next")}})};Component.EditorGraph=function(e){if(typeof Editor==="undefined")return;e=$.extend({affiliate:false,legacyDYM:true},e||{});var t=document.getElementById("gpc-container");var r=document.querySelector(".gpc-inner");var n=document.getElementById("editor-group");var i=document.querySelector(".gpc-alt-inner");var a=$("#drawer");var o=document.querySelector(".gpc-wrapper");var s=[];var u=[];var l=0;var c=0;var p=false;var d=false;var f=false;var h=false;var m=false;var g=250;var v=null;var b=["MWRed","MWBlue","Green","Purple","Orange","SlateGray","Cyan","Crimson","Lavender","Yellow"];$.query("#gp-header .add-button").click(function(){w()});var y=function(e){App.CurrentEditor=e;$(".editor-container").removeClass("current");App.CurrentEditor.editElem.parent().addClass("current");for(var t=0,r=s.length;t<r;t++){var n=s[t].object;if(n.graphId!==e.graphId){n.RemoveFocus()}}$.publish("editor/focused");$.publish("drawer/open")};var w=function(){var e=new Color(b[c%b.length]);c++;var t=document.createElement("div");t.setAttribute("class","editor-outer");var r=document.createElement("div");r.setAttribute("class","editor-container");var n=document.createElement("button");n.setAttribute("class","editor-color");r.appendChild(n);var i=new jscolor(n,{zIndex:5e3,closable:true,closeText:Strings.Graph.Close,onFineChange:"Util.Debounce(Component.EditorGraph.PickerCallback(this, "+c+"), 100)"});i.fromString(G(e));var a=document.createElement("div");a.setAttribute("class","editor-single");a.setAttribute("id","editor-number-"+c);a.setAttribute("data-number",c);a.setAttribute("tabindex","0");r.appendChild(a);t.appendChild(r);o.appendChild(t);setTimeout(function(){var t=$(a);var r=new Editor(t,Strings.Editor,{graphId:c,deferFocus:s.length!==0,isGraph:true,isApps:App.IsApps,onFocus:function(e){y(e)},onBlur:function(e){}});r.Buttons=new Editor.Buttons({editor:r,mode:EditorButtonsMode.graph});s.push({index:c,object:r,button:r.Buttons.getCloseButton(),dirty:false,content:"",dymFn:null,color:e});k(true);if(typeof u[l]!=="undefined"){r.Paste(u[l]);l++;if(l<u.length){w()}else{m=false;w()}}},0)};var C=function(e){for(var t=0,r=s.length;t<r;t++){if(s[t].index===e){return t}}return 0};var S=function(e,t){for(var r=0,n=s.length;r<n;r++){if(s[r].index===e){var i=false;if(App.CurrentEditor===s[r].object)i=true;s[r].object.Delete();delete s[r].object;s.splice(r,1);t.remove();if(i){var a=s.length-1;App.CurrentEditor=s[a].object;App.CurrentEditor.TakeFocus()}p=true;k(true);return}}};var x=function(e){var e=App.getQueryParam("problem");if(e===false){return}try{u=JSON.parse(Base64.decode(e))}catch(t){Debug.warn("Cannot parse affiliate widget problems for the graph.");return}if(u.length>0)m=true};var A=function(){x();if(s.length===0)w()};var T=false;var I=false;$(o).focusin(function(){if(!d){I=true;var e=Util.Debounce(E,200);e.call(this)}});$(o).focusout(function(){if(!d){I=false;var e=Util.Debounce(E,200);e.call(this)}});$.subscribe("dialog/open",function(){d=true});$.subscribe("dialog/close",function(){d=false});var E=function(){if(T!==I){if(T===true){$.publish("graphSlider/blur");T=false}else{$.publish("graphSlider/focus");T=true}}};var P=function(){if(s.length<=1)n.className="single";else if(s.length===2)n.className="double";else n.className="many"};var k=function(e){if(typeof e==="undefined")e=false;P();$.publish("layout/drawer");var t=Util.Debounce(D,g,e);t.call(this)};var M=function(){return window.location.href.toLowerCase().indexOf("appsgraphsubject")>=0};var D=function(){if(f===false){f=true;var e=[];var t=false;var r=[];var n=false;n=p;for(var i=0,a=s.length;i<a;i++){if(s[i].dirty===true)n=true;if(s[i].object.CanClear()){if(s[i].dirty===true){s[i].content=s[i].object.GetAsciiMath();s[i].dirty=false}e.push(s[i].content);r.push(s[i].color)}else{s[i].content="";t=true}if(s[i].content==""&&M()){O(s[i].object.graphId)}else{B(s[i].object.graphId)}}if(n){$.publish("graph/update",[e,r])}if(t===false&&!m){w()}if(p){$.publish("graph/resize")}setTimeout(function(){f=false},0);if(h===true){setTimeout(function(){h=false;k(true)},50)}}else{h=true}};var L=function(){var e=$(o).detach();if(v){$(i).append(e)}else{$(r).append(e)}};var R=function(){if(v===true)return;v=true;L();$(n).show();$(t).addClass("gpc-alternate").removeClass("gpc-standard");a.addClass("with-shadow");$.publish("layout/drawer");$.publish("drawer/open")};var N=function(){if(v===false)return;v=false;L();$(n).hide();$(t).removeClass("gpc-alternate").addClass("gpc-standard");a.removeClass("with-shadow");$.publish("layout/drawer");$.publish("graphSlider/open")};var U=function(){if(MediaQuery.useGraphAltView()){R()}else{N()}};$.subscribe("editorContentUpdate",function(e){F(e)});$.subscribe("apps/graphocr",function(e){App.CurrentEditor.InsertMathPix(e)});var F=function(e){var t=false;for(var r=0,n=s.length;r<n;r++){if(s[r].object.graphId===e.graphId){s[r].dirty=true;t=true;break}if(s[r].content==""&&M()){O(s[r].object.graphId)}else{B(s[r].object.graphId)}}if(t)k()};var O=function(e){$("#camera-"+e).css("display","inline-block");$("#close-editor-"+e).css("display","none")};var B=function(e){$("#camera-"+e).css("display","none");$("#close-editor-"+e).css("display","inline-block")};var H=function(e,t,r){while(true){var n=e.indexOf("set[");if(n==-1)break;var i=e.indexOf("]",n);if(i==-1)break;e=e.substring(0,n)+t+e.substring(n+4).replace("]",r)}return e};$(o).on("click",".editor-buttons .mw-editor-remove",function(){var e=$(this).closest(".editor-outer");var t=parseInt(e.find(".editor-single").attr("data-number"));S(t,e)});$.subscribe("graph/picker",function(e,t){var r=[];for(var n=0,i=s.length;n<i;n++){if(s[n].index===t){s[n].color=q(e)}if(s[n].color!==null)r.push(s[n].color)}$.publish("graph/colors",[r])});$.subscribe("window/resize",function(){var e=Util.Debounce(function(){$.publish("graph/resize")},100);e.call(this);U()});$.subscribe("dialog/open",function(){if(App.CurrentEditor===null)return;App.CurrentEditor.RemoveFocus()});$.subscribe("overlay/show",function(){if(App.CurrentEditor===null)return;App.CurrentEditor.RemoveFocus()});$.subscribe("dialog/close",function(){if(App.CurrentEditor===null)return;if(a.hasClass("opened"))App.CurrentEditor.TakeFocus();else App.CurrentEditor.MakeFree()});$.subscribe("overlay/hide",function(){if(App.CurrentEditor===null)return;if(a.hasClass("opened"))App.CurrentEditor.TakeFocus();else App.CurrentEditor.MakeFree()});$.subscribe("layout/graph",function(){if(App.CurrentEditor===null)return;if(a.hasClass("opened"))App.CurrentEditor.TakeFocus();else{App.CurrentEditor.RemoveFocus();App.CurrentEditor.MakeFree()}});var q=function(e){e=e.replaceAll("#","");var t=parseInt(e.substring(0,2),16);var r=parseInt(e.substring(2,4),16);var n=parseInt(e.substring(4,6),16);var i=new Color;i.r=t;i.g=r;i.b=n;return i};var G=function(e){return _(e.r)+_(e.g)+_(e.b)};var _=function(e){e=parseInt(e,10);if(isNaN(e))return"00";e=Math.max(0,Math.min(e,255));return"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16)};Component.Editor.Common(true);U();Scheduler.Add({label:"Editor Initialization",priority:8,evalFn:function(){return true},execFn:function(){A();$.publish("Scheduler/Next")}})};Component.EditorGraph.PickerCallback=function(e,t){$.publish("graph/picker",[e.toString(),t])};Component.Editor.Common=function(e){if(!e)e=false;var t=function(e){if(e=="")return true;var t=/[\u0000-\u03FF]|[\u0600-\u077f]|[\u2200-\u22ff]|[\uf000-\uf1ff]|[\ud800-\udbff]|[\udc00-\udfff]/g.test(e);if(App.debug&&!t)Debug.log("Invalid unicode character"+": ("+e.charCodeAt(0).toString(16)+")");return t};$.subscribe("document/cut",function(e){if(App.CurrentEditor){e.text=App.CurrentEditor.Copy();App.CurrentEditor.startCursor=App.CurrentEditor.endCursor=App.CurrentEditor.DeleteSelected();App.CurrentEditor.updateView()}},true);$.subscribe("document/copy",function(e){if(App.CurrentEditor){e.text=App.CurrentEditor.Copy()}},true);$.subscribe("document/paste",function(e,r){if(App.CurrentEditor!==null&&App.CurrentEditor.Focused()&&t(e))App.CurrentEditor.Paste(e,r)},true);$.subscribe("keyboard/output",function(e){if(App.CurrentEditor!=null){if(t(e.character)){App.CurrentEditor.KeyboardInput(e);if(App.IsApps)$.publish("layout/drawer")}}else{if(App.debug){Debug.groupCollapsed("unhandled input");Debug.log(e);Debug.groupEnd();
}}},true);if(e)MathJaxConfig.Preload()};Component.Examples=function(e){var t=$.query("#ex-container");var r=document.querySelector("#ex-container .ex-inner");var n=$.query("#ex-header");var i=$.query("#ex-input");var a="ex-active";var o=[];var s=[];var u=null;var l=function(e,t){var r=[];e.forEach(function(e,n){var i={translated:e.translated,value:e.value,text:e.text,category:e.category,visible:true};if(typeof e.children!=="undefined"&&e.children.length>0){i.children=l(e.children,n)}if(e.category==="topic"){s.push({parentIndex:t,index:n,text:e.translated})}r.push(i)});return r};var c=function(e){var t=new Sifter(s,{diacritics:true});var r=t.search(e,{fields:["text"],conjunction:"and"});if(r.items.length>0){var n=[];r.items.forEach(function(e){var t=s[e.id];n.push(t.parentIndex);o[t.parentIndex].children[t.index].visible=true});n.forEach(function(e){o[e].visible=true});f(false)}else{d()}};var p=function(e){if(o.length<1)return;o.forEach(function(t,r){o[r].visible=e;if(typeof o[r].children!=="undefined"&&o[r].children.length>0){o[r].children.forEach(function(t,n){o[r].children[n].visible=e})}})};var d=function(){$(r).empty().append($("<div></div>").addClass("ex-empty").appendText(Strings.Search.NotFound))};var f=function(e){var t=$("<ul></ul>");o.forEach(function(r){t.append(h(r,e))});$(r).empty().append(t)};var h=function(e,t){if(e.value.length===0||e.text.length===0||e.category.length===0||e.visible===false)return"";var r=$("<li></li>").addClass("ex-chapter");if(t===false){r.addClass(a)}if(typeof e.children!=="undefined"&&e.children.length>0){r.append($("<div></div>").addClass("ex-expandable").attr("data-value",e.value).attr("data-category",e.category).append($("<div></div>").addClass("ex-bullet")).append($("<div></div>").addClass("ex-chapter-text").appendText(e.translated)).append($("<div></div>").addClass("clear")));$ctr=$("<ul></ul>");var n=$("<div></div>").attr("data-parent-id",e.id).addClass("ex-children").css("display",t===true?"none":"block");e.children.forEach(function(e){$ctr.append(m(e,t))});r.append(n.append(n.append($ctr)))}else{r.append($("<div></div>").addClass("ex-expandable").attr("data-value",e.value).attr("data-category",e.category).append($("<div></div>").addClass("ex-chapter-empty").appendText(e.text)).append($("<div></div>").addClass("clear")))}return r};var m=function(e,t){if(e.value.length===0||e.text.length===0||e.category.length===0||e.visible===false)return"";var r=$("<li></li>").addClass("ex-example");if(t===false){r.addClass(a)}r.append($("<div></div>").addClass("ex-topic").attr("data-text",e.text).attr("data-topic-id",e.value).append($("<i></i>").addClass("mw")).append($("<div></div>").addClass("ex-text-inner").appendText(e.translated)).append($("<div></div>").addClass("clear")));return r};var g=function(e){var t=e.parentNode;$(t).addClass(a);var r=e.nextElementSibling;$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"block",duration:150,easing:"easeOutQuad"})};var v=function(e){var t=e.parentNode;$(t).removeClass(a);var r=e.nextElementSibling;$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:150,easing:"easeInQuad"})};var b=function(e){n.html("<i class='mw "+w(e)+"'></i>"+C(e));$(r).append(UI.buildSpinnerDOM());API.getAllExamples(e,function(t){if(typeof t.nodes!=="undefined"){for(var r=0,n=t.nodes.length;r<n;r++){if(t.nodes[r].value===e){o=l(t.nodes[r].children);break}}if(Object.keys(o).length>0){f(true);$.unsubscribe(u)}else{d()}}else{d()}})};var y=function(e){var t="";switch(e.toLowerCase()){case"basicmath":t="Basic Math";break;case"prealgebra":t="Pre-Algebra";break;case"algebra":t="Algebra";break;case"trigonometry":t="Trigonometry";break;case"precalculus":t="Precalculus";break;case"calculus":t="Calculus";break;case"statistics":t="Statistics";break;case"finitemath":t="Finite Math";break;case"linearalgebra":t="Linear Algebra";break;case"chemistry":t="Chemistry";break;case"graphing":t="Graphing";break}return t};var w=function(e){var t="";switch(e){case"Basic Math":t="mw-basic-math";break;case"Pre-Algebra":t="mw-pre-algebra";break;case"Algebra":t="mw-algebra";break;case"Trigonometry":t="mw-trigonometry";break;case"Precalculus":t="mw-precalculus";break;case"Calculus":t="mw-calculus";break;case"Statistics":t="mw-statistics";break;case"Finite Math":t="mw-finite-math";break;case"Linear Algebra":t="mw-linear-algebra";break;case"Chemistry":t="mw-chemistry";break;case"Graphing":t="mw-graph";break}return t};var C=function(e){switch(e){case"Basic Math":return Strings.Examples.BasicMath;case"Pre-Algebra":return Strings.Examples.PreAlgebra;default:case"Algebra":return Strings.Examples.Algebra;case"Trigonometry":return Strings.Examples.Trigonometry;case"Precalculus":return Strings.Examples.Precalculus;case"Calculus":return Strings.Examples.Calculus;case"Statistics":return Strings.Examples.Statistics;case"Finite Math":return Strings.Examples.FiniteMath;case"Linear Algebra":return Strings.Examples.LinearAlgebra;case"Chemistry":return Strings.Examples.Chemistry;case"Graphing":return Strings.Examples.Graph}};var S=function(t){var r=t.getAttribute("data-topic-id");var n=t.getAttribute("data-text");API.generateExample(r,e,n,function(t){if(t.status===1&&typeof t.inputtext!=="undefined"&&t.inputtext!==null){if(e!=="Graphing"){var r=true;if(Tutor.inChatRoom()){r=false}if(r){$.publish("solving/dispatch",[{topicId:t.topicid,topicText:t.topictext,asciiMath:t.inputtext,mathML:t.mathml,customData:t.customData,isOCR:false,isSpeech:false,asciiEdited:false,historyClick:false,fromExamples:true}])}}else{$.publish("example/problem",[t.inputtext,{editor:App.CurrentEditor}])}}$.publish("graphSlider/open");$.publish("examples/close");setTimeout(function(){$(".ex-topic").prop("disabled",false)},1500)})};expandChildren=function(){var e=this.nextElementSibling;if(e===null)return;if(e.childNodes.length>0){var t=window.getComputedStyle(e,null);if(t.display==="none"){g(this)}else{v(this)}}else{fetch(this)}};t.on("click",".ex-expandable",expandChildren);clickATopic=function(){$(this).prop("disabled",true);S(this)};t.on("click",".ex-topic",clickATopic);i.keyup(function(){var e=$(this).val();if(e.length>0){p(false);c(e)}else{p(true);f(true)}});u=$.subscribe("examples/open",function(){b(y(e))});$.subscribe("subject/set",function(t){e=t;b(y(e))});Component.Examples.Control()};Component.Examples.Control=function(){var e=$.query("#ex-container");var t=$.query("body");var r=false;var n=false;var i=function(t){if(!e.is(t.target)&&e.has(t.target).length===0&&window.getSelection().type!=="Range"){o()}};var a=function(){if(r)return;$.publish("overlay/show");e.css("display","inline-block").velocity("stop").velocity({right:0},{duration:150,easing:"easeOutQuad",complete:function(){n=$.subscribe("document/mouseup",i);t.addClass("clickable");r=true}})};var o=function(){if(!r)return;var i=parseInt(e.width())+10;$.publish("overlay/hide");e.velocity("stop").velocity({right:"-"+i+"px"},{duration:150,easing:"easeOutQuad",complete:function(){$.unsubscribe(n);t.removeClass("clickable");r=false;e.css("display","none")}})};$.subscribe("examples/open",function(){if(Tutor.inChatRoom())return;a()});$.subscribe("examples/close",function(){o()})};ExpertQA=function(){var e={};var t=24e4;var r=null;var n=false;e.UnreadAnswers=0;e.CurrentPending=0;e.MaxPending=3;e.DeferPolling=false;var i={startAtPayment:false,selectedPlan:undefined,source:UpgradeSource.bubble};e.Ask=function(t){var t=Util.Extend({},t||{subject:"Algebra",topicId:0,topicText:"",asciiMath:"",mathML:"",solutionId:"",fromBubble:false,freeTrial:false,trialToken:null});if(Auth.hasRole(UserRoles.StepByStep)){var r=false;var n=false;var a=Auth.hasRole(UserRoles.ExpertQA);var o=Auth.hasRole(UserRoles.TutoringAccess);if(t.freeTrial){if(!a)n=true}else{if(!o)n=true;if(!a)r=true}if(r){Actions.Do(Actions.showUpgrade,i)}else if(n){Actions.Do(Actions.createExpertQuestion,DtoHelper.CreateExpertQuestion({UserId:Auth.userstate.userId,AnonUserId:WebStorage.anonUserId.get(),DeviceString:App.deviceString(),Topic:{Id:t.topicId,Text:t.topicText},Subject:t.subject,Ascii:t.asciiMath,MathML:t.mathML,SolutionId:t.solutionId,Source:e.GetSource(false,t.freeTrial,t.fromBubble,false)}))}else{Actions.Do(Actions.showAskExperts,{subject:t.subject,topicId:t.topicId,topicText:t.topicText,asciiMath:t.asciiMath,mathML:t.mathML,solutionId:t.solutionId,fromBubble:t.fromBubble,freeTrial:t.freeTrial})}}else{Actions.Do(Actions.showUpgrade,i)}};e.CreateQuestion=function(e){Popup.showTutorPreSession(true,e,function(e){Actions.Do(Actions.submitExpertQuestion,e)})};e.SubmitQuestion=function(t){API.createExpertQuestion(t,function(t){var r=Strings.ExpertQA.QuestionSubmitThanks;if(t.status!==ResponseStatuses.Success){if(t.messageId===ErrorCode.ExpertTooManyQuestions){a(t.State);r=e.QuestionLimitString()}else{r=Strings.ExpertQA.QuestionSubmitError}}else{a(t.State)}$.publish("expertQA/RemoveFreeTrial");$.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:r,testContext:BubbleContext.ExpertQA})]},{commitMessages:true}]);$.publish("ChatLibrary/ScrollBottom")})};e.GetSource=function(e,t,r,n){var i=Auth.hasRole(UserRoles.Student);if(e){if(r){if(n)return TutorInviteSource.CreditsBubble;if(t)return TutorInviteSource.TrialBubble;return i?TutorInviteSource.StudentBubble:TutorInviteSource.Bubble}else{if(n)return TutorInviteSource.CreditsViewSteps;if(t)return TutorInviteSource.TrialViewSteps;return i?TutorInviteSource.StudentViewSteps:TutorInviteSource.ViewSteps}}else{if(r){if(t)return ExpertQuestionSource.TrialBubble;return i?ExpertQuestionSource.StudentBubble:ExpertQuestionSource.Bubble}else{if(t)return ExpertQuestionSource.TrialViewSteps;return i?ExpertQuestionSource.StudentViewSteps:ExpertQuestionSource.ViewSteps}}};e.QuestionLimitString=function(){if(e.MaxPending>1)return Strings.ExpertQA.TooManyQuestions.replace("{MAX_PENDING_QUESTIONS}",e.MaxPending);else return Strings.ExpertQA.OneTooManyQuestions};e.SetState=function(e){};var a=function(t){e.UnreadAnswers=t.UnreadAnswers;e.CurrentPending=t.CurrentPending;e.MaxPending=t.MaxPending;$.publish("expertQA/update")};var o=function(){return Auth.isLoggedIn()};var s=function(){API.getExpertQAState(function(e){if(e.status===ResponseStatuses.Success){a(e.State)}})};var u=function(){if(r)return;if(!e.DeferPolling)s();r=setInterval(function(){s()},t)};var l=function(){clearInterval(r);r=null};$.subscribe("auth/loggedin",function(){if(n&&o()){u()}});$.subscribe("auth/loggedout",function(){l()});Scheduler.Add({label:"Expert Q/A",priority:60,evalFn:function(){return o()},execFn:function(){n=true;u();$.publish("Scheduler/Next")}});return e}();Component.ExpertSubject=function(){var e=$.query("#top-menu .left-side");var t=$.query("#top-menu .subject");var r=$("#subjects-menu");var n=$("#subjects-menu a");var i=$.query("body");var a=r.css("display")!=="none"?true:false;var o;var s=function(){if(!a){r.velocity({opacity:1},{display:"block",duration:100,easing:"easeOutQuad",complete:function(){i.addClass("clickable");o=$.subscribe("document/mouseup",l);a=true}})}};var u=function(){if(a){r.velocity({opacity:0},{display:"none",duration:50,easing:"easeInQuad",complete:function(){i.removeClass("clickable");$.unsubscribe(o);a=false}})}};var l=function(e){if(!r.is(e.target)){u()}};var c=function(e){n.removeClass("current");n.addClass("link");Util.RemoveClass("link",e);Util.AddClass("current",e);subject=e.getAttribute("data-subject");var r=subject.toLowerCase();t.text(e.innerText);$.publish("keyboard/change",[r]);if(App.CurrentEditor!==null)App.CurrentEditor.TakeFocus()};e.on("click",function(){if(a!==true){s()}else{u()}});n.click(function(e){e.preventDefault();if(Util.HasClass("current",this))return;c(this)})};Component.ForgotPassword=function(){var e,t,r;$.subscribe("forgotPassword/beforeShow",function(i){e=i;t=document.getElementById("f-email");r=document.getElementById("forgot-dialog-submit");r.addEventListener("click",function(e){e.preventDefault();n()})});$.subscribe("forgotPassword/afterShow",function(){if(e.security){$("#fp-security").show()}});var n=function(){if(o()){Actions.Do(Actions.showSpinner);API.forgotPassword(t.value.trim(),function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.hide();setTimeout(function(){Popup.show(Strings.ForgotPassword.ForgotPasswordSuccess)},500)}else if(e.status===ResponseStatuses.Failure){switch(e.messageId){case 61:a("email-is-facebook");break;case 40:a("email-not-found");break;default:a("generic-error");break}}else{a("generic-error")}})}};var i=function(){$(".validation-message").hide()};var a=function(e){$(".validation-message[data-error-type="+e+"]").show()};var o=function(){var e=true;var r={email:t.value.trim()};i();if(typeof r.email==="undefined"){a("no-email");e=false}else if(r.email.length===0){a("no-email");e=false}else if(!Util.isRFC2822Email(r.email)){a("invalid-email");e=false}return e}};Component.GDPR=function(){var e=$.query("#gdpr-banner");var t=$.query(".gdpr-button");var r=function(){var e=WebStorage.GDPR.get();if(e==="1"||e==="3")return false;if(e===null){WebStorage.GDPR.set("0")}return true};var n=function(){e.velocity("stop").velocity({opacity:0},{display:"none",duration:100,easing:"easeInQuad"});t.off("click");WebStorage.GDPR.set("3")};var i=function(){e.velocity("stop").velocity({opacity:1},{delay:2e3,display:"block",duration:150,easing:"easeOutQuad"});t.on("click",function(e){e.preventDefault();n()})};Scheduler.Add({label:"GDPR Compliance Notice",priority:85,evalFn:function(){return r()},execFn:function(){i();$.publish("Scheduler/Next")}})};Component.GlossaryTerm=function(){var e=[];var t=function(e){var t=parseInt(e.getAttribute("index"));Actions.Do(Actions.openGlossary,[t])};$.subscribe("document/mouseup",function(e){if(Util.HasClass("GlossaryTerm",e.target)){t(e.target)}});$.subscribe("glossary/open",function(t){if(e[t]===undefined){Actions.Do(Actions.showSpinner);API.getGlossaryTerm(t,function(r){Actions.Do(Actions.hideSpinner);if(r.status===ResponseStatuses.Success){e[t]=r.definition;Popup.showGlossary(e[t])}})}else{Popup.showGlossary(e[t])}})};var GraphBuilder=function(e){var t=[];var r={};r.widthFn=null;var n=0;var i=[];r.add=function(e,r,n){t.push({parent:e,input:r,loader:n})};r.process=function(){if(t.length>0){window.requestAnimationFrame(a)}};r.addGraphWrapper=function(e){var t=450;if(GraphBuilder.widthFn!=null){t=GraphBuilder.widthFn()}e.setAttribute("style","width: "+t+"px; height: "+t+"px;");var r=Util.CreateElement({tagName:"img",className:"graph-thumbnail",attributes:[{key:"src",value:"/images/placeholder.gif"},{key:"alt",value:"image of graph"}]});e.appendChild(r);var n=e.getAttribute("data-graph-input");if(n!==null){GraphBuilder.add(e,n,r);GraphBuilder.process()}};var a=function(){var o=t.shift();if(!o)return;var s=450;if(r.widthFn!==null){s=r.widthFn.apply(this)}if(s>450)s=450;var u=s;n=s;var l="";if(typeof o.input==="string")l=o.input.replace(/"/g,"&quot;");var c=e('<div class="Graph" style="width:'+u+"px; height:"+u+'px;" data-input="'+l+'"></div>');i.push(c.MWGraph({showErrors:true,mousewheel:false,draggable:false,background:"#fff",fromSubjectsPage:true,postRender:function(){e.Velocity(o.loader,{opacity:0},{duration:500,easing:"easeInQuint"})},solverInput:c.data("input")}));c.show();c.draw();e(o.parent).width(u);e(o.parent).height(u);o.parent.appendChild(c[0]);window.requestAnimationFrame(a)};r.resize=function(){var e=450;if(r.widthFn!==null){e=r.widthFn.apply(this)}if(n===e)return;var t=document.querySelectorAll("#chat-area .GraphWrapper");for(var i=0,a=t.length;i<a;i++){t[i].setAttribute("style","width: "+e+"px; height: "+e+"px;");t[i].innerHTML="";var o=Util.CreateElement({tagName:"img",className:"graph-thumbnail",attributes:[{key:"src",value:"/images/placeholder.gif"}]});t[i].appendChild(o);var s=t[i].getAttribute("data-graph-input");if(s!==null){r.add(t[i],s,o)}}n=e;r.process()};return r}(jQuery);Component.GraphDialog=function(){var e,t,r,n,i;var a,o;$.subscribe("graph/beforeShow",function(u){var l=document.querySelectorAll(".popup-container");if(l.length>0){Util.AddClass("popup-graph",l[l.length-1])}e=null;t=document.getElementById("graph-inner");r=$("#graph-zoom-in");n=$("#graph-zoom-out");i=$("#graph-center");a=u;o=null;r.on("click",function(){if(e!==null)e.zoomIn()});n.on("click",function(){if(e!==null)e.zoomOut()});i.on("click",function(){if(e!==null)e.reset()});s();o=$.subscribe("window/resize",function(){e.resize()});$.publish("window/disableSelection")});$.subscribe("graph/afterHide",function(){$.unsubscribe(o);$.publish("window/enableSelection")});var s=function(){var r=t.offsetWidth;var n=t.offsetHeight;e=$('<div class="Graph" style="width:'+r+"px; height:"+n+'px;" data-input="'+a+'"></div>');e.MWGraph({showErrors:false,mousewheel:true,draggable:true,background:"#fff",fromSubjectsPage:false,solverInput:e.data("input")});e.show();e.draw();$(t).append($("<div></div>").addClass("GraphWrapper").append(e));e.removeAttr("style")}};Component.Header=function(e,t){e=e||false;t=t||false;var r=$.query("#return-link");var n=$.query("#mathway-link");var i=$.query(".member-icon");var a=App.getHomeLink(e);if(r.length>0){r.click(function(e){e.preventDefault();Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:t?"Enter a problem link ALT":"Enter a problem link",eventAction:"click",eventLabel:"from: "+document.location.pathname});Util.Redirect(a)})}var o=App.getQueryParam("pr");if(e&&o!==false){a+=a.indexOf("?")!==-1?"&":"?";a+="affiliateid="+o}$.subscribe("TutorHub/Connected",function(){if(Auth.hasRole(UserRoles.Tutor))i.addClass("tutorConnected")});$.subscribe("TutorHub/Disconnected",function(){if(Auth.hasRole(UserRoles.Tutor))i.removeClass("tutorConnected")});$.subscribe("auth/refreshedUserState",function(){if(Auth.hasRole(UserRoles.TutoringAccess))i.addClass("tutorAccess")});n.attr("href",a)};Component.ImageCropDialog=function(){var e=null;var t=null;var r=null;var n=null;var i=null;var a=null;var o=null;var s=null;var u=200;var l=150;var c=36;var p={x:0,y:0,width:0,height:0,mouseX:0,mouseY:0};var d={nw:null,ne:null,sw:null,se:null};var f={width:0,height:0,offsetTop:0,offsetLeft:0,ratio:1};var h=0;var m=1e3;$.subscribe("ocr/afterShow",function(u,l,c){e=document.getElementById("ocr-image");t=document.getElementById("ocr-result");r=new Image;n=document.getElementById("ocr-overlay");i=document.getElementById("ocr-submit");o=c;Util.ProcessImageData(u,l.Orientation,1e3,function(e){var n=e.toDataURL("image/jpeg");t.addEventListener("load",function(){g();b();a=$.subscribe("window/resize",function(){g();clearTimeout(s);s=null;s=setTimeout(function(){g()},250)})});t.setAttribute("src",n);r.src=n})});$.subscribe("ocr/afterHide",function(){S();t.removeAttribute("src");t=null;n=null;i=null;e=null;o=null;$.unsubscribe(a);a=null;clearTimeout(s);s=null;f={width:0,height:0,offsetTop:0,offsetLeft:0,ratio:1}});var g=function(){f.width=t.width;f.height=t.height;var r=getComputedStyle(e,null);var n=parseInt(r.width);var i=parseInt(r.height);f.offsetLeft=n-f.width;if(f.offsetLeft>0)f.offsetLeft=Math.floor(f.offsetLeft/2);f.offsetTop=i-f.height;if(f.offsetTop>0)f.offsetTop=Math.floor(f.offsetTop/2);if(f.width!=t.naturalWidth)f.ratio=t.naturalWidth/f.width;v()};var v=function(){var t=e.getBoundingClientRect();var r=u;if(r>f.width)r=f.width;var i=l;if(i>f.height)i=f.height;n.style.width=r+"px";n.style.height=i+"px";n.style.left=Math.floor((t.width-r)*.5)+"px";n.style.top=Math.floor((t.height-i)*.5)+"px"};var b=function(){d.nw=document.querySelector(".ocr-corner-nw");C(d.nw,function(e,t){var r=p.width-(e-p.mouseX);var i=p.height-(t-p.mouseY);var a=p.x+(e-p.mouseX);var o=p.y+(t-p.mouseY);if(r>c&&a>f.offsetLeft){n.style.width=r+"px";n.style.left=a+"px"}if(i>c&&o>f.offsetTop){n.style.height=i+"px";n.style.top=o+"px"}});d.ne=document.querySelector(".ocr-corner-ne");C(d.ne,function(e,t){var r=p.width+(e-p.mouseX);var i=p.height-(t-p.mouseY);var a=p.y+(t-p.mouseY);if(r>c&&p.x+r<=f.offsetLeft+f.width){n.style.width=r+"px"}if(i>c&&a>f.offsetTop){n.style.height=i+"px";n.style.top=a+"px"}});d.sw=document.querySelector(".ocr-corner-sw");C(d.sw,function(e,t){var r=p.width-(e-p.mouseX);var i=p.height+(t-p.mouseY);var a=p.x+(e-p.mouseX);if(r>c&&a>f.offsetLeft){n.style.width=r+"px";n.style.left=a+"px"}if(i>c&&p.y+i<=f.offsetTop+f.height){n.style.height=i+"px"}});d.se=document.querySelector(".ocr-corner-se");C(d.se,function(e,t){var r=p.width+(e-p.mouseX);var i=p.height+(t-p.mouseY);if(r>c&&p.x+r<=f.offsetLeft+f.width){n.style.width=r+"px"}if(i>c&&p.y+i<=f.offsetTop+f.height){n.style.height=i+"px"}});i.addEventListener("click",function(){w()})};var y=function(){var t=getComputedStyle(n,null);var r=e.getBoundingClientRect();var i=n.getBoundingClientRect();return{width:parseInt(t.width),height:parseInt(t.height),x:Math.abs(r.left-i.left),y:Math.abs(r.top-i.top)}};var w=function(){var e=Util.TimeStamp();if(h>e)return;h=e+m;var r=y();var n=Util.CropFromImage(t,r.width,r.height,r.x-f.offsetLeft,r.y-f.offsetTop,f.ratio);if(typeof o==="function"){Actions.Do(Actions.showSpinner);o.apply(this,[n]);Popup.hide();Actions.Do(Actions.hideSpinner)}else{Actions.Do(Actions.showSpinner);$.ajax({url:"/OCR",method:"POST",contentType:"application/x-www-form-urlencoded",async:true,cache:false,data:{imageData:n.toDataURL(),culture:App.Culture.current}}).done(function(e){if(e.IsError){x(e.Message)}else{App.CurrentEditor.InsertMathPix(e.AsciiMath);Popup.hide()}Actions.Do(Actions.hideSpinner)})}};var C=function(e,t){var r="ontouchstart"in document.documentElement;e.addEventListener(r?"touchstart":"mousedown",function(e){e.preventDefault();p=y();if(r){p["mouseX"]=e.changedTouches[0].pageX;p["mouseY"]=e.changedTouches[0].pageY}else{p["mouseX"]=e.pageX;p["mouseY"]=e.pageY}var n=function(e){var n=0;var i=0;if(r){n=e.changedTouches[0].pageX;i=e.changedTouches[0].pageY}else{n=e.pageX;i=e.pageY}t.apply(this,[n,i])};window.addEventListener(r?"touchmove":"mousemove",n);window.addEventListener(r?"touchend":"mouseup",function(){window.removeEventListener(r?"touchmove":"mousemove",n)})})};var S=function(){p={x:0,y:0,width:0,height:0,mouseX:0,mouseY:0};d={nw:null,ne:null,sw:null,se:null};i.removeEventListener("click",w)};var x=function(e){Popup.showError(e)}};Component.ImageUpload=function(){var e=80;var t=80;var r=false;var n=1;$.subscribe("tutorPreSession/no",function(){n=2});$.subscribe("Tutor/StartRoom",function(){n=3});$.subscribe("tutor/leaveRoom",function(){n=1});$.subscribe("tutorPreSession/beforeHide",function(){n=1});$.subscribe("tutorPreSession/appPhoto",function(e){n=4;l(e)});$.subscribe("expertQA/composeAnswer",function(){n=5});$.subscribe("editor/imageUpload",function(e){e.off().on("change",function(){if(r)return;r=true;Actions.Do(Actions.showSpinner);if(this.files&&this.files[0]){var t=this.files[0];l(t)}e.attr("value","");e.val("");r=false;Actions.Do(Actions.hideSpinner)});e.trigger("click")});var i=function(r,n,i){if(r.width>e&&r.height>t){Popup.showImageCrop(n,i)}else{Popup.showError(Strings.OCR.TooSmall)}};var a=function(e,t){Popup.showImageCrop(e,t,function(e){var t="t"+(new Date).getTime()+".jpg";e.toBlob(function(e){API.uploadBlobImage(t,e,ImageType.Whiteboard,false,function(e){if(e.status===1){$.publish("tutorPreSession/imageUpload",[e.value])}else{Popup.showError(Strings.OCR.ProblemWithImage)}})})})};var o=function(e,t){Popup.showImageCrop(e,t,function(e){e.toBlob(function(e){var t="t"+(new Date).getTime()+".jpg";API.uploadBlobImage(t,e,ImageType.Whiteboard,false,function(e){if(e.status===1){var t=Chat.CreateBubble({content:e.value,callout:"ToggleImage",genre:"localImage",avatarUrl:Auth.userstate.avatarUrl,typeset:false,testContext:BubbleContext.TutorBubble,action:{method:"ToggleImage"}});Tutor.Hub.userSendsMessage(t)}else{Popup.showError(Strings.OCR.ProblemWithImage)}})})})};var s=function(e,t){Util.ProcessImageData(e,t.Orientation,2e3,function(){a(e,t)})};var u=function(e,t){Popup.showImageCrop(e,t,function(e){var t="t"+(new Date).getTime()+".jpg";e.toBlob(function(e){API.uploadBlobImage(t,e,ImageType.Whiteboard,false,function(e){if(e.status===1){$.publish("expertQA/insertImage",[e.value])}else{Popup.showError(Strings.OCR.ProblemWithImage)}})})})};var l=function(e){if(e.type!=="image/png"&&e.type!=="image/jpeg"&&e.type!=="image/gif"){Popup.showError(Strings.OCR.InvalidImage);return}var t=new FileReader;EXIF.getData(e,function(){var r=this.exifdata;t.onload=function(e){var t=new Image;t.src=e.target.result;t.onload=function(){switch(n){case 1:i(t,e.target.result,r);break;case 2:a(e.target.result,r);break;case 3:o(e.target.result,r);break;case 4:s(e.target.result,r);break;case 5:u(e.target.result,r);break;default:Debug.warn("Invalid state value: ",n);break}};t.onerror=function(){Popup.showError(Strings.OCR.ProblemWithImage)}};t.readAsDataURL(e)})}};Component.Keyboard=function(e){e=Util.Extend({subject:"algebra",size:"default",mock:false},e||{});var t=$.query("#drawer");var r=$("#keyboard .cell");var n=e.subject.toLowerCase();var i=e.mock;var a=false;var o=false;var s=false;var u=true;var l={};var c={};var p=null;var d=null;var f=null;var h=null;var m=function(e){r.off();u=true;d=null;f=null;currentId=null;a=false;o=false;s=false;p=null;c={};l={};n=e.toLowerCase();g(function(){k();L();$.unsubscribe(h);h=$.subscribe("window/resize",function(){k()})})};var g=function(e){var t=function(t){v(t);if(typeof e==="function"){e.call(this)}};if(i){t(Component.Keyboard[n]);return}var r=n+".json";$.ajax({url:"/json/keyboard/"+r.toLowerCase(),method:"GET",dataType:"json",async:true,cache:true}).done(function(e){t(e)})};var v=function(e){if(typeof e.qwerty!=="undefined"){l.qwerty=new S(e.qwerty)}if(typeof e.large!=="undefined"){l.large=new S(e.large)}if(typeof e.small!=="undefined"){l.small=new S(e.small)}$.publish("pages/subject",[n])};var b=function(e){this.primary={id:null,"char":null,uni:null,keycode:-1};this.shift={id:null,"char":null,uni:null,keycode:-1};this.secondary={id:null,"char":null,uni:null,keycode:-1};this.span=1;this.row=0;this.style="default";this.fontSize="default";this.suppressPopup=false;if(typeof e!=="undefined"){this.fromJson(e)}};b.prototype.fromJson=function(e){if(typeof e.Primary!=="undefined"){if(typeof e.Primary.Id!=="undefined"){this.primary.id=e.Primary.Id}if(typeof e.Primary.Character!=="undefined"){this.primary.char=e.Primary.Character}if(typeof e.Primary.Keycode!=="undefined"){if(e.Primary.Keycode!=null){this.primary.keycode=e.Primary.Keycode}}if(typeof e.Primary.Uni!=="undefined"){this.primary.uni=e.Primary.Uni}if(typeof e.Primary.Shift!=="undefined"){if(e.Primary.Shift!==null){if(typeof e.Primary.Shift.Id!=="undefined"){this.shift.id=e.Primary.Shift.Id}if(typeof e.Primary.Shift.Character!=="undefined"){this.shift.char=e.Primary.Shift.Character}if(typeof e.Primary.Shift.Keycode!=="undefined"){if(e.Primary.Shift.Keycode!=null){this.shift.keycode=e.Primary.Shift.Keycode}}}}}if(typeof e.Secondary!=="undefined"){if(e.Secondary!==null){if(typeof e.Secondary.Id!=="undefined"){this.secondary.id=e.Secondary.Id}if(typeof e.Secondary.Character!=="undefined"){this.secondary.char=e.Secondary.Character}if(typeof e.Secondary.Keycode!=="undefined"){if(e.Secondary.Keycode!=null){this.secondary.keycode=e.Secondary.Keycode}}if(typeof e.Secondary.Uni!=="undefined"){this.secondary.uni=e.Secondary.Uni}}}if(typeof e.Span!=="undefined"){if(e.Span!==null){this.span=e.Span}}if(typeof e.Style!=="undefined"){if(e.Style!==null){this.style=e.Style}}if(typeof e.FontSize!=="undefined"){if(e.FontSize!==null){this.fontSize=e.FontSize}}if(typeof e.Suppresspopup!=="undefined"){if(e.Suppresspopup!==null){this.suppressPopup=e.Suppresspopup}}};var y=function(e,t,r){var n=$("<div></div>").addClass("kbKeyContainer").addClass("kbSpan"+e.span);var i=false;var a;var u=e.secondary;if(o){a=e.shift.id!==null?e.shift:e.primary}else{a=e.primary}var l=u.id!==null;if(s&&l){var c=u;u=a;a=c}var p=P(a);var d=P(u);if(!e.suppressPopup){i=true;var f=$("<div></div>").addClass("kbAlt").addClass(l?"kbDouble":"kbSingle").addClass(e.style).attr("id","key-"+a.id);if(t)f.addClass("kbAltFirst");if(r)f.addClass("kbAltLast");f.append($("<div></div>").addClass("kbAltKey").addClass(l?"kbAltLeft":"kbAltSingle").attr("data-id",a.id).attr("data-keycode",a.keycode).attr("data-char",p).text(p));if(l){f.append($("<div></div>").addClass("kbAltKey").addClass("kbAltRight").attr("data-id",u.id).attr("data-keycode",u.keycode).attr("data-char",d).text(d))}n.append(f)}var h=$("<div></div>").addClass("kbKey").addClass(e.style).attr("data-id",a.id).attr("data-keycode",a.keycode).attr("data-char",p).attr("data-popup",i?"1":"0").text(p);if(e.fontSize=="large")h.addClass("large");if(d!==null){h.append($("<span></span>").addClass("kbKeySecondary").text(d))}if(t)h.addClass("kbFirst");if(r)h.addClass("kbLast");n.append(h);return n};var w=function(e){this.keys=[];if(typeof e!=="undefined"){this.fromJson(e)}};w.prototype.fromJson=function(e){for(var t=0,r=e.length;t<r;t++){this.keys.push(new b(e[t]))}};var C=function(e){var t=$("<div></div>").attr("class","kbRow");for(var r=0,n=e.keys.length;r<n;r++){t.append(y(e.keys[r],r===0?true:false,r===n-1?true:false))}return t};var S=function(e){this.rows=[];this.maxInRow=0;if(typeof e!=="undefined"){this.fromJson(e)}};S.prototype.fromJson=function(e){for(var t=0,r=e.Rows.length;t<r;t++){if(!(this.rows[t]instanceof w)){this.rows[t]=new w}this.rows[t].fromJson(e.Rows[t]);var n=this.rows[t].keys.length;if(n>this.maxInRow){this.maxInRow=n}}};var x=function(e,t){if(s){e+="-swap"}if(o){e+="-shift"}if(p!==e){var n=c[e];if(typeof n==="undefined"){n=$("<div></div>").attr("class","kbContainer");for(var i=0,a=t.rows.length;i<a;i++){n.append(C(t.rows[i]))}c[e]=n}r.empty();r.append(n);p=e}var u=Math.floor(r.width()/t.maxInRow);var l=parseInt($(".kbKeyContainer").css("padding-left"))+parseInt($(".kbKeyContainer").css("padding-right"));u-=l;for(var d=0;d<10;d++){var f=d+1;$(".kbSpan"+f).css("width",E(u,f,l)+"px")}};var A=function(e){return e};var T=function(){return MediaQuery.maxWidth(550)};var I=function(){return MediaQuery.isLarge()};var E=function(e,t,r){var n=(t-1)*r;return e*t+n};var P=function(e){if(e.char!==null)return e.char;if(e.uni!==null)return e.uni.replace("u","");return A(e.id)};var k=function(){var t=e.size==="small"||T();if(!u){x("qwerty",l.qwerty)}else if(t){x("small",l.small)}else{x("large",l.large)}};var M=function(e){if(a)return;d=$("#key-"+e);if(d.hasClass("kbAltLast")){$keyContainer=d.parent();var t=$keyContainer.width();var n=d.width();d.css("margin-left",t-n+"px")}currentId=e;d.velocity({opacity:1},{duration:150,easing:"easeOutQuad",display:"block"});f.addClass("hover");r.on("mouseleave",".kbKey",function(e){e.preventDefault();var t=$.fn.eventTarget(e);if(!$(this).is(t)&&$(this).has(t).length===0&&!d.is(t)&&d.has(t).length===0){D()}});r.on("mouseleave",".kbAlt",function(e){e.preventDefault();var t=$.fn.eventTarget(e);if(!$(this).is(t)&&$(this).has(t).length===0&&!f.is(t)&&f.has(t).length===0){D()}});var i;r.on("touchmove",function(e){e.stopPropagation();e.preventDefault();var t=e.originalEvent.touches[0];var r=document.elementFromPoint(t.clientX,t.clientY);if(i!="undefined"&&i!=null){if(r!=i){$(i).removeClass("hover")}}if($(r).hasClass("kbAltKey")){$(r).addClass("hover");i=r}});r.on("touchend",function(e){e.stopPropagation();e.preventDefault();var t=$(".hover");if($(t).hasClass("kbAltKey")||$(t).hasClass("kbKey")){var r=$(t).attr("data-id");var n=$(t).attr("data-keycode");var a=$(t).attr("data-char");R(r,n,a);D();if(i!="undefined"){$(i).removeClass("hover")}}$(t).removeClass("hover");i=null});a=true};var D=function(){if(!a)return;if(d!==null){d.velocity({opacity:0},{duration:100,easing:"easeInQuad",display:"none"});f.removeClass("hover")}d=null;f=null;currentId=null;r.off("mouseleave",".kbKey");r.off("mouseleave",".kbAlt");r.off("touchend");a=false};var L=function(){r.on("touchstart mousedown",".kbKey",function(e){e.preventDefault();var t=$(this).attr("data-id");f=$(this);M(t)});r.on("mouseup",".kbKey",function(e){e.preventDefault();e.stopPropagation();if(t.hasClass("opening"))return;var r=$(this).attr("data-id");
var n=$(this).attr("data-keycode");var i=$(this).attr("data-char");R(r,n,i);D()});r.on("mouseup",".kbAltKey",function(e){e.preventDefault();e.stopPropagation();if(t.hasClass("opening"))return;var r=$(this).attr("data-id");var n=$(this).attr("data-keycode");var i=$(this).attr("data-char");R(r,n,i);D()});r.on("mouseenter",".kbAltKey",function(){$(this).addClass("hover")});r.on("mouseleave",".kbAltKey",function(){$(this).removeClass("hover")})};var R=function(e,t,r){if(typeof t==="undefined")t=-1;if(typeof r==="undefined")r="";var n={id:e,code:t,character:r};$.publish("testing/keyboard/output",[n]);switch(e){case"shift":o=!o;k();break;case"abc":u=false;o=false;s=false;k();break;case"num":u=true;o=false;s=false;k();break;case"swap":s=!s;k();break;case"matrix":Popup.showMatrix();break;case"trig":Popup.showTrig();break;case"periodicTable":Popup.showPeriodicTable();break;default:$.publish("keyboard/output",[n]);break}};$.subscribe("keyboard/change",function(e){m(e)});Scheduler.Add({label:"Initialize Keyboard",priority:12,evalFn:function(){return true},execFn:function(){g(function(){k();L();$.publish("Scheduler/Next");h=$.subscribe("window/resize",function(){k()});setTimeout(function(){k()},400)})}})};Component.Login=function(e){e=e||{};var t=false;var r,n,i,a,o,s;var u=false;$.subscribe("login/beforeShow",function(e){o=e;var s=e.state==="signin"?1:0;r=$("#si-forgot-password");n=$("#sign-up .login-bottom a");i=$("#sign-in .login-bottom a");n.on("click",function(t){t.preventDefault();Popup.hide();setTimeout(function(){e.state="signin";Popup.showLogin(e)},500)});i.on("click",function(t){t.preventDefault();Popup.hide();setTimeout(function(){e.state="signup";Popup.showSignUp(e)},500)});r.on("click",function(e){e.preventDefault();Popup.hide();Popup.showForgotPassword()});l();var u=function(){if(s===0){a=new d("sign-up",API.signUpUS,"#login-verify-signin-container")}else{a=new d("sign-in",API.signInUS,"#login-verify-signin-container")}a.onActivate();auth2.attachClickHandler(a.$google[0],{},function(e){$.publish("auth/google",[e])},function(e){Debug.log(JSON.stringify(e,undefined,2));Debug.trace()})};if(!t){gapi.load("auth2",function(){auth2=gapi.auth2.init({client_id:"198280107541-a59a1nbkhjap2so70htcvkicf6gkvblc.apps.googleusercontent.com",cookiepolicy:"single_host_origin"});u()});t=true}else{u()}});$.subscribe("login/afterShow",function(){Popup.center()});$.subscribe("login/beforeHide",function(){if(a.$verify.children().length>0){a.$verifyExternal[0].appendChild(a.$verify.children()[0])}a.onClose();a=null;document.removeEventListener("AppleIDSignInOnSuccess",c);document.removeEventListener("AppleIDSignInOnFailure",p)});var l=function(){var e=Math.random().toString(36).substring(7);s=new oAuthHandler(oAuthProviders.Apple,e);AppleID.auth.init({clientId:"com.chegg.mathway",scope:"email",redirectURI:App.baseUrl+"/AppleSignInReturn",state:e,usePopup:true});document.addEventListener("AppleIDSignInOnSuccess",c);document.addEventListener("AppleIDSignInOnFailure",p)};var c=function(e){Actions.Do(Actions.showSpinner);if(s!==undefined){var t=s.getEmailAndIdFromAuth(e.detail.authorization);if(t.error==""){$.publish("auth/apple",[t])}else{Actions.Do(Actions.hideSpinner);Popup.showError(Strings.Errors.Generic)}}};var p=function(e){if(s!==undefined){var t=s.handleError(e);if(t.showMessage){Popup.showError(t.message)}}};var d=function(e,t,r){this.prefix="#"+e;this.$submitBtn=$(this.prefix+" .login-submit");this.$email=$(this.prefix+" .login-email");this.$password=$(this.prefix+" .login-password");this.$validator=$(this.prefix+" .login-validation");this.$items=$(this.prefix+" .login-validation > ul > li");this.$ajax=$(this.prefix+" .login-ajax");this.$inner=$(this.prefix+" .login-inner");this.$verify=$(this.prefix+" .login-verify");this.$verifyExternal=$(r);this.$facebook=$(this.prefix+" .login-facebook");this.$google=$(this.prefix+" .login-google");this.$server=$(this.prefix+" .serverresult");this.api=t;this.startDelay=null;this.nextSubmitTime=Util.TimeStamp();var n=this;this.$submitBtn.click(function(e){e.preventDefault();n.submit()});this.$password.keypress(function(e){if(e.which===13){n.submit()}});this.$facebook.click(function(){FB.login(function(e){if(e.status==="connected"){var t=null;if(!Util.IsNullOrEmpty(e.authResponse)&&!Util.IsNullOrEmpty(e.authResponse.accessToken)){t=e.authResponse.accessToken}$.publish("auth/facebook",[t])}},{scope:"email"})});this.activateRecaptcha()};d.prototype={getWidget:function(){if(this.prefix==="#sign-up")return App.Validator.widgetIn;else if(this.prefix==="#sign-in")return App.Validator.widgetIn;else return-1},activateRecaptcha:function(){this.$verify[0].appendChild(this.$verifyExternal.children()[0]);this.$verify.show();Popup.center()},submit:function(){var e=this;if(e.nextSubmitTime>Util.TimeStamp())return;e.nextSubmitTime=Util.TimeStamp()+1e3;var t=App.getQueryParam("affiliateid");if(t===false)t=App.getQueryParam("pr");var r={email:this.$email.val(),password:this.$password.val(),promocode:t===false?"":t};Actions.Do(Actions.showSpinner);var n=grecaptcha.getResponse(e.getWidget());e.api.apply(this,[r.email,r.password,r.promocode,e.getWidget(),n,function(t){Actions.Do(Actions.hideSpinner);f(e,t)}])},startValidation:function(){var e=this;this.$email.on("keyup",function(){var t=Component.Login.Validate({email:e.$email.val(),password:e.$password.val()});e.updateValidation(t)});this.$password.on("keyup",function(){var t=Component.Login.Validate({email:e.$email.val(),password:e.$password.val()});e.updateValidation(t)})},stopValidation:function(){this.$validator.hide();this.$items.hide();this.$email.removeClass("error");this.$password.removeClass("error");this.$email.off("keyup");this.$password.off("keyup")},updateValidation:function(e){if(u===true)return;this.$items.hide();this.$email.removeClass("error");this.$password.removeClass("error");if(e.length>0){var t=[];for(var r=0,n=e.length;r<n;r++){t.push($(this.prefix+" ."+e[r]).html());if(e[r].indexOf("email")>-1)this.$email.addClass("error");if(e[r].indexOf("password")>-1)this.$password.addClass("error")}u=true;Popup.show(t.join("<br>"),{},{onX:function(){u=false}})}},startAjax:function(){var e=this;this.startDelay=setTimeout(function(){e.$ajax.velocity({opacity:1},{duration:150,easing:"easeOutQuad",display:"block"});e.$inner.velocity({opacity:.2},{duration:200,easing:"easeInQuad"})},250)},stopAjax:function(){clearTimeout(this.startDelay);this.$ajax.velocity({opacity:0},{duration:125,easing:"easeInQuad",display:"none"});this.$inner.velocity({opacity:1},{duration:50,easing:"easeOutQuad"})},onActivate:function(){Tabbing.addFields([this.prefix+" .login-email",this.prefix+" .login-password",this.prefix+" .login-submit"],true)},onDeactivate:function(){Tabbing.removeAllFields()},onClose:function(){this.$email.val("");this.$password.val("");this.stopValidation();this.onDeactivate()}};var f=function(e,t){locked=false;e.stopAjax();if(t.status===ResponseStatuses.Success){if(t.messageId===ErrorCode.PasswordOutdated){Popup.showForgotPassword({security:true});return}Auth.logInUS(t.userState.token,t.userState);if(!o.onAuthUpgrade){$.publish("check/resolve")}$.publish("auth/fromDialog")}else{switch(t.messageId){case ErrorCode.RecaptchaChallenge:e.updateValidation(["captchainvalid"]);break;case ErrorCode.PasswordShort:case ErrorCode.PasswordSimple:e.updateValidation(["passwordsimple"]);break;default:$.publish("auth/loginfailed",[t.messageId]);e.$server.html(t.errorMessage)}if(t.messageId===88){}else if(t.messageId===84){$.publish("auth/loginfailed",[43]);e.$server.html(t.errorMessage);grecaptcha.reset()}else{$.publish("auth/loginfailed",[t.messageId]);e.$server.html(t.errorMessage);grecaptcha.reset()}}};$.subscribe("auth/loggedin",function(){if(!o)return;if(o.onAuthReload){Util.reload();return}Popup.hide();if(o.onAuthUpgrade&&!Auth.hasSubscription()){App.upgrade()}if(o.onAuthUpgradeDelayed){$.publish("upgrade/authenticated")}});$.subscribe("auth/loginfailed",function(e){if(typeof e==="undefined")return;switch(e){case ErrorCode.EmailTaken:a.updateValidation(["emailtaken"]);break;case ErrorCode.FacebookEmailNotProvided:a.updateValidation(["facebooknoemail"]);FB.api("/me/permissions","DELETE",function(e){});break;case ErrorCode.CredentialsInvalid:a.updateValidation(["passwordinvalid"]);break;case ErrorCode.LoginAttemptThreshold:$.publish("login/lockedOut");break;default:case ErrorCode.InvalidGoogleAccessToken:a.updateValidation(["serverresult"]);break}});$.subscribe("document/ready",function(){if(typeof e.startOpen!=="undefined"&&e.startOpen!==""){if(Auth.isLoggedIn()){$.publish("ChatLibrary/StateCheck");App.upgrade()}else{if(e.startOpen==="signin"){Popup.showLogin({onAuthUpgrade:true})}else{Popup.showSignUp({onAuthUpgrade:true})}}}});$.subscribe("login/lockedOut",function(){setTimeout(function(){Popup.hide();setTimeout(function(){Popup.showModal(Strings.Auth.TooManyAttempts)},250)},100)})};Component.Login.Validate=function(e){if(typeof e==="undefined"){return["noemail","nopassword"]}var t=[];var r=function(e){if(typeof e==="undefined"){return false}return true};if(typeof e.email!=="undefined"){if(typeof e.email!=="string"){t.push("emailinvalid")}else if(e.email.length===0){t.push("noemail")}else if(!Util.isRFC2822Email(e.email)){t.push("emailinvalid")}}else{t.push("noemail")}if(typeof e.password!=="undefined"){if(typeof e.password!=="string"){t.push("passwordinvalid")}else if(e.password.length===0){t.push("nopassword")}else if(!r(e.password)){t.push("passwordshort")}}else{t.push("nopassword")}return t};Component.Matrix=function(){var e,t,r,n,i;const a=["#matrix-num-cols","#matrix-num-rows","#matrix-select"];var o,s;$.subscribe("matrix/beforeShow",function(){e=$(".matrix-cells");t=$("#matrix-num-rows");r=$("#matrix-num-cols");n=$(".matrix-cell");i=$("#matrix-select");o=3;s=3;n.on("mouseenter",function(){var e=parseInt(this.attributes["data-row"].value);var t=parseInt(this.attributes["data-col"].value);u(e,t)});n.on("mouseleave",function(){u(o,s)});n.click(function(e){e.preventDefault();o=parseInt(this.attributes["data-row"].value);s=parseInt(this.attributes["data-col"].value);l()});t.change(function(){o=parseInt(t.val());l()});r.change(function(){s=parseInt(r.val());l()});t.on("mouseup",function(e){e.stopPropagation()});r.on("mouseup",function(e){e.stopPropagation()});i.click(function(e){e.preventDefault();$.publish("keyboard/output",[{id:"matrix",row:o,col:s}]);Popup.hide()});l()});var u=function(e,t){var r=document.getElementsByClassName("matrix-cell");for(var n=0,i=r.length;n<i;n++){var a=parseInt(r[n].attributes["data-row"].value);var u=parseInt(r[n].attributes["data-col"].value);var l=a<=e&&u<=t;var c=a<=o&&u<=s;if(l&&c){r[n].className="matrix-cell selhoved"}else if(c){r[n].className="matrix-cell selected"}else if(l){r[n].className="matrix-cell hovered"}else{r[n].className="matrix-cell"}}};var l=function(){t.val(o);r.val(s);u(o,s)}};Component.Member=function(){var e=$.query("#top-menu .member-icon");var t=function(){n();i();e.removeClass("notLoggedIn").removeClass("signedInFB").addClass("signedIn")};var r=function(){n();i();e.removeClass("signedIn").removeClass("signedInFB").addClass("notLoggedIn")};var n=function(){try{if(Auth.hasRole(UserRoles.Affiliate)&&Auth.userstate.MWaffiliateCode!=""){$("#affiliates-placeholder").html('<a class="menu-row link" href="/AffiliateDashboard.aspx" id="menu-affiliate-entry"><div class="menu-bullet">'+'<i class="mw mw-statistics"></i></div><div class="menu-text">'+Strings.Pages.Affiliates+'</div><div class="clear"></div></a>')}else{$("#affiliates-placeholder").html("")}}catch(e){$("#affiliates-placeholder").html("")}};var i=function(){try{if(Auth.hasRole(UserRoles.TutorInTraining)||Auth.hasRole(UserRoles.Tutor)){$("#tutor-placeholder").html('<a class="menu-row link" href="/TutorDashboard" id="menu-affiliate-entry"><div class="menu-bullet">'+'<i class="mw mw-statistics"></i></div><div class="menu-text">'+Strings.Pages.Tutors+'</div><div class="clear"></div></a>')}else{$("#tutor-placeholder").html("")}}catch(e){$("#tutor-placeholder").html("")}};$.subscribe("auth/loggedin",function(){t()});$.subscribe("auth/loggedout",function(){r()});$.subscribe("upgrade/success",function(t){if(t)e.addClass("tutorAccess")});if(Auth.isLoggedIn()){$.publish("auth/loggedin")}else{$.publish("auth/loggedout")}n();i()};Component.Mobile=function(e){e=$.extend({graphPage:false},e||{});var t=false;var r=WebStorage.mobileNag.get();if(Tutor.isConnected()){t=false}else if((r===null||r==="false")&&App.isBot===false){t=true}var n=$.query("#mobile-notify .mobile-dismiss");var i=$.query("#mobile-notify .culture-go");var a=$.query("#mobile-notify .mobile-browse");var o=$.query("#header");var s=document.querySelector("#top-menu .cell");var u=$.query(".main-window");var l=$.query("#about-content");var c=$.query("#dropdowns");var p=null;var d=50;var f=false;var h=App.Platform.Web;var m=navigator.userAgent||navigator.vendor||window.opera;var g=e.graphPage?"graph/resize":"layout/chat";if(m.match(/iPad/i)||m.match(/iPhone/i)||m.match(/iPod/i)){h=App.Platform.IOS}else if(m.match(/Android/i)){h=App.Platform.Android}var v=window.location.href;var b=false;function y(e){if(e=="ko")e="kr";else if(e=="zh")e="cn";else if(e=="hi")e="";else if(e=="ja")e="jp";if(e=="en-US")return"";return e+"/"}switch(h){case App.Platform.Web:f=false;v="https://www.mathway.com";break;case App.Platform.IOS:f=true;var w=y(App.Culture.current);v="https://itunes.apple.com/"+w+"app/apple-store/id467329677?pt=688318&ct=banner&mt=8";break;case App.Platform.Android:f=true;v="http://play.google.com/store/apps/details?id=com.bagatrix.mathway.android&hl="+App.Culture.current;break;case App.Platform.Amazon:f=false;v="https://www.mathway.com";break;case App.Platform.WindowsPhone:f=false;v="https://www.mathway.com";break}var C=function(){switch(h){case App.Platform.Web:$.query("#mobile-web").show();break;case App.Platform.IOS:$.query("#mobile-ios").show();break;case App.Platform.Android:$.query("#mobile-android").show();break;case App.Platform.Amazon:$.query("#mobile-amazon").show();break;case App.Platform.WindowsPhone:$.query("#mobile-windows").show();break}$.query("#culture-hint").hide();$.query("#mobile-notify .mobile-messages").show();i.hide();a.show()};var S=function(){return s.offsetHeight+1};var x=function(){settings={duration:250,easing:"easeInQuint"};var t=S()+d+"px";if(u.length>0)u.velocity({top:t},settings);if(l.length>0)l.velocity({top:t},settings);if(c.length>0)c.velocity({top:t},settings);if(!e.graphPage)settings.progress=function(){$.publish("layout/chat")};settings.complete=function(){$.publish(g)};o.velocity({top:0},settings);$.publish("topbar/open",[t]);b=true};var A=function(){settings={duration:100,easing:"easeOutQuint"};var t=S()+"px";if(u.length>0)u.velocity({top:t},settings);if(l.length>0)l.velocity({top:t},settings);if(c.length>0)c.velocity({top:t},settings);if(!e.graphPage)settings.progress=function(){$.publish("layout/chat")};settings.complete=function(){$.publish(g)};o.velocity({top:"-"+d+"px"},settings);$.publish("topbar/close");b=false};n.click(function(e){if(b){e.preventDefault();if(p!==null)clearTimeout(p);WebStorage.mobileNag.set("true");A();$.publish("Scheduler/Next")}});Scheduler.Add({label:"Mobile Platform Banner",priority:110,evalFn:function(){return t&&f?true:false},execFn:function(){p=setTimeout(function(){C();x();$.publish("layout/scrollBottom")},2500);a.click(function(e){e.preventDefault();Util.Redirect(v)})}})};Component.Offers=function(){var e=function(){$("#btnRedeemOffer").hide();if(App.getQueryParam("promo")==""){Util.Redirect("/")}if(!Auth.isLoggedIn()){Actions.Do(Actions.showLogin);$("#EmailMarketingContent").html("<h2>You must be logged in to claim promo codes</h2>")}else{if(Auth.hasSubscription()){Util.Redirect("/")}API.getPromo(App.getQueryParam("promo"),function(e){if(t(e)){if(e.promo!=null)$("#EmailMarketingContent").html(e.promo.LandingPageHTML);$("#btnRedeemOffer").show()}else{$.publish("coupon/invalid")}})}};var t=function(e){if(e.status!=1){return false}if(e.promo==null){return false}if(e.promo.MWpromo==""){return false}if(e.promo.MWDays==-1&&e.promo.MWAvailable==0){return false}API.checkRecurlyCoupon(App.getQueryParam("promo"),function(e){if(e.status!=1){$.publish("coupon/invalid")}});return true};e();$("#btnRedeemOffer").click(function(){App.upgrade()});$.subscribe("auth/loggedin",function(){e()});$.subscribe("upgrade/success",function(){Util.Redirect("/")});$.subscribe("coupon/invalid",function(){$("#EmailMarketingContent").html("<h2>This is not a valid promo code.</h2>");$("#btnRedeemOffer").hide()})};Component.PauseAsk=function(){var e,t,r;$.subscribe("pauseAsk/beforeShow",function(){e=$("#pause-ask-until");t=$("#pause-ask-submit");r=$("#pause-ask-deny");n();e.on("change",function(r){if(e.val()===""){t[0].setAttribute("disabled","disabled")}else{t[0].removeAttribute("disabled")}}).trigger("change");t.on("click",function(r){r.preventDefault();t[0].setAttribute("disabled","disabled");API.pauseSubscription(e.val(),false,function(e){t[0].removeAttribute("disabled");if(e.status===ResponseStatuses.Success){Popup.hide()}else{Popup.show(Strings.Settings.PauseError)}})});r.on("click",function(e){e.preventDefault();Popup.hide()})});var n=function(){e.html("");$('<option value="">No Pause</option>').appendTo(e);var r=new Date(parseInt(Auth.userstate.subEndDate.substr(6)));var n=r;for(var i=1;i<=6;i++){n=DateHelper.addMonths(r,n,1);$('<option value="'+i+'">'+Util.formatDateShort(n)+"</option>").appendTo(e)}t[0].setAttribute("disabled","disabled")}};Component.PeriodicTable=function(){var e,t,r,n,i,a,o;var s,u,l=[],c;$.subscribe("periodicTable/beforeShow",function(){e=$("#pt-elements-outer");t=$("#pt-elements-inner");r=$("#pt-select");n=$("#pt-next");i=$("#pt-previous");a=$("#pt-main");o=$("#pt-submit");s=1;u=0;c=false;if(l.length===0){$.ajax({url:"/json/elements.json",method:"GET",dataType:"json",async:true,cache:true}).done(function(e){l=e;p()})}else{p()}});var p=function(){r.change(function(){f(parseInt($(this).val()));this.size=0});r.blur(function(){this.size=0});r.on("mousedown",function(){if(this.options.length>12)this.size=12});a.on("swiperight",function(e){f(s+1)});a.on("swipeleft",function(e){f(s-1)});n.click(function(){f(s+1)});i.click(function(){f(s-1)});o.click(function(e){e.preventDefault();var t=s;var r=$("#e"+s+" .pt-symbol").text();var n=$("#e"+s+" .pt-name").text();var i=$("#e"+s+" .pt-weight").text();$.publish("keyboard/output",[{id:"element",number:t,symbol:r,name:n,weight:i}]);Popup.hide()});i.addClass("greyed");u=l.length;t.empty();r.empty();for(var e=0;e<u;e++){r.append($("<option></option>").attr("value",l[e].atomicNumber).appendText(l[e].atomicNumber+" - "+l[e].name+"("+l[e].symbol+")"));t.append($("<div></div>").attr("id","e"+l[e].atomicNumber).addClass("pt-element").append($("<div></div>").addClass("pt-shell").append($("<div></div>").addClass("pt-number").appendText(l[e].atomicNumber)).append($("<div></div>").addClass("pt-symbol").appendText(l[e].symbol)).append($("<div></div>").addClass("pt-name").appendText(l[e].name)).append($("<div></div>").addClass("pt-weight").appendText(l[e].atomicMass))))}};var d=function(e){var t=150;var r=600;return(r-t)*e/u+t};var f=function(t){if(c)return;if(t<1||t>u||t===s)return;c=true;var a=t>s?t-s:s-t;s=t;r.val(s);e.scrollTo("#e"+s,{duration:d(a),easing:"easeOutQuint",complete:function(){c=false;if(s===u)n.addClass("greyed");else n.removeClass("greyed");if(s===1)i.addClass("greyed");else i.removeClass("greyed")}})};var h=function(){e.scrollTo("#e"+s)}};Component.ProblemLink=function(){var e;var t,r,n;$.subscribe("problemLink/beforeShow",function(r){e=$("#link-container");t=$.subscribe("document/copy",function(e){var t=document.getElementById("link-textbox");if(t!=null&&t.value!=null)e.text=t.value},true);i(r)});$.subscribe("problemLink/afterHide",function(){$.unsubscribe(t)});var i=function(t){if(t!==r){r=t;e.html(UI.buildSpinnerDOM());$.ajax({url:"/Subjects/CreateLink/"+r,method:"GET",contentType:"text/plain",dataType:"text",cache:true}).done(function(e){n=e;a()})}else{a()}};var a=function(){e.empty().append($("<input />").attr("id","link-textbox").attr("type","text").attr("readonly","readonly").attr("value",n));$("#link-textbox").select();if(App.isSafari){$("#link-textbox").on("click",function(){$(this)[0].setSelectionRange(0,9999)})}}};Component.RateSolution=function(){var e,t,r,n,i,a,o,s,u,l;var c,p,d,f,h,m,g,v,b;$.subscribe("rateSolution/beforeShow",function(w){e=$("#rate-solution-container");t=$("#rate-solution-form");r=t.children(".placeholder");n=t.find(".rating-container");i=$("#rate-solution-comment");a=$("#rate-solution-submit");o=$(".rate-solution .error");s=$("#rate-error-general");u=$("#rate-error-stars");l=$(".rate-solution .thanks");c=0;p=false;d=false;f=w.asciiMath;h=w.mathML;m=w.subject;g=w.topicId;v=w.topicText;b=w.customData;new Component.Rating({elem:n[0],onRating:function(e){c=e}});t.on("submit",function(e){e.preventDefault();if(d){Popup.hide();return}if(p||f==null)return;if(c===0){u.show();return}p=true;Actions.Do(Actions.showSpinner);Actions.Do(Actions.dispatchRating,{asciiMath:f,mathML:h,subject:m,topicId:g,topicText:v,customData:b,rating:c,comments:i.val(),callback:function(e){y(e)}})})});$.subscribe("rateSolution/afterHide",function(){if(d)$.publish("rating/success",[])});var y=function(e){p=false;o.hide();Actions.Do(Actions.hideSpinner);d=true;Popup.hide()};var w=function(){d=false;s.show()};var C=function(){d=true;a.val(Strings.RateSolution.Button_Success);i.hide()}}();Component.RateTutor=function(){var e,t,r,n,i,a,o,s;var u,l,c,p,d,f;$.subscribe("rateTutor/beforeShow",function(m){App.CurrentEditor.RemoveFocus();e=$("#rate-tutor-container");t=e.children(".placeholder");r=e.find(".rating-container");n=$("#rate-tutor-comment");i=$("#rate-tutor-submit");a=$(".rate-tutor .error");o=$("#rate-tutor-error-general");s=$("#rate-tutor-error-stars");u=0;l=false;c=false;p=m.RoomId;d=m.TutorId;f=m.EndSource;new Component.Rating({elem:r[0],onRating:function(e){u=e}});e.on("submit",function(e){e.preventDefault();if(c){Popup.hide();return}if(u===0){s.show();return}l=true;h();var t=DtoHelper.RatingResponse({RoomId:p,TutorId:d,UserId:Auth.userstate.userId,Rating:u,EndSource:f,Comments:n.val()});API.rateTutor(t)})});var h=function(e){l=false;a.hide();Actions.Do(Actions.hideSpinner);c=true;Popup.hide();App.CurrentEditor.TakeFocus()};var m=function(){c=false;o.show()};var g=function(){c=true;i.val(Strings.RateSolution.Button_Success);n.hide()}};Component.Rating=function(e){e=$.extend({elem:null,onRating:function(){}},e||{});var t=this;t.$container=$(e.elem);t.rating=0;var r=$("<div></div>").addClass("rating-stars");r.on("click","i",function(r){r.preventDefault();t.set($(this).index()+1);e.onRating(t.rating)});for(var n=0;n<Component.Rating.NumStars;n++)r.append(t.buildStar(true));t.$container.append(r)};Component.Rating.NumStars=5;Component.Rating.MaxRating=5;Component.Rating.prototype={buildStar:function(e){return e?'<i class="mw mw-star-o"></i>':'<i class="mw mw-star"></i>'},set:function(e){var t=this;t.rating=e;var r=t.$container.find(".mw");for(var n=0;n<Component.Rating.NumStars;n++){r.eq(n).removeClass("mw-star mw-star-o");if(n<=t.rating-1){r.eq(n).addClass("mw-star")}else{r.eq(n).addClass("mw-star-o")}}}};Component.ResetPassword=function(){var e="resetpassword";$.query("#reset-password").click(function(e){e.preventDefault();t();$.publish("overlay/show");Actions.Do(Actions.showSpinner);var n=$.query("#r-new-password").val().trim();var i=$.query("#r-verify-password").val().trim();API.resetPassword(n,i,WebStorage.userId.get(),function(e){$.publish("overlay/hide");Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success&&e.userState!=null){Auth.logIn(e.userState.token,e.userState);Popup.show(Strings.Settings.ResetPasswordComplete,{},{onOk:function(){Popup.hide()},afterHide:function(){Util.Redirect(App.getHomeLink())}})}else{switch(e.messageId){case ErrorCode.PasswordEmpty:case ErrorCode.PasswordInvalid:case ErrorCode.PasswordShort:case ErrorCode.PasswordSimple:r("password-simple");break;case ErrorCode.PasswordMismatch:r("mismatch");break;default:r("generic-error")}}})});var t=function(){$.query(".validation-message").hide()};var r=function(e){$.query(".validation-message[data-error-type="+e+"]").show()};$("#password-restart").on("click",function(e){e.preventDefault();Popup.showForgotPassword()})};Component.SetPasswordDialog=function(){var e=null;var t=null;var r=null;var n=null;var i=null;var a=false;var o="sp-has-error";var s=false;var u=function(){r.hide();n.hide();i.hide();t.removeClass(o)};var l=function(e){u();if(typeof e!=="string"){r.show();t.addClass(o);return false}if(e.length===0){n.show();t.addClass(o);return false}return true};var c=function(){if(s)return;s=true;t.on("change keyup paste",function(){var e=p();l(e)})};var p=function(){var e=t.val();e=e.replace(/^\s+|\s+$/gm,"");return e};var d=function(e,t,r){$.ajax({url:"/User/SetAnonPassword",method:"POST",contentType:"application/x-www-form-urlencoded",async:true,cache:false,data:{id:e,password:t}}).done(function(e){if(typeof r==="function")r.call(this,e)})};$.subscribe("setPassword/beforeShow",function(){e=$("#sp-submit");t=$("#sp-password");r=$("#sp-error-invalid");n=$("#sp-error-empty");i=$("#sp-error-tooshort");u();e.on("click",function(e){e.preventDefault();var t=p();if(l(t)){var r=0;if(Auth.userstate!==null&&typeof Auth.userstate.userId!=="undefined")r=Auth.userstate.userId;d(r,t,function(e){switch(e.messageId){case ErrorCode.PasswordShort:case ErrorCode.PasswordSimple:Popup.show($("#password-simple").html());return}a=true;$.publish("app/subscribed");Popup.hideAll();if(App.upgradeAllowed()){setTimeout(function(){Popup.showUpgrade({source:UpgradeSource.upgradeAfter})},UPGRADE_AFTER_TIMEOUT)}})}else{c()}})});$.subscribe("setPassword/afterShow",function(){t.focus()});$.subscribe("setPassword/afterHide",function(){e.off("click");if(!a){}u();if(s){t.off("change keyup paste");s=false}e=null;t=null;r=null;n=null;i=null;a=false})};Component.SettingsVM=function(e){if(!Auth.isLoggedIn()){Popup.showLogin({closeOnOverlay:false,closeOnX:false,onAuthReload:true,onX:function(){Util.Redirect(App.getHomeLink())}});return}API.getSettingsPageViewModel(function(t){if(t.status===ResponseStatuses.Success){new SettingsPageController(t.model);$.publish("auth/refreshedUserState");if(typeof e==="function")e.call(this)}else{switch(t.messageId){case ErrorCode.UserSessionExpired:Auth.logOut();Popup.showAndReload(Strings.Errors.UserSessionExpired);break;default:Popup.showError(t.message)}}})};var SettingsPageController=function(e){App.Model=e;var t=$("#tab-profile"),r=$("#tab-access"),n=$("#tab-email"),i=$("#tab-password"),a=$("#tab-account"),o=$("#tab-billing"),s=$("#tab-chat"),u=$("#tab-signout");var l=$("#change-email");var c=$("#settings-loader");c.removeClass("on");if(e.profile.show){var p=$("#settings_profile_avatar");var d=$("#settings_profile_firstname");t.show();p.css({backgroundImage:"url("+e.profile.avatarUrl+")"});d.val(e.profile.firstName);p.on("click",function(){Popup.showAvatar(e.profile.avatarUrl)});$.subscribe("AvatarRemoved",function(){e.profile.avatarUrl="/images/userAvatarDefault.png";p.css({backgroundImage:"url("+e.profile.avatarUrl+")"})});$.subscribe("AvatarUploaded",function(t){Actions.Do(Actions.hideSpinner);e.profile.avatarUrl=t;Auth.userstate.firstName=d.val();p.css({backgroundImage:"url("+e.profile.avatarUrl+")"});API.setFirstName(function(){Popup.showAndReload(Strings.Settings.ProfileSuccess)})})}if(e.access.show){r.show();if(e.access.showSBSAccess){var f=$("#stepbystep-access");if(e.user.info.hasStepByStep){f.addClass("on")}else{f.addClass("off")}f.show()}if(e.access.showExpertMessageAccess){var h=$("#expert-messages-access");if(e.user.info.hasExpertMessages){h.addClass("on")}else{h.addClass("off")}h.show()}var m=$("#stepbystep-credits");m.text(Strings.Settings.StepByStepCredits.replace("{NUM}",e.user.info.stepByStepCredits));if(e.access.showSBSCredits){m.show()}var g=$("#expert-live-credits");var v=e.user.info.expertLiveCredits>0?"":"red";g.html(Strings.Settings.ExpertLiveCredits+'&nbsp;<span class="'+v+'">'+e.user.info.expertLiveCredits+"</span>");if(e.access.showExpertLiveCredits){g.show()}var b=$("#tutoring-credits-renew-date");var y=$("#expert-live-credit-renewal");b.html(Util.formatDateShort(new Date(parseInt(e.user.subscription.creditRenewal.substr(6)))));if(e.access.showExpertLiveCreditRenewal){y.show()}if(e.access.showEndDate){$("#access-enddate").find("span").text(Util.formatDateShort(new Date(parseInt(e.user.subscription.end.substring(6)))));$("#access-enddate").show()}if(e.access.showUpgradeButton){var w=$("#stepbystep-upgrade");w.on("click",function(e){e.preventDefault();Actions.Do(Actions.showUpgrade)}).show()}}if(e.email.show){n.show()}if(e.email.readOnly){l.hide()}var C=function(e){ie(n);var t=[];e=e||[];if(typeof e.email==="undefined")t.push("no-email");else if(e.email.length===0)t.push("no-email");else if(!Util.isRFC2822Email(e.email))t.push("invalid-email");else if(e.email===Auth.userstate.email)t.push("same-email");if(typeof e.verify==="undefined")t.push("no-verify");else if(e.verify.length===0)t.push("no-verify");else if(e.verify!==e.email)t.push("mismatch");if(typeof e.password==="undefined")t.push("no-password");else if(e.password.length===0)t.push("no-password");return t};$("#btn-email").on("click",function(e){e.preventDefault();var t={email:$.query("#e-new-email").val().trim(),verify:$.query("#e-verify-email").val().trim(),password:$.query("#e-password").val().trim()};var r=C(t);if(r.length>0){ne(n,r);return}Actions.Do(Actions.showSpinner);API.updateEmailSettings(t.email,t.password,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.EmailSuccess)}else{ne(n,ae(e.messageId))}})});$("#e-user-email").val(e.user.info.email);if(e.password.show){i.show()}var S=function(e){ie(i);var t=[];e=e||[];if(typeof e.reset==="undefined"){if(typeof e.current==="undefined")t.push("no-password");else if(e.current.length===0)t.push("no-password")}if(typeof e.newPassword==="undefined")t.push("no-new-password");else if(e.newPassword.length===0)t.push("no-new-password");if(typeof e.verify==="undefined")t.push("no-verify");else if(e.verify.length===0)t.push("no-verify");else if(e.verify!==e.newPassword)t.push("mismatch");return t};$("#btn-password").on("click",function(e){e.preventDefault();var t={current:$.query("#p-current-password").val().trim(),newPassword:$.query("#p-new-password").val().trim(),verify:$.query("#p-verify-password").val().trim()};var r=S(t);if(r.length>0){ne(i,r);return}Actions.Do(Actions.showSpinner);API.changePassword(t.current,t.newPassword,t.verify,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.PasswordSuccess)}else{ne(i,ae(e.messageId))}})});if(e.account.show){a.show();$buttonDelete=$("#account-delete").on("click",function(e){e.preventDefault();var t=$.query("#d-current-password").val().trim();if(t===""){ne(a,["no-password"]);return}Popup.showConfirm(Strings.Settings.AccountDeleteConfirm,function(){API.deleteAccount(t,function(e){if(e.status===1){$.publish("auth/logout",[function(){Util.Redirect(App.getHomeLink())}])}else{ne(a,ae(e.messageId))}})})})}if(e.billing.show){o.show();if(e.billing.status.show){var x=$("#billing-status");var A=x.find(".form-buttons");x.show();var T=new Date(parseInt(e.user.subscription.end.substring(6))),I=new Date(parseInt(e.user.subscription.next.substring(6)));var E=$("#subscription-endson"),P=$("#subscription-endedon"),k=$("#subscription-nextbill"),M=$("#subscription-renewal");E.find(".date").text(Util.formatDateShort(T));P.find(".date").text(Util.formatDateShort(T));k.find(".date").text(Util.formatDateShort(I));M.find(".date").text(Util.formatDateShort(I));switch(e.user.subscription.status){case SubStatus.Active:$("#subscription-active").show();M.show();break;case SubStatus.PausePending:$("#subscription-pausepending").show();
E.show();M.show();break;case SubStatus.Paused:$("#subscription-paused").show();P.show();k.show();break;case SubStatus.Cancelled:$("#subscription-cancelled").show();E.show();break}if(e.billing.status.showReactivateButton){A.show();$("#btn-reactivate").on("click",function(t){t.preventDefault();Actions.Do(Actions.showSpinner);API.reactivateSubscription(e.user.info.id,e.user.subscription.id,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.ReactivateSuccess)}else{Popup.showError(Strings.Settings.ReactivateError)}})}).show()}if(e.billing.status.showResumeButton){A.show();$("#btn-resume").on("click",function(e){e.preventDefault();Actions.Do(Actions.showSpinner);API.resumeSubscription(function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.ResumeSuccess)}else{Popup.showError(Strings.Settings.ResumeError)}})}).show()}if(e.billing.status.showCancelPauseButton){A.show();$("#btn-cancel-pause").on("click",function(e){e.preventDefault();Popup.showConfirm(Strings.Settings.CancelPauseConfirm,function(){Actions.Do(Actions.showSpinner);API.pauseSubscription(0,true,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.CancelPauseSuccess)}else{Popup.showError(Strings.Settings.PauseError)}})})}).show()}}if(e.billing.upgrade.show){var D=$("#btn-upgrade-subscription");$("#billing-upgrade").show();var L=Strings.Settings.StepByStep;switch(e.user.subscription.type){case SubType.MonthlyTutoring:case SubType.YearlyTutoring:case SubType.QuarterlyTutoring:L+=" + "+Strings.Settings.ExpertLive;break;case SubType.MonthlyExpertQA:case SubType.QuarterlyExpertQA:case SubType.YearlyExpertQA:L+=" + "+Strings.Settings.Expert;break}$("#current-plan-label").html(L);var R=Currency.FormatCurrency(e.billing.upgrade.currentPlan.price,true);var N=Strings.Upgrade.PerMonth;if(e.user.subscription.type===SubType.Quarterly||e.user.subscription.type===SubType.QuarterlyTutoring||e.user.subscription.type===SubType.QuarterlyExpertQA)N=Strings.Upgrade.Quarter;if(e.user.subscription.type===SubType.Yearly||e.user.subscription.type===SubType.YearlyTutoring||e.user.subscription.type===SubType.YearlyExpertQA)N=Strings.Upgrade.PerYear;$("#current-plan-price").text(R+N+" + "+Strings.Upgrade.PriceTax);var U={};var F=$("#billing-upgrade-options");e.billing.upgrade.upgradePlans.forEach(function(e){U[e.type]=e.code;var t=F.children('[data-type="'+e.type+'"]');t.show();t.find(".upgrade-price").text(Currency.FormatCurrency(e.price,true))});$(".live-tutor-info").on("click",function(e){e.preventDefault();Popup.showTutorLearnMore()});D.on("click",function(t){t.preventDefault();var r=F.find("input:checked").parent(),n=parseInt(r.attr("data-type")),i=e.billing.upgrade.upgradePlans.filter(function(e){return e.type===n})[0].price,a="",o=Strings.Upgrade.PerMonth;switch(n){default:break;case SubType.MonthlyTutoring:a=Strings.Settings.ConfirmUpgradeMonthlyTutoring;break;case SubType.MonthlyExpertQA:a=Strings.Settings.ConfirmUpgradeMonthlyExpertQA;break;case SubType.Quarterly:o=Strings.Upgrade.Quarter;a=Strings.Settings.ConfirmUpgradeQuarterly;break;case SubType.QuarterlyTutoring:o=Strings.Upgrade.Quarter;a=Strings.Settings.ConfirmUpgradeQuarterlyTutoring;break;case SubType.QuarterlyExpertQA:o=Strings.Upgrade.Quarter;a=Strings.Settings.ConfirmUpgradeQuarterlyExpertQA;break;case SubType.Yearly:o=Strings.Upgrade.PerYear;a=Strings.Settings.ConfirmUpgradeAnnual;break;case SubType.YearlyTutoring:o=Strings.Upgrade.PerYear;a=Strings.Settings.ConfirmUpgradeAnnualTutoring;break;case SubType.YearlyExpertQA:o=Strings.Upgrade.PerYear;a=Strings.Settings.ConfirmUpgradeAnnualExpertQA;break}price="("+Currency.FormatCurrency(i)+" + "+Strings.Upgrade.PriceTax+o+")";a=a.replace("{PRICE}",price)+"  "+Strings.Settings.UpgradeRefundNote.replace("{REFUND}",Currency.FormatCurrency(e.billing.upgrade.refundAmount));Popup.showYesNo(a,function(){Actions.Do(Actions.showSpinner);API.upgradeSubscription(n,e.billing.upgrade.refundTimestamp,function(t){Actions.Do(Actions.hideSpinner);if(t.status===ResponseStatuses.Success){e.user.subscription.type=Auth.userstate.MWSubscriptionType;var r="";switch(e.user.subscription.type){case SubType.Quarterly:r=Strings.Settings.UpgradeSuccessQuarterly;break;case SubType.Yearly:r=Strings.Settings.UpgradeSuccessAnnual;break;case SubType.MonthlyTutoring:r=Strings.Settings.UpgradeSuccessMonthlyTutoring;break;case SubType.QuarterlyTutoring:r=Strings.Settings.UpgradeSuccessQuarterlyTutoring;break;case SubType.YearlyTutoring:r=Strings.Settings.UpgradeSuccessAnnualTutoring;break;case SubType.MonthlyExpertQA:r=Strings.Settings.UpgradeSuccessMonthlyExpertQA;break;case SubType.QuarterlyExpertQA:r=Strings.Settings.UpgradeSuccessQuarterlyExpertQA;break;case SubType.YearlyExpertQA:r=Strings.Settings.UpgradeSuccessAnnualExpertQA;break}Popup.showAndReload(r)}else{switch(t.messageId){case 71:Popup.showError(Strings.Errors.NoPaymentMethod);break;default:Popup.showError(Strings.Settings.UpgradeError);break}}})})}).prop("disabled",true);$("[name=upgrade-plan]").on("change",function(){D.prop("disabled",false)})}if(e.billing.pause.show){$("#billing-pause").show();var O=$("#pause-until"),B=$("#btn-pause"),H=new Date(parseInt(e.user.subscription.end.substr(6))),q={};for(var G=1;G<=6;G++){var _=DateHelper.addMonths(H,G);q[G]=Util.formatDateShort(_)}O.append('<option value="">'+Strings.Settings.PauseDefaultOption+"</option>");Object.keys(q).forEach(function(e){O.append('<option value="'+e+'">'+q[e]+"</option>")});O.on("change",function(e){e.preventDefault();if($(this).val()!==""){B.prop("disabled",false)}else{B.prop("disabled",true)}});B.on("click",function(e){e.preventDefault();var t=parseInt(O.val());var r=DateHelper.addMonths(H,t);var n=DateHelper.format(r,"mm/dd/yyyy");var i=Strings.Settings.PauseConfirm.replace("{DATE}",n);Popup.showConfirm(i,function(){Actions.Do(Actions.showSpinner);API.pauseSubscription(t,false,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.PauseSuccess)}else{Popup.showError(Strings.Settings.PauseError)}})})}).prop("disabled",true)}if(e.billing.showCancel){$("#billing-cancel").show();$("#btn-cancel").on("click",function(e){e.preventDefault();Popup.showCancelConfirm(function(){Actions.Do(Actions.showSpinner);API.cancelSubscription(Auth.userstate.userId,Auth.userstate.subscriptionId,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showCancellationSurvey()}else{Popup.show(Strings.Settings.CancelError)}})})})}if(e.billing.info.show){$("#billing-info").show();var W=$("#settings-page-recurly"),z=$('<div data-recurly="card"></div>');W.append(z);Recurly.configure();var d=$("#b-first-name"),j=$("#b-last-name"),V=$("#b-address"),Q=$("#b-city"),Y=$("#b-state"),X=$("#b-state-intl"),K=$("#b-zipcode");$country=$("#b-country"),hostedFieldsState=null;recurly.on("change",function(e){hostedFieldsState=e});d.val(e.billing.info.firstName);j.val(e.billing.info.lastName);V.val(e.billing.info.address);Q.val(e.billing.info.city);Y.val(e.billing.info.state);X.val(e.billing.info.state);K.val(e.billing.info.postalCode);$country.val(e.billing.info.country);var J=function(){X.removeAttr("data-recurly");$(".state-intl").hide();Y.attr("data-recurly","state");$(".state-us").show()};var Z=function(){Y.removeAttr("data-recurly");$(".state-us").hide();X.attr("data-recurly","state");$(".state-intl").show()};var ee=function(){return $country.val()==="US"};var te=function(){return $country.val()==="CA"};$country.on("change",function(e){if(ee())J();else Z()}).trigger("change");var re=function(){var e=ee()?Y:X;var t=[];if(d.val()===""){t.push("no-first-name")}if(j.val()===""){t.push("no-last-name")}if(V.val()===""){t.push("no-address")}if(Q.val()===""){t.push("no-city")}if(e.val()===""&&(ee()||te())){t.push("no-state")}if(K.val()===""){if(ee()||te()){t.push("no-postal-code")}}else if(ee()){var r=/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(K.val());if(r===false){t.push("no-postal-code")}}if(!hostedFieldsState||!hostedFieldsState.fields.card.valid){t.push("bi-recurly-cc-invalid")}var n=t.length===0;if(!n)ne(o,t);return n};$("#btn-billing-info").on("click",function(e){e.preventDefault();ie(o);if(!re()){return}Actions.Do(Actions.showSpinner);var t=$("#billing-form");Recurly.updateBilling(t[0],function(e,t){if(e){Actions.Do(Actions.hideSpinner);if(e.code==="validation"&&e.fields.length>0){e.fields.forEach(function(e,t){if(e==="number"||e==="month"||e==="year"||e==="cvv")ne(o,["bi-recurly-cc-invalid"]);else if(e==="first_name")ne(o,["no-first-name"]);else if(e==="last_name")ne(o,["no-last-name"]);else if(e==="city")ne(o,["no-city"]);else if(e==="postal_code")ne(o,["no-postal-code"]);else if(e==="address1")ne(o,["no-address"])})}else{ne(o,["bi-recurly-generic-error"])}}else{API.updateRecurlyBilling(Auth.userstate.userId,t.id,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Popup.showAndReload(Strings.Settings.UpdateInfoSuccess)}else{c.removeClass("on");switch(e.messageId){case 71:ne(o,["bi-recurly-cc-invalid"]);break;default:ne(o,["bi-recurly-generic-error"]);break}}})}})})}if(e.billing.showiTunes){$("#billing-itunes").show();$("#btn-itunes").on("click",function(e){e.preventDefault();Util.Redirect("https://support.apple.com/en-us/HT202039",true)})}if(e.billing.showGooglePlay){$("#billing-google").show();$("#btn-google").on("click",function(e){e.preventDefault();Util.Redirect("https://support.google.com/googleplay/answer/2476088?hl=en",true)})}}$("#btn-clear-history").on("click",function(e){e.preventDefault();Popup.showYesNo(Strings.Settings.ChatConfirm,function(){Actions.Do(Actions.showSpinner);API.clearMessageHistory(function(){Actions.Do(Actions.hideSpinner);Popup.show(Strings.Settings.ChatHistoryCleared,{},{onOk:function(){Popup.hide()}})})})});$("#btn-signout").on("click",function(e){e.preventDefault();Actions.Do(Actions.signOut)});var ne=function(e,t){t.forEach(function(t){e.find('.validation-message[data-error-type="'+t+'"]').show()})};var ie=function(e){e.find(".validation-message").hide()};var ae=function(e){switch(e){case 22:return["email-exists"];case 23:return["same-email"];case 21:return["invalid-email"];case 31:return["password-invalid"];case 34:return["mismatch"];case 33:return["password-simple"];case 32:return["password-invalid"];case 37:return["password-simple"];default:return["generic"]}};new Accordion($("#settings-accordion"));var oe=window.location.hash?window.location.hash:"#access";$("#tab-"+oe.substring(1)).children().first().trigger("click");$.subscribe("upgrade/success",function(){Util.reload()})};Component.ShowMore=function(){var e=$.query("#top-menu .show-more");var t=$.query("#showmore-menu");var r=$.query("body");var n=$.query("#showmore-menu .auth-only");var i=$.query("#showmore-menu .not-authed");var a=$.query("#showmore-menu .auth-not-subbed");var o=$.query("#menu-upgrade");var s=$.query("#menu-expert-qa");var u=$.query("#unread-expert-qa");var l;var c=t.css("display")!=="none"?true:false;var p=function(){if(!c){t.velocity({opacity:1},{display:"block",duration:100,easing:"easeOutQuad",complete:function(){r.addClass("clickable");l=$.subscribe("document/mouseup",f);c=true}})}};var d=function(){if(c){t.velocity({opacity:0},{display:"none",duration:50,easing:"easeInQuad",complete:function(){r.removeClass("clickable");$.unsubscribe(l);c=false}})}};var f=function(r){if(!t.is(r.target)&&t.has(r.target).length===0&&!e.is(r.target)&&e.has(r.target).length===0){d()}};var h=function(){n.show();i.hide();if(App.upgradeAllowed())o.show();else o.hide();m()};var m=function(){if(!Auth.isLoggedIn()||!App.Culture.isEnglish()){s.hide()}else{s.show();if(ExpertQA.UnreadAnswers>0){u.text(ExpertQA.UnreadAnswers).addClass("on");e.addClass("expert-qa-notify")}else{u.text("").removeClass("on");e.removeClass("expert-qa-notify")}}};$.subscribe("expertQA/update",function(){m()});$.subscribe("upgrade/success",function(){m()});var g=function(){n.hide();i.show();if(App.upgradeAllowed())o.show();else o.hide()};e.on("click",function(){if(c!==true){p()}else{d()}});$.subscribe("auth/loggedin",function(){h();if(Auth.hasSubscription()&&STM.Tests.CreditPackPurchase.enabled())o.remove()});$.subscribe("auth/loggedout",function(){g()});$.subscribe("upgrade/success",function(){if(App.upgradeAllowed())o.show();else o.hide()});$.query("#showmore-menu .link").click(function(e){var t=e.currentTarget.getAttribute("href");var r=true;switch(t){case"#help":UI.alert("help");break;case"#examples":d();$.publish("examples/open");break;case"#upgrade":d();Actions.Do(Actions.showUpgrade,{source:UpgradeSource.menu});break;case"#sign-out":Auth.logOut();d();Util.reload();break;default:r=false;d();break}if(r)e.preventDefault()});$.subscribe("splitTest/update",function(){if(Auth.hasSubscription()&&STM.Tests.CreditPackPurchase.enabled())o.remove();m()});if(Auth.isLoggedIn()){h()}else{g()}};Component.Solving=function(e){var t=2e3;$.subscribe("solving/dispatch",function(i){i=Util.Extend({subject:"",topicId:0,topicText:"",searchText:null,customData:null,asciiMath:"",mathML:"",isOCR:null,asciiEdited:null,historyClick:null,isSpeech:null,fromExamples:false,solveType:ChatSolveType.Regular,backIntoSolve:false,hideTopicBubble:false,fromPreset:false},i||{});var a=[];var o=[];var s=Editor.AsciiToMathml(i.asciiMath);if(i.solveType===ChatSolveType.LocalSolve)s="@mwsolve "+Editor.AsciiToMathml(i.asciiMath);var u="";if(Auth.userstate!==null)u=Auth.userstate.avatarUrl;var l=Chat.CreateBubble({content:s,genre:"local",avatarUrl:u,typeset:true,testContext:BubbleContext.Problem,action:{method:"InsertIntoEditor",params:{asciiMath:i.asciiMath,moreTopics:"n"}},extraClass:"ch-solution-top"});a.push(l);o.push(l);if(!i.hideTopicBubble&&i.topicId!==t&&i.topicText!==null){var c=Chat.CreateBubble({content:i.topicText,genre:"local",testContext:BubbleContext.Topic});a.push(c);o.push(c)}a.push(Chat.CreateBubble({genre:"loading",testContext:BubbleContext.Loading}));if(i.topicId===null&&i.topicText===null){$.publish("chat/getTopics")}else{if(!Tutor.inChatRoom()){$.publish("ChatLibrary/Insert",[{bubbles:a},{requestSolution:true,postRender:function(){n()}}])}$.publish("solving/start");API.chatBotTopics(i.topicId,i.topicText,i.customData,i.subject!==""?i.subject:e,i.asciiMath,i.mathML,i.isOCR,i.asciiEdited,i.historyClick,i.isSpeech,i.fromExamples,i.searchText,function(e){var t=e.messages;if(Tutor.inChatRoom())t=o.concat(t);r(e,i,t)})}});var r=function(t,r,i){if(t.status!==1&&t.error==="timeout"){var a=Chat.CreateBubble({content:Strings.Chat.TimeoutError,genre:"error",testContext:BubbleContext.ErrorBubble});if(Tutor.inChatRoom()){Tutor.dispatchSolution([a],0,false)}else{$.publish("ChatLibrary/Insert",[{bubbles:[a]},{solutionId:0}])}ErrorLog.SolveTimeout();return}if(t.type==="messagesResponse"&&t.showInterstitial&&!r.fromPreset){Actions.Do(Actions.showInterstitial)}Actions.Do(Actions.problemSolved,t.problemCount);WebStorage.lastSolve.set({subject:e,editorMarkup:r.mathML,editorNoMarkup:r.asciiMath,topicId:r.topicId,topicText:r.topicText});var o=t.solutionId!==undefined?t.solutionId:"";App.lastMessages=i;if(t.context==="TopicsError")ErrorLog.ChatBotTopics();else if(t.context==="SolverError")ErrorLog.ChatBotSolve();if(!Tutor.inChatRoom()){$.publish("ChatLibrary/Insert",[{bubbles:i},{solutionId:o,commitMessages:true,postRender:function(){n()}}])}else{Tutor.dispatchSolution(i,o,r.solveType===ChatSolveType.AtMathway?true:false)}};$.subscribe("check/resolve",function(){var e=WebStorage.attemptResolve.get();if(typeof ignoreAuth==="undefined")ignoreAuth=false;if(e!==null&&e==="true"){var t=WebStorage.lastSolve.get();if(t!==null){WebStorage.attemptResolve.set("false");topicId=t.topicId;topicText=t.topicText;editorNoMarkup=t.editorNoMarkup;editorMarkup=t.editorMarkup;$.publish("solving/dispatch",[{topicId:t.topicId,topicText:t.topicText,asciiMath:t.editorNoMarkup,mathML:t.editorMarkup,isOCR:false,asciiEdited:false,historyClick:false,isSpeech:false,fromExamples:false,fromPreset:true}])}}else{$.publish("ChatLibrary/StateCheck")}});var n=function(){var e=document.getElementsByClassName("ch-solution-top");if(e.length>0){$.publish("ChatLibrary/Scroll",[e[e.length-1],true])}};$.subscribe("subject/set",function(t){e=t})};var SplitTest=function(e,t){if(typeof e==="object"){this.testId=e.testId;this.testVariantId=typeof e.testVarientId!=="undefined"?e.testVarientId:e.testVariantId}else{this.testId=e;this.testVariantId=t}};SplitTest.Plans=function(e){if(typeof e!=="undefined"){WebStorage.recurlyTest.set(e)}else{var t=WebStorage.recurlyTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.TutorCheck=function(e){if(typeof e!=="undefined"){WebStorage.tutoringCheckTest.set(e)}else{var t=WebStorage.tutoringCheckTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.TutorFrame=function(e){if(typeof e!=="undefined"){WebStorage.tutoringFrameTest.set(e)}else{var t=WebStorage.tutoringFrameTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.Simple=function(e){if(typeof e!=="undefined"){WebStorage.simpleUpgradeTest.set(e)}else{var t=WebStorage.simpleUpgradeTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.UpgradeAfter=function(e){if(typeof e!=="undefined"){WebStorage.upgradeAfterTest.set(e)}else{var t=WebStorage.upgradeAfterTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.AltAnnualPrice=function(e){if(typeof e!=="undefined"){WebStorage.altAnnualPriceTest.set(e)}else{var t=WebStorage.altAnnualPriceTest.get();if(t===null)return t;return new SplitTest(t)}};SplitTest.Quarterly=function(e){if(typeof e!=="undefined"){WebStorage.quarterlyTest.set(e)}else{var t=WebStorage.quarterlyTest.get();if(t===null)return t;return new SplitTest(t)}};var StaticAdManager=function(){var e={};var t="mw-static-left";var r="dimension1";var n=false;var i=App.Screen.width>=1200;var a=false;var o=document.querySelector("body");var s=document.getElementById("D_VID");var u=document.getElementById("D_R3");var l=document.getElementById("D_R2");window.sbmCmd=window.sbmCmd||[];var c=function(){if(!App.isProduction)return false;return true};var p=function(){Util.AddClass(t,o);if(c()){sbmCmd.push(function(e){e.reload({page:"ros",layout:i?"large":"small"});$.publish("layout/drawer")})}else{s.innerHTML="<img src='/images/placeholder.png' alt='left top' border='0' />";u.innerHTML="<img src='/images/placeholder_skyscraper.png' alt='left top' border='0' />";l.innerHTML="<img src='/images/placeholder_smol.png' alt='left top' border='0' />"}n=true;m();document.body.style.zIndex=0;$.publish("window/resize")};var d=function(){Util.AddClass(t,o);n=true;m();document.body.style.zIndex=0;$.publish("window/resize")};e.evaluate=function(e){if(typeof e==="undefined")e=false;API.setAdsTestVariant(STM.Tests.CheggStaticAds.variantId,function(e){});if(!STM.Tests.CheggStaticAds.enabled())return;if(n){if(Auth.hasSubscription()){if(e)WebStorage.showUpgradeAfterReload.set("true");Util.reload()}}else if(!Auth.hasSubscription()){var t=STM.Tests.CheggStaticAds.value;f(t);p()}};var f=function(e){GoogleAnalytics.set(r,e);Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"Advertisements",eventAction:"Phase 3",eventLabel:e})};var h=function(){if(App.Screen.width<1200){if(i===true){i=false;return true}}else{if(i===false){i=true;return true}}return false};var m=function(){if(a===true)return;a=true;$.subscribe("auth/loggedin",function(){e.evaluate()});$.subscribe("auth/loggedout",function(){WebStorage.showUpgradeAfterReload.remove();e.evaluate()});$.subscribe("window/resize",function(){if(h()){n=false;e.evaluate()}})};return e}();Component.StickyBottom=function(e){e=$.extend({chat:true,graph:false},e||{});var t=false;var r=document.getElementById("chat-area");var n=document.querySelector("#chat-area .cell");var i=document.getElementById("chat-inner");var a=document.getElementById("chat-shim");var o=document.querySelector("#gpc-container");var s=document.querySelector("#keyboard .cell");var u=document.querySelector("#editor-group");var l=document.getElementById("editor-tester");var c=document.getElementById("editor-outer");var p=document.querySelector("#editor .cell");var d=document.getElementById("drawer");var f=document.getElementById("did-you-mean");var h=document.querySelector("#did-you-mean .cell");var m=null;var g={chat:{window:null,width:null,left:null,bubbles:{height:null},shim:null},graph:{window:null,alternate:false},worksheet:{window:null},drawer:{width:null,height:null,open:false,keyboard:null,editor:{inner:null,minHeight:null,maxHeight:null,paddingTop:null,paddingBottom:null,submit:{bottom:null}},didYouMean:{height:null}}};var v=window.performance&&window.performance.now?window.performance.now.bind(window.performance):function(){return 0};var b=function(){return JSON.stringify(g)===m?false:true};$.subscribe("layout/scrollBottom",function(){timer=setTimeout(function(){$(".scrollable").scrollTop($(".scrollable")[0].scrollHeight)},500)});$.subscribe("layout/scroll",function(e){var r=$(i).offset().top;var a=$(e).offset().top;var o=10;$(n).scrollTop(Math.abs(r-a)-o);if(t)Debug.info("--- layout/scroll ---");y(true);w(true)});$.subscribe("window/resize",function(){if(t)Debug.info("--- window/resize ---");y(true);w(true)});if(e.chat===true){$.subscribe("layout/chat",function(){if(t)Debug.info("--- layout/chat ---");y(false);w(false)})}$.subscribe("layout/drawer",function(){if(t)Debug.info("--- layout/drawer ---");y(true);w(true)});var y=function(r){var p=v();if(r){var h=window.getComputedStyle(d,null);g.drawer.height=d.offsetHeight;g.drawer.open=parseInt(h.bottom)!==0?false:true;g.drawer.keyboard=s===null?0:s.offsetHeight;if(e.chat){var m=window.getComputedStyle(c,null);g.drawer.editor.inner=e.graph?0:l.offsetHeight;g.drawer.editor.minHeight=parseInt(m.minHeight);g.drawer.editor.maxHeight=parseInt(m.maxHeight);g.drawer.editor.paddingTop=parseInt(m.paddingTop);g.drawer.editor.paddingBottom=parseInt(m.paddingBottom);g.drawer.didYouMean.height=f.offsetHeight;g.drawer.width=parseInt(h.width)}if(e.graph){if(!Util.HasClass("gpc-alternate",o))g.drawer.open=h.bottom==="0px"?false:true;g.drawer.didYouMean.height=f.offsetHeight;var b=window.getComputedStyle(u,null);g.drawer.editor.inner=b.display!=="none"?u.offsetHeight:0}}if(e.chat){var y=n.getBoundingClientRect();g.chat.window=n.offsetHeight;g.chat.bubbles.height=i.offsetHeight;g.chat.shim=a.offsetHeight;g.chat.width=n.offsetWidth;g.chat.left=y.left}if(e.graph){g.graph.window=o.offsetHeight;g.graph.alternate=Util.HasClass("gpc-alternate",o)}if(t)Debug.info("measure took "+(v()-p))};var w=function(i){if(!b()){if(t)Debug.info("mutate not necessary due to lack of state change");return}var u=v();if(i){var c=g.drawer.editor.inner;if(e.chat){if(c>g.drawer.editor.maxHeight){c=g.drawer.editor.maxHeight}else if(c<g.drawer.editor.minHeight){c=g.drawer.editor.minHeight}l.style.height=c;c+=g.drawer.editor.paddingTop+g.drawer.editor.paddingBottom+g.drawer.didYouMean.height;d.style.height=c+g.drawer.keyboard+"px";d.style.bottom=g.drawer.open?"0px":"-"+g.drawer.keyboard+"px";g.chat.window=n.offsetHeight;r.style.bottom=g.drawer.open?c+g.drawer.keyboard+"px":c+"px";d.style.width="100%";d.style.left="auto";p.style.width="auto";h.style.width="auto";s.style.width="auto"}if(e.graph){var f=c+g.drawer.keyboard+g.drawer.didYouMean.height+"px";d.style.height=f;if(!g.graph.alternate){if(g.drawer.open){o.style.bottom="0px";d.style.bottom="-"+f}else{o.style.bottom=f;d.style.bottom="0px"}}else{o.style.bottom=f;if(g.graph.alternate){d.style.bottom=g.drawer.open?"0px":"-"+g.drawer.keyboard+"px"}else{d.style.bottom=g.drawer.open?"0px":"-"+f}}}}if(e.chat&&App.isIE){var y=g.chat.window-g.chat.bubbles.height-g.drawer.didYouMean.height-8;if(y>0){a.style.height=y+"px"}else{a.removeAttribute("style")}}m=JSON.stringify(g);if(t)Debug.info("mutate took  "+(v()-u))};if(t)Debug.info("--- the begin ---");y(true);w(true)};Component.Subjects=function(e){App.CurrentSubject=Subject.FromString(e);var t=$.query("#top-menu .left-side");var r=$.query("#top-menu .subject");var n=$("#subjects-menu");var i=$("#subjects-menu a");var a=$.query("body");var o=n.css("display")!=="none"?true:false;var s;var u=function(){if(!o){n.velocity({opacity:1},{display:"block",duration:100,easing:"easeOutQuad",complete:function(){a.addClass("clickable");s=$.subscribe("document/mouseup",c);o=true}})}};var l=function(){if(o){n.velocity({opacity:0},{display:"none",duration:50,easing:"easeInQuad",complete:function(){a.removeClass("clickable");$.unsubscribe(s);o=false}})}};var c=function(e){if(!n.is(e.target)){l()}};var p=function(t){i.removeClass("current");i.addClass("link");Util.RemoveClass("link",t);Util.AddClass("current",t);var n=t.getAttribute("href");e=t.getAttribute("data-subject");var a=e.toLowerCase();if(window.location.pathname.toLowerCase().indexOf("documenteditor")===-1)history.pushState({},e,n);document.querySelector("title").innerText=Strings.MetaTitles[a];r.text(t.innerText);WebStorage.lastSubject.set(e);App.CurrentSubject=Subject.FromString(e);$.publish("subject/set",[a]);$.publish("keyboard/change",[a]);if(App.CurrentEditor!==null)App.CurrentEditor.TakeFocus()};var d=function(){if(typeof e==="undefined")return;if(window.location.pathname.toLowerCase().indexOf(e.toLowerCase())>-1)return;if(window.location.pathname.toLowerCase().indexOf("documenteditor")>-1)return;p($("#subjects-menu .menu-row.current")[0])};var f=function(t){if(t.toLowerCase().indexOf("documenteditor")>-1)return false;var r=t.split("/");if(e==="Graph")return true;if(t.contains("subject=Graph")){return true}if(r.length===2){if(r[1]==="Graph")return true}else if(r.length===3){if(r[2]==="Graph")return true}};t.on("click",function(){if(o!==true){u()}else{l()}});i.click(function(e){e.preventDefault();if(Util.HasClass("current",this))return;var t=this.getAttribute("href");if(f(t)){Util.Redirect(t);return}p(this)});$.subscribe("Tutor/ChangeSubject",function(e){var t=e.charAt(0).toUpperCase()+e.substr(1);switch(Util.NormalizeSubject(t)){case"basicmath":t="BasicMath";break;case"prealgebra":t="PreAlgebra";break;case"algebra":t="Algebra";break;case"trigonometry":t="Trigonometry";break;case"precalculus":t="Precalculus";break;case"calculus":t="Calculus";break;case"statistics":t="Statistics";break;case"finitemath":t="FiniteMath";break;case"linearalgebra":t="LinearAlgebra";break;case"chemistry":t="Chemistry";break}$link=$("*[data-subject="+t+"]")[0];$link.click()});d()};Component.SuggestTopic=function(){var e,t;var r,n,i,a;var o=function(){e=document.getElementById("suggest-topic-comment");t=document.getElementById("suggest-topic-form");a=[];t.addEventListener("submit",function(t){t.preventDefault();c();if(e.value===""){p("no-comment");return}Actions.Do(Actions.showSpinner);API.saveTopicSurvey(i,n,r,e.value,function(e){Actions.Do(Actions.hideSpinner);s(e)})})};$.subscribe("suggestTopic/beforeShow",function(e,t,a){r=e;n=t;i=a;o()});var s=function(e){if(e.status===1){u()}else{l()}};var u=function(){e.value="";Popup.hide()};var l=function(){p("error-saving")};var c=function(){$(".validation-message").hide()};var p=function(e){$(".validation-message[data-error-type="+e+"]").show()}}();Component.SurveyText=function(){var e={};var t=null;var r=null;var n=null;var i=null;var a=false;var o="survey-text-has-error";var s=false;var u=function(){$(".survey-text-error").hide();n.removeClass(o)};var l=function(e){u();if(!e){i.show();n.addClass(o);return false}if(e.length===0){i.show();n.addClass(o);return false}return true};var c=function(){if(s)return;s=true;n.on("change keyup paste",function(){var e=n.val();l(e)})};$.subscribe("surveyText/beforeShow",function(o){e=Util.Extend({surveyId:0,responseId:0,surveyText:null},o||{});t=$("#survey-text-question");r=$("#survey-text-submit");n=$("#survey-text-comment");i=$("#survey-text-empty-error");t.text(e.surveyText);u();r.on("click",function(t){t.preventDefault();var r=n.val();if(l(r)){Actions.Do(Actions.surveySubmit,{surveyId:e.surveyId,responseId:e.responseId,surveyDetails:r});a=true;Popup.hide()}else{c()}})});$.subscribe("surveyText/afterShow",function(){n.focus()});$.subscribe("surveyText/afterHide",function(){r.off("click");if(!a){Actions.Do(Actions.surveyCancel,{surveyId:e.surveyId,responseId:e.responseId})}u();if(s){n.off("change keyup paste");s=false}t=null;r=null;n=null;i=null;a=false})};Component.TopicsDialog=function(e,t){t=!(t===false);const r=13;const n=38;const i=40;var a=$("body");var o=$("#editor-submit");var s=$("#editor-submit .mw");var u=$("#chat-area .cell");var l;var c;var p;var d=null;var f=false;var h=false;var m=false;var g=false;var v=null;var b=false;var y=false;var w;var C=null;var S="";var x="";var A="";var T;var I=1;var E=0;var P=true;var k=null;var M=false;var D={};$.subscribe("topics/beforeShow",function(){w=false;l=$("#topics-container");c=$("#topics-inner");Tabbing.addFieldsFromSelector("#topic-close");Tabbing.addFieldsFromSelector(".topics-single");Tabbing.addFieldsFromSelector(".topics-single-alt");u.addClass("scrollable-hold");a.addClass("clickable");b=false;D={};L(T)});$.subscribe("topics/afterShow",function(){l.scrollTop(0);f=true;var e=k.GetSolverStrings();S=e.html;x=e.ascii;A=e.command});$.subscribe("topics/afterHide",function(){Tabbing.removeAllFields();u.removeClass("scrollable-hold");a.removeClass("clickable");var t;if(d===null){t=""}else{t=$(d).val()}f=false;y=false;P=true;d=null;if(!b)API.addTopicAbandon(WebStorage.anonUserId.get("Mathway.AnonUserId"),e,x,w,t)});$.subscribe("editorContentUpdate",function(e){k=e;I++});var L=function(e,t,r){t=typeof t==="undefined"?false:t;r=typeof r==="undefined"?false:r;if(r)p.html("");if(t){for(var n=0,i=e.length;n<i;n++){var a=typeof e[n].text==="undefined"?e[n].Text:e[n].text;if(!D.hasOwnProperty(a)){p.append($("<div></div>").addClass("topics-single").attr("data-id",e[n].id||e[n].Id).data("custom-data",e[n].customData||e[n].CustomData).appendText(e[n].text||e[n].Text));D[a]=true}}if(P){var o=$("<div></div>").addClass("topics-more").appendText(Strings.Topics.More);o.on("click",R);p.append(o)}else{p.append($("<div></div>").addClass("topics-single-alt").appendText(Strings.Topics.TopicINeed))}return}p=$("<div></div>").addClass("topics-list");for(var n=0,i=e.length;n<i;n++){p.append($("<div></div>").addClass("topics-single").attr("data-id",e[n].id||e[n].Id).data("custom-data",e[n].customData||e[n].CustomData).appendText(e[n].text||e[n].Text));var a=typeof e[n].text==="undefined"?e[n].Text:e[n].text;D[a]=true}if(P){var o=$("<div></div>").addClass("topics-more").appendText(Strings.Topics.More);o.on("click",R);p.append(o)}else{p.append($("<div></div>").addClass("topics-single-alt").appendText(Strings.Topics.TopicINeed))}c.append(p);p.on("click",".topics-single",topicClickHandler);p.on("click",".topics-single-alt",altTopicClickHandler)};Component.TopicsCore({subject:e,onTopicsResponse:function(e,t,r){T=e;E=t;r=r;Popup.showTopics()},bubbleOnError:t});var R=function(e){$(".topics-more").remove();w=true;N();Popup.center()};$.subscribe("document/keyup",function(e){if(!f)return;if(e.which!==n&&e.which!==i&&e.which!==r)return;e.preventDefault();var t=e.which;var a=p.children(":visible");var o=a.filter(".on");var s=null;if(t===r){if(o.length===1){o.trigger("click")}else{a.first().trigger("click")}return}if(o.length===0){s=a.first()}else if(t===n){s=o.prevAll(":visible").first();if(s.length===0)s=o}else if(t===i){s=o.nextAll(":visible").first();if(s.length===0)s=o}o.removeClass("on");s.addClass("on");o=s;var u=s.siblings(":visible").addBack().index(s);var l=u*s.outerHeight();c.scrollTop(l)});topicClickHandler=function(){var e=k.GetSolverStrings();S=e.html;x=e.ascii;A=e.command;$(".topics-list").off("click");Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"topic",eventAction:"click",eventLabel:this.textContent});var t=this.getAttribute("data-id");var r=this.textContent;var n=$(this).data("custom-data");if(App.getQueryParam("subject")!=false){
App.postAffiliateMessage(App.getQueryParam("subject"),r,x)}var i=Tutor.getTutorCommand(A);$.publish("solving/dispatch",[{topicId:t,topicText:r,customData:n,asciiMath:x,mathML:S,isOCR:k.isOCR,asciiEdited:k.asciiEdited,historyClick:k.historyClick,isSpeech:k.isSpeech,fromExamples:false,searchText:d===null?null:d.val(),solveType:i,backIntoSolve:E>TOPICS_PER_PAGE&&T.length==1}]);b=true;Popup.hide()};altTopicClickHandler=function(){var t=k.GetSolverStrings();S=t.html;x=t.ascii;A=t.command;$(".topics-list").off("click");Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"topic",eventAction:"click",eventLabel:"alt"});b=true;Popup.hide();setTimeout(function(){Popup.showSuggestTopic(S,x,e)},500)};$.subscribe("subject/set",function(t){e=t});$.subscribe("document/keyup",function(e){if(f&&e.which===27)Popup.hide()});var N=function(){var t=k.GetSolverStrings();S=t.html;x=t.ascii;A=t.command;API.chatBotEditor(e,x,S,k.isOCR,k.asciiEdited,k.historyClick,k.isSpeech,false,E,TOPICS_PER_PAGE,function(e){E=e.nextIndex;P=e.moreTopics;L(e.topics,true,false)})};var U=function(){if(App.CurrentEditor)App.CurrentEditor.RemoveFocus();var t=k.GetSolverStrings();S=t.html;x=t.ascii;A=t.command;if(d===null){Popup.spinner();API.chatBotEditor(e,x,S,k.isOCR,k.asciiEdited,k.historyClick,k.isSpeech,false,0,500,function(e){var t=document.createElement("input");t.setAttribute("type","text");t.setAttribute("placeholder",Strings.Topics.SearchPlaceholder);t.className="topic-search-box";c.prepend(t);d=$(".topic-search-box");d.keyup(function(){var e=$(this).val();if(e.length>0){O(e)}else{$(".topics-single").show()}});d.focus();C=e;P=false;L(C.topics,false,true);Popup.hideSpinner()})}else{d.show();d.focus()}c.scrollTop(0)};var F=function(){if(d!==null){d.val("").hide();L(C.topics,false,true);if(App.CurrentEditor)App.CurrentEditor.TakeFocus()}};var O=function(e){var t=new Sifter(C.topics,{diacritics:true});var r=t.search(e,{fields:["Text","Keywords"],conjunction:"and"});$(".topics-single").hide();if(r.items.length>0){var n=[];r.items.forEach(function(e){var t=C.topics[e.id];n.push(t);$('[data-id="'+t.Id+'"]').show()})}};$.subscribe("topics/searchToggle",function(){y=!y;if(y)U();else F()});if(App.isModern){s.velocity("stop").velocity({scaleX:0,scaleY:0})}};Component.TopicsCore=function(e){e.bubbleOnError=!(e.bubbleOnError===false);var t=true;var r=[];var n=[];var i=0;var a;var o;var s;var u;var l;var c=1;var p;var d;var f;var h=false;var m=true;var g=null;$.subscribe("topics/parse",function(e){e=Util.Extend({asciiMath:"",mathML:""},e||{});s=e.mathML;u=e.asciiMath;t=true;v(false,true)});$.subscribe("chat/getMoreTopics",function(){v(true)});$.subscribe("editorContentUpdate",function(e){g=e;c++;t=true});var v=function(n,a){var o=g.GetSolverStrings();s=o.html;u=o.ascii;l=o.command;var c=true;var p=false;var d=ChatSolveType.Regular;if(Tutor.inChatRoom()){d=Tutor.getTutorCommand(l);p=true;if(d==ChatSolveType.Regular){var f=Chat.CreateBubble({action:{method:"InsertIntoEditor",params:{asciiMath:u,moreTopics:"n",isTutor:true}},content:u,avatarUrl:Auth.userstate.avatarUrl,genre:"localTutor",typeset:true,testContext:BubbleContext.TutorBubble});Actions.Do(Actions.userSendsMessage,f);c=false}}if(c){if(!t&&typeof e.onTopicsResponse==="function"){e.onTopicsResponse(r,i,m);return}Actions.Do(Actions.showSpinner);API.chatBotEditor(e.subject,u,s,g.isOCR,g.asciiEdited,g.historyClick,g.isSpeech,n,0,n?TOPICS_PER_PAGE:0,function(t){if(t.status!==1&&t.error==="timeout"){if(e.bubbleOnError){var r=[Chat.CreateBubble({content:u,genre:"local",typeset:true,testContext:BubbleContext.Problem,action:{params:{asciiMath:u}}}),Chat.CreateBubble({content:Strings.Chat.TimeoutError,genre:"error",testContext:BubbleContext.ErrorBubble})];if(Tutor.inChatRoom()){Tutor.dispatchSolution(r,0,false)}else{$.publish("ChatLibrary/Insert",[{bubbles:r}])}ErrorLog.TopicsTimeout()}else{alert("Topics Timed Out!")}Actions.Do(Actions.hideSpinner);return}var n=false;switch(t.type){case"topicsResponse":b(t);n=true;break;case"messagesResponse":WebStorage.lastSolve.set({subject:e.subject,editorMarkup:s,editorNoMarkup:u,topicId:null,topicText:null},true);if(t.showInterstitial){Actions.Do(Actions.showInterstitial)}Actions.Do(Actions.problemSolved,t.problemCount);y(t,p,d);n=false;break}Actions.Do(Actions.hideSpinner);if(a){var i=false;if(n===false&&Auth.isLoggedIn())i=true;$.publish("ChatLibrary/StateCheck",[i])}})}else{$.publish("editor/erase")}};var b=function(t){r=S(t.topics);n=[];if(typeof e.onTopicsResponseLegacy==="function"){e.onTopicsResponseLegacy(r,t.excessTopics)}if(typeof e.onTopicsResponse==="function"){e.onTopicsResponse(r,t.nextIndex,t.moreTopics)}};var y=function(t,r,n){if(!e.bubbleOnError){alert("Got a message response from topics!");return}if(t.context==="TopicsError")ErrorLog.ChatBotTopics();else if(t.context==="SolverError")ErrorLog.ChatBotSolve();var i=s;if(n==ChatSolveType.LocalSolve)i="@mwsolve "+s;App.lastMessages=t.messages;var a="";if(Auth.userstate!==null)a=Auth.userstate.avatarUrl;var o=[Chat.CreateBubble({content:i,genre:"local",avatarUrl:a,typeset:true,testContext:BubbleContext.Problem,action:{method:"InsertIntoEditor",params:{asciiMath:u,moreTopics:"n"}},extraClass:"ch-solution-top"})];o=o.concat(t.messages);$.publish("editor/erase");t.solutionId=t.solutionId!==undefined?t.solutionId:"";if(r){Tutor.dispatchSolution(o,t.solutionId,n==ChatSolveType.AtMathway?true:false)}else{$.publish("ChatLibrary/Insert",[{bubbles:o},{solutionId:t.solutionId,commitMessages:true,postRender:function(){w()}}])}};var w=function(){var e=document.getElementsByClassName("ch-solution-top");if(e.length>0){$.publish("ChatLibrary/Scroll",[e[e.length-1],true])}};var C=function(e,t,r){API.saveTopicSurvey(e,r,t,"(AUTO)");Actions.Do(Actions.hideSpinner);var n=[Chat.CreateBubble({content:r,genre:"local",typeset:true,testContext:BubbleContext.Problem,action:{params:{asciiMath:r}}}),Chat.CreateBubble({content:Strings.Chat.NoTopics,genre:"mathway",typeset:false,testContext:BubbleContext.Topic})];if(Tutor.inChatRoom()){Tutor.dispatchSolution(n,0,false)}else{$.publish("ChatLibrary/Insert",[{bubbles:n},{immediate:false,fromUser:true}])}};var S=function(e){var t=[];e.forEach(function(e){t.push({id:e.Id,text:e.Text,customData:e.CustomData})});return t};$.subscribe("dialog/open",function(e){if(e==="topics")v()});$.subscribe("chat/getTopics",function(){v()});$.subscribe("subject/set",function(t){e.subject=t})};Component.Trigonometry=function(){$.subscribe("trig/beforeShow",function(){Util.AddClass("popup-trig",document.querySelector(".popup-container"));$(".trig-cell").click(function(e){e.preventDefault();var t=this.getAttribute("data-func");if(!IsNull(t)){$.publish("keyboard/output",[{id:"trig",name:t}])}Popup.hide()})})};$.fn.ColorSlider=function(e){var t=this;t.id="";t.radius=16;t.color={R:0,G:0,B:255};t.value=5;t.maxValue=50;var r;var n;var i;var a;var o;if(typeof e==="object"){if(e.id!==undefined)t.id=e.id;if(e.radius!==undefined)t.radius=e.radius;if(e.color!==undefined)t.color=e.color;if(e.value!==undefined)t.value=e.value;if(e.maxValue!==undefined)t.maxValue=e.maxValue}if(t.id!="")$(t).attr("id","colorSlider_"+t.id);n=$("<div class='RightTrack'/>").appendTo($(t));r=$("<div class='LeftTrack'/>").appendTo($(t));i=$("<div class='OuterThumb'/>").appendTo($(t));a=$("<div class='InnerThumb'/>").appendTo($(i));var s=u("rgb("+t.color.R+","+t.color.G+","+t.color.B+")");o=new jscolor(a[0],{value:s,valueElement:null,position:"top",onFineChange:"$.publish('ColorSliderColorChanged');"});$(i).draggable({axis:"x",containment:"parent",start:function(){o.hide()},drag:function(e,r){t.SetValue(r.position.left/($(t).width()-$(i).width()-4)*t.maxValue);$.publish("ColorSliderSizeChanging")},stop:function(){$.publish("ColorSliderSizeChanged")}});$(i).on("mouseenter",function(){$(this).addClass("Hover")});$(i).on("mouseleave",function(){$(this).removeClass("Hover")});$(i).on("mousedown",function(){$(this).removeClass("Hover");$(this).addClass("Click")});$(i).on("mouseup",function(){$(this).removeClass("Click");$(this).addClass("Hover")});$(i).on("click",function(){o.show()});t.SetValue=function(e){t.value=Math.max(Math.min(e,t.maxValue),1);$(a).width($(i).width()*(t.value/t.maxValue));$(a).height($(a).width());$(i).css("left",t.value/t.maxValue*($(t).width()-$(i).width()-4)+"px");$(r.width($(i).position().left))};t.SetColor=function(e){t.color=e;var r=u("rgb("+t.color.R+","+t.color.G+","+t.color.B+")");o.value=r;$(a).css("background-color","#"+r)};t.GetRGBColor=function(){var e=o.toRGBString();e=e.substr(4,e.length-5);var t=e.split(",");return{R:t[0],G:t[1],B:t[2]}};function u(e){var t=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/;var r,n,i,a,o="";if(r=t.exec(e)){n=l(r[1],r[2]);i=l(r[3],r[4]);a=l(r[5],r[6]);o=(16777216+(n<<16)+(i<<8)+a).toString(16).slice(1)}return o}function l(e,t){var r=Math.max(0,parseInt(e,10));return t?Math.floor(255*Math.min(100,r)/100):Math.min(255,r)}t.SetValue(t.value);t.SetColor(t.color);return t};Component.TutorDashboard=function(e,t){var r=$("#StartDate");var n=$("#EndDate");var i=$("#earnings-results-area");var a=$("#refresh-data");var o=$("#dash-spinner");var s=$("#Sessions");var u=$("#sessions-chart");var l=$("#reviews-results-area");var c=$("#AvgRating");var p=$("#reviews-chart");var d=$("#review-list");var f=$("#td-question-list");var h=$("#td-answer-list");var m=$(".td-answer-pagination");var g=false;var v=false;var b=false;var y=function(e){this.timestamp=new Date(parseInt(e.Timestamp.substr(6)))};var w=function(e){this.timestamp=new Date(parseInt(e.Timestamp.substr(6)));this.rating=e.Rating;this.comments=e.Comments};var C=function(){o.show();a.hide();g=true;var e=new Date(r.val());var t=new Date(n.val());var i=new Date;i.setHours(0,0,0,0);if(e===null||t===null){$.query(".validation-message[data-error-type=check-date-range").show();return false}else{$.query(".validation-message[data-error-type=check-date-range").hide()}if(t<e){this.message(tab,"check-date-range");return false}var s=t;s.setDate(t.getDate()-32);if(s>e){this.message(tab,"dates-too-far");return false}S(function(){x(function(){o.hide();a.show();g=false;if(!v){v=true}})})};var S=function(e){API.getTutorInvitesByDateRange(r.val(),n.val(),function(t){var r=false;if(t.status===ResponseStatuses.Success&&typeof t.Invites!=="undefined"&&t.Invites.length>0)r=true;if(!r){$.query(".validation-message[data-error-type=no-results]").show();$(".accordian-title[data-name=sessions]").hide();$(".accordian-title[data-name=sessions]").next().hide()}else{$.query(".validation-message[data-error-type=no-results]").hide();$(".accordian-title[data-name=sessions]").show();$(".accordian-title[data-name=sessions]").next().show();var n={};var a=[];t.Invites.forEach(function(e){var t=new y(e);var r=t.timestamp.getMonth()+1+"/"+t.timestamp.getDate();if(typeof n[r]==="undefined")n[r]=1;else n[r]++;a.push(t)});s.text(a.length);i.show();A(n)}e()})};var x=function(e){API.getTutorRatingsByDateRange(r.val(),n.val(),function(t){var r=false;if(t.status===ResponseStatuses.Success&&typeof t.Ratings!=="undefined"&&t.Ratings.length>0)r=true;if(!r){$.query(".validation-message[data-error-type=no-results]").show();$(".accordian-title[data-name=ratings]").hide();$(".accordian-title[data-name=ratings]").next().hide()}else{$.query(".validation-message[data-error-type=no-results]").hide();$(".accordian-title[data-name=ratings]").show();$(".accordian-title[data-name=ratings]").next().show();d.html("");var n={5:1,4:1,3:1,2:1,1:1};var i=[];var a=0;t.Ratings.forEach(function(e){var t=new w(e);n[t.rating]++;a+=t.rating;i.push(t);T(t)});a/=i.length;c.text(a.toFixed(2));l.show();I(n)}e()})};var A=function(e){u.html("");var t=document.createElement("canvas");t.setAttribute("width",u.width());t.setAttribute("height",300);u.append(t);var r=[];var n=[];for(var i in e){r.push(i);n.push(e[i])}new Chart(t.getContext("2d"),{type:"bar",data:{labels:r,datasets:[{label:"Sessions By Day",data:n,borderWidth:1,lineTension:0,backgroundColor:"rgba(114,140,194,0.7)",hoverBackgroundColor:"rgba(114,140,194,0.85)",borderColor:"rgba(114,140,194,1)"}]},options:{scales:{yAxes:[{ticks:{beginAtZero:true}}]}}})};var T=function(e){var t=document.createElement("div");t.className="form-row";var r=document.createElement("div");r.className="s-rating";var n="";for(var i=1;i<=5;i++){var a=i<=e.rating?"mw-star":"mw-star-o";n+='<span class="mw '+a+'"></span>'}r.innerHTML=n;var o=document.createElement("div");o.className="s-date";o.innerHTML=e.timestamp.getMonth()+1+"/"+e.timestamp.getDate()+"/"+e.timestamp.getFullYear();var s=document.createElement("div");s.className="s-comments";s.innerHTML=e.comments;t.appendChild(r);t.appendChild(o);t.appendChild(s);d.append(t)};var I=function(e){p.html("");var t=document.createElement("canvas");t.setAttribute("width",p.width());t.setAttribute("height",300);p.append(t);var r=[];var n=[];for(var i in e){r.push(i);n.push(e[i])}r.reverse();n.reverse();new Chart(t.getContext("2d"),{type:"horizontalBar",data:{labels:r,datasets:[{label:"Overall Ratings",data:n,borderWidth:1,lineTension:0,backgroundColor:"rgba(114,140,194,0.7)",hoverBackgroundColor:"rgba(114,140,194,0.85)",borderColor:"rgba(114,140,194,1)"}]},options:{scales:{xAxes:[{ticks:{beginAtZero:true}}]}}})};var E=["stats","questions","history"];var P=false;var k=null;var M=[];var D=45e3;var L=10;var R=function(t){t=$.extend({text:"",page:null,"class":null,url:"/TutorDashboard?tab=history&page="},t||{});var r=$("<span />");if(t.class)r.addClass(t.class);if(t.page){var n=t.url+t.page;r.append($("<a />").attr("href",n).on("click",function(r){r.preventDefault();H(t.page);window.history.pushState({},e,n)}).text(t.text))}else{r.text(t.text)}return r};var N=function(e,t){m.empty();m.append(e>1?R({text:Pagination.LeftArrow,page:e-1}):R({text:Pagination.LeftArrow}));var r=Pagination.Ranged(e,t);for(var n=0,i=r.length;n<i;n++){var a={text:r[n]?r[n]:Pagination.Ellipses};if(r[n]===e)a["class"]="bold";else if(r[n]!==null)a["page"]=r[n];m.append(R(a))}m.append(e<t?R({text:Pagination.RightArrow,page:e+1}):R({text:Pagination.RightArrow}))};var U=function(e,t,r,n){var i=$("<td />");if(Util.IsNullOrEmpty(e.ImageURL)){var a=$("<div />").html(Editor.AsciiToMathml(e.AsciiMath?e.AsciiMath:"No AsciiMath"));M.push(a[0]);i.append(a)}else{i.append($("<img />").attr("src",e.ImageURL).attr("border","0"))}var o="";switch(e.AnswerType){case 1:o=Strings.ExpertQA.AnswerType1;break;case 2:o=Strings.ExpertQA.AnswerType2;break;case 3:o=Strings.ExpertQA.AnswerType3;break;case 4:o=Strings.ExpertQA.AnswerType4;break;case 5:o=Strings.ExpertQA.AnswerType5;break}i.append($("<div />").addClass("td-answer-type").text(o));var s=$("<td />").text(e.Subject);var u=$("<td />").text(e.UserEmail);var l=$("<td />").text(Util.formatDateWithTime(e.Timestamp*1e3));var c=$("<tr />");if(r){c.addClass("td-pending").attr("data-object-id",t)}else{c.attr("data-object-id",t)}return c.on("click",function(e){e.preventDefault();if(typeof n==="function"){var t=$(this).attr("data-object-id");n.call(this,t)}}).append(i).append(s).append(u).append(l)};var F=function(e){if(b){Popup.showError(Strings.ExpertQA.ErrorPendingAnswers);return}API.createExpertAnswer(e,function(e){if(e.status===1){Util.Redirect("/TutorDashboard/Compose/"+e.AnswerId,false)}else if(e.messageId===ErrorCode.ExpertQuestionHasBeenAnswered){Popup.showError(Strings.ExpertQA.ErrorQuestionAnswered);_()}else{Popup.showError(Strings.ExpertQA.ErrorGeneric)}})};var O=function(){API.getPendingExpertQuestions(function(e){var t=false;f.empty();if(e.status===1){if(e.PendingQuestions.length>0){b=true;t=true;for(var r=0,n=e.PendingQuestions.length;r<n;r++){f.append(U(e.PendingQuestions[r],e.PendingQuestions[r].AnswerID,true,function(e){Util.Redirect("/TutorDashboard/Compose/"+e,false)}))}}else{b=false}if(e.Questions.length>0){t=true;for(var r=0,n=e.Questions.length;r<n;r++){f.append(U(e.Questions[r],e.Questions[r].ID,false,function(e){F(e)}))}}}if(!t){f.append($("<tr />").append($("<td />").attr("colspan",4).text(Strings.ExpertQA.NothingAsked)))}if(M.length>0){MathJax.Hub.Queue(["Typeset",MathJax.Hub,M,function(){G();M.length=0}])}else{G()}})};var B=function(e){Util.Redirect("/TutorDashboard/Question/"+e)};var H=function(e){API.getExpertQuestionsFromTutor(e,L,function(r){if(r.status===ResponseStatuses.Success){N(e,Math.ceil(r.Count/L));h.empty();for(var n=0,i=r.Questions.length;n<i;n++){h.append(U(r.Questions[n],r.Questions[n].AnswerID,false,function(e){B(e)}))}t=e}if(M.length>0){MathJax.Hub.Queue(["Typeset",MathJax.Hub,M,function(){G();M.length=0}])}else{G()}})};var q=new Tabset(document.querySelector(".mw-tabset"),function(e){W(e)});E.forEach(function(e){q.add(new Tab(document.querySelector(".mw-tab-nav-heading[data-tab-id='"+e+"']")))});var G=function(){if(P)return;$.query(".validation-message[data-error-type=no-results]").hide();$(".accordian-title[data-name=sessions]").hide();$(".accordian-title[data-name=sessions]").next().hide();$.query(".validation-message[data-error-type=no-results]").hide();$(".accordian-title[data-name=ratings]").hide();$(".accordian-title[data-name=ratings]").next().hide();$("#td-tabset").css({visibility:"visible"}).velocity({opacity:1},{duration:150,complete:function(){P=true;$.publish("Scheduler/Next")}})};var _=function(){clearInterval(k);O();k=setInterval(function(){O()},D)};var W=function(r){if(E.indexOf(r)===-1)r=E[0];var n="/TutorDashboard?tab="+r;clearInterval(k);if(r==="stats"){if(!v&&!g)C()}else if(r==="questions"){O();k=setInterval(function(){O()},D)}else if(r==="history"){n+="&page="+t;H(t)}window.history.pushState({},r,n);e=r};a.on("click",function(e){if(!g)C()});q.switchTo(e);Scheduler.Add({label:"Tutor Dashboard",priority:120,evalFn:function(){return true},execFn:function(){G()}})};Component.TutorFormulas=function(){var e=$.query("#tf-container");var t=document.querySelector("#tf-container .tf-inner");var r=$.query("#tf-input");var n=[];var i=[];var a=[];var o=WebStorage.lastSubject.get();var s=150;var u="tf-active";var l="data-ascii-math";var c="data-formula-id";var p="data-category-name";var d=function(e){var t=new Sifter(i,{diacritics:true});var r=t.search(e,{fields:["text","ascii"],conjunction:"and"});if(r.items.length>0){var a=[];var o=[];for(var s=0,u=r.items.length;s<u;s++){o.push(r.items[s].id)}for(var s=0,u=n.length;s<u;s++){if(o.indexOf(s)!==-1)a.push(n[s])}m(a,true)}else{h()}};var f=function(e){e.forEach(function(e){n.push(e);i.push({text:e.FormulaName,ascii:e.AsciiMath})})};var h=function(){$(t).empty().append($("<div></div>").addClass("tf-empty").appendText(Strings.Search.NotFound))};var m=function(e,r){var n=$("<ul></ul>");var i=null;var o=null;var s=null;var d=0;for(var f=0,h=e.length;f<h;f++){if(s!==e[f]["Category"]){s=e[f]["Category"];var m=r;if(!r&&s in a){m=a[s]}if(i)n.append(i);i=$("<li></li>").addClass("tf-chapter");if(m)i.addClass(u);i.append($("<div></div>").addClass("tf-expandable").attr(p,s).append($("<div></div>").addClass("tf-bullet")).append($("<div></div>").addClass("tf-chapter-text").appendText(s)).append($("<div></div>").addClass("clear")));o=$("<ul></ul>");i.append($("<div></div>").addClass("tf-children").css("display",m?"block":"none").append(o))}var g=$("<li></li>").addClass("tf-example");if(m)g.addClass(u);var v=$("<div></div>").addClass("tf-topic");if(e[f]["FormulaName"]){v.append($("<i></i>").addClass("mw"));v.append($("<div></div>").addClass("tf-text-inner").appendText(e[f]["FormulaName"]));v.append($("<div></div>").addClass("clear"))}v.attr(c,e[f]["ID"]);v.attr(l,e[f]["AsciiMath"]);if(e[f]["MathML"]){d++;v.append($("<div></div>").addClass("tf-mathml").html(e[f]["MathML"]));v.append($("<div></div>").addClass("clear"))}v.append($("<div></div>").addClass("clear"));o.append(g.append(v))}n.append(i);$(t).empty().append(n);if(d>0)MathJax.Hub.Queue(["Typeset",MathJax.Hub,t])};var g=function(e){var t=e.parentNode;$(t).addClass(u);var r=e.getAttribute(p);a[r]=true;var n=e.nextElementSibling;$.Velocity(n,"stop");$.Velocity(n,"slideDown",{display:"block",duration:s,easing:"easeOutQuad"})};var v=function(e){var t=e.parentNode;$(t).removeClass(u);var r=e.getAttribute(p);a[r]=false;var n=e.nextElementSibling;$.Velocity(n,"stop");$.Velocity(n,"slideUp",{display:"none",duration:s,easing:"easeInQuad"})};var b=function(e){var t=e.nextElementSibling;if(t===null)return;if(t.childNodes.length>0){var r=window.getComputedStyle(t,null);if(r.display==="none"){g(e)}else{v(e)}}else{fetch(e)}};var y=function(e,t){$.ajax({url:"/PushFormula",method:"POST",contentType:"application/x-www-form-urlencoded",async:true,cache:false,data:JSON.stringify({AsciiMath:e,FormulaID:t,RoomID:Tutor.getRoomId(),TutorEmail:Auth.userstate.email,TutorID:Auth.userstate.userId})}).done(function(e){Actions.Do(Actions.hideSpinner)})};e.on("click",".tf-expandable",function(){b(this)});var w=function(e){$(e).prop("disabled",true);var t=$(e).attr(l);var r=$(e).attr(c);y(t,r);App.CurrentEditor.Clear();App.CurrentEditor.Paste(t);$.publish("Tutor/CloseFormulas");setTimeout(function(){$(".tf-topic").prop("disabled",false)},1500)};e.on("click",".tf-topic",function(){w(this)});r.keyup(function(){var e=$(this).val();if(e.length>0){d(e)}else{m(n,false)}});$.subscribe("subject/set",function(e){o=e;n.length=0;i.length=0;C()});$.subscribe("Tutor/OpenFormulas",function(){C()});var C=function(){r.val("");n.length=0;$(t).append(UI.buildSpinnerDOM());API.getTutorFormulas(o,function(e){f(e.Formulas);m(e.Formulas,false)})};Component.TutorFormulas.Control()};Component.TutorFormulas.Control=function(){var e=$.query("#tf-container");var t=$.query("body");var r=false;var n=false;var i=function(t){if(!e.is(t.target)&&e.has(t.target).length===0&&window.getSelection().type!=="Range"){o()}};var a=function(){if(r)return;$.publish("overlay/show");e.css("display","inline-block").velocity("stop").velocity({right:0},{duration:150,easing:"easeOutQuad",complete:function(){n=$.subscribe("document/mouseup",i);t.addClass("clickable");r=true;App.CurrentEditor.RemoveFocus()}})};var o=function(){if(!r)return;var i=parseInt(e.width())+10;$.publish("overlay/hide");e.velocity("stop").velocity({right:"-"+i+"px"},{duration:150,easing:"easeOutQuad",complete:function(){$.unsubscribe(n);t.removeClass("clickable");r=false;e.css("display","none");App.CurrentEditor.TakeFocus()}})};$.subscribe("Tutor/OpenFormulas",function(){a()});$.subscribe("Tutor/CloseFormulas",function(){o()})};Component.Tutorials=function(e){e=Util.Extend({autoRun:false},e||{});var t=document.getElementById("tutorial-outer");var r=document.getElementById("tutorial-inner");var n=document.getElementById("tutorial-content");var i=document.getElementById("tutorial-text");var a=document.getElementById("tutorial-dismiss");var o=document.getElementById("tutorial-next-subject");var s=document.getElementById("tutorial-next-problem");var u=document.getElementById("tutorial-next-photo");var l=document.getElementById("tutorial-skip");var c=$.query("#tutorial-subject");var p=$.query("#tutorial-photo");var d=$.query("#tutorial-problem");var f=$.query("#tutorial-finished");var h=null;var m=50;var g={None:0,Subject:1,Photo:2,Problem:3,Finished:4};var v=function(e){if(e.length===0){return{width:0,height:0,top:0,left:0}}var t=e.offset(),r=e.height(),n=e.width();var i=t.top,a=t.left;var o=Math.floor(m/2);n+=m;r+=m;i-=o;a-=o;return{width:n,height:r,top:i,left:a}};var b=function(){if(App.isBot===true)return false;if(Tutor.isConnected())return false;var e=WebStorage.dismissedTutorial.get();if(e!==null&&e!=="false")return false;return true};var y=function(e,h,m){e=e||[];if(e.length>1)$(l).show();else $(l).hide();$.publish("tutorial/start");var b=0;var y=e.length-1;var w=null;var C={width:"20000px",height:"20000px",top:"-10000px",left:"-10000px"};var S=function(){fastdom.mutate(function(){$.Velocity(n,{opacity:0},{display:"none",duration:100,easing:"easeInQuad",complete:function(){$.Velocity.animate(r,C,{duration:250,easing:"easeInExpo",complete:function(){I(e[b])}})}})})};var x=function(){if(b<y){b++;S()}};var A=function(){if(b>0){b--;S()}};var T=function(){$.publish("editor/erase");w=null;$(l).unbind("click");$(n).unbind("click");$(a).unbind("click");$(o).unbind("click");$(s).unbind("click");$(u).unbind("click");h.set("true");$.publish("window/enableSelection");fastdom.mutate(function(){$.Velocity(n,{opacity:0},{display:"none",duration:100,easing:"easeInQuad",complete:function(){$.Velocity.animate(r,C,{duration:250,easing:"easeInExpo",complete:function(){t.style.display="none";$.publish("tutorial/finished");if(m)$.publish("Scheduler/Next")}})}})})};var I=function(e){$(r).css(C);w=e.action;switch(e.controls){case g.Subject:c.show();p.hide();d.hide();f.hide();break;case g.Photo:c.hide();p.show();d.hide();f.hide();break;case g.Problem:c.hide();p.hide();d.show();f.hide();break;case g.Finished:c.hide();p.hide();d.hide();f.show();break;default:case g.None:c.hide();p.hide();d.hide();f.hide();break}var t=v(e.element);i.innerHTML=e.text;var a=Math.floor(parseInt($(n).width())/2);fastdom.mutate(function(){$.Velocity(r,t,{duration:600,easing:"easeOutExpo",complete:function(){i.innerHTML=e.text;$.Velocity(n,{opacity:1},{display:"block",duration:150,easing:"easeOutQuad"})}})})};$.subscribe("tutorial/subject",function(){x()});$.subscribe("tutorial/photo",function(){x();setTimeout(function(){$.publish("chat/problem",[{mathml:'<div class="editorLine"><script type="math/mml"><math><mrow><msup><mrow><mi>x</mi></mrow><mrow><mn>2</mn></mrow></msup><mo>-</mo><mn>9</mn></mrow></math></script></div>',ascii:"x^2-9"},true])},150)});$.subscribe("tutorial/problem",function(){x()});$.subscribe("tutorial/finish",function(){T()});$(l).bind("click",function(){T()});var E=function(){if(w!==null){$.publish(w);w=null}};$(n).bind("click",function(e){var t=$(this);if(!t.hasClass("tutorial-button")){E()}});$(o).bind("click",function(){E()});$(s).bind("click",function(){E()});$(u).bind("click",function(){E()});$(a).bind("click",function(){E()});t.style.display="block";I(e[b])};var w=function(e){$.publish("window/disableSelection");setTimeout(function(){y([{element:$.query("#top-menu .left-side"),text:Strings.Tutorials.StepOne,controls:g.Subject,action:"tutorial/subject"},{element:$("#editor-tester0"),text:Strings.Tutorials.StepTwo,controls:g.Problem,action:"tutorial/problem"},{element:$(".editor-buttons"),text:Strings.Tutorials.StepFour,controls:g.Photo,action:"tutorial/photo"},{element:$(".editor-buttons"),text:Strings.Tutorials.StepThree,controls:g.Finished,action:"tutorial/finish"}],WebStorage.dismissedTutorial,e)},150)};if(e.autoRun){Scheduler.Add({label:"Tutorials",priority:50,evalFn:function(){return b()},execFn:function(){w(true)}})}$.subscribe("tutorial/run",function(){w(false)})};Component.Tutoring=function(e){var e=e;var t=function(){Tutor.Hub.init(e)};Scheduler.Add({label:"Initialize TutorHub",priority:11,evalFn:function(){return true},execFn:function(){t();$.publish("Scheduler/Next")}})};Component.TutorInvite=function(){var e,t,r,n,i,a,o,s,u,l,c;var p,d;$.subscribe("tutorInvite/beforeShow",function(m){p=DtoHelper.InviteRequest(m);var g="";d=false;e=$(".tutor-invite-inner");t=$("#tutor-invite-ok");r=$("#tutor-invite-cancel");n=$("#invite-problem");i=$("#invite-topic");a=$("#tutor-invite-answer");o=$("h3");s=$("#invite-device");u=$("#invite-email");l=$("#tutor-invite-button-container");c=$("#invite-end-shift");t.on("click",function(e){e.preventDefault();if(!p.isInvite){if(p.ImageURL!=="")return;var t={};t.asciiMath=p.AltAscii==""?p.Ascii:p.AltAscii;t.moreTopics="n";ChatBridge.InsertIntoEditor(t);Popup.hide();return}d=true;Tutor.Notifier.reset();h();Popup.hide()});c.on("click",function(e){e.preventDefault();$.publish("tutor/off");Popup.hide()});if(p.ImageURL!==""){n.html('<img src="'+p.ImageURL+'" />')}else if(p.IsProblem){n.html(Editor.AsciiToMathml(p.Ascii));i.html(p.Topic.Text)}else{n.html(Editor.AsciiToMathml(p.AltAscii));i.html("(No Topic Provided)")}a.text(Strings.Tutor.PreSessionAnswers[p.AnswerId-1]);var v=p.Subject;switch(v.toLowerCase()){case"basicmath":v="Basic Math";break;case"prealgebra":v="Pre-Algebra";break;case"finitemath":v="Finite Math";break;case"linearalgebra":v="Linear Algebra";break}o.html(Strings.Tutor.InvitationTitle.replace("{SUBJECT}","<br>"+v));if(p.isInvite){t.text("OK");f(false)}else{t.text("Insert Problem");if(p.ImageURL=="")f(true);else{t.hide();f(false)}c.hide()}var b="Website";if(p.DeviceString.indexOf("ios")>-1)b="iOS";else if(p.DeviceString.indexOf("android")>-1)b="Android";var y=p.UserEmail;s.children("span").text(b);u.children("span").text(y);MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])});$.subscribe("tutorInvite/xClicked",function(){h();p=null;Tutor.Notifier.reset()});$.subscribe("Tutor/InviteCancelled",function(){Tutor.Notifier.reset();p=null;Popup.hide(true)});var f=function(e){if($("#tutorinvite-stepsbutton").length===0&&e){var t=Util.CreateElement({tagName:"button",id:"tutorinvite-stepsbutton",className:"btn-secondary",content:"View Steps</button>"});if(p.AltAscii!==""){t.disabled=true}t.addEventListener("click",function(e){e.preventDefault();m()});l.append(t)}};var h=function(){var e=d?Actions.tutorAcceptsInvite:Actions.tutorDeclineInvite;if(d){WebStorage.tutorRoomSubject.set(p.Subject.toLowerCase().replace("-",""))}var t=DtoHelper.InviteResponse({UserId:p.UserId,Type:p.Type,DeviceString:p.DeviceString,AnonUserId:p.AnonUserId,Id:p.Id,TutorRequestId:p.TutorRequestId});if(p.isInvite)Actions.Do(e,t)};var m=function(){var e={subject:p.Subject,asciitext:p.Ascii,mathml:Base64.toBase64(p.MathML),topicid:p.Topic.Id,topictext:p.Topic.Text,solutionid:p.SolutionId,platform:"ios",culture:App.Culture.current,anonuserid:p.AnonUserId,userid:p.UserId,deviceid:p.DeviceString,version:"APPS",freeTrialToken:"",showLineNumbers:Tutor.inChatRoom()};Util.OpenWindowWithPost("/StepsPopout/","width=400,height=600,left=100,top=100,resizable=yes,scrollbars=yes","NewFile",e)}};Component.TutorLanding=function(){var e=$("#tutor-sign-up");$(".tutor-sign-up").on("click",function(e){e.preventDefault();if(!Auth.isLoggedIn()){Actions.Do(Actions.showSignUp);return}else Util.Redirect("/TutorSignUp")});$.subscribe("dialog/close",function(e){var t=$.query("#login-container");if(e==="login"&&Auth.isLoggedIn()&&t.is(":visible"))Util.Redirect("/TutorSignUp")})};Component.TutorMacros=function(){var e=$.query("#tm-container");var t="tm-active";var r=function(e){e.preventDefault();var t=$(this).text();var r=Chat.CreateBubble({content:t,genre:"localTutor",avatarUrl:Auth.userstate.avatarUrl,testContext:BubbleContext.TutorBubble});Actions.Do(Actions.userSendsMessage,r);$.publish("Tutor/CloseMacros")};var n=function(e){var r=e.parentNode;$(r).addClass(t);var n=e.nextElementSibling;$.Velocity(n,"stop");$.Velocity(n,"slideDown",{display:"block",duration:150,easing:"easeOutQuad"})};var i=function(e){var r=e.parentNode;$(r).removeClass(t);var n=e.nextElementSibling;$.Velocity(n,"stop");$.Velocity(n,"slideUp",{display:"none",duration:150,easing:"easeInQuad"})};e.on("click",".tm-expandable",function(){var e=this.nextElementSibling;if(e===null)return;if(e.childNodes.length>0){var t=window.getComputedStyle(e,null);if(t.display==="none"){n(this)}else{i(this)}}});var a=function(){e.on("click",".tm-single",r);e.on("click",".tm-text-inner",r)};Component.TutorMacros.Control();a()};Component.TutorMacros.Control=function(){var e=$.query("#tm-container");var t=$.query("body");var r=false;var n=false;var i=function(t){if(!e.is(t.target)&&e.has(t.target).length===0&&window.getSelection().type!=="Range"){o()}};var a=function(){if(r)return;$.publish("overlay/show");e.css("display","inline-block").velocity("stop").velocity({right:0},{duration:150,easing:"easeOutQuad",complete:function(){n=$.subscribe("document/mouseup",i);t.addClass("clickable");r=true}})};var o=function(){if(!r)return;var i=parseInt(e.width())+10;$.publish("overlay/hide");e.velocity("stop").velocity({right:"-"+i+"px"},{duration:150,easing:"easeOutQuad",complete:function(){$.unsubscribe(n);t.removeClass("clickable");r=false;e.css("display","none")}})};$.subscribe("Tutor/OpenMacros",function(){
if(!Tutor.inChatRoom())return;a()});$.subscribe("Tutor/CloseMacros",function(){o()})};Component.TutorNotifier=function(){var e={};var t=document.querySelector("#chat-area .cell");var r=document.getElementById("chat-inner");var n=document.getElementById("chat-notifier");var i=document.querySelector("#chat-notifier .cn-dismiss");var a=document.querySelector("#chat-notifier .cn-new");var o=document.querySelector("#chat-notifier .cn-typing");var s=false;var u={newMessages:false,userTyping:false};e.init=function(){n.style.display="none";$.subscribe("tutor/leaveRoom",function(){f()});$(t).on("scrollend",150,function(){if(d())f()});$.query("#chat-notifier .cn-block").on("click",function(e){e.stopPropagation();$.publish("ChatLibrary/GoToBottom");f()});$(i).on("click",function(e){e.stopPropagation();f()})};var l=function(){if(!s){s=true;$(n).velocity("stop").velocity({opacity:1},{duration:150,easing:"easeOutQuad",display:"block"})}};var c=function(){if(s){s=false;$(n).velocity("stop").velocity({opacity:0},{duration:100,easing:"easeInQuad",display:"none"})}};var p=function(){var e=false;var t=false;a.style.display="none";o.style.display="none";if(!d()){e=true;if(u.newMessages){a.style.display="inline-block";t=true}else if(u.userTyping){o.style.display="inline-block";t=true}}if(t){l()}else{c()}return e};var d=function(){var e=$(r);var n=$(t);if(e.height()<n.height())return false;if(n.scrollTop()+n.height()>=e.height()-25)return true;return false};var f=function(){u.newMessages=false;u.userTyping=false;p()};e.NewMessages=function(){u.newMessages=true;return p()};e.UserIsTyping=function(){u.userTyping=true;return p()};e.UserStoppedTyping=function(){u.userTyping=false;p()};return e}();Component.TutorPreSession=function(){var e,t,r,n,i,a,o,s,u,l,c,p,d,f;var h,m,g,v,b,y;var w,C,S;$.subscribe("tutorPreSession/beforeShow",function(A,T,I){y=A;b=null;h=y?DtoHelper.CreateExpertQuestion(T):DtoHelper.InviteRequest(T);e=$(".popup-container");t=$("#drawer");$editorSubmit=t.find("#editor-submit");r=$("#pre-session-q1");n=$("#pre-session-problem");i=r.find(".btn-primary");a=r.find(".btn-secondary");o=$("#pre-session-q2");u=$("#pre-session-q3");l=u.find("input[name=pre-session-answer]");c=u.find("button");p=o.find("#pre-tutor-image-thumb");s=o.find("#pre-tutor-q2-next");d=$("#renew-date-footer");f=$("#renew-date-small");s.hide();n.html(Editor.AsciiToMathml(T.Ascii));MathJax.Hub.Queue(["Typeset",MathJax.Hub,n[0]]);i.on("click",function(){r.hide();u.show();h.IsProblem=true;$("#pre-session-credits").css("display","none");if(App.IsApps){Actions.Do(Actions.chatTapped)}});a.on("click",function(){r.hide();o.show();$.publish("topics/hijack");$("#pre-session-credits").css("display","none");h.IsProblem=false;if(App.IsApps){b=setInterval(function(){x(true)},250)}else{x(true)}App.CurrentEditor.Clear();App.CurrentEditor.TakeFocus();$.publish("tutorPreSession/no");m=$.subscribe("editorContentUpdate",function(e){var t=e.GetSolverStrings();g=t.ascii===""?g:t;x(true);if(v!=""){v="";p.empty();s.hide()}if(t.ascii=="")$.publish("tutorPreSession/no")})});s.on("click",function(){$.publish("tutorPreSession/problem")});w=$.subscribe("tutorPreSession/imageUpload",function(e){v=e;var t=document.createElement("img");t.setAttribute("src",e);p.empty().append(t).show();s.show();Actions.Do(Actions.hideKeyboard)});C=$.subscribe("drawer/closed",function(){x(false)});S=$.subscribe("tutorPreSession/problem",function(){$.publish("topics/release");o.hide();$.unsubscribe(m);App.CurrentEditor.RemoveFocus();App.CurrentEditor.Clear();u.show();if(App.IsApps){Actions.Do(Actions.chatTapped)}x(false)});l.on("click",function(){c[0].removeAttribute("disabled")});c.on("click",function(){Popup.hide();if(!h.IsProblem){if(v!==""&&v!==null){if(y){h.ImageURL=v}else{h.imageURL=v}}else{h.AltAscii=g.ascii;h.AltMathML=g.html}}if(y){h.AnswerType=l.filter(":checked").val()}else{h.AnswerId=l.filter(":checked").val()}I(h)});if(!y){API.getCreditInfoForUser(CreditType.Tutoring,function(e){if(e.status===1){App.TutoringCredits=e.Credits}if(App.TutoringCredits>0&&App.TutoringCredits<4&&!App.IsApps){var t=Strings.Tutor.RenewDateFooter.replace("{SESSION_RENEWAL_DATE}",Util.formatDate(new Date(parseInt(Auth.userstate.nextCreditRefreshDate.substr(6)))));$("#pre-session-credits-number").html(App.TutoringCredits);$("#pre-session-credits").css("display","inline-block");d.html(t);if(!Auth.hideCreditRenewal()){f.show();$(".asterisk-blue").show()}}else{$("#pre-session-credits").css("display","none")}})}});$.subscribe("tutorPreSession/beforeHide",function(e,t){A();App.CurrentEditor.RemoveFocus();App.CurrentEditor.Clear();$.publish("topics/release");$.unsubscribe(w);$.unsubscribe(C);$.unsubscribe(S)});var x=function(r){if(!r){A()}var n=r?t.height():0;e.css({bottom:n});Popup.center()};var A=function(){if(b!==null){clearInterval(b);b=null}}};Component.TutorSignUp=function(){var e=$("#TutorSignUp");var t=$.query("#firstname");var r=$.query("#lastname");var n=$.query("#timezone");var i=$.query("#contactemail");var a=$.query("#contactphone");var o=$.query("#contactaddress");var s=$.query("#tutor-signup-submit");var u=$("#subject-section select.field").length;$(".tutor-schedule td").on("click",function(e){e.preventDefault();l($(this))});s.on("click",function(e){e.preventDefault();if(!c())return;s.prop("disabled",true);Actions.Do(Actions.showSpinner);API.addTutorApplication(t.val(),r.val(),n.val(),i.val(),a.val(),o.val(),v(),m(),function(e){s.prop("disabled",false);Actions.Do(Actions.hideSpinner);if(e.status===1){document.location.href="/TutorThanks"}else{alert(Strings.TutorSignUp.ErrorSaving)}})});var l=function(e){if(e.hasClass("date-selected")){e.removeClass("date-selected")}else e.addClass("date-selected")};var c=function(){$(".validation-message").hide();var e=[];if(t.val()=="")e.push("no-firstname");if(r.val()=="")e.push("no-lastname");if(n.val()=="")e.push("no-timezone");if(!p())e.push("no-subject");if(!d())e.push("no-schedule");if(e.length==0)return true;for(var i=0;i<e.length;i++)f(e[i]);return false};var p=function(){return $("#subject-section select").filter(function(){return $(this).val()=="None"}).length!=u};var d=function(){return $(".date-selected").length>0};var f=function(e){$.query(".validation-message[data-error-type="+e+"]").show()};var h=function(){var e=[];$(".date-selected").each(function(t){e.push($(this).parents("table").attr("data-day")+" "+$(this).html())});return e};var m=function(){var e="";$(h()).each(function(t,r){var n=t===0?"":",";e+=n+r});return e};var g=function(){var e=[];$("#subject-section select").each(function(t,r){e.push($(r).val())});return e};var v=function(){var e="";$(g()).each(function(t,r){var n=t===0?"":",";e+=n+r});return e};if(!Auth.isLoggedIn()){Util.Redirect("/Tutors")}else e.show()};Component.TutorToggle=function(){var e=$("#tutor-available");var t=$("#tutor-available input");t.change(function(){var e=$(this).is(":checked");API.setIsAvailable(e,function(){Auth.userstate.isAvailable=e;if(e){Tutor.Requester.start()}})});var r=function(){if(Auth.getChatUserType()==ChatUserType.Tutor){e.css("display","inline-block");$("#tutor-available input").prop("checked",Auth.userstate.isAvailable)}else{e.hide()}};$.subscribe("tutor/off",function(){t.prop("checked",true);t.trigger("click")});$.subscribe("tutor/updateAvailability",function(){r()});$.subscribe("auth/logout",function(){r()});$.subscribe("auth/refreshedUserState",function(){r()});$.subscribe("auth/loggedin",function(){r()});$.subscribe("TutorHub/Connected",function(){r()});$.subscribe("TutorHub/Disconnected",function(){r()})};Component.TutorToolbar=function(){var e=$("#tutor-toolbar");var t=$("#tutor-toolbar .left-side");var r=$("#tutor-toolbar .right-side");var n;var i;var a;var o;var s;var u;var l=false;var c;var p;var d;var f=true;var h=false;var m=false;var g=function(e){t.empty();r.empty();var n=new Array;var s=new Array;e=$.extend({tutorName:"Tutor",showCamera:false,showVideo:false,isTutor:false},e||{});c=e.tutorName;p=e.isTutor;m=false;a=Util.CreateElement({tagName:"span",id:"tutor-toolbar-message"});if(p)r.append(a);else t.append(a);var u=Util.CreateElement({className:"Button",id:"button_close_session",content:'<button class="btn-secondary-cancel small">End Session</button>'});u.addEventListener("click",function(e){e.preventDefault();Popup.showYesNo("Are you sure you want to exit this live expert session?",function(){Actions.Do(Actions.leaveRoom,ChatRoomLeaveReason.Manual)})});if(p){o=Util.CreateElement({id:"room-timer"});r.append(o);v()}r.append(u);var l=Util.CreateElement({className:"Button",id:"button_show_problem",content:'<i class="mw mw-algebra"></i>'});l.addEventListener("click",function(e){e.preventDefault();Popup.showTutorInvite(WebStorage.tutorInvite.get(),false)});if(p){t.append(l)}if(p){var d=Util.CreateElement({className:"Button",id:"button_show_macros",content:'<i class="mw mw-chat"></i>'});d.addEventListener("click",function(e){e.preventDefault();Actions.Do(Actions.showTutorMacros)});t.append(d);var f=Util.CreateElement({className:"Button",id:"button_show_formulas",content:'<i class="mw mw-chemistry"></i>'});f.addEventListener("click",function(e){e.preventDefault();Actions.Do(Actions.showTutorFormulas)});t.append(f);var g=Util.CreateElement({className:"Button",id:"button_edit_mode",content:'<i class="mw mw-trash"></i>'});g.addEventListener("click",function(e){e.preventDefault();h=!h;if(h){$(g).addClass("edit-mode-active");$.publish("ChatLibrary/StartEditMode")}else{$(g).removeClass("edit-mode-active");$.publish("ChatLibrary/EndEditMode")}});t.append(g);var b=Util.CreateElement({className:"Button",id:"button_flag_room",content:'<i class="mw mw-flag"></i>'});b.addEventListener("click",function(e){e.preventDefault();if(!m)Popup.showYesNo("Are you sure you want to flag this session?",function(){Tutor.Hub.flagRoom();b.className="Button disabled";m=true})});t.append(b)}if(e.showCamera&&e.isTutor){if(App.iOSversion().major>=9){i=Util.CreateElement({className:"Button",id:"button_camera"});var y=Util.CreateElement({tagName:"label",className:"mw mw-camera"});document.getElementById("tutor-camera").addEventListener("change",function(e){var t=this.files[0];Tutor.handleCameraInput(t);$(this).attr("value","");$(this).val("")});i.appendChild(y);$("#button_camera").remove();t.append(i)}else{Devices.videoInput(Devices.ALL,function(e){n=e;s=Devices.filter(Devices.BACK,e);if(n.length>0){if(!App.isMobile){i=Util.CreateElement({className:"Button",id:"button_camera",content:'<i class="mw mw-camera"></i>'});i.addEventListener("click",function(e){Popup.showCamera({cameraType:Devices.BACK,captureType:Component.Camera.CaptureTypes.blob,captureCallback:function(e){Tutor.onCapture(e)}})})}else{i=Util.CreateElement({className:"Button",id:"button_camera"});var r=Util.CreateElement({tagName:"label",className:"mw mw-camera"});document.getElementById("tutor-camera").addEventListener("change",function(e){var t=this.files[0];Tutor.handleCameraInput(t);$(this).attr("value","")});i.appendChild(r)}$("#button_camera").remove();t.append(i)}})}}w(true)};var v=function(){u=WebStorage.roomTimerElapsed.get();if(u===null)u=0;else u=parseInt(u);y();if(!l){l=true;s=setInterval(function(){u++;WebStorage.roomTimerElapsed.set(u);y()},1e3)}};var b=function(){clearInterval(s);l=false;WebStorage.roomTimerElapsed.remove()};var y=function(){var e="";var t=u;var r=Math.floor(t/60/60);if(r>0){t-=r*60*60;e+=r+":"}var n=Math.floor(t/60);if(n>0){t-=n*60}e+=r>0&&n<10?"0"+n:n;e+=":";var i=t;e+=i>=10?i:"0"+i;o.innerText=e};var w=function(e){f=e;if(e)if(!App.isMobile)d=p?"":"Connected to: <strong>"+c+"</strong>";else d=p?"":"<strong>"+c+"</strong>";else d="User has disconnected...";C()};var C=function(){a.innerHTML=d;if(!f)e.addClass("disconnected");else e.removeClass("disconnected")};var S=function(){e.show()};var x=function(){e.hide()};$.subscribe("Tutor/InviteAccepted",function(e){g(e);S()});$.subscribe("tutor/reconnected",function(){w(true);Tutor.waitingForReconnect=false});$.subscribe("tutor/disconnected",function(){w(false);Tutor.waitingForReconnect=true});$.subscribe("tutor/leaveRoom",function(){if(p){b();h=false;$.publish("ChatLibrary/EndEditMode")}x()});$.subscribe("tutor/roomFinished",function(){x()});$.subscribe("Tutor/RatingSent",function(){x()})};$.fn.Whiteboard=function(e){var t=e.isOwner||false;var r=this;if(t){r.penColor={R:255,G:0,B:0}}else{r.penColor={R:0,G:0,B:255}}r.penWidth=5;r.selected=false;r.layerid="";var n=null;var i=null;var a=null;var o;var s;var u;var l;var c;var p=new Array;var d=new Array;var f=new Array;var h=new Array;var m=new Array;var g=new Array;var v=new Array;var b=new Array;var y;var w;var C;var S;var x;var A;var T;var I;var E=null;var P=false;var k=false;var M=20;y=20;w=70;$(r).on("mousedown touchstart",function(e){e.preventDefault();var t;var n;if(e.originalEvent&&e.originalEvent.touches&&e.originalEvent.changedTouches){var i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];var t=i.pageX;var n=i.pageY}else{t=e.pageX;n=e.pageY}var a=false;if(!a){r.selected=false;P=true;C=t-y;S=n-w;x=C;A=C;T=S;I=S;$.publish("WhiteboardLayerUnselected")}});$(r).on("mousemove touchmove",function(e){e.preventDefault();var t;var s;if(e.originalEvent&&e.originalEvent.touches&&e.originalEvent.changedTouches){var u=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];var t=u.pageX;var s=u.pageY}else{t=e.pageX;s=e.pageY}if(P&&!k&&(Math.abs(C-(t-y))>20||Math.abs(S-(s-w))>20)){k=true;var l="t"+(new Date).getTime();p.push(l);n=$("<div id='"+l+"' class='Layer'><div class='ResizeHandle'/></div>").appendTo($(r));var c=0;$(".Layer").each(function(){var e=parseInt($(this).css("zIndex"),10);if(e>c)c=e});$(n).css("zIndex",c+1);i=document.createElement("canvas");$(i).attr("width",$(r).width());$(i).attr("height",$(r).height());$(i).appendTo($(n));a=i.getContext("2d");a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.lineCap="round";a.lineJoin="round";a.lineWidth=r.penWidth;a.strokeStyle="rgb("+r.penColor.R+","+r.penColor.G+","+r.penColor.B+")";o=new Path2D;o.moveTo(C,S);E=new Array;E.push({X:C,Y:S})}if(P&&k&&(Math.abs(C-(t-y))>10||Math.abs(S-(s-w))>10)){C=t-y;S=s-w;if(C>A)A=C;if(C<x)x=C;if(S>I)I=S;if(S<T)T=S;o.lineTo(C,S);a.stroke(o);E.push({X:C,Y:S})}});$(r).on("mouseup touchend",function(e){if(P&&k){var t=x-M;var p=T-M;s=A-x+2*M;u=I-T+2*M;$(n).css("left",t+"px");$(n).css("top",p+"px");$(i).attr("width",s);$(i).attr("height",u);$(n).draggable({containment:$(r),disabled:true,start:function(){P=false},drag:function(){if(!$(this).hasClass("Selected")){D(r.layerid)}}});a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.lineCap="round";a.lineJoin="round";a.lineWidth=r.penWidth;a.strokeStyle="rgb("+r.penColor.R+","+r.penColor.G+","+r.penColor.B+")";o=new Path2D;o.moveTo(E[0].X-x+M,E[0].Y-T+M);for(var y=1;y<E.length;y++){o.lineTo(E[y].X-x+M,E[y].Y-T+M)}a.stroke(o);d.push(o);v.push(r.penColor);b.push(r.penWidth);f.push(s);h.push(u);l=1;m.push(l);c=0;g.push(c)}P=false;k=false});r.Erase=function(){for(var e=0;e<p.length;e++){var t=$("#"+p[e]);$(t).fadeOut("fast",function(){$(this).remove()})}p=new Array;d=new Array;v=new Array;b=new Array;f=new Array;h=new Array;m=new Array;g=new Array};r.Remove=function(){for(var e=0;e<p.length;e++){if(p[e]==r.layerid){var t=$("#"+p[e]);$(t).fadeOut("fast",function(){$(this).remove();p.removeAt(e);d.removeAt(e);v.removeAt(e);b.removeAt(e);f.removeAt(e);h.removeAt(e);m.removeAt(e);g.removeAt(e)});break}}};r.SetBackground=function(e){var t=new Image;t.onload=function(){$(r).find(".Background").remove();var e=Math.min(t.width,$(r).width());var n=Math.min(t.height,$(r).height());var i=document.createElement("canvas");$(i).addClass("Background");$(i).attr("width",e);$(i).attr("height",n);$(i).appendTo($(r));var a=i.getContext("2d");a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.drawImage(t,0,0,e,n)};t.crossOrigin="";t.src=e};r.SetLayerPenWidth=function(e){for(var t=0;t<p.length;t++){if(p[t]==r.layerid){b[t]=e;var n=$("#"+p[t]);var i=$(n).find("canvas")[0];var a=i.getContext("2d");var o=v[t];$(i).attr("width",f[t]);$(i).attr("height",h[t]);a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.lineCap="round";a.lineJoin="round";a.scale(m[t],m[t]);a.lineWidth=b[t]+10;a.strokeStyle="rgb("+(255-o.R)+","+(255-o.G)+","+(255-o.B)+")";a.stroke(d[t]);a.lineWidth=b[t];a.strokeStyle="rgb("+o.R+","+o.G+","+o.B+")";a.stroke(d[t]);break}}};r.SetLayerPenColor=function(e){for(var t=0;t<p.length;t++){if(p[t]==r.layerid){v[t]=e;var n=$("#"+p[t]);var i=$(n).find("canvas")[0];var a=i.getContext("2d");var e=v[t];$(i).attr("width",f[t]);$(i).attr("height",h[t]);a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.lineCap="round";a.lineJoin="round";a.scale(m[t],m[t]);a.lineWidth=b[t]+10;a.strokeStyle="rgb("+(255-e.R)+","+(255-e.G)+","+(255-e.B)+")";a.stroke(d[t]);a.lineWidth=b[t];a.strokeStyle="rgb("+e.R+","+e.G+","+e.B+")";a.stroke(d[t]);break}}};r.Upload=function(){var t=i.width;var r=i.height;var n=0;var a=t;var o=0;var s=r;var u=i.getContext("2d");var l=u.getImageData(0,0,t,r);var c=l.data;var p=false;for(var d=0;d<t-1;d++){for(var f=0;f<r-1;f++){var h=c[f*t*4+d*4+3];if(h!=0){p=true;n=d;break}}if(p)break}p=false;for(var d=t-1;d>0;d--){for(var f=0;f<r-1;f++){var h=c[f*t*4+d*4+3];if(h!=0){p=true;a=d;break}}if(p)break}p=false;for(var f=r-1;f>0;f--){for(var d=0;d<t-1;d++){var h=c[f*t*4+d*4+3];if(h!=0){p=true;s=f;break}}if(p)break}p=false;for(var f=0;f<r-1;f++){for(var d=0;d<t-1;d++){var h=c[f*t*4+d*4+3];if(h!=0){p=true;o=f;break}}if(p)break}var m=document.createElement("canvas");$(m).attr("width",a-n);$(m).attr("height",s-o);cropcontext=m.getContext("2d");cropcontext.drawImage(i,n,o,a-n,s-o,0,0,a-n,s-o);var g="t"+(new Date).getTime()+".png";m.toBlob(function(t){API.uploadBlobImage(g,t,ImageType.Whiteboard,false,function(t){if(t.status===1){e.onUploaded(t.value)}})})};r.Blur=function(){r.selected=false;L(r.layerid)};function D(e){for(var t=0;t<p.length;t++){if(p[t]==e){n=$("#"+p[t]);if(!$(n).hasClass("Selected")){r.selected=true;r.layerid=p[t];r.penWidth=b[t];r.penColor=v[t];o=d[t];s=f[t];u=h[t];l=m[t];c=g[t];i=$(n).find("canvas")[0];a=i.getContext("2d");$(n).addClass("Selected");$(n).draggable("option","disabled",false);var y=0;$(".Layer").each(function(){var e=parseInt($(this).css("zIndex"),10);if(e>y)y=e});$(n).css("zIndex",y+1);$(i).attr("width",s);$(i).attr("height",u);a.imageSmoothingEnabled=true;a.imageSmoothingQuality="high";a.lineCap="round";a.lineJoin="round";a.lineWidth=r.penWidth+10;a.strokeStyle="rgb("+(255-r.penColor.R)+","+(255-r.penColor.G)+","+(255-r.penColor.B)+")";a.scale(l,l);a.stroke(o);a.lineWidth=r.penWidth;a.strokeStyle="rgb("+r.penColor.R+","+r.penColor.G+","+r.penColor.B+")";a.stroke(o);$.publish("WhiteboardLayerSelected",[r.layerid,r.penWidth,r.penColor])}break}}}function L(e){for(var t=0;t<p.length;t++){if(p[t]==e){var r=$("#"+p[t]);if($(r).hasClass("Selected")){var n=$(r).find("canvas")[0];var i=n.getContext("2d");$(r).removeClass("Selected");$(r).draggable("option","disabled",true);$(n).attr("width",f[t]);$(n).attr("height",h[t]);i.imageSmoothingEnabled=true;i.imageSmoothingQuality="high";i.lineCap="round";i.lineJoin="round";i.lineWidth=b[t];var a=v[t];i.strokeStyle="rgb("+a.R+","+a.G+","+a.B+")";i.scale(m[t],m[t]);i.stroke(d[t])}break}}}function R(e,t){var r=[1,0,0,1,0,0];var n=[1,0,0,1,s/2,u/2];var i=r[0]*n[0]+r[2]*n[1];var a=r[1]*n[0]+r[3]*n[1];var o=r[0]*n[2]+r[2]*n[3];var l=r[1]*n[2]+r[3]*n[3];var p=r[0]*n[4]+r[2]*n[5]+r[4];var d=r[1]*n[4]+r[3]*n[5]+r[5];r=[i,a,o,l,p,d];var f=Math.cos(-c);var h=Math.sin(-c);var n=[f,h,-h,f,0,0];var i=r[0]*n[0]+r[2]*n[1];var a=r[1]*n[0]+r[3]*n[1];var o=r[0]*n[2]+r[2]*n[3];var l=r[1]*n[2]+r[3]*n[3];var p=r[0]*n[4]+r[2]*n[5]+r[4];var d=r[1]*n[4]+r[3]*n[5]+r[5];r=[i,a,o,l,p,d];var n=[1,0,0,1,-s/2,-u/2];var i=r[0]*n[0]+r[2]*n[1];var a=r[1]*n[0]+r[3]*n[1];var o=r[0]*n[2]+r[2]*n[3];var l=r[1]*n[2]+r[3]*n[3];var p=r[0]*n[4]+r[2]*n[5]+r[4];var d=r[1]*n[4]+r[3]*n[5]+r[5];r=[i,a,o,l,p,d];var m=e*r[0]+t*r[2]+r[4];var g=e*r[1]+t*r[3]+r[5];return{x:m,y:g}}return r};var Upgrade=function(e){const t={CreditCard:"cc",PayPal:"paypal",Amazon:"amazon",ApplePay:"applepay"};var r=["#cc-country","#cc-address1","#cc-city","#cc-state","#cc-zipcode","#cc-first-name","#cc-last-name","HOSTED-cardnumber","HOSTED-expiration","HOSTED-cvv","#cc-upgrade"];var n=["#cc-country","#cc-address1","#cc-city-intl","#cc-state-intl","#cc-zipcode-intl","#cc-first-name","#cc-last-name","HOSTED-cardnumber","HOSTED-expiration","HOSTED-cvv","#cc-upgrade"];var i,a,o,s,u,l,c,p,d,f,h,m,g,v,b,y,w,C,S,x,A,T,I,E,P,k,M,$,D,L,R,N,U,F,O,B,H,q,G,_,W,z,j,V,Q,Y,X,K,J,Z,ee,te,re,ne,Z,ie,ae;var oe,se,ue,le,ce,pe,de,fe,he,me,ge,ve,be,ye,we;var Ce,Se,xe,Ae,Te,Ie,Ee,Pe,ke,Me,$e,De,Le,Re,Ne,Ue,Fe,Oe,Be,He,qe,Ge,_e,We=null,ze=null,je=false,Ve,Qe=null,Ye=t.CreditCard,Xe=[];var Ke=null;e.subscribe("upgrade/beforeShow",function(t){t=typeof t==="undefined"?{}:t;Ve=t;Oe=typeof t.source==="undefined"?null:t.source;je=typeof t.tutorSessionAfterPurchase==="undefined"?false:t.tutorSessionAfterPurchase;GoogleAnalytics.send({eventCategory:"upgrade",eventAction:"Upgrade Dialog Opened",eventLabel:WebStorage.anonUserId.get()});if(t.selectedPlan!=="undefined")Ie=t.selectedPlan;e.publish("chat/removeUpgrade");if(Auth.isLoggedIn()){API.getCreditInfoForUser(CreditType.Tutoring,function(e){if(e.status===1){App.TutoringCredits=e.Credits}et(t)})}else{et(t)}});e.subscribe("upgrade/beforeHide",function(){Qt();ut();Kt();GoogleAnalytics.send({eventCategory:"upgrade",eventAction:"Upgrade Dialog Closed",eventLabel:WebStorage.anonUserId.get()})});e.subscribe("upgrade/authenticated",function(){if(Auth.hasSubscription())Popup.hide();else Popup.showUpgrade({startAtPayment:true,selectedPlan:Ie})});var Je=function(){i=e("#upgrade-container");a=e(".upgrade-cards");o=e("#upgrade-option-monthly");s=e("#upgrade-option-quarterly");u=e("#upgrade-option-annual");$tutorToggle=e("#tutoring-addon-checkbox");$tutorAdditionalWrap=e(".additional-wrap");$tutorLearnMore=e(".tutoring-addon .learn-more");$tutoringAdditionalPrice=e(".tutoring-addon .additional");$currentPlanPrice=e(".upgrade-existing-current span");$newPlanPrice=e(".upgrade-existing-new span");$planMonthly=e(".upgrade-plan-monthly");$planQuarterly=e(".upgrade-plan-quarterly");$planAnnual=e(".upgrade-plan-annual");l=e("#include-expertqa-price");c=e("#include-expertqa-confirm");p=e("#include-expertqa-deny");d=e("#include-expertqa-refund");f=e("#include-tutoring-price");$includeExpertTutoringRefund=e("#include-expert-tutoring-refund");$includeExpertTutoringPrice=e("#include-expert-tutoring-price");h=e("#include-tutoring-confirm");m=e("#include-tutoring-deny");g=e("#include-tutoring-refund");v=e(".upgrade-form-cc");$wrapPaypal=e(".upgrade-form-paypal");b=e(".upgrade-form-amazon");y=v;w=e("#monthly-price");C=e("#quarterly-price");S=e("#annual-price");x=e("#premium-price");A=e("#go-premium");I=e("#quarterly-price-save");$annualPriceSave=e("#annual-price-save");$priceSaveTutoring=e("#price-save-tutoring");E=e("#current-plan");P=e(".payment-options li[data-type=cc]");k=e(".payment-options li[data-type=paypal]");M=e(".payment-options li[data-type=amazon]");$=e(".payment-options li[data-type=applepay]");D=e("#upgrade-step-plan");L=e("#upgrade-step-expertqa");R=e("#upgrade-step-tutoring");N=e("#upgrade-step-payment");U=e("#invoke-cvv");F=e("#cvv-help");O=D;$selectedPrice=e("#selectedPrice");$selectedPeriod=e("#selectedPeriod");B=e(".upgrade-go-back");q=e("#upgrade-form-row-address-us");G=e("#upgrade-form-row-address-intl");_=e("#upgrade-form-row-payment");W=e("#cc-form-credit-card");H=e("#upgrade-label-annual");z=e("#tutoring-dropdown");J=e(".col-confirm");Z=e("#tutoring-text-upper");$upgradeOptionExpertQA=e("#upgrade-option-expertqa");$upgradeOptionTutoring=e("#upgrade-option-tutoring");ee=e("#footnote-expert");te=e("#upgrade-step-one-off");re=e(".one-off-price");ne=e(".one-off-price-total");$oneOffPurchaseButton=e("#one-off-tutor-session");$oneOffCancelButton=e("#one-off-tutor-session-cancel");ie=e("#upgrade-form-row-three");ae=e(".form-legal");oe=e("#upgrade-form-moon-and-star");se=e("#cc-country");ue=e("#cc-address1");le=e("#cc-city");ce=e("#cc-city-intl");pe=e("#cc-state");de=e("#cc-state-intl");fe=e("#cc-zipcode");he=e("#cc-zipcode-intl");me=e("#cc-first-name");ge=e("#cc-last-name");ve=e("#cc-upgrade");be=e("#amazon-upgrade");ye=e("#change-currency");$liAmazon=e('li[data-type="amazon"]');$liPaypal=e('li[data-type="paypal"]');$liCC=e('li[data-type="cc"]');we=e("#cc-email");Xe=[se,ue,le,ce,pe,de,fe,he];$ccVisa=e("#cc-type-visa");$ccMasterCard=e("#cc-type-mc");$ccAmex=e("#cc-type-amex");$ccDiscover=e("#cc-type-disc");$ccNone=e("#cc-type-none");$ccAll=e(".cc-type");$ccContainer=e(".form-cc-icon");Ae=null;xe=false;isLocked=false;Te=null;packs=null;defaultPaymentOption=1;amazonLoggedIn=false;ke=false;Me=null;$e=null;De=false;Le=false;mouseUpHandleCVV=false;Re=0;Ne=null;Ue=null;validationFields=[me,ge];He=null;e("#upgrade-option-monthly, #upgrade-option-quarterly, #upgrade-option-annual").on("change",function(){if(o.is(":checked")){o.addClass("checked");s.removeClass("checked");u.removeClass("checked")}else if(s.is(":checked")){o.removeClass("checked");s.addClass("checked");u.removeClass("checked")}else if(u.is(":checked")){o.removeClass("checked");s.removeClass("checked");u.addClass("checked")}}).trigger("change");Fe=document.getElementById("pay-with-amazon");ve.on("click",function(){if(isLocked)return;if(Ze()){gt()}else{vt()}API.logTestEvent("clicked-pay-cc",Re,pt())});U.mouseenter(function(){lt()});U.mouseleave(function(){ct()});o.on("click",function(e){rt();Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User chose monthly upgrade",eventLabel:WebStorage.anonUserId.get()});API.logTestEvent("chose-plan",0,pt())});u.on("click",function(e){rt();Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User chose annual upgrade",eventLabel:WebStorage.anonUserId.get()});API.logTestEvent("chose-plan",Re,pt())});A.on("click",function(e){e.preventDefault();if(Ce){wt()}else{if(o.is(":checked")){Ie=Te.monthly}else if(s.is(":checked")){Ie=Te.quarterly}else if(u.is(":checked")){Ie=Te.annual}Wt();API.logTestEvent("clicked-go-premium",Re,pt());Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"upgrade",eventAction:"Go Premium",eventLabel:pt()})}});var t=e(".payment-options");e(".payment-options li").on("mouseenter",function(){var r=e(this);if(r.attr("data-type")==="cc")t.addClass("cc-hover");else if(r.attr("data-type")==="paypal")t.addClass("paypal-hover");else if(r.attr("data-type")==="amazon")t.addClass("amazon-hover")}).on("mouseleave",function(){t.removeClass("cc-hover");t.removeClass("paypal-hover");t.removeClass("amazon-hover")});P.on("click",function(e){e.preventDefault();Jt();Qt();if(P.hasClass("selected"))return;zt(P);API.logTestEvent("chose-payment-cc",Re,pt())});k.on("click",function(e){e.preventDefault();Jt();Qt();if(k.hasClass("selected"))return;if(Ze()){Popup.hideAll();Popup.showSignUp({selectPlan:Ie,onAuthUpgradeDelayed:true});return}Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User selected Pay with PayPal",eventLabel:WebStorage.anonUserId.get()});$t();API.logTestEvent("chose-payment-pp",Re,pt())});M.on("click",function(e){e.preventDefault();Jt();Qt();Vt();if(Ze()){Popup.hideAll();Popup.showSignUp({selectPlan:Ie,onAuthUpgradeDelayed:true});return}if(!M.hasClass("selected")){API.logTestEvent("chose-payment-amz",Re,pt())}});be.on("click",function(){Jt();if(isLocked)return;if(Ze()){Popup.hideAll();Popup.showSignUp({selectPlan:Ie,onAuthUpgradeDelayed:true});return}Dt();API.logTestEvent("clicked-pay-amz",Re,pt())});$.on("click",function(e){e.preventDefault();Jt();Qt();if(Ze()){Popup.hideAll();Popup.showSignUp({selectPlan:Ie,onAuthUpgradeDelayed:true});return}zt($);API.logTestEvent("chose-payment-applepay",Re,pt())});recurly.on("change",function(e){Ke=e});var r=recurly.Elements();e.subscribe("tabbing/hosted",function(e){var t=null;switch(e){case"cardnumber":t=r.CardNumberElement();break;case"expiration":t=r.CardMonthElement();break;case"cvv":t=r.CardCvvElement();break}if(t)t.focus()});B.on("click",function(e){e.preventDefault();Jt();Lt();Qt()});oe.on("submit",function(e){e.preventDefault();Qt()});e("#upgrade_access_bullet").on("click",function(t){e("#upgrade-access-full").css("display","block");setTimeout(function(){e("#upgrade-access-full").css("display","none")},4e3)});se.on("change",function(){i.find(".field-error").remove();i.find(".field .invalid").removeClass("invalid");Ft()});se.val(WebStorage.location.get())};var Ze=function(){if(Ve.anonPurchase&&!Auth.isLoggedIn())return true;return false};var et=function(t){Yt();Ce=false;Se=false;isOneOffSessionUpgrade=false;if(Auth.hasTutoringSubscription()&&App.TutoringCredits==0)isOneOffSessionUpgrade=true;else if(Auth.hasExpertSubscription()&&!Auth.hasTutoringSubscription())Ce=true;else if(Auth.hasRole(UserRoles.StepByStep))Se=true;if(STM.Tests.UpgradeGuarantee.enabled()){e(".form-satisfaction").addClass("test-on")}else{e(".form-satisfaction").addClass("test-off")}var r=e(".upgrade-plans");var n="opened-upgrade";Je();if(Se){n="opened-upgrade-expertqa";Re=3;O=L;O.show();p.css("float","right");e("#footnote-tutoring a").on("click",function(e){e.preventDefault();Popup.showTutorVideo()});e("#footnote-learn-more a").on("click",function(e){e.preventDefault();Popup.showExpertVideo()});e("input[type=radio][name=upgrade-option-expert]").change(function(){Ae=null;if($upgradeOptionExpertQA.is(":checked")){Actions.Do(Actions.showSpinner);Ie=Pe;Se=true;Ce=false;rt(function(){d.show();$includeExpertTutoringRefund.hide();l.show();$includeExpertTutoringPrice.hide();Actions.Do(Actions.hideSpinner)})}else if($upgradeOptionTutoring.is(":checked")){Actions.Do(Actions.showSpinner);Se=false;Ce=true;Ie=Ee;rt(function(){d.hide();$includeExpertTutoringRefund.show();l.hide();$includeExpertTutoringPrice.show();Actions.Do(Actions.hideSpinner)})}});c.on("click",function(){rt();if(Se){API.logTestEvent("include-expertqa-confirm",Re,pt());yt()}else{API.logTestEvent("include-tutoring-confirm",Re,pt());wt()}});p.on("click",function(){API.logTestEvent("include-expertqa-deny",Re,pt());Popup.hide()})}else if(Ce){n="opened-upgrade-tutoring";Re=2;O=R;O.show();Rt();if(STM.Tests.CreditPackPurchase.enabled()){z.show();J.hide();m.css("float","initial").css("margin-top","initial");Z.html(Strings.Upgrade.TutoringLearnMorePurchase)}else{z.hide();J.show();m.css("float","initial").css("margin-top","10px");h.on("click",function(){API.logTestEvent("include-tutoring-confirm",Re,pt());wt()})}m.on("click",function(){API.logTestEvent("include-tutoring-deny",Re,pt());Popup.hide()})}else if(isOneOffSessionUpgrade){n="opened-upgrade-one-off";Re=2;e("#credit-renewal-date").html(Util.formatDateShort(new Date(parseInt(Auth.userstate.nextCreditRefreshDate.substr(6)))));if(Auth.hideCreditRenewal()){e("#credit-renewal-date-line").hide()}O=te;O.show()}else{Recurly.configure();if(!Auth.isLoggedIn())Currency.SetCurrency(Currency.GetDefaultCurrency());D.show();tt();r.addClass("swapped");if(Bt()){_.addClass("from-us");N.addClass("from-us")}else{_.removeClass("from-us");N.removeClass("from-us");fe.val("")}}Actions.Do(Actions.showSpinner);Recurly.init(function(){Recurly.getPrices(false,function(r){Te=r;if(Se){switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:Ie=Te.monthlyExpertQA;Pe=Te.monthlyExpertQA;Ee=Te.monthlyTutoring;break;case SubType.Yearly:Ie=Te.annualExpertQA;Pe=Te.annualExpertQA;Ee=Te.annualTutoring;break;case SubType.Quarterly:Ie=Te.quarterlyExpertQA;Pe=Te.quarterlyExpertQA;Ee=Te.quarterlyTutoring;break}}else if(Ce){switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:Ie=Te.monthlyExpertQA;Pe=Te.monthlyExpertQA;Ee=Te.monthlyTutoring;break;case SubType.Yearly:Ie=Te.annualExpertQA;Pe=Te.annualExpertQA;Ee=Te.annualTutoring;break;case SubType.Quarterly:Ie=Te.quarterlyExpertQA;Pe=Te.quarterlyExpertQA;Ee=Te.quarterlyTutoring;break;case SubType.MonthlyExpertQA:Ie=Te.monthlyTutoring;break;case SubType.YearlyExpertQA:
Ie=Te.annualTutoring;break;case SubType.QuarterlyExpertQA:Ie=Te.quarterlyTutoring;break}}else{s.parent().hide();e(".upgrade-plans").show()}rt();API.logTestEvent(n,Re,pt());if(!Ce&&!isOneOffSessionUpgrade)API.deleteBillingInfo();if(t.startAtPayment)Nt()})})};var tt=function(){if(Currency.CanChangeCurrency()){currency_select=Currency.CreateCurrencyOptions(Currency.chosenCurrency.code);e(currency_select).on("change",function(){Currency.SetCurrencyByCode(e(this).val());Currency.wasChanged=true;Actions.Do(Actions.showSpinner);Recurly.getPrices(true,function(e){Actions.Do(Actions.hideSpinner);Te=e;rt()})});ye.append(currency_select)}};var rt=function(e){if(isOneOffSessionUpgrade){var t=function(){var e=Currency.FormatCurrency(Te.oneOffExpertPlan.price)+" + "+Strings.Upgrade.PriceTax;re.text(e);ne.text(e);$oneOffPurchaseButton.on("click",function(e){e.preventDefault();oneOffPurchaseQty=1;We=Te.oneOffExpertPlan.price;Ct()});$oneOffCancelButton.on("click",function(e){Popup.hide(true)})};Actions.Do(Actions.hideSpinner);t();return}else if(Se){var t=function(){var t=Strings.Upgrade.PerMonth;var r="";var n="";var i=d.text();switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:r=Strings.Upgrade.PerMonth;qe=Ae.monthlySubtotal;Ge=Ae.monthlyTax;_e=Ae.monthlyTotal;n=ot(qe,Ae.currentPrice);break;case SubType.Quarterly:r=Strings.Upgrade.Quarter;qe=Ae.quarterlySubtotal;Ge=Ae.quarterlyTax;_e=Ae.quarterlyTotal;n=it(qe-Ae.currentPrice);break;case SubType.Yearly:r=Strings.Upgrade.PerYear;qe=Ae.annualSubtotal;Ge=Ae.annualTax;_e=Ae.annualTotal;n=at(qe-Ae.currentPrice);break}l.text("+ "+Currency.FormatCurrency(n,true)+t);var a=st(Ae.refundAmount);i=i.replace("{RENEWAL_AMOUNT}",""+Currency.FormatCurrency(qe)+r).replace("{REFUND_AMOUNT}",""+Currency.FormatCurrency(a));d.text(i);d.show();Actions.Do(Actions.hideSpinner);if(typeof e==="function"){e()}};if(Ae!==null){t();Actions.Do(Actions.hideSpinner);return}API.getExpertQAPrices(function(e){if(e.status!==ResponseStatuses.Success){switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:e.currentPrice=Te.monthly.price.toFixed(2);break;case SubType.Quarterly:e.currentPrice=Te.quarterly.price.toFixed(2);break;case SubType.Yearly:e.currentPrice=Te.annual.price.toFixed(2);break}e.monthlyCode=Te.monthlyTutoring.code;e.monthlyPrice=Te.monthlyTutoring.price.toFixed(2);e.quarterlyCode=Te.quarterlyTutoring.code;e.quarterlyPrice=Te.quarterlyTutoring.price.toFixed(2);e.annualCode=Te.annualTutoring.code;e.annualPrice=Te.annualTutoring.price.toFixed(2)}Ae=e;t();Actions.Do(Actions.hideSpinner)})}else if(Ce){var t=function(){var t=Strings.Upgrade.PerMonth;var r="";var n="";var i=g.text();needToFetch=false;switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:case SubType.MonthlyExpertQA:r=Strings.Upgrade.PerMonth;qe=Ae.monthlySubtotal;Ge=Ae.monthlyTax;_e=Ae.monthlyTotal;n=ot(qe,Ae.currentPrice);break;case SubType.Quarterly:case SubType.QuarterlyExpertQA:r=Strings.Upgrade.Quarter;qe=Ae.quarterlySubtotal;Ge=Ae.quarterlyTax;_e=Ae.quarterlyTotal;n=it(qe-Ae.currentPrice);break;case SubType.Yearly:case SubType.YearlyExpertQA:r=Strings.Upgrade.PerYear;qe=Ae.annualSubtotal;Ge=Ae.annualTax;_e=Ae.annualTotal;n=at(qe-Ae.currentPrice);break}f.text("+ "+Currency.FormatCurrency(n,true)+t);$includeExpertTutoringPrice.text("+ "+Currency.FormatCurrency(n,true)+t);var a=st(Ae.refundAmount);i=i.replace("{RENEWAL_AMOUNT}",""+Currency.FormatCurrency(qe)+r).replace("{REFUND_AMOUNT}",""+Currency.FormatCurrency(a));g.text(i);g.show();$includeExpertTutoringRefund.text(i);Actions.Do(Actions.hideSpinner);if(typeof e==="function"){e()}};if(Ae!==null){t();Actions.Do(Actions.hideSpinner);return}API.getTutoringPrices(function(e){if(e.status!==ResponseStatuses.Success){switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:e.currentPrice=Te.monthly.price.toFixed(2);break;case SubType.Quarterly:e.currentPrice=Te.quarterly.price.toFixed(2);break;case SubType.Yearly:e.currentPrice=Te.annual.price.toFixed(2);break}e.monthlyCode=Te.monthlyTutoring.code;e.monthlyPrice=Te.monthlyTutoring.price.toFixed(2);e.quarterlyCode=Te.quarterlyTutoring.code;e.quarterlyPrice=Te.quarterlyTutoring.price.toFixed(2);e.annualCode=Te.annualTutoring.code;e.annualPrice=Te.annualTutoring.price.toFixed(2)}Ae=e;Actions.Do(Actions.hideSpinner);t()})}else{var r=Te.monthly.price.toFixed(2);w.text(Currency.FormatCurrency(r));o.parent().show();if(STM.Tests.Quarterly.enabled()){var n=Te.quarterly.price;var i=(n/3).toFixed(2);var a=Strings.Upgrade.PriceQuarterly.replace("{PRICE}",Currency.FormatCurrency(n));C.text(Currency.FormatCurrency(i));I.text("("+a+")");I.css("display","block");s.parent().show()}else{var c=Te.annual.price.toFixed(2);var p=(c/12).toFixed(2);var h=Strings.Upgrade.PriceMonthly.replace("{PRICE}",Currency.FormatCurrency(p));S.text(Currency.FormatCurrency(c));H.text(Strings.Upgrade.PerYear);$annualPriceSave.text("("+h+")");$annualPriceSave.css("display","block");u.parent().show()}Actions.Do(Actions.hideSpinner)}};var nt=function(e){var t=Strings.Upgrade.LegalText;var r=t.replace("{UPGRADE_BUTTON}","<i>"+Strings.Upgrade.UpgradeTitle+"</i>").replace("{TERMS_LINK}",'<a href="'+App.urlPrefix+'terms" target="_blank">'+Strings.Upgrade.LegalTerms+"</a>").replace("{PRIVACY_LINK}",'<a href="'+App.urlPrefix+'privacy" target="_blank">'+Strings.Upgrade.LegalPrivacy+"</a>").replace("{RENEWAL_PRICE}",e);return r};var it=function(e){return(e/3).toFixed(2)};var at=function(e){return(e/12).toFixed(2)};var ot=function(e,t){return st(e-t)};var st=function(e){var t=parseFloat(Number(e).toFixed(2));return t*100%100===0?t.toFixed(0):t.toFixed(2)};var ut=function(){Jt();Qt();Tabbing.removeAllFields();document.querySelector("#pay-with-amazon-container").appendChild(Fe);e("#upgrade-default").hide();var t=Ce?"closed-upgrade-tutoring":"closed-upgrade";API.logTestEvent(t,Re,pt())};var lt=function(){if(Le)return;F.velocity("stop").velocity({opacity:1},{duration:150,easing:"easeOutQuad",display:"block"});Le=true};var ct=function(){if(!Le)return;F.velocity("stop").velocity({opacity:0},{duration:100,easing:"easeInQuad",display:"none"});Le=false};var pt=function(){if(Ce){switch(Auth.userstate.MWSubscriptionType){case SubType.Monthly:case SubType.MonthlyTutoring:return Te.monthlyTutoring.code;case SubType.Quarterly:case SubType.QuarterlyTutoring:return Te.quarterlyTutoring.code;case SubType.Yearly:case SubType.YearlyTutoring:return Te.annualTutoring.code}}else{if(o.is(":checked"))return Te.monthly.code;else if(s.is(":checked"))return Te.quarterly.code;else if(u.is(":checked"))return Te.annual.code}};var dt=function(){Actions.Do(Actions.showSpinner);ft();Ne=setTimeout(function(){Popup.spinner(Strings.Upgrade.Wait)},2e3)};var ft=function(){isLocked=true;ve[0].setAttribute("disabled","disabled");be[0].setAttribute("disabled","disabled")};var ht=function(){isLocked=false;ve[0].removeAttribute("disabled");be[0].removeAttribute("disabled")};var mt=function(){var t=true;me.removeClass("invalid");ge.removeClass("invalid");e(".recurly-hosted-field").removeClass("invalid");var r,n,i;if(Bt()){r=le;n=pe;i=fe}else{r=ce;n=de;i=he}r.removeClass("invalid");n.removeClass("invalid");i.removeClass("invalid");we.removeClass("invalid");if(me.val()===""){At(me,Strings.Upgrade.ErrorInvalid);t=false}if(ge.val()===""){At(ge,Strings.Upgrade.ErrorInvalid);t=false}if(ue.val()===""){At(ue,Strings.Upgrade.ErrorInvalid);t=false}if(!Ke||!Ke.fields.card.valid){At(e(".recurly-hosted-field"),Strings.Upgrade.ErrorInvalid);t=false}if(Ze()){var a=we.val();if(a===""||!Util.isRFC2822Email(a)){At(we,Strings.Upgrade.ErrorInvalid);t=false}}if(r.val()===""){At(r,Strings.Upgrade.ErrorInvalid);t=false}if(n.val()===""&&(Bt()||Ot())){At(n,Strings.Upgrade.ErrorInvalid);t=false}if(i.val()===""){if(Bt()||Ot()){At(i,Strings.Upgrade.ErrorInvalid);t=false}}else if(Bt()){var o=/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(i.val());if(o===false){At(i,Strings.Upgrade.ErrorInvalid);t=false}}return t};var gt=function(){i.find(".field-error").remove();i.find(".field .invalid").removeClass("invalid");if(!mt())return;Actions.Do(Actions.showSpinner);var e=we.val();API.signUpEmail(e,function(e){Actions.Do(Actions.hideSpinner);if(e.status===ResponseStatuses.Success){Auth.logInUS(e.userState.token,e.userState);vt()}else{switch(e.messageId){case ErrorCode.EmailTaken:Popup.showConfirm(Strings.Upgrade.ErrorEmailExists,function(){Kt();Popup.hideAll(true);setTimeout(function(){Popup.showLogin({onAuthReload:false,onAuthUpgradeDelayed:true})},250)},function(){At(we,Strings.Upgrade.ErrorInvalid)});break;default:At(we,Strings.Upgrade.ErrorInvalid);break}}})};var vt=function(){if(!Bt()){le.val("");pe.val("");fe.val("")}v.find(".field-error").remove();if(!mt())return;dt();Recurly.updateBilling(oe[0],function(e,t){Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User subscribed via Credit Card",eventLabel:WebStorage.anonUserId.get()});bt(e,t)})};var bt=function(e,t){if(e){Tt();xt(e)}else{Recurly.subscribe({purchasetype:"cc",tokenid:t.id,plancode:Ie.code,couponcode:Recurly.getCoupon(),actualcurrency:Currency.chosenCurrency.code},function(e){if(e.status<0){St(e.messageId)}Tt(e)})}};var yt=function(){var e="";var t="";if(Ie.code.includes("monthly-premium-expertqa")){t=Strings.Upgrade.PerMonth;e=Strings.Settings.ConfirmUpgradeMonthlyExpertQA}else if(Ie.code.includes("quarterly-premium-expertqa")){t=" "+Strings.Upgrade.PerQuarter;e=Strings.Settings.ConfirmUpgradeQuarterlyExpertQA}else if(Ie.code.includes("annual-premium-expertqa")){t=Strings.Upgrade.PerYear;e=Strings.Settings.ConfirmUpgradeAnnualExpertQA}var r=Currency.FormatCurrency(Ie.price)+t+" + "+Strings.Upgrade.PriceTax;e=e.replace("{PRICE}","("+r+")");Popup.showYesNo(e,function(){dt();Recurly.upgradeToExpertQA({plancode:Ie.code,refundTimestamp:Ae.refundTimestamp},function(e){if(e.status<0)St(e.messageId);kt(e)})})};var wt=function(){var e="";var t="";var e="";if(Ie.code.includes("monthly-premium-tutoring")){t=Strings.Upgrade.PerMonth;e=Strings.Settings.ConfirmUpgradeMonthlyTutoring}else if(Ie.code.includes("quarterly-premium-tutoring")){t=" "+Strings.Upgrade.PerQuarter;e=Strings.Settings.ConfirmUpgradeQuarterlyTutoring}else if(Ie.code.includes("annual-premium-tutoring")){t=Strings.Upgrade.PerYear;e=Strings.Settings.ConfirmUpgradeAnnualTutoring}var r=Currency.FormatCurrency(Ie.price)+t+" + "+Strings.Upgrade.PriceTax;e=e.replace("{PRICE}","("+r+")");Popup.showYesNo(e,function(){dt();Recurly.upgradeToTutoring({plancode:Ie.code,refundTimestamp:Ae.refundTimestamp},function(e){if(e.status<0)St(e.messageId);Mt(e)})})};var Ct=function(){var e=oneOffPurchaseQty>1?Strings.Upgrade.Sessions:Strings.Upgrade.Session;var t=Strings.Upgrade.UpgradeConfirmPurchase.replace("{PRICE}",Currency.FormatCurrency(We.toFixed(2))).replace("{CREDIT}",e).replace("{QUANTITY}","<strong>"+oneOffPurchaseQty+"</strong>");Popup.showYesNo(t,function(){dt();Recurly.purchaseTutoringCredits(Te.oneOffExpertPlan.code,function(e){if(e.status<0){St(e.messageId)}Et(e)})})};var St=function(e){ht();switch(e){case 83:Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"upgrade",eventAction:"blocked-ip",eventLabel:""});break}Popup.showError(API.serverError(e))};var xt=function(t){ht();var r=Bt()?fe:he;switch(t.code){case"invalid-parameter":case"validation":if(typeof t.fields!=="undefined")if(t.fields.length>0){t.fields.forEach(function(t,n){if(t==="number"||t==="month"||t==="year"||t==="cvv")At(e(".recurly-hosted-field"),Strings.Upgrade.ErrorInvalid);else if(t==="first_name")At(me,Strings.Upgrade.ErrorInvalid);else if(t==="last_name")At(ge,Strings.Upgrade.ErrorInvalid);else if(t==="postal_code")At(r,Strings.Upgrade.ErrorInvalid);else if(t==="address1")At(ue,Strings.Upgrade.ErrorInvalid)})}break;case"declined":Popup.showError(Strings.Upgrade.ErrorBillingDeclined);break;case"paypal-canceled":Popup.showError(Strings.Upgrade.ErrorBillingPaypalCanceled);break;case"paypal-error":Popup.showError(Strings.Upgrade.ErrorBillingPaypalError+" "+t.message);break;default:Popup.showError(t.message);break}};var At=function(t,r){t.addClass("invalid");if(t.next().hasClass("field-error"))return;var n=e("<div></div>").addClass("field-error");n.html(r);n.insertAfter(t)};var Tt=function(t,r){clearTimeout(Ne);Actions.Do(Actions.hideSpinner);if(typeof t!=="undefined"&&t!==null){if(t.status===1){Auth.logIn(t.userState.token,t.userState);e.publish("check/resolve");API.logTestEvent("upgrade-success",Re,pt());It()}else{ht();API.logTestEvent("upgrade-error",Re,pt())}}};var It=function(){WebStorage.afterOfferUpgrade.set("true");e.publish("upgrade/success",[Ce]);Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"upgrade",eventAction:"success",eventLabel:""});if(Ve.anonPurchase){e.publish("upgrade/anonPurchase");Popup.showSetPassword()}else{Popup.showUpgradeSuccess(function(){if(!Ce&&!Se){if(STM.Tests.CreditPackPurchase.enabled()){e.publish("splitTest/update")}var t=e("#settings-tab-container").length>0;if(t){WebStorage.showUpgradeFromSettings.set("true")}else if(App.upgradeAllowed()){StaticAdManager.evaluate(true);setTimeout(function(){Popup.showUpgrade({source:UpgradeSource.upgradeAfter})},UPGRADE_AFTER_TIMEOUT)}}})}};var Et=function(e){clearTimeout(Ne);Actions.Do(Actions.hideSpinner);if(typeof e!=="undefined"&&e!==null){if(e.status===1){API.logTestEvent("purchase-credit-success",Re,"credit");Pt()}else{ht();API.logTestEvent("purchase-credit-error",Re,"credit")}}};var Pt=function(){var t=e("#settings-tab-container").length>0;if(t){Util.reload();return}if(je){Popup.hide(true);var r={};r.DeviceString=App.deviceString();r=DtoHelper.InviteRequest({UserId:Auth.userstate.userId,Topic:{Id:Ve.Topic.Id,Text:Ve.Topic.Text},Type:ChatUserType.Student,DeviceString:App.deviceString(),AnonUserId:WebStorage.anonUserId.get(),Subject:Ve.Subject,Ascii:Ve.Ascii,MathML:Ve.MathML,SolutionId:Ve.SolutionId,Reason:InviteReason.UnableToSolve,Source:Ve.InviteSource});Actions.Do(Actions.studentRequestsTutor,r)}else{Popup.hide(true);var n=Strings.Chat.CreditsPurchased;e.publish("ChatLibrary/Insert",[{bubbles:[Chat.CreateBubble({content:n,genre:"notice",testContext:BubbleContext.Generic},{commitMessages:true})]}])}Actions.Do(Actions.gaEvent,{hitType:"event",eventCategory:"purchase-credit",eventAction:"success",eventLabel:""})};var kt=function(e,t){clearTimeout(Ne);Actions.Do(Actions.hideSpinner);if(typeof e!=="undefined"&&e!==null){if(e.status===ResponseStatuses.Success){Auth.logIn(e.userState.token,e.userState);var r="upgrade-expertqa-success";if(Oe===UpgradeSource.menu){r+="-menu"}else if(Oe===UpgradeSource.tutorBubble){r+="-bub"}else if(Oe===UpgradeSource.viewSteps){r+="-vs"}else if(Oe===UpgradeSource.expertQA){r+="-eqa"}API.logTestEvent(r,Re,pt());It()}else{ht();API.logTestEvent("upgrade-error",Re,pt())}}};var Mt=function(e,t){clearTimeout(Ne);Actions.Do(Actions.hideSpinner);if(typeof e!=="undefined"&&e!==null){if(e.status===1){Auth.logIn(e.userState.token,e.userState);var r="upgrade-tutoring-success";if(Oe===UpgradeSource.menu){r+="-menu"}else if(Oe===UpgradeSource.tutorBubble){r+="-bub"}else if(Oe===UpgradeSource.viewSteps){r+="-vs"}else if(Oe===UpgradeSource.expertQA){r+="-eqa"}API.logTestEvent(r,Re,pt());It()}else{ht();API.logTestEvent("upgrade-error",Re,pt())}}};e.subscribe("amazon/login",function(){amazonLoggedIn=true;zt(M)});e.subscribe("amazon/change",function(e){ke=e});var $t=function(){Be=e.subscribe("window/popupOpened",function(e){He=e});Recurly.paypal(pt(),function(e,t){He=null;Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User subscribed via PayPal",eventLabel:WebStorage.anonUserId.get()});bt(e,t)});e.unsubscribe(Be)};var Dt=function(){if(ke===false)return;if(!ke.consent){e(".amazon-validation-message").show();return}dt();Recurly.subscribe({purchasetype:"amazon",tokenid:ke.id,plancode:Ie.code,couponcode:Recurly.getCoupon(),actualcurrency:Currency.chosenCurrency.code},function(e){if(e.status<0){St(e.messageId)}else{Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User subscribed via Amazon",eventLabel:WebStorage.anonUserId.get()})}Tt(e)})};var Lt=function(){Re=0;O.fadeOut(function(){O=D;Tabbing.removeAllFields();P.siblings().removeClass("current");P.addClass("current");D.fadeIn(function(){Popup.center();if(Ie!==null){if(Ie.code.includes("annual")){u.siblings().removeClass("checked");u.siblings().prop("checked",false);u.addClass("checked");u.prop("checked",true)}else if(Ie.code.includes("quarterly")){s.siblings().removeClass("checked");s.siblings().prop("checked",false);s.addClass("checked");s.prop("checked",true)}else{o.siblings().removeClass("checked");o.siblings().prop("checked",false);o.addClass("checked");o.prop("checked",true)}}})})};var Rt=function(){const t=560;const r=.5625;var n=e("#tutoring-video iframe");var i=n.parent().width();if(t>i){n.attr({width:i,height:i*r})}Popup.center()};var Nt=function(){Re=1;switch(Ye){default:case t.CreditCard:$currentWrap=P;break;case t.PayPal:$currentWrap=k;break;case t.Amazon:$currentWrap=M;break;case t.ApplePay:$currentWrap=$;break}zt($currentWrap);O.fadeOut(function(){O=N;var t=Bt()?r:n;Tabbing.addFields(t);Recurly.configure();Ut(Ie.price,0,Ie.price);var i=e(".payment-options");var a=2;Gt(a);if(!Currency.CanUseAmazonPay()){$liAmazon.hide()}else{$liAmazon.show();Gt(++a)}if(Currency.CanUseApplePay()&&!Auth.isLoggedIn()&&STM.Tests.AnonymousPurchasing.enabled()){i.addClass("apple-pay-enabled");Gt(++a)}else if(Currency.CanUseApplePay()&&Auth.isLoggedIn()){_t(function(){Gt(++a)})}i.children().first().addClass("selected");Ft();if(Ze())ie.show();O.fadeIn(function(){Popup.center()})})};var Ut=function(e,t,r){var n=t>0;var i="";if(Ie===Te.monthly){i=Strings.Upgrade.PerMonth}else if(Ie===Te.quarterly){i=Strings.Upgrade.Quarter}else{i=Strings.Upgrade.PerYear}var a=Currency.FormatCurrency(e);ae.html(nt(a));if(n){var o=Currency.FormatCurrency(t);var s=Currency.FormatCurrency(r);x.html(Strings.Upgrade.ShowTotalPriceTaxes.replace("{SUBTOTAL}",a).replace("{TAX}",o).replace("{TOTAL}",s+i))}else{x.html(Strings.Upgrade.ShowTotalPrice.replace("{PRICE}",a+i))}};var Ft=function(){if(Bt())Ht();else qt()};var Ot=function(){return se.val()==="CA"};var Bt=function(){return se.val()==="US"};var Ht=function(){Tabbing.removeAllFields();Tabbing.addFields(r);G.find("input,select").removeAttr("data-recurly");G.hide();le.attr("data-recurly","city");pe.attr("data-recurly","state");fe.attr("data-recurly","postal_code");q.show()};var qt=function(){Tabbing.removeAllFields();Tabbing.addFields(n);q.find("input,select").removeAttr("data-recurly");q.hide();ce.attr("data-recurly","city");de.attr("data-recurly","state");he.attr("data-recurly","postal_code");G.show()};var Gt=function(t){var r=e(".payment-options");switch(t){case 4:r.removeClass("three-items").removeClass("two-items").addClass("four-items");break;case 3:r.removeClass("four-items").removeClass("two-items").addClass("three-items");break;case 2:default:r.removeClass("four-items").removeClass("three-items").addClass("two-items");break}};var _t=function(t){Recurly.applePay(e(".payment-options"),e(".payment-options [data-type=applepay]"),Ie.code,xt,function(e){if(!Ze()){Recurly.subscribe({purchasetype:"applepay",tokenid:e,plancode:Ie.code,couponcode:Recurly.getCoupon(),actualcurrency:Currency.chosenCurrency.code},function(e){if(e.status<0){St(e.messageId)}else{Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User subscribed via Apple Pay",eventLabel:WebStorage.anonUserId.get()})}Tt(e)})}},t)};var Wt=function(){if(!Auth.isLoggedIn()&&!STM.Tests.AnonymousPurchasing.enabled()){Popup.hideAll();Actions.Do(Actions.showSignUpUpgradeDelayed)}else{Nt()}};var zt=function(r){r.siblings().removeClass("selected");r.addClass("selected");y.fadeOut(function(){switch(e(".payment-options li.selected").attr("data-type")){case t.CreditCard:y=v;y.fadeIn(function(){jt()});break;case t.Amazon:y=b;y.fadeIn();break;case t.ApplePay:y.fadeOut(function(){y=v;y.fadeIn()});break}Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User selected Pay with Apple Pay",eventLabel:WebStorage.anonUserId.get()})})};var jt=function(){Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User selected Pay with Credit Card",eventLabel:WebStorage.anonUserId.get()})};var Vt=function(){if(De)return;De=true;zt(M);Actions.Do(Actions.gaEvent,{eventCategory:"upgrade",eventAction:"User selected Pay with Amazon",eventLabel:WebStorage.anonUserId.get()});$e=e.subscribe("window/popupOpened",function(e){Me=e});Fe.click();e("#pay-with-amazon img").trigger("click");e.unsubscribe($e);$e=null};var Qt=function(){if(Me&&typeof Me.close==="function"){Me.close();De=false}};var Yt=function(){window._open=window.open;window.open=Xt};var Xt=function(t,r,n){var i=window._open(t,r,n);e.publish("window/popupOpened",[i])};var Kt=function(){window.open=window._open};var Jt=function(){if(He!==null){He.close();He=null}}}(jQuery);Component.UserMenu=function(){var e=$.query("#top-menu .member-icon");var t=$.query("#user-menu");var r=$.query("body");var n;var i=t.css("display")!=="none"?true:false;var a=function(){if(!i){t.velocity({opacity:1},{display:"block",duration:100,easing:"easeOutQuad",complete:function(){r.addClass("clickable");n=$.subscribe("document/mouseup",s);i=true}})}};var o=function(){if(i){t.velocity({opacity:0},{display:"none",duration:50,easing:"easeInQuad",complete:function(){r.removeClass("clickable");$.unsubscribe(n);i=false}})}};var s=function(r){if(!t.is(r.target)&&t.has(r.target).length===0&&!e.is(r.target)&&e.has(r.target).length===0){o()}};e.on("click",function(){if(Auth.isLoggedIn()){Util.Redirect(App.urlPrefix+"settings");return}if(i!==true){a()}else{o()}});$.query("#user-menu .link").click(function(e){var t=e.currentTarget.getAttribute("href");var r=true;switch(t){case"#signin":Actions.Do(Actions.showLogin);o();break;case"#signup":Actions.Do(Actions.showSignUp);o();break}if(r)e.preventDefault()})};Component.ViewSteps=function(e){var t,r,n,i,a,o,s;var u,l,c,p,d,f;$.subscribe("ChatLibrary/ViewSteps",function(e){u=e;l=u.solutionId===c&&!Tutor.inChatRoom();c=u.solutionId;links=[];if(!l)d=u.freeTrialToken!==null;if(Auth.hasTutoringSubscription())d=false;if(typeof u.showProblemLink==="undefined")u.showProblemLink=true;Popup.showViewSteps(e.topicText);$(".popup-container:last").addClass("popup-view-steps")});$.subscribe("viewsteps/beforeShow",function(){t=document.getElementById("viewsteps-container");topic=document.getElementById("viewsteps-topic");r=document.getElementById("visitor-area");linkText=document.getElementById("visitor-link-text");var e=$(".popup-wrap:last")[0];if(!App.isMobile){a=document.createElement("div");a.setAttribute("id","visitor-popout");a.innerHTML='<i class="mw mw-pop-out"></i>';e.appendChild(a)}n=document.createElement("div");n.setAttribute("id","visitor-print");n.innerHTML='<i class="mw mw-print"></i>';e.appendChild(n);i=document.createElement("div");i.setAttribute("id","visitor-share");i.innerHTML='<i class="mw mw-problem-link"></i>';o=$("#steps-sbs-credits");s=$("#sbs-credit-count");if(u.showProblemLink)e.appendChild(i);if(Tutor.inChatRoom()){$(t).addClass("currently-tutoring")}else{$(t).removeClass("currently-tutoring")}$(r).on("click",".visitor-toggle-button",function(){y(this)});$(n).on("click",function(){window.print()});$(i).on("click",function(){Popup.showLink(c)});if(!App.isMobile){$(a).on("click",function(){w()})}if(l){r.innerHTML=p;g();if(!Tutor.inChatRoom())v(d);$(t).addClass("on");b()}else{h()}});var h=function(){Actions.Do(Actions.showSpinner);API.chatBotViewSteps(u.solutionId,u.topicId,u.topicText,u.customData,e,u.asciiMath,u.mathML,u.freeTrialToken,m)};var m=function(e){if(e===undefined||e.solutionhtml===undefined){r.innerHTML='<div class="steps-error">'+Strings.Errors.NullSteps+"</div ><div>"+Strings.Errors.NullSteps2.Replace("{SUPPORT_LINK}","<a href='https://mathway.zendesk.com/hc/"+WebStorage.culture.get().toLowerCase()+"/requests/new'>"+Strings.Errors.NullStepsSupportLink+"</a>.")+"</div>"}else{r.innerHTML=e.solutionhtml}if(e.isCreditSteps){App.SBSCredits=e.creditsRemaining;o.show();s.text(App.SBSCredits)}if(!d)d=e.tutorfreetrial;var a=false;if(d&&!Auth.hasSubscription()){var l=document.createElement("div");l.setAttribute("id","visitor-upgrade");var c=document.createElement("h5");c.innerText=Strings.ViewSteps.UpgradeText;l.appendChild(c);var f=document.createElement("a");f.setAttribute("id","visitor-upgrade-link");f.setAttribute("href","#");f.innerText=Strings.ViewSteps.UpgradeButton;l.appendChild(f);r.appendChild(l)}else{if(!Tutor.inChatRoom()&&e.showtutorlink)a=true}if(a){var h=document.createElement("div");h.setAttribute("id","visitor-callouts");if(!Auth.hasExpertSubscription()&&e.tutorfreetrial)h.setAttribute("class","visitor-tutor-free-trial");var m=document.createElement("h5");m.innerText=Strings.ViewSteps.TutorLinkTitle;var y=document.createElement("a");y.setAttribute("id","visitor-tutor-link");y.setAttribute("href","#");y.innerText=Strings.ViewSteps.ExpertLink;h.appendChild(m);h.appendChild(y);if(!Auth.hasExpertSubscription()){if(d){var w=document.createElement("div");w.setAttribute("class","free-trial-bar");w.innerText=Strings.ViewSteps.TutorLinkTrial;h.appendChild(w)}}r.appendChild(h);v(d)}var S=$(r).find(".visitor-bubbles").children(":not(.visitor-child-rows)").toArray();var x=document.getElementById("visitor-problem");S.push(x);MathJax.Hub.Queue(["Typeset",MathJax.Hub,S,function(){n.style.display="inline-block";i.style.display=(d||Auth.isLoggedIn())&&!u.presetProblem?"inline-block":"none";if(x){Util.AddClass("rendered",x)}C();p=r.innerHTML;g();Actions.Do(Actions.hideSpinner);$(t).addClass("on");b()}])};var g=function(){$("#visitor-upgrade-link").on("click",function(){Actions.Do(Actions.showUpgrade,{source:UpgradeSource.viewSteps})});$(".Explanation .GraphWrapper").each(function(){GraphBuilder.addGraphWrapper(this);$(this).on("click",function(e){e.preventDefault();var t=HtmlEntitites.encode(this.getAttribute("data-graph-input"));Actions.Do(Actions.openGraph,{graphInput:t})})})};var v=function(t){$(r).on("click","#visitor-tutor-link",function(r){r.preventDefault();Popup.hideAll(true);Actions.Do(Actions.askOurExperts,{subject:e,topicId:u.topicId,topicText:u.topicText,asciiMath:u.asciiMath,mathML:u.mathML,solutionId:u.solutionId,fromBubble:false,freeTrial:t,trialToken:u.freeTrialToken})})};var b=function(){i.style.display="block";n.style.display="block";if(!App.isMobile&&Tutor.inChatRoom()){a.style.display="block"}};var y=function(e){var t=$(e);var r=e.parentNode.nextElementSibling;var n=$(r);var i=r.nextElementSibling;var a=n.css("display");var o=e.querySelector("span");var s=function(){if(a==="none"){$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"block",duration:250,easing:"easeOutQuint",begin:function(){i.style.display="none"},complete:function(){n.css({height:"inherit"})}});API.clickMoreSteps(c);t.addClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){i.style.display=""}});t.removeClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionShowSteps}};var u=n.children(":not(.visitor-child-rows)").toArray();if(!n.hasClass("rendered")){MathJax.Hub.Queue(["Typeset",MathJax.Hub,u,function(){n.addClass("rendered");s();C()}])}else{s()}};var w=function(){var t={subject:e,asciitext:u.asciiMath,mathml:Base64.toBase64(u.mathML),topicid:u.topicId,topictext:u.topicText,solutionid:u.solutionId,platform:"web",culture:App.Culture.current,anonuserid:WebStorage.anonUserId.get(),userid:Auth.userstate!=null?Auth.userstate.userId:"",deviceid:App.deviceString(),version:"Web",freeTrialToken:"",showLineNumbers:Tutor.inChatRoom()};Util.OpenWindowWithPost("/StepsPopout/","width=400,height=600,left=100,top=100,resizable=yes,scrollbars=yes","NewFile",t)};var C=function(){$(".SyntheticDivision .mjx-full-width").removeClass("mjx-full-width");$(".gridExplanationTable .mjx-full-width").removeClass("mjx-full-width")};$.subscribe("auth/loggedin",function(){solutionId=null});$.subscribe("auth/loggedout",function(){solutionId=null});$.subscribe("subject/set",function(t){e=t});$.subscribe("viewsteps/clearcache",function(){c=null;p=null})};Component.WebWorker=function(){var e={};var t=App.baseUrl+App.urlPrefix+"service-worker.js";var r=false;var n=function(){try{navigator.serviceWorker.register(t).then(i).catch(function(e){Debug.error("unable to register service worker",e)})}catch(e){Debug.warn(e)}};var i=function(e){return new Promise(function(t,r){if(e.installing){e.installing.addEventListener("statechange",function(e){switch(e.target.state){case"installed":t();break;case"redundant":r();break;default:break}})}else{t()}})};var a=function(){var e=this;try{navigator.serviceWorker.getRegistrations().then(function(t){for(var r=0,n=t.length;r<n;r++){t[r].unregister().then(function(){return e.clients.matchAll()}).then(function(e){e.forEach(function(e){if(e.url&&"navigate"in e){e.navigate(e.url)}})})}})}catch(t){Debug.warn(t)}};e.init=function(){var e=navigator.serviceWorker;var t=App.baseUrl.indexOf("localhost")!==-1?true:false;if(e&&!t){if(r){n()}else{a()}}};return e}();Component.Apps.ViewSteps=function(e,t,r,n,i,a,o,s,u,l,c){if(typeof s==="undefined"){Debug.log("asciiText is undefined!!!!!!");return}s=Base64.fromBase64(s);var p=document.getElementById("visitor-problem");var d=document.getElementById("visitor-area");var f=$.query("#viewsteps-container");var h=f.find(".viewsteps-inner");var m=e;var g=$("#steps-sbs-credits");var v=$("#sbs-credit-count");GraphBuilder.widthFn=function(){var e=f.width()-80;if(e>450)e=450;return e};var b=t!==null&&t!=="";var y=i=="True";if(Auth.hasSubscription())b=false;$("#container").addClass("ios-scroll");if(r!==null&&r=="True")f.addClass("currently-tutoring");f.show();f.css("opacity",1);Actions.Do(Actions.showSpinner);$.subscribe("document/ready",function(){if(b&&App.ShowUpgradeInViewStepsApps()&&!Auth.hasSubscription()){var e=document.createElement("div");e.setAttribute("id","visitor-upgrade");var t=document.createElement("h5");t.innerText=Strings.ViewSteps.UpgradeText;e.appendChild(t);var a=document.createElement("a");a.setAttribute("id","visitor-upgrade-link");a.setAttribute("href","#");a.innerText=Strings.ViewSteps.UpgradeButton;e.appendChild(a);d.appendChild(e);$("#visitor-upgrade-link").on("touchend",function(){Actions.Do(Actions.showUpgrade,{source:UpgradeSource.viewSteps})})}if(l){App.SBSCredits=c;g.show();v.text(App.SBSCredits)}if(n=="True"&&r!=="True"){var o=document.createElement("div");o.setAttribute("id","visitor-callouts");if(y)o.setAttribute("class","visitor-tutor-free-trial");var s=document.createElement("h5");s.innerText=Strings.ViewSteps.TutorLinkTitle;var u=document.createElement("a");u.setAttribute("id","visitor-tutor-link");u.setAttribute("href","#");u.innerText=Strings.ViewSteps.ExpertLink;o.appendChild(s);o.appendChild(u);if(y){var f=document.createElement("div");f.setAttribute("class","free-trial-bar");f.innerText=Strings.ViewSteps.TutorLinkTrial;o.appendChild(f)}d.appendChild(o);C(i=="True")}var m=$(d).find(".visitor-bubbles").children(":not(.visitor-child-rows)").toArray();m.push(p);window.setTimeout(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub,m,function(){h.addClass("on");w();if(p!=null)Util.AddClass("rendered",p);Actions.Do(Actions.hideSpinner)}])},500)});var w=function(){$(".Explanation .GraphWrapper").each(function(){GraphBuilder.addGraphWrapper(this)})};$(d).on("click",".visitor-toggle-button",function(){S(this)});var C=function(e){$(d).on("click","#visitor-tutor-link",function(e){e.preventDefault();var t=function(e){Actions.Do(Actions.studentRequestsTutor,DtoHelper.InviteRequest({UserId:Auth.userstate.userId,Topic:{Id:a,Text:o},Type:ChatUserType.Student,DeviceString:App.deviceString(),Subject:u,Ascii:Base64.toBase64(s),SolutionId:m,Reason:InviteReason.UnableToSolve,Source:e}))};if(Auth.hasRole(UserRoles.TutoringAccess)){if(Auth.hasRole(UserRoles.Student)){t(TutorInviteSource.StudentViewSteps);
}else{t(TutorInviteSource.ViewSteps)}}else if(y&&Auth.userstate.MWSubscriptionSource!==SubSource.Recurly){t(TutorInviteSource.TrialViewSteps)}else if(Auth.userstate.MWSubscriptionSource===SubSource.Recurly){API.validateCredits(CreditType.Tutoring,function(e){if(y){t(TutorInviteSource.TrialViewSteps);return}if(e.status===1&&e.count>0){t(TutorInviteSource.CreditsViewSteps)}else{Actions.Do(Actions.showUpgrade,{source:UpgradeSource.viewSteps})}})}else{Actions.Do(Actions.showUpgrade,{source:UpgradeSource.viewSteps})}})};var S=function(e){var t=$(e);var r=e.parentNode.nextElementSibling;var n=$(r);var i=r.nextElementSibling;var a=n.css("display");var o=e.querySelector("span");var s=function(){if(a==="none"){$.Velocity(r,"stop");$.Velocity(r,"slideDown",{display:"inline-block",duration:250,easing:"easeOutQuint",begin:function(){i.style.display="none"},complete:function(){n.css({height:"auto"})}});API.clickMoreSteps(m);t.addClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionHideSteps}else{$.Velocity(r,"stop");$.Velocity(r,"slideUp",{display:"none",duration:250,easing:"easeInQuint",complete:function(){i.style.display=""}});t.removeClass("visitor-steps-open");if(o!==null)o.innerHTML=Strings.Chat.ActionShowSteps}};var u=n.children(":not(.visitor-child-rows)").toArray();if(!n.hasClass("rendered")){t.children(".visitor-bullet").addClass("rotating");MathJax.Hub.Queue(["Typeset",MathJax.Hub,u,function(){n.addClass("rendered");s();t.children(".visitor-bullet").removeClass("rotating")}])}else s()}};